/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(d){var c=0;return function(){return c<d.length?{done:!1,value:d[c++]}:{done:!0}}};$jscomp.arrayIterator=function(d){return{next:$jscomp.arrayIteratorImpl(d)}};$jscomp.makeIterator=function(d){var c="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];return c?c.call(d):$jscomp.arrayIterator(d)};$jscomp.arrayFromIterator=function(d){for(var c,f=[];!(c=d.next()).done;)f.push(c.value);return f};
$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};"undefined"==typeof _pio&&(_pio={});
(function(){_pio.channel=function(){};_pio.channel.prototype.call=function(d,c,f,l,a){var e="undefined"!=typeof PLAYERIO_API_HOST?PLAYERIO_API_HOST:(PlayerIO.useSecureApiRequests?"https":"http")+"://api.playerio.com/json/",b=new XMLHttpRequest;"withCredentials"in b?b.open("post",e,!0):"undefined"!=typeof XDomainRequest?(b=new XDomainRequest,b.open("post",e)):b=new _pio.flashWebRequest("post",e);var h=Error();null!=b?(b.send("["+d+"|"+(this.token||"")+"]"+JSON.stringify(c)),b.onload=function(){var k=
null;try{var g=b.response||b.responseText;if("["==g[0]){var m=g.indexOf("]");this.token=g.substring(1,m);g=g.substring(m+1)}k=JSON.parse(g)}catch(n){_pio.handleError(h,l,PlayerIOErrorCode.GeneralError,"Error decoding response from webservice: "+n);return}if("undefined"==typeof k.errorcode&&"undefined"==typeof k.message){g=k;if(a)try{g=a(k)}catch(n){_pio.handleError(h,l,n.code,n.message)}f&&f(g)}else _pio.handleError(h,l,k.errorcode,k.message)},b.onerror=function(k){_pio.handleError(h,l,PlayerIOErrorCode.GeneralError,
"Error talking to webservice: "+JSON.stringify(k))}):_pio.handleError(h,l,PlayerIOErrorCode.GeneralError,"Need to implement flash calling")};_pio.runCallback=function(d,c,f){try{d&&d(c)}catch(l){d="Unhandled error in callback: "+l.message,d=d+"\nStack:\n"+(l.stack||l.stacktrace||l.StackTrace),f&&(d=d+"\nCallsite stack:\n"+(f.stack||f.stacktrace||f.StackTrace)),console.log(d)}};_pio.handleError=function(d,c,f,l){f=_pio.error(f,l);d&&(d.stack&&(f.stack=d.stack),d.stacktrace&&(f.stacktrace=d.stacktrace),
d.StackTrace&&(f.StackTrace=d.StackTrace));c?_pio.runCallback(c,f,d):"undefined"!=typeof console?console.log("No error callback specified for: "+f.code+": "+f.message+"\n"+(f.stack||f.stacktrace||f.StackTrace)):alert("No error callback specified for: "+f.code+": "+f.message+"\n"+(f.stack||f.stacktrace||f.StackTrace))};_pio.error=function(d,c){1==arguments.length&&(c=d,d=PlayerIOErrorCode.GeneralError);"number"==typeof d&&(d=PlayerIOErrorCode.codes[d]);if("string"!=typeof d)throw console.log(d,c,Error().stack),
"Code must be a string!";var f=Error();return new PlayerIOError(d,c,f.stack||f.stacktrace||f.StackTrace)};_pio.debugLog=function(d){"undefined"!=typeof console&&console.log(d)};_pio.convertToKVArray=function(d){var c=[];if(d)for(var f in d)c.push({key:""+f,value:""+d[f]});return c};_pio.convertFromKVArray=function(d){var c={};if(d&&d.length)for(var f in d)c[d[f].key]=d[f].value;return c};_pio.convertToSegmentArray=function(d){var c=[];if(d)for(var f in d)c.push(f+":"+d[f]);return c}})();
PlayerIO={useSecureApiRequests:!1,authenticate:function(d,c,f,l,a,e){if("auto"==f.publishingnetworklogin)"undefined"==typeof window.PublishingNetwork?e(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Could not find the PublishingNetwork object on the current page. Did you include the PublishingNetwork.js script?")):PublishingNetwork.dialog("login",{gameId:d,connectionId:c,__use_usertoken__:!0},function(h){h.error?e(new PlayerIOError(PlayerIOErrorCode.GeneralError,h.error)):"undefined"==typeof h.userToken?
e(new PlayerIOError(PlayerIOErrorCode.GeneralError,"Missing userToken value in result, but no error message given.")):PlayerIO.authenticate(d,c,{userToken:h.userToken},l,a,e)});else{var b=new _pio.channel;b.authenticate(d,c,_pio.convertToKVArray(f),_pio.convertToSegmentArray(l),"javascript",_pio.convertToKVArray({}),null,a,e,function(h){b.token=h.token;return new _pio.client(b,d,h.gamefsredirectmap,h.userid)})}},quickConnect:null,gameFS:function(d){return new _pio.gameFS(d)}};var JSON;
JSON||(JSON={});
(function(){function d(g){return 10>g?"0"+g:g}function c(g){a.lastIndex=0;return a.test(g)?'"'+g.replace(a,function(m){var n=h[m];return"string"===typeof n?n:"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function f(g,m){var n,q=e,p=m[g];p&&"object"===typeof p&&"function"===typeof p.toJSON&&(p=p.toJSON(g));"function"===typeof k&&(p=k.call(m,g,p));switch(typeof p){case "string":return c(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);case "object":if(!p)return"null";
e+=b;var u=[];if("[object Array]"===Object.prototype.toString.apply(p)){var r=p.length;for(n=0;n<r;n+=1)u[n]=f(n,p)||"null";var t=0===u.length?"[]":e?"[\n"+e+u.join(",\n"+e)+"\n"+q+"]":"["+u.join(",")+"]";e=q;return t}if(k&&"object"===typeof k)for(r=k.length,n=0;n<r;n+=1){if("string"===typeof k[n]){var v=k[n];(t=f(v,p))&&u.push(c(v)+(e?": ":":")+t)}}else for(v in p)Object.prototype.hasOwnProperty.call(p,v)&&(t=f(v,p))&&u.push(c(v)+(e?": ":":")+t);t=0===u.length?"{}":e?"{\n"+e+u.join(",\n"+e)+"\n"+
q+"}":"{"+u.join(",")+"}";e=q;return t}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(g){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(g){return this.valueOf()});var l=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,b,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(g,m,n){var q;b=e="";if("number"===typeof n)for(q=0;q<n;q+=1)b+=" ";else"string"===typeof n&&(b=n);if((k=m)&&"function"!==typeof m&&("object"!==typeof m||"number"!==typeof m.length))throw Error("JSON.stringify");return f("",{"":g})});
"function"!==typeof JSON.parse&&(JSON.parse=function(g,m){function n(p,u){var r,t=p[u];if(t&&"object"===typeof t)for(r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var v=n(t,r);void 0!==v?t[r]=v:delete t[r]}return m.call(p,u,t)}g=String(g);l.lastIndex=0;l.test(g)&&(g=g.replace(l,function(p){return"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var q=eval("("+g+")");return"function"===typeof m?n({"":q},""):q}throw new SyntaxError("JSON.parse");})})();
(function(){function d(h){if(null!=a)h(a);else if(e)h(null);else if(null==b){b=[h];var k=setInterval(function(){var m=c();null!=m&&g(m)},50);setTimeout(function(){null==a&&g(null)},3E4);var g=function(m){a=m;e=null==m;clearInterval(k);for(var n=0;n!=b.length;n++)b[n](m)}}else b.push(h)}function c(){var h='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="10" height="10" style="$style$" id="$id$">\t<param name="movie" value="$src$" />\t<param name="allowNetworking" value="all" />\t<param name="allowScriptAccess" value="always" />\t\x3c!--[if !IE]>--\x3e\t<object type="application/x-shockwave-flash" data="$src$" width="10" height="10" style="$style$">\t\t<param name="allowNetworking" value="all" />\t\t<param name="allowScriptAccess" value="always" />\t</object>\t\x3c!--<![endif]--\x3e</object>'.replace(/\$id\$/gi,"__pio_flashfallback__");
h=h.replace(/\$src\$/gi,"http://192.168.30.154/html5client/FlashFallback/bin-debug/FlashFallback.swf");h=h.replace(/\$style\$/gi,"width:10px;height:10px");var k=document.getElementById("containerId");if(!k){var g=document.createElement("div");g.setAttribute("id",k);g.setAttribute("style","position:absolute;top:-20px;left:-20px");g.innerHTML=h;try{document.body.appendChild(g)}catch(m){}}h=function(m){m=document.getElementsByTagName(m);for(var n=0;n!=m.length;n++)if(m[n].ping&&"pong"==m[n].ping())return m[n]};
return h("embed")||h("object")}var f={},l=0;__pio_flashfallback_callback__=function(){var h=f[arguments[0]];if(h){for(var k=[],g=1;g!=arguments.length;g++)k[g-1]=arguments[g];h.apply(null,k)}};_pio.flashWebRequest=function(h,k){var g=this;this.response=null;this.onload=function(){};this.onerror=function(){};this.send=function(m){d(function(n){if(null==n)g.onerror("Browser does not support Cross-Origin (CORS) webrequest or Flash as a fallback method");else{var q="cb"+l++;f[q]=function(p,u){delete f[q];
if(p)g.response=u,g.onload();else g.onerror(u)};n.webrequest(q,h,k,m)}})}};_pio.flashSocketConnection=function(h,k,g,m,n){var q="cb"+l++,p=this,u=new _pio.messageSerializer,r=!1,t=!1,v=setTimeout(function(){r||(r=!0,g(!1,"Connect attempt timed out"))},k);this.disconnect=function(){console.log("... this shouldn't happen")};this.sendMessage=function(x){console.log("... send msg. this shouldn't happen")};d(function(x){null==x?(r=!0,g(!1,"Browser does not support WebSocket connections and the Flash fallback failed.")):
(f[q]=function(y,A){switch(y){case "onopen":r||(clearTimeout(v),t=r=!0,x.socketSend(q,[0]),g(t));break;case "onclose":p.disconnect();break;case "onerror":p.disconnect();break;case "onmessage":n(u.deserializeMessage(A,0,A.length))}},p.disconnect=function(){if(t){t=!1;m();try{x.socketClose(q)}catch(y){_pio.debugLog(y)}}},p.sendMessage=function(y){y=u.serializeMessage(y);x.socketSend(q,y)},x.socketConnection(q,h))})};_pio.isFlashFallbackEnabled=function(h){d(function(k){h(null!=k)})};var a=null,e=!1,
b=null})();
(function(){var d=_pio.channel.prototype;d.connect=function(c,f,l,a,e,b,h,k,g,m,n){this.call(10,{gameid:c,connectionid:f,userid:l,auth:a,partnerid:e,playerinsightsegments:b,clientapi:h,clientinfo:k},g,m,n)};_pio.ApiSecurityRule={RespectClientSetting:0,UseHttp:1,UseHttps:2};d.authenticate=function(c,f,l,a,e,b,h,k,g,m){this.call(13,{gameid:c,connectionid:f,authenticationarguments:l,playerinsightsegments:a,clientapi:e,clientinfo:b,playcodes:h},k,g,m)};d.createRoom=function(c,f,l,a,e,b,h,k){this.call(21,{roomid:c,
roomtype:f,visible:l,roomdata:a,isdevroom:e},b,h,k)};d.joinRoom=function(c,f,l,a,e,b){this.call(24,{roomid:c,joindata:f,isdevroom:l},a,e,b)};d.createJoinRoom=function(c,f,l,a,e,b,h,k,g){this.call(27,{roomid:c,roomtype:f,visible:l,roomdata:a,joindata:e,isdevroom:b},h,k,g)};d.listRooms=function(c,f,l,a,e,b,h,k){this.call(30,{roomtype:c,searchcriteria:f,resultlimit:l,resultoffset:a,onlydevrooms:e},b,h,k)};d.userLeftRoom=function(c,f,l,a,e,b){this.call(40,{extendedroomid:c,newplayercount:f,closed:l},
a,e,b)};d.writeError=function(c,f,l,a,e,b,h,k){this.call(50,{source:c,error:f,details:l,stacktrace:a,extradata:e},b,h,k)};d.updateRoom=function(c,f,l,a,e,b){this.call(53,{extendedroomid:c,visible:f,roomdata:l},a,e,b)};_pio.ValueType={String:0,Int:1,UInt:2,Long:3,Bool:4,Float:5,Double:6,ByteArray:7,DateTime:8,Array:9,Obj:10};d.createObjects=function(c,f,l,a,e){this.call(82,{objects:c,loadexisting:f},l,a,e)};d.loadObjects=function(c,f,l,a){this.call(85,{objectids:c},f,l,a)};_pio.LockType={NoLocks:0,
LockIndividual:1,LockAll:2};d.saveObjectChanges=function(c,f,l,a,e,b){this.call(88,{locktype:c,changesets:f,createifmissing:l},a,e,b)};d.deleteObjects=function(c,f,l,a){this.call(91,{objectids:c},f,l,a)};d.loadMatchingObjects=function(c,f,l,a,e,b,h){this.call(94,{table:c,index:f,indexvalue:l,limit:a},e,b,h)};d.loadIndexRange=function(c,f,l,a,e,b,h,k){this.call(97,{table:c,index:f,startindexvalue:l,stopindexvalue:a,limit:e},b,h,k)};d.deleteIndexRange=function(c,f,l,a,e,b,h){this.call(100,{table:c,
index:f,startindexvalue:l,stopindexvalue:a},e,b,h)};d.loadMyPlayerObject=function(c,f,l){this.call(103,{},c,f,l)};d.payVaultReadHistory=function(c,f,l,a,e,b){this.call(160,{page:c,pagesize:f,targetuserid:l},a,e,b)};d.payVaultRefresh=function(c,f,l,a,e){this.call(163,{lastversion:c,targetuserid:f},l,a,e)};d.payVaultConsume=function(c,f,l,a,e){this.call(166,{ids:c,targetuserid:f},l,a,e)};d.payVaultCredit=function(c,f,l,a,e,b){this.call(169,{amount:c,reason:f,targetuserid:l},a,e,b)};d.payVaultDebit=
function(c,f,l,a,e,b){this.call(172,{amount:c,reason:f,targetuserid:l},a,e,b)};d.payVaultBuy=function(c,f,l,a,e,b){this.call(175,{items:c,storeitems:f,targetuserid:l},a,e,b)};d.payVaultGive=function(c,f,l,a,e){this.call(178,{items:c,targetuserid:f},l,a,e)};d.payVaultPaymentInfo=function(c,f,l,a,e,b){this.call(181,{provider:c,purchasearguments:f,items:l},a,e,b)};d.payVaultUsePaymentInfo=function(c,f,l,a,e){this.call(184,{provider:c,providerarguments:f},l,a,e)};d.partnerPayTrigger=function(c,f,l,a,
e){this.call(200,{key:c,count:f},l,a,e)};d.partnerPaySetTag=function(c,f,l,a){this.call(203,{partnerid:c},f,l,a)};d.notificationsRefresh=function(c,f,l,a){this.call(213,{lastversion:c},f,l,a)};d.notificationsRegisterEndpoints=function(c,f,l,a,e){this.call(216,{lastversion:c,endpoints:f},l,a,e)};d.notificationsSend=function(c,f,l,a){this.call(219,{notifications:c},f,l,a)};d.notificationsToggleEndpoints=function(c,f,l,a,e,b){this.call(222,{lastversion:c,endpoints:f,enabled:l},a,e,b)};d.notificationsDeleteEndpoints=
function(c,f,l,a,e){this.call(225,{lastversion:c,endpoints:f},l,a,e)};d.gameRequestsSend=function(c,f,l,a,e,b){this.call(241,{requesttype:c,requestdata:f,requestrecipients:l},a,e,b)};d.gameRequestsRefresh=function(c,f,l,a){this.call(244,{playcodes:c},f,l,a)};d.gameRequestsDelete=function(c,f,l,a){this.call(247,{requestids:c},f,l,a)};d.achievementsRefresh=function(c,f,l,a){this.call(271,{lastversion:c},f,l,a)};d.achievementsLoad=function(c,f,l,a){this.call(274,{userids:c},f,l,a)};d.achievementsProgressSet=
function(c,f,l,a,e){this.call(277,{achievementid:c,progress:f},l,a,e)};d.achievementsProgressAdd=function(c,f,l,a,e){this.call(280,{achievementid:c,progressdelta:f},l,a,e)};d.achievementsProgressMax=function(c,f,l,a,e){this.call(283,{achievementid:c,progress:f},l,a,e)};d.achievementsProgressComplete=function(c,f,l,a){this.call(286,{achievementid:c},f,l,a)};d.playerInsightRefresh=function(c,f,l){this.call(301,{},c,f,l)};d.playerInsightSetSegments=function(c,f,l,a){this.call(304,{segments:c},f,l,a)};
d.playerInsightTrackInvitedBy=function(c,f,l,a,e){this.call(307,{invitinguserid:c,invitationchannel:f},l,a,e)};d.playerInsightTrackEvents=function(c,f,l,a){this.call(311,{events:c},f,l,a)};d.playerInsightTrackExternalPayment=function(c,f,l,a,e){this.call(314,{currency:c,amount:f},l,a,e)};d.playerInsightSessionKeepAlive=function(c,f,l){this.call(317,{},c,f,l)};d.playerInsightSessionStop=function(c,f,l){this.call(320,{},c,f,l)};d.oneScoreLoad=function(c,f,l,a){this.call(351,{userids:c},f,l,a)};d.oneScoreSet=
function(c,f,l,a){this.call(354,{score:c},f,l,a)};d.oneScoreAdd=function(c,f,l,a){this.call(357,{score:c},f,l,a)};d.oneScoreRefresh=function(c,f,l){this.call(360,{},c,f,l)};d.simpleConnect=function(c,f,l,a,e,b,h,k,g){this.call(400,{gameid:c,usernameoremail:f,password:l,playerinsightsegments:a,clientapi:e,clientinfo:b},h,k,g)};d.simpleRegister=function(c,f,l,a,e,b,h,k,g,m,n,q,p,u){this.call(403,{gameid:c,username:f,password:l,email:a,captchakey:e,captchavalue:b,extradata:h,partnerid:k,playerinsightsegments:g,
clientapi:m,clientinfo:n},q,p,u)};d.simpleRecoverPassword=function(c,f,l,a,e){this.call(406,{gameid:c,usernameoremail:f},l,a,e)};d.kongregateConnect=function(c,f,l,a,e,b,h,k,g){this.call(412,{gameid:c,userid:f,gameauthtoken:l,playerinsightsegments:a,clientapi:e,clientinfo:b},h,k,g)};d.simpleGetCaptcha=function(c,f,l,a,e,b){this.call(415,{gameid:c,width:f,height:l},a,e,b)};d.facebookOAuthConnect=function(c,f,l,a,e,b,h,k,g){this.call(418,{gameid:c,accesstoken:f,partnerid:l,playerinsightsegments:a,clientapi:e,
clientinfo:b},h,k,g)};d.steamConnect=function(c,f,l,a,e,b,h,k,g){this.call(421,{gameid:c,steamappid:f,steamsessionticket:l,playerinsightsegments:a,clientapi:e,clientinfo:b},h,k,g)};d.simpleUserGetSecureLoginInfo=function(c,f,l){this.call(424,{},c,f,l)};d.joinCluster=function(c,f,l,a,e,b,h,k,g,m,n,q,p,u,r,t,v){this.call(504,{clusteraccesskey:c,isdevelopmentserver:f,ports:l,machinename:a,version:e,machineid:b,os:h,cpu:k,cpucores:g,cpulogicalcores:m,cpuaddresswidth:n,cpumaxclockspeed:q,rammegabytes:p,
ramspeed:u},r,t,v)};d.serverHeartbeat=function(c,f,l,a,e,b,h,k,g,m,n,q,p,u,r,t,v,x,y,A){this.call(510,{serverid:c,appdomains:f,servertypes:l,machinecpu:a,processcpu:e,memoryusage:b,avaliablememory:h,freememory:k,runningrooms:g,usedresources:m,apirequests:n,apirequestserror:q,apirequestsfailed:p,apirequestsexecuting:u,apirequestsqueued:r,apirequeststime:t,serverunixtimeutc:v},x,y,A)};d.getGameAssemblyUrl=function(c,f,l,a,e,b){this.call(513,{clusteraccesskey:c,gamecodeid:f,machineid:l},a,e,b)};d.devServerLogin=
function(c,f,l,a,e){this.call(524,{username:c,password:f},l,a,e)};d.webserviceOnlineTest=function(c,f,l){this.call(533,{},c,f,l)};d.getServerInfo=function(c,f,l,a){this.call(540,{machineid:c},f,l,a)};d.socialRefresh=function(c,f,l){this.call(601,{},c,f,l)};d.socialLoadProfiles=function(c,f,l,a){this.call(604,{userids:c},f,l,a)}})();
PlayerIOError=function(d,c,f){this.code=d;this.message=c;this.stack=f;this.stack||(f=Error(),this.stack=f.stack||f.stacktrace||f.StackTrace);this.toString=function(){return"PlayerIOError["+d+"]: "+c}};PlayerIOError.prototype=Error();
PlayerIOErrorCode={UnsupportedMethod:"UnsupportedMethod",GeneralError:"GeneralError",InternalError:"InternalError",AccessDenied:"AccessDenied",InvalidMessageFormat:"InvalidMessageFormat",MissingValue:"MissingValue",GameRequired:"GameRequired",ExternalError:"ExternalError",ArgumentOutOfRange:"ArgumentOutOfRange",GameDisabled:"GameDisabled",UnknownGame:"UnknownGame",UnknownConnection:"UnknownConnection",InvalidAuth:"InvalidAuth",NoServersAvailable:"NoServersAvailable",RoomDataTooLarge:"RoomDataTooLarge",
RoomAlreadyExists:"RoomAlreadyExists",UnknownRoomType:"UnknownRoomType",UnknownRoom:"UnknownRoom",MissingRoomId:"MissingRoomId",RoomIsFull:"RoomIsFull",NotASearchColumn:"NotASearchColumn",QuickConnectMethodNotEnabled:"QuickConnectMethodNotEnabled",UnknownUser:"UnknownUser",InvalidPassword:"InvalidPassword",InvalidRegistrationData:"InvalidRegistrationData",InvalidBigDBKey:"InvalidBigDBKey",BigDBObjectTooLarge:"BigDBObjectTooLarge",BigDBObjectDoesNotExist:"BigDBObjectDoesNotExist",UnknownTable:"UnknownTable",
UnknownIndex:"UnknownIndex",InvalidIndexValue:"InvalidIndexValue",NotObjectCreator:"NotObjectCreator",KeyAlreadyUsed:"KeyAlreadyUsed",StaleVersion:"StaleVersion",CircularReference:"CircularReference",HeartbeatFailed:"HeartbeatFailed",InvalidGameCode:"InvalidGameCode",VaultNotLoaded:"VaultNotLoaded",UnknownPayVaultProvider:"UnknownPayVaultProvider",DirectPurchaseNotSupportedByProvider:"DirectPurchaseNotSupportedByProvider",BuyingCoinsNotSupportedByProvider:"BuyingCoinsNotSupportedByProvider",NotEnoughCoins:"NotEnoughCoins",
ItemNotInVault:"ItemNotInVault",InvalidPurchaseArguments:"InvalidPurchaseArguments",InvalidPayVaultProviderSetup:"InvalidPayVaultProviderSetup",UnknownPartnerPayAction:"UnknownPartnerPayAction",InvalidType:"InvalidType",IndexOutOfBounds:"IndexOutOfBounds",InvalidIdentifier:"InvalidIdentifier",InvalidArgument:"InvalidArgument",LoggedOut:"LoggedOut",InvalidSegment:"InvalidSegment",GameRequestsNotLoaded:"GameRequestsNotLoaded",AchievementsNotLoaded:"AchievementsNotLoaded",UnknownAchievement:"UnknownAchievement",
NotificationsNotLoaded:"NotificationsNotLoaded",InvalidNotificationsEndpoint:"InvalidNotificationsEndpoint",NetworkIssue:"NetworkIssue",OneScoreNotLoaded:"OneScoreNotLoaded",PublishingNetworkNotAvailable:"PublishingNetworkNotAvailable",PublishingNetworkNotLoaded:"PublishingNetworkNotLoaded",DialogClosed:"DialogClosed",AdTrackCheckCookie:"AdTrackCheckCookie",codes:{0:"UnsupportedMethod",1:"GeneralError",2:"InternalError",3:"AccessDenied",4:"InvalidMessageFormat",5:"MissingValue",6:"GameRequired",7:"ExternalError",
8:"ArgumentOutOfRange",9:"GameDisabled",10:"UnknownGame",11:"UnknownConnection",12:"InvalidAuth",13:"NoServersAvailable",14:"RoomDataTooLarge",15:"RoomAlreadyExists",16:"UnknownRoomType",17:"UnknownRoom",18:"MissingRoomId",19:"RoomIsFull",20:"NotASearchColumn",21:"QuickConnectMethodNotEnabled",22:"UnknownUser",23:"InvalidPassword",24:"InvalidRegistrationData",25:"InvalidBigDBKey",26:"BigDBObjectTooLarge",27:"BigDBObjectDoesNotExist",28:"UnknownTable",29:"UnknownIndex",30:"InvalidIndexValue",31:"NotObjectCreator",
32:"KeyAlreadyUsed",33:"StaleVersion",34:"CircularReference",40:"HeartbeatFailed",41:"InvalidGameCode",50:"VaultNotLoaded",51:"UnknownPayVaultProvider",52:"DirectPurchaseNotSupportedByProvider",54:"BuyingCoinsNotSupportedByProvider",55:"NotEnoughCoins",56:"ItemNotInVault",57:"InvalidPurchaseArguments",58:"InvalidPayVaultProviderSetup",70:"UnknownPartnerPayAction",80:"InvalidType",81:"IndexOutOfBounds",82:"InvalidIdentifier",83:"InvalidArgument",84:"LoggedOut",90:"InvalidSegment",100:"GameRequestsNotLoaded",
110:"AchievementsNotLoaded",111:"UnknownAchievement",120:"NotificationsNotLoaded",121:"InvalidNotificationsEndpoint",130:"NetworkIssue",131:"OneScoreNotLoaded",200:"PublishingNetworkNotAvailable",201:"PublishingNetworkNotLoaded",301:"DialogClosed",302:"AdTrackCheckCookie"}};
(function(){_pio.client=function(d,c,f,l){this.connectUserId=l;this.gameId=c;this.gameFS=new _pio.gameFS(c,f);this.errorLog=new _pio.errorLog(d);this.payVault=new _pio.payVault(d);this.bigDB=new _pio.bigDB(d);this.multiplayer=new _pio.multiplayer(d);this.gameRequests=new _pio.gameRequests(d);this.achievements=new _pio.achievements(d);this.playerInsight=new _pio.playerInsight(d);this.oneScore=new _pio.oneScore(d);this.notifications=new _pio.notifications(d);this.publishingNetwork=new _pio.publishingNetwork(d,
this.connectUserId)}})();
(function(){var d={};_pio.gameFS=function(c,f){if("string"==typeof f&&0<f.length){var l=(f||"").split("|");if(1<=l.length)for(var a=d[c.toLowerCase()]={},e=0;e!=l.length;e++){var b=l[e];"alltoredirect"==b||"cdnmap"==b?a.baseUrl=l[e+1]:"alltoredirectsecure"==b||"cdnmapsecure"==b?a.secureBaseUrl=l[e+1]:a["."+b]=l[e+1]}}this.getUrl=function(h,k){if("/"==!h[0])throw _pio.error("The path given to getUrl must start with a slash, like: '/myfile.swf' or '/folder/file.jpg'");var g=d[c];return g?(k?g.secureBaseUrl:
g.baseUrl)+(g["."+h]||h):(k?"https":"http")+"://r.playerio.com/r/"+c+h}}})();
(function(){_pio.gameRequests=function(d){function c(a){if(null==a||0==a.length)return[];for(var e=[],b=0;b!=a.length;b++){var h=a[b];e.push(new _pio.gameRequest(h.id,h.type,h.senderuserid,h.created,h.data))}return e}var f=[];this.waitingRequests="[ERROR: You tried to access gameRequests.waitingRequests before loading waiting requests. You have to call the refresh method first.]";var l=this;this.send=function(a,e,b,h,k){d.gameRequestsSend(a,_pio.convertToKVArray(e),b,h,k,function(g){})};this.refresh=
function(a,e){d.gameRequestsRefresh(f,a,e,function(b){l._playCodes=b.newplaycodes;l.waitingRequests=c(b.requests)})};this["delete"]=function(a,e,b){if("object"==typeof a||a.length){for(var h=[],k=0;k!=a.length;k++){var g=a[k].id;if(g)h.push(g);else{a=_pio.error("No GameRequest id found on item#"+k+". You have to use requests from the gameRequests.waitingRequests array. For instance: client.gameRequests.delete(client.gameRequests.waitingRequests, ...)");_pio.handleError(a,b,a.code,a.message);return}}d.gameRequestsDelete(h,
e,b,function(m){l.waitingRequests=c(m.requests)})}else a=_pio.error("The first argument to delete should be an array: client.gameRequests.delete([requests], ...)"),_pio.handleError(a,b,a.code,a.message)}};_pio.gameRequest=function(d,c,f,l,a){this.id=d;this.type=c;this.senderUserId=f;this.created=new Date(l);this.data=_pio.convertFromKVArray(a)}})();(function(){_pio.errorLog=function(d){this.writeError=function(c,f,l,a){d.writeError("Javascript",c,f,l,_pio.convertToKVArray(a))}}})();
(function(){_pio.quickConnect=function(){this.simpleGetCaptcha=function(d,c,f,l,a){(new _pio.channel).simpleGetCaptcha(d,c,f,l,a,function(e){return new _pio.simpleGetCaptchaOutput(e.captchakey,e.captchaimageurl)})};this.simpleRecoverPassword=function(d,c,f,l){(new _pio.channel).simpleRecoverPassword(d,c,f,l,function(a){})}};_pio.simpleGetCaptchaOutput=function(d,c){this.captchaKey=d;this.captchaImageUrl=c};PlayerIO.quickConnect=new _pio.quickConnect})();
(function(){_pio.payVault=function(d){function c(a){if(null!=a&&(f=a.version,l.coins=a.coins||0,l.items=[],a.items&&a.items.length))for(var e=0;e!=a.items.length;e++){var b=a.items[e],h=l.items[e]=new _pio.vaultItem(b.id,b.itemkey,(new Date).setTime(b.purchasedate));_pio.bigDBDeserialize(b.properties,h,!0)}}var f=null;this.coins="[ERROR: you tried to access payVault.coins before the vault was loaded. You have to refresh the vault before the .coins property is set to the right value]";this.items="[ERROR: you tried to access payVault.items before the vault was loaded. You have to refresh the vault before the .items property is set to the right value]";
this.has=function(a){if(null==f)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var e=0;e!=this.items.length;e++)if(this.items[e].itemKey==a)return!0;return!1};this.first=function(a){if(null==f)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var e=0;e!=this.items.length;e++)if(this.items[e].itemKey==a)return this.items[e];
return null};this.count=function(a){if(null==f)throw new PlayerIOError(PlayerIOErrorCode.VaultNotLoaded,"Cannot access items before vault has been loaded. Please refresh the vault first");for(var e=0,b=0;b!=this.items.length;b++)this.items[b].itemKey==a&&e++;return e};this.refresh=function(a,e){d.payVaultRefresh(f,null,a,e,function(b){c(b.vaultcontents)})};this.readHistory=function(a,e,b,h){d.payVaultReadHistory(a,e,null,b,h,function(k){for(var g=[],m=0;m!=k.entries.length;m++){var n=k.entries[m];
g.push(new _pio.payVaultHistoryEntry(n.type,n.amount,n.timestamp,n.itemkeys||[],n.reason,n.providertransactionid,n.providerprice))}return g})};this.credit=function(a,e,b,h){d.payVaultCredit(a,e,null,b,h,function(k){c(k.vaultcontents)})};this.debit=function(a,e,b,h){d.payVaultDebit(a,e,null,b,h,function(k){c(k.vaultcontents)})};this.consume=function(a,e,b){if("object"==typeof a||a.length){for(var h=[],k=0;k!=a.length;k++){var g=a[k].id;if(g)h.push(g);else{a=_pio.error("No PayVault item id found on item#"+
k+". You have to use items from the payVault.items array. For instance: client.payVault.consume([client.payVault.first('sportscar')], ...)");_pio.handleError(a,b,a.code,a.message);return}}d.payVaultConsume(h,null,e,b,function(m){c(m.vaultcontents)})}else a=_pio.error("The first argument to consume should be an array: client.payVault.consume([item], ...)"),_pio.handleError(a,b,a.code,a.message)};this.buy=function(a,e,b,h){d.payVaultBuy(_pio.convertBuyItems(a),e,null,b,h,function(k){c(k.vaultcontents)})};
this.give=function(a,e,b){d.payVaultGive(_pio.convertBuyItems(a),null,e,b,function(h){c(h.vaultcontents)})};this.getBuyCoinsInfo=function(a,e,b,h){d.payVaultPaymentInfo(a,_pio.convertToKVArray(e),null,b,h,function(k){return _pio.convertFromKVArray(k.providerarguments)})};this.getBuyDirectInfo=function(a,e,b,h,k){d.payVaultPaymentInfo(a,_pio.convertToKVArray(e),_pio.convertBuyItems(b),h,k,function(g){return _pio.convertFromKVArray(g.providerarguments)})};var l=this};_pio.convertBuyItems=function(d){if(null==
d)return[];for(var c=[],f=0;f!=d.length;f++){var l=d[f].itemkey;if(!l)throw _pio.error("You have to specify an itemkey for the payvault item. Example:  {itemkey:'car'}");c.push({itemkey:l,payload:_pio.compareForChanges({itemkey:l},d[f],!0,!0)})}return c};_pio.vaultItem=function(d,c,f){this.id=d;this.itemKey=c;this.purchaseDate=f};_pio.payVaultHistoryEntry=function(d,c,f,l,a,e,b){this.type=d;this.amount=c;this.timestamp=(new Date).setTime(f);this.itemKeys=l;this.reason=a;this.providerTransactionId=
e;this.providerPrice=b}})();
(function(){_pio.bigDB=function(d){function c(){for(var e=0;e<a.length;e++){var b=a[e],h=!0,k;for(k in b.objects)if(b.objects[k]._internal_("get-is-saving")){h=!1;break}if(h){for(k in b.objects)for(h=e+1;h<a.length;h++){futureSave=a[h];for(var g=0;g<futureSave.objects.length;g++)futureSave.objects[g]==b.objects[k]&&futureSave.fullOverwrite==b.fullOverwrite&&futureSave.useOptimisticLock==b.useOptimisticLock&&(b.changesets[k]=futureSave.changesets[g],b.futureSaves.push(futureSave))}a.splice(e,1);e--;
b.execute()}}}function f(e,b){null==e?e=[]:e instanceof Array||(e=[e]);null!=b&&(e=e.concat([b]));for(var h=[],k=0;k!=e.length;k++){var g=e[k];switch(typeof g){case "boolean":h.push({valuetype:_pio.ValueType.Bool,bool:g});break;case "string":h.push({valuetype:_pio.ValueType.String,string:g});break;case "number":0!=g%1?h.push({valuetype:_pio.ValueType.Double,"double":g}):-2147483648<g&&2147483647>g?h.push({valuetype:_pio.ValueType.Int,"int":g}):0<g&&4294967295>g?h.push({valuetype:_pio.ValueType.UInt,
uint:g}):h.push({valuetype:_pio.ValueType.Long,"long":g});break;case "object":if(g.getTime&&g.getMilliseconds)h.push({valuetype:_pio.ValueType.DateTime,datetime:g.getTime()});else throw Error("Don't know how to serialize type '"+typeof g+"' for BigDB");break;default:throw Error("Don't know how to serialize type '"+typeof g+"' for BigDB");}}return h}var l=this,a=[];this.createObject=function(e,b,h,k,g){var m=_pio.compareForChanges({},h||{},!0,!0);d.createObjects([{key:b,table:e,properties:m}],!1,k,
g,function(n){if(1==n.objects.length)return new _pio.databaseobject(l,e,n.objects[0].key,n.objects[0].version,!1,m);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.loadMyPlayerObject=function(e,b){d.loadMyPlayerObject(e,b,function(h){return new _pio.databaseobject(l,"PlayerObjects",h.playerobject.key,h.playerobject.version,!0,h.playerobject.properties)})};this.load=function(e,b,h,k){d.loadObjects([{table:e,keys:[b]}],h,k,function(g){if(1==g.objects.length)return null==
g.objects[0]?null:new _pio.databaseobject(l,e,g.objects[0].key,g.objects[0].version,!1,g.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error loading object");})};this.loadKeys=function(e,b,h,k){d.loadObjects([{table:e,keys:b}],h,k,function(g){for(var m=[],n=0;n!=g.objects.length;n++){var q=g.objects[n];m[n]=null==q?null:new _pio.databaseobject(l,e,q.key,q.version,!1,q.properties)}return m})};this.loadOrCreate=function(e,b,h,k){d.createObjects([{key:b,table:e,properties:[]}],
!0,h,k,function(g){if(1==g.objects.length)return new _pio.databaseobject(l,e,g.objects[0].key,g.objects[0].version,!1,g.objects[0].properties);throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"Error creating object");})};this.deleteKeys=function(e,b,h,k){d.deleteObjects([{table:e,keys:b}],h,k,function(g){return null})};this.loadKeysOrCreate=function(e,b,h,k){for(var g=[],m=0;m!=b.length;m++)g.push({key:b[m],table:e,properties:[]});d.createObjects(g,!0,h,k,function(n){for(var q=[],p=0;p!=n.objects.length;p++){var u=
n.objects[p];q[p]=new _pio.databaseobject(l,e,u.key,u.version,!1,u.properties)}return q})};this.loadSingle=function(e,b,h,k,g){d.loadMatchingObjects(e,b,f(h),1,k,g,function(m){return 0==m.objects.length?null:new _pio.databaseobject(l,e,m.objects[0].key,m.objects[0].version,!1,m.objects[0].properties)})};this.loadRange=function(e,b,h,k,g,m,n,q){d.loadIndexRange(e,b,f(h,k),f(h,g),m,n,q,function(p){for(var u=[],r=0;r!=p.objects.length;r++){var t=p.objects[r];u[r]=null==t?null:new _pio.databaseobject(l,
e,t.key,t.version,!1,t.properties)}return u})};this.deleteRange=function(e,b,h,k,g,m,n){d.deleteIndexRange(e,b,f(h,k),f(h,g),m,n,function(){})};this.saveChanges=function(e,b,h,k,g,m){var n=1==m;m=[];for(var q in h){var p=h[q];if(!(p.existsInDatabase&&p.key&&p.table&&p._internal_&&p.save)){e=_pio.error("You can only save database objects that exist in the database");_pio.handleError(e,g,e.code,e.message);return}var u=_pio.compareForChanges(b?{}:p._internal_("get-dbCurrent"),p,!0,!0);(b||0<u.length)&&
m.push({key:p._internal_("get-key"),table:p._internal_("get-table"),fulloverwrite:b,onlyifversion:e?p._internal_("get-version"):null,changes:u})}a.push({objects:h,changesets:m,fullOverwrite:b,useOptimisticLock:e,futureSaves:[],setIsSavingOnAll:function(r){for(var t=0;t!=this.objects.length;t++)this.objects[t]._internal_("set-is-saving",r)},done:function(){this.setIsSavingOnAll(!1);c()},execute:function(){var r=this;r.setIsSavingOnAll(!0);0<r.changesets.length?d.saveObjectChanges(_pio.LockType.LockAll,
r.changesets,n,k,function(t){r.done();_pio.handleError(t,g,t.code,t.message)},function(t){for(var v=0;v!=r.objects.length;v++){var x=r.objects[v];x._internal_("set-version",t.versions[v]);x._internal_("change-dbCurrent",r.changesets[v].changes);for(var y=0;y!=r.futureSaves.length;y++)for(var A=r.futureSaves[y],D=0;D<A.objects.length;D++)A.objects[D]==x&&(A.changesets.splice(D,1),A.objects.splice(D,1),D--)}r.done()}):(r.done(),setTimeout(k,1))}});c()}};_pio.databaseobject=function(d,c,f,l,a,e){var b=
{},h=!1;_pio.bigDBDeserialize(e,b,!0);this.table=c;this.key=f;this.existsInDatabase=!0;this.save=function(k,g,m,n){d.saveChanges(k,g,[this],m,n,a)};this._internal_=function(k,g){switch(k){case "get-table":return c;case "get-key":return f;case "set-is-saving":h=g;case "get-is-saving":return h;case "get-version":return l;case "set-version":l=g;case "get-dbCurrent":return b;case "change-dbCurrent":_pio.bigDBDeserialize(g,b,!0)}};_pio.bigDBDeserialize(e,this,!0)};_pio.compareForChanges=function(d,c,f,
l){var a=[],e;for(e in c){var b=c[e],h=d?d[e]:null;switch(e){case "table":if(l)continue;case "key":if(l)continue;case "save":if(l)continue;case "existsInDatabase":if(l)continue;case "_internal_":if(l)continue;case "_circular_reference_finder_":continue}if(null!=b){var k=f?{name:e}:{index:parseInt(e)};switch(typeof b){case "boolean":b!=h&&(k.value={valuetype:_pio.ValueType.Bool,bool:b},a.push(k));break;case "number":b!=h&&(isFinite(b)&&Math.floor(b)===b?k.value=-2147483648<=b&&2147483647>=b?{valuetype:_pio.ValueType.Int,
"int":b}:0<b&&4294967295>=b?{valuetype:_pio.ValueType.UInt,uint:b}:-0x7ffffffffffffc00<=b&&0x7ffffffffffffc00>=b?{valuetype:_pio.ValueType.Long,"long":b}:0<b&&1.844674407370955E19>=b?{valuetype:_pio.ValueType.ULong,ulong:b}:{valuetype:_pio.ValueType.Double,"double":b}:k.value={valuetype:_pio.ValueType.Double,"double":b},a.push(k));break;case "string":b!=h&&(k.value={valuetype:_pio.ValueType.String,string:b},a.push(k));break;case "object":if(b.getTime&&b.getMilliseconds)b+""!=h+""&&(k.value={valuetype:_pio.ValueType.DateTime,
datetime:b.getTime()},a.push(k));else{if(b._circular_reference_finder_)throw new PlayerIOError(PlayerIOErrorCode.CircularReference,"The object you're trying to save contains a circular reference for "+(f?"a property named":"the array entry")+"): "+e);b._circular_reference_finder_=!0;var g=b instanceof Array;if(g&&b.bytearray){g=Array(b.length);for(h=0;h!=g.length;h++){var m=b[h];if(0<=m&&255>=m)g[h]=m;else throw new PlayerIOError(PlayerIOErrorCode.GeneralError,"The bytearray property '"+e+"' was supposed to only contain byte (0-255) values, but contained the value: "+
m);}k.value={valuetype:_pio.ValueType.ByteArray,bytearray:g}}else h=_pio.compareForChanges(h,b,!g,!1),k.value=g?{valuetype:_pio.ValueType.Array,arrayproperties:h}:{valuetype:_pio.ValueType.Obj,objectproperties:h};a.push(k);delete b._circular_reference_finder_}break;case "undefined":break;case "function":break;default:throw Error("Don't know how to serialize type '"+typeof b+"' for BigDB");}}}for(e in d)null!=c[e]&&"undefined"!=typeof c[e]||a.push(f?{name:e}:{index:parseInt(e)});return a};_pio.bigDBDeserialize=
function(d,c,f){for(var l in d){var a=d[l],e=f?a.name:a.index||0;if(a=a.value)switch(a.valuetype||0){case _pio.ValueType.String:c[e]=a.string||"";break;case _pio.ValueType.Int:c[e]=a["int"]||0;break;case _pio.ValueType.UInt:c[e]=a.uint||0;break;case _pio.ValueType.Long:c[e]=a["long"]||0;break;case _pio.ValueType.Bool:c[e]=a.bool||0;break;case _pio.ValueType.Float:c[e]=a["float"]||0;break;case _pio.ValueType.Double:c[e]=a["double"]||0;break;case _pio.ValueType.ByteArray:c[e]=a.bytearray;c[e].bytearray=
!0;break;case _pio.ValueType.DateTime:c[e]=new Date(a.datetime||0);break;case _pio.ValueType.Array:var b=c[e]instanceof Array?c[e]:[];_pio.bigDBDeserialize(a.arrayproperties,b,!1);c[e]=b;break;case _pio.ValueType.Obj:b="object"==typeof c[e]?c[e]:{},_pio.bigDBDeserialize(a.objectproperties,b,!0),c[e]=b}else delete c[e]}}})();
(function(){_pio.multiplayer=function(f){var l=this;this.developmentServer=null;this.useSecureConnections=!1;this.createRoom=function(a,e,b,h,k,g){f.createRoom(a,e,b,_pio.convertToKVArray(h),null!=l.developmentServer,k,g,function(m){return m.roomid})};this.joinRoom=function(a,e,b,h){clearTimeout(setTimeout(function(){b(new _pio.connection)},1E4));var k=Error();f.joinRoom(a,_pio.convertToKVArray(e),null!=l.developmentServer,function(){},h,function(g){return new _pio.connection(k,l.developmentServer,
l.useSecureConnections,g.endpoints,g.joinkey,e||{},b,h)})};this.createJoinRoom=function(a,e,b,h,k,g,m){clearTimeout(setTimeout(function(){g(new _pio.connection)},1E4));var n=Error();f.createJoinRoom(a,e,b,_pio.convertToKVArray(h),_pio.convertToKVArray(k),null!=l.developmentServer,function(){},m,function(q){return new _pio.connection(n,l.developmentServer,l.useSecureConnections,q.endpoints,q.joinkey,k||{},g,m)})};this.listRooms=function(a,e,b,h,k,g){f.listRooms(a,_pio.convertToKVArray(e),b,h,null!=
l.developmentServer,k,g,function(m){var n=[];if(m.rooms&&0<m.rooms.length)for(var q=0;q!=m.rooms.length;q++){var p=m.rooms[q];n.push(new _pio.roomInfo(p.id,p.roomtype,p.onlineusers,_pio.convertFromKVArray(p.roomdata)))}return n})}};_pio.websocketConnection=function(f,l,a,e,b,h,k){var g=this,m=!1,n=new _pio.messageSerializer,q=!1,p=null;l=(l?"wss://":"ws://")+a+"/";try{p="undefined"!=typeof MozWebSocket?new MozWebSocket(l):new WebSocket(l)}catch(r){b(!1,""+r);return}var u=setTimeout(function(){m||
(m=!0,b(!1,"Connect attempt timed out"))},e);p.onopen=function(){m||(clearTimeout(u),q=m=!0,b(q))};p.onclose=function(r){g.disconnect()};p.onerror=function(r){g.disconnect()};p.onmessage=function(r){if(q)if(f){var t=new FileReader;t.onloadend=function(){for(var v=new Uint8Array(t.result),x=Array(v.length),y=0;y!=v.length;y++)x[y]=v[y];k(n.deserializeMessage(x,0,x.length))};t.readAsArrayBuffer(r.data)}else r=_pio.base64decode(r.data),k(n.deserializeMessage(r,0,r.length))};this.disconnect=function(){if(q){q=
!1;h();try{p.close()}catch(r){_pio.debugLog(r)}}};this.sendMessage=function(r){r=n.serializeMessage(r);if(f){for(var t=new Uint8Array(r.length),v=0;v<r.length;v++)t[v]=r[v];p.send(t.buffer)}else r=_pio.base64encode(r),p.send(r)}};_pio.connection=function(f,l,a,e,b,h,k,g){function m(y){function A(){if(0<M.length){var F=M[0];M.splice(0,1);var E=y(a,F,4E3,function(H,T){if(H){t=E;n.connected=!0;var P=n.createMessage("join");P.addString(b);if(null!=h)for(var ia in h)P.addString(ia),P.addString(""+h[ia]);
n.sendMessage(P)}else _pio.debugLog("Unable to connect to endpoint: "+F+'. reason: "'+T+(0<M.length?'". Trying next endpoint.':'". No more endpoints to try.')),A()},function(H){n.connected&&(n.connected=!1,setTimeout(function(){for(var T=0;T!=p.length;T++)_pio.runCallback(p[T].callback,n,p[T].stackSource)},100))},function(H){q?"playerio.joinresult"==H.type?(q=!1,H.getBoolean(0)?_pio.runCallback(k,n,null):_pio.handleError(f,g,H.getInt(1),H.getString(2))):_pio.handleError(f,g,PlayerIOErrorCode.GeneralError,
"The expected inital messagetype is: playerio.joinresult, received: "+joinResult.getType()):(D(H.type,H),D("*",H))})}else _pio.handleError(f,g,PlayerIOErrorCode.GeneralError,"Could not establish a socket connection to any of the given endpoints for the room")}function D(F,E){var H=u[F];if(H)for(var T=0;T<H.length;T++)_pio.runCallback(H[T].callback,E,H[T].stackSource)}var M=[];if(l)M.push(l);else for(var L=0;L!=e.length;L++)M.push(e[L].address+":"+e[L].port);A()}var n=this,q=!0,p=[],u={},r=[],t=null,
v=/(WebKit|Firefox|Trident)\/([0-9]+)/gi.exec(navigator.userAgent),x=v&&3<=v.length?v[1]:null;v=v&&3<=v.length?parseInt(v[2]):null;window.FileReader&&"WebKit"==x&&535<=v||"Firefox"==x&&11<=v||"Trident"==x&&6<=v?m(function(y,A,D,M,L,F){return new _pio.websocketConnection(!0,y,A,D,M,L,F)}):_pio.isFlashFallbackEnabled(function(y){y?m(function(A,D,M,L,F,E){return new _pio.flashSocketConnection(D,M,L,F,E)}):m(function(A,D,M,L,F,E){return new _pio.websocketConnection(!1,A,D,M,L,F,E)})});this.connected=
!1;this.addDisconnectCallback=function(y){p.push({callback:y,stackSourc:Error()})};this.addMessageCallback=function(y,A){null==y&&(y="*");var D=u[y];D||(u[y]=D=[]);D.push({callback:A,stackSource:Error()})};this.removeDisconnectCallback=function(y){for(var A=0;A<p.length;A++)p[A].callback==y&&(p.splice(A,1),A--)};this.removeMessageCallback=function(y){for(var A in u)for(var D=u[A],M=0;M<D.length;M++)D[M].callback==y&&(D.splice(M,1),M--)};this.createMessage=function(y){for(var A=new _pio.message(y),
D=1;D<arguments.length;D++)A.add(arguments[D]);return A};this.send=function(y){var A=this.createMessage.apply(this,arguments);this.sendMessage(A)};this.sendMessage=function(y){n.connected?t.sendMessage(y):r.push(y)};this.disconnect=function(){n.connected&&t.disconnect()}};_pio.message=function(f){function l(m,n,q,p){if(m)g.push(n),k.push(q),h.length=g.length;else throw _pio.error("The given value ("+n+") is not "+p);}function a(m,n){if(m>g.length)throw _pio.error("this message ("+h.type+") only has "+
g.length+" entries");if(k[m]==n)return g[m];throw _pio.error("Value at index:"+m+" is a "+e(k[m])+" and not a "+e(n)+" as requested. The value is: "+g[m]);}function e(m){return{0:"Integer",1:"Unsigned Integer",2:"Long",3:"Unsigned Long",4:"Double",5:"Float",6:"String",7:"ByteArray",8:"Boolean"}[m]}function b(m){var n="object"==typeof m&&"undefined"!=typeof m.length;if(n)for(var q=0;q!=m.length;q++)if(255<m[q]||0>m[q]){n=!1;break}return n}var h=this,k=[],g=[];this.type=f;this.length=0;this.add=function(){for(var m=
0;m<arguments.length;m++){var n=arguments[m];switch(typeof n){case "string":h.addString(n);break;case "boolean":h.addBoolean(n);break;case "number":if(isFinite(n)&&Math.floor(n)===n)if(-2147483648<=n&&2147483647>=n){h.addInt(n);break}else if(0<n&&4294967295>=n){h.addUInt(n);break}else if(-0x7ffffffffffffc00<=n&&0x7ffffffffffffc00>=n){h.addLong(n);break}else if(0<n&&1.844674407370955E19>=n){h.addULong(n);break}h.addDouble(n);break;case "object":if(b(n)){this.addByteArray(n);break}default:throw _pio.error("The type of the value ("+
n+") cannot be inferred");}}};this.addInt=function(m){l(-2147483648<=m&&2147483647>=m,Math.trunc(m),0,"an integer (32bit)")};this.addUInt=function(m){l(0<=m&&4294967295>=m,Math.trunc(m),1,"an unsigned integer (32bit)")};this.addLong=function(m){l(-0x7ffffffffffffc00<=m&&0x7ffffffffffffc00>=m,Math.trunc(m),2,"a long (64bit)")};this.addULong=function(m){l(0<=m&&1.844674407370955E19>=m,m,3,"an unsigned long (64bit)")};this.addBoolean=function(m){l(!0,m?!0:!1,8,"a boolean value")};this.addFloat=function(m){l(!0,
Number(m),5,"a floating point value (32bit)")};this.addDouble=function(m){l(!0,Number(m),4,"a double floating point value (64bit)")};this.addByteArray=function(m){l(b(m),m,7,"a bytearray")};this.addString=function(m){l(!0,m+"",6,"a string")};this.getInt=function(m){return a(m,0)};this.getUInt=function(m){return a(m,1)};this.getLong=function(m){return a(m,2)};this.getULong=function(m){return a(m,3)};this.getBoolean=function(m){return a(m,8)};this.getDouble=function(m){return a(m,4)};this.getFloat=
function(m){return a(m,5)};this.getByteArray=function(m){return a(m,7)};this.getString=function(m){return a(m,6)};this.toString=function(){for(var m="msg.Type = "+this.type,n=0;n!=this.length;n++)m+=", msg["+n+"] = "+g[n]+" ("+e(k[n])+")";return m};this._internal_=function(m,n){switch(m){case "get-objects":return g;case "get-types":return k}}};_pio.roomInfo=function(f,l,a,e){this.id=f;this.roomType=l;this.onlineUsers=a;this.roomData=e};_pio.byteWriter=function(){this.bytes=[];this.writeByte=function(f){if(0<=
f&&255>=f)this.bytes.push(f);else throw Error("This is not a byte value: "+f);};this.writeBytes=function(f){for(var l=0;l!=f.length;l++)this.writeByte(f[l])};this.writeTagWithLength=function(f,l,a){63<f||0>f?this.writeBottomPatternAndBytes(a,_pio.binaryserializer.bytesFromInt(f)):this.writeByte(l|f)};this.writeBottomPatternAndBytes=function(f,l){var a=0;0!=l[0]?a=3:0!=l[1]?a=2:0!=l[2]&&(a=1);this.writeByte(f|a);for(a=l.length-a-1;a!=l.length;a++)this.writeByte(l[a])};this.writeLongPattern=function(f,
l,a){for(var e=0,b=0;7!=b;b++)if(0!=a[b]){e=7-b;break}3<e?this.writeByte(l|e-4):this.writeByte(f|e);for(b=a.length-e-1;b!=a.length;b++)this.writeByte(a[b])}};_pio.messageSerializer=function(){this.serializeMessage=function(f){var l=new _pio.byteWriter;l.writeTagWithLength(f.length,128,4);var a=_pio.binaryserializer.bytesFromString(f.type);l.writeTagWithLength(a.length,192,12);l.writeBytes(a);for(var e=0;e!=f.length;e++)switch(a=f._internal_("get-objects")[e],f._internal_("get-types")[e]){case 6:a=
_pio.binaryserializer.bytesFromString(a);l.writeTagWithLength(a.length,192,12);l.writeBytes(a);break;case 0:l.writeTagWithLength(a,128,4);break;case 1:l.writeBottomPatternAndBytes(8,_pio.binaryserializer.bytesFromUInt(a));break;case 2:l.writeLongPattern(48,52,_pio.binaryserializer.bytesFromLong(a));break;case 3:l.writeLongPattern(56,60,_pio.binaryserializer.bytesFromULong(a));break;case 7:l.writeTagWithLength(a.length,64,16);l.writeBytes(a);break;case 4:l.writeByte(3);l.writeBytes(_pio.binaryserializer.bytesFromDouble(a));
break;case 5:l.writeByte(2);a=_pio.binaryserializer.bytesFromFloat(a);l.writeBytes(a);break;case 8:l.writeByte(a?1:0)}return l.bytes};this.deserializeMessage=function(f,l,a){var e=l;l+=a;a=null;for(var b=0;e<l;){var h=0,k=0,g=f[e];e++;var m=g&192;0==m&&(m=g&60,0==m&&(m=g));switch(m){case 12:case 16:h=(g&3)+1;if(e+h>l)throw Error("Unexpected: Unfinished message");g=h;h=_pio.binaryserializer.intFromBytes(f,e,h);e+=g;break;case 192:h=g&63;break;case 128:k=g&63;break;case 64:h=g&63;break;case 4:case 8:case 48:case 56:h=
(g&3)+1;break;case 52:case 60:h=(g&3)+5;break;case 3:h=8;break;case 2:h=4}if(e+h>l)throw Error("Unexpected: Unfinished message");switch(m){case 12:case 192:null==a?(a=new _pio.message(_pio.binaryserializer.stringFromBytes(f,e,h)),b++):a.addString(_pio.binaryserializer.stringFromBytes(f,e,h));break;case 4:k=_pio.binaryserializer.intFromBytes(f,e,h);case 128:0==b?b=k:a.addInt(k);break;case 16:case 64:a.addByteArray(f.slice(e,e+h));break;case 8:a.addUInt(_pio.binaryserializer.uintFromBytes(f,e,h));break;
case 48:case 52:a.addLong(_pio.binaryserializer.longFromBytes(f,e,h));break;case 56:case 60:a.addULong(_pio.binaryserializer.ulongFromBytes(f,e,h));break;case 3:a.addDouble(_pio.binaryserializer.doubleFromBytes(f,e,h));break;case 2:a.addFloat(_pio.binaryserializer.floatFromBytes(f,e,h));break;case 1:a.addBoolean(!0);break;case 0:a.addBoolean(!1)}e+=h;if(null!=a&&0==--b)return a}throw Error("Unexpected: Misaligned message");}};_pio.binaryserializer={pow2:function(f){return 0<=f&&31>f?1<<f:this.pow2[f]||
(this.pow2[f]=Math.pow(2,f))},_intEncode:function(f,l){if(4==l)var a=[f>>>24&255,f>>>16&255,f>>>8&255,f&255];else{if(0<=f){a=Math.floor(f/this.pow2(32));var e=f-a*this.pow2(32)}else a=Math.floor(f/this.pow2(32)),e=f-a*this.pow2(32),a+=this.pow2(32);a=[a>>>24&255,a>>>16&255,a>>>8&255,a&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255]}return a},_floatEncode:function(f,l,a){var e=0>f?1:0,b,h=~(-1<<a-1),k=1-h;0>f&&(f=-f);0===f?f=b=0:isNaN(f)?(b=2*h+1,f=1):Infinity===f?(b=2*h+1,f=0):(b=Math.floor(Math.log(f)/
Math.LN2),b>=k&&b<=h?(f=Math.floor((f*this.pow2(-b)-1)*this.pow2(l)),b+=h):(f=Math.floor(f/this.pow2(k-l)),b=0));for(h=[];8<=l;)h.push(f%256),f=Math.floor(f/256),l-=8;b=b<<l|f;for(a+=l;8<=a;)h.push(b&255),b>>>=8,a-=8;h.push(e<<a|b);h.reverse();return h},bytesFromString:function(f){for(var l=[],a=0;a<f.length;a++)if(127>=f.charCodeAt(a))l.push(f.charCodeAt(a));else for(var e=encodeURIComponent(f.charAt(a)).substr(1).split("%"),b=0;b<e.length;b++)l.push(parseInt(e[b],16));return l},bytesFromInt:function(f){return this._intEncode(f,
4)},bytesFromUInt:function(f){return this._intEncode(f,4)},bytesFromLong:function(f){return this._intEncode(f,8)},bytesFromULong:function(f){return this._intEncode(f,8)},bytesFromFloat:function(f){return this._floatEncode(f,23,8)},bytesFromDouble:function(f){return this._floatEncode(f,52,11)},_intDecode:function(f,l,a,e,b){var h=l+a-1;l=b&&a==e&&f[l]&128;e=0;b=1;for(var k=0;k<a;k++){var g=f[h-k];l&&(g=(g^255)+b,b=g>>8,g&=255);e+=g*this.pow2(8*k)}return l?-e:e},_float32Decode:function(f,l){var a=f.slice(l,
l+4).reverse(),e=1-2*(a[3]>>7),b=(a[3]<<1&255|a[2]>>7)-127;a=(a[2]&127)<<16|a[1]<<8|a[0];return 128===b?0!==a?NaN:Infinity*e:-127===b?e*a*this.pow2(-149):e*(1+a*this.pow2(-23))*this.pow2(b)},_float64Decode:function(f,l){var a=f.slice(l,l+8).reverse(),e=1-2*(a[7]>>7),b=((a[7]<<1&255)<<3|a[6]>>4)-1023;a=(a[6]&15)*this.pow2(48)+a[5]*this.pow2(40)+a[4]*this.pow2(32)+a[3]*this.pow2(24)+a[2]*this.pow2(16)+a[1]*this.pow2(8)+a[0];return 1024===b?0!==a?NaN:Infinity*e:-1023===b?e*a*this.pow2(-1074):e*(1+a*
this.pow2(-52))*this.pow2(b)},stringFromBytes:function(f,l,a){for(var e="",b=l;b<l+a;b++)e+=127>=f[b]?37===f[b]?"%25":String.fromCharCode(f[b]):"%"+f[b].toString(16).toUpperCase();return decodeURIComponent(e)},intFromBytes:function(f,l,a){return this._intDecode(f,l,a,4,!0)},uintFromBytes:function(f,l,a){return this._intDecode(f,l,a,4,!1)},longFromBytes:function(f,l,a){return this._intDecode(f,l,a,8,!0)},ulongFromBytes:function(f,l,a){return this._intDecode(f,l,a,8,!1)},floatFromBytes:function(f,l,
a){return 4==a?this._float32Decode(f,l):NaN},doubleFromBytes:function(f,l,a){return 8==a?this._float64Decode(f,l):NaN}};for(var d=[],c=0;65!=c;c++)d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(c)]=c;_pio.base64encode=function(f){for(var l=[],a=0;a<f.length;a++){var e=f[a],b=++a<=f.length?f[a]:NaN,h=++a<=f.length?f[a]:NaN,k=e>>2;e=(e&3)<<4|b>>4;var g=(b&15)<<2|h>>6,m=h&63;isNaN(b)?g=m=64:isNaN(h)&&(m=64);l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k));
l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m))}return l.join("")};_pio.base64decode=function(f){for(var l=[],a=0;a<f.length;a++){var e=d[f.charCodeAt(a)],b=++a<f.length?d[f.charCodeAt(a)]:64,h=++a<f.length?d[f.charCodeAt(a)]:64,k=++a<f.length?d[f.charCodeAt(a)]:64,g=(b&15)<<4|h>>2,m=(h&3)<<
6|k;l.push(e<<2|b>>4);64!=h&&(l.push(g),64!=k&&l.push(m))}return l}})();
(function(){_pio.achievements=function(d){function c(a,e){var b=new _pio.achievement(a.identifier,a.title,a.description,a.imageurl,a.progress,a.progressgoal,a.lastupdated);if("string"!==typeof l.myAchievements)for(var h=0;h<l.myAchievements.length;h++)l.myAchievements[h].id==b.id&&(l.myAchievements[h]=b,l.currentVersion=null);if(e)for(h=0;h<l.onCompleteHandlers.length;h++)(0,l.onCompleteHandlers[h])(b);return b}var f=null;this.myAchievements="[ERROR: You tried to access achievements.myAchievements before loading them. You have to call the refresh method first.]";
this.onCompleteHandlers=[];var l=this;this.addOnComplete=function(a){if("function"===typeof a&&1==a.length)l.onCompleteHandlers.push(a);else throw new PlayerIOError(PlayerIOErrorCode.InvalidArgument,"Expects argument to be a function that takes an achievement as an argument.");};this.get=function(a){if("string"===typeof l.myAchievements)return null;for(var e=0;e<l.myAchievements.length;e++)if(l.myAchievements[e].id==a)return l.myAchievements[e];return null};this.refresh=function(a,e){d.achievementsRefresh(f,
a,e,function(b){if(f!=b.version)if(f=b.version,null==b.achievements||0==b.achievements.length)l.myAchievements=[];else{for(var h=[],k=0;k<b.achievements.length;k++){var g=b.achievements[k];h.push(new _pio.achievement(g.identifier,g.title,g.description,g.imageurl,g.progress,g.progressgoal,g.lastupdated))}l.myAchievements=h}})};this.load=function(a,e,b){"object"==typeof a||requests.length?d.achievementsLoad(a,e,b,function(h){if(null==h||0==h.length)return{};for(var k={},g=0;g<h.userachievements.length;g++){for(var m=
h.userachievements[g],n=[],q=0;q<m.achievements.length;q++){var p=m.achievements[q];n.push(new _pio.achievement(p.identifier,p.title,p.description,p.imageurl,p.progress,p.progressgoal,p.lastupdated))}k[m.userid]=n}return k}):(a=_pio.error("The first argument to load should be an array: client.achievements.load(['user1', 'user2', ...], ...)"),_pio.handleError(a,b,a.code,a.message))};this.progressSet=function(a,e,b,h){d.achievementsProgressSet(a,e,b,h,function(k){return c(k.achievement,k.completednow)})};
this.progressAdd=function(a,e,b,h){d.achievementsProgressAdd(a,e,b,h,function(k){return c(k.achievement,k.completednow)})};this.progressMax=function(a,e,b,h){d.achievementsProgressMax(a,e,b,h,function(k){return c(k.achievement,k.completednow)})};this.progressComplete=function(a,e,b){d.achievementsProgressComplete(a,e,b,function(h){return c(h.achievement,h.completednow)})}};_pio.achievement=function(d,c,f,l,a,e,b){this.id=d;this.title=c;this.description=f;this.imageUrl=l;this.progress="undefined"===
typeof a?0:a;this.progressGoal=e;this.lastUpdated=new Date(1E3*b);this.progressRatio=this.progress/this.progressGoal;this.completed=this.progress==this.progressGoal}})();
(function(){_pio.playerInsight=function(d){function c(l){f.playersOnline=-1==l.playersonline?"[ERROR: The current connection does not have the rights required to read the playersonline variable.]":l.playersonline;f.segments=_pio.convertFromKVArray(l.segments)}this.playersOnline="[ERROR: You tried to access playerInsight.playersOnline before loading it. You have to call the refresh method first.]";this.segments={};var f=this;this.refresh=function(l,a){d.playerInsightRefresh(l,a,function(e){c(e.state)})};
this.setSegments=function(l,a,e){d.playerInsightSetSegments(_pio.convertToSegmentArray(l),a,e,function(b){c(b.state)})};this.trackInvitedBy=function(l,a,e,b){d.playerInsightTrackInvitedBy(l,a,e,b,function(h){})};this.trackEvent=function(l,a,e,b){d.playerInsightTrackEvents([{eventtype:l,value:a}],e,b,function(h){})};this.trackExternalPayment=function(l,a,e,b){d.playerInsightTrackExternalPayment(l,a,e,b,function(h){})};this.sessionKeepAlive=function(l,a){d.playerInsightSessionKeepAlive(l,a,function(e){})}}})();
(function(){_pio.oneScore=function(d){this.percentile="[ERROR: You tried to access oneScore.percentile before loading the OneScore. You have to call the refresh method first.]";this.score="[ERROR: You tried to access oneScore.score before loading the OneScore. You have to call the refresh method first.]";this.topRank="[ERROR: You tried to access oneScore.topRank before loading the OneScore. You have to call the refresh method first.]";var c=this;this.refresh=function(f,l){d.oneScoreRefresh(f,l,function(a){a=
new _pio.oneScoreValue(a.onescore.percentile,a.onescore.score,a.onescore.toprank);c.percentile=a.percentile;c.score=a.score;c.topRank=a.toprank})};this.set=function(f,l,a){d.oneScoreSet(f,l,a,function(e){e=new _pio.oneScoreValue(e.onescore.percentile,e.onescore.score,e.onescore.toprank);c.percentile=e.percentile;c.score=e.score;c.topRank=e.toprank;return e})};this.add=function(f,l,a){d.oneScoreAdd(f,l,a,function(e){e=new _pio.oneScoreValue(e.onescore.percentile,e.onescore.score,e.onescore.toprank);
c.percentile=e.percentile;c.score=e.score;c.topRank=e.toprank;return e})};this.load=function(f,l,a){if("object"==typeof f||requests.length)d.oneScoreLoad(f,l,a,function(e){if(null==e||null==e.onescores||0==e.onescores.length)return[];for(var b=[],h=0,k=0;k<f.length;k++){var g=e.onescores[h];g&&f[k]==g.userid?(b.push(new _pio.oneScoreValue(g.percentile,g.score,g.toprank)),h++):b.push(null)}return b});else l=_pio.error("The first argument to load should be an array: client.oneScore.load(['user1', 'user2', ...], ...)"),
_pio.handleError(l,a,l.code,l.message)}};_pio.oneScoreValue=function(d,c,f){this.percentile="undefined"===typeof d?0:d;this.score="undefined"===typeof c?0:c;this.topRank="undefined"===typeof f?0:f}})();
(function(){_pio.notifications=function(d){function c(e){if(e.version!=a){var b=[];if(e.endpoints)for(var h=0;h!=e.endpoints.length;h++){var k=e.endpoints[h];b[h]=new _pio.notificationEndpoint(k.type,k.identifier,_pio.convertFromKVArray(k.configuration),k.enabled?!0:!1)}a=e.version;l.myEndpoints=b}}function f(e){var b=[];if(e&&0<e.length)for(var h=0;h!=e.length;h++){var k=e[h];k.type&&k.identifier&&b.push({type:k.type,identifier:k.identifier})}return b}this.myEndpoints="[ERROR: You tried to access notifications.myEndpoints before calling refresh.]";
var l=this,a="";this.refresh=function(e,b){d.notificationsRefresh(a,e,b,c)};this.registerEndpoint=function(e,b,h,k,g,m){var n;a:{if(""!=a)for(n=0;n!=l.myEndpoints.length;n++){var q=l.myEndpoints[n];if(q.type==e&&q.identifier==b){n=q;break a}}n=null}(q=null==n||n.enabled!=k)||(q=JSON.stringify(n.configuration)!=JSON.stringify(h));q?d.notificationsRegisterEndpoints(a,[{type:e,identifier:b,configuration:_pio.convertToKVArray(h),enabled:k}],g,m,c):g&&g()};this.toggleEndpoints=function(e,b,h,k){e=f(e);
0<e.length?d.notificationsToggleEndpoints(a,e,b?!0:!1,h,k,c):h&&h()};this.deleteEndpoints=function(e,b,h){e=f(e);0<e.length?d.notificationsDeleteEndpoints(a,e,b,h,c):b&&b()};this.send=function(e,b,h){for(var k=[],g=0;g!=e.length;g++){var m=e[g],n={recipient:m.recipientUserId,endpointtype:m.endpointType,data:{}};0!=(n.recipient+"").length&&0!=(n.endpointtype+"").length||console.log("error");for(var q in m)"recipientUserId"!=q&&"endpointType"!=q&&(n.data[q]=m[q]);k[g]=n}0<k.length?d.notificationsSend(k,
b,h,null):b&&b()}};_pio.notificationEndpoint=function(d,c,f,l){this.type=d;this.identifier=c;this.configuration=f;this.enabled=l}})();
(function(){_pio.publishingNetwork=function(d,c){var f=this;this.profiles=new _pio.publishingNetworkProfiles(d);this.payments=new _pio.publishingNetworkPayments(d);this.relations=new _pio.publishingNetworkRelations(d,c,this);this.userToken="[ERROR: you tried to access publishingNetwork.userToken before calling publishingNetwork.refresh(callback)]";this.refresh=function(l,a){d.socialRefresh(l,a,function(e){f.userToken=e.myprofile.usertoken;f.profiles.myProfile=new _pio.publishingNetworkProfile(e.myprofile);
"undefined"==typeof _pio.friendLookup&&(_pio.friendLookup={},_pio.blockedLookup={});var b=_pio.friendLookup[f.profiles.myProfile.userId],h=_pio.blockedLookup[f.profiles.myProfile.userId];b||h||(b=_pio.friendLookup[f.profiles.myProfile.userId]={},h=_pio.blockedLookup[f.profiles.myProfile.userId]={});f.relations.friends=[];for(var k=0;k!=e.friends.length;k++){var g=new _pio.publishingNetworkProfile(e.friends[k]);f.relations.friends.push(g);b[g.userId]=!0}for(k=0;k!=e.blocked.length;k++)h[e.blocked[k]]=
!0})}};_pio.showDialog=function(d,c,f,l){if("undefined"==typeof window.PublishingNetwork)throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotAvailable,"PublishingNetwork.js was not found on the current page. You have to include the 'piocdn.com/publishingnetwork.js' on the containing page to show dialogs. See http://playerio.com/documentation/ for more information.");f.__apitoken__=c.token;window.PublishingNetwork.dialog(d,f,l)}})();
(function(){_pio.publishingNetworkPayments=function(d){this.showBuyCoinsDialog=function(c,f,l,a){f||(f={});f.coinamount=c;d.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(f),null,function(e){_pio.showDialog("buy",d,e,function(b){b.error?a(new PlayerIOError(PlayerIOErrorCode.GeneralError,b.error)):l(b)})},a,function(e){return _pio.convertFromKVArray(e.providerarguments)})};this.showBuyItemsDialog=function(c,f,l,a){d.payVaultPaymentInfo("publishingnetwork",_pio.convertToKVArray(f||{}),
_pio.convertBuyItems(c),function(e){_pio.showDialog("buy",d,e,function(b){b.error?a(new PlayerIOError(PlayerIOErrorCode.GeneralError,b.error)):l(b)})},a,function(e){return _pio.convertFromKVArray(e.providerarguments)})}}})();
(function(){_pio.publishingNetworkProfiles=function(d){this.myProfile="[ERROR: you tried to access publishingNetworkProfiles.myProfile before calling publishingNetwork.refresh(callback)]";this.showProfile=function(c,f){_pio.showDialog("profile",d,{userId:c},f)};this.loadProfiles=function(c,f,l){d.socialLoadProfiles(c,f,l,function(a){for(var e=[],b=0;b!=c.length;b++){var h=c[b];e[b]=null;for(var k=0;k!=a.profiles.length;k++){var g=a.profiles[k];if(g&&g.userid==h){e[b]=new _pio.publishingNetworkProfile(a.profiles[k]);
break}}}return e})}};_pio.publishingNetworkProfile=function(d){this.userId=d.userid;this.displayName=d.displayname;this.avatarUrl=d.avatarurl;this.lastOnline=new Date(d.lastonline);this.countryCode=d.countrycode}})();
(function(){_pio.publishingNetworkRelations=function(d,c,f){this.friends="[ERROR: you tried to access publishingNetworkRelations.friends before calling publishingNetwork.refresh(callback)]";this.isFriend=function(l){if("undefined"!=typeof _pio.friendLookup&&"undefined"!=typeof _pio.friendLookup[c])return _pio.friendLookup[c][l]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");
};this.isBlocked=function(l){if("undefined"!=typeof _pio.blockedLookup&&"undefined"!=typeof _pio.blockedLookup[c])return _pio.blockedLookup[c][l]||!1;throw new PlayerIOError(PlayerIOErrorCode.PublishingNetworkNotLoaded,"Cannot access profile, friends, ignored before Publishing Network has been loaded. Please refresh Publishing Network first");};this.showRequestFriendshipDialog=function(l,a){_pio.showDialog("requestfriendship",d,{userId:l},a)};this.showRequestBlockUserDialog=function(l,a){_pio.showDialog("requestblockuser",
d,{userId:l},function(){f.refresh(function(){a&&a()},function(){a&&a()})})};this.showFriendsManager=function(l){_pio.showDialog("friendsmanager",d,{},function(a){a.updated?f.refresh(function(){l&&l()},function(){l&&l()}):l&&l()})};this.showBlockedUsersManager=function(l){_pio.showDialog("blockedusersmanager",d,{},function(a){a.updated?f.refresh(function(){l&&l()},function(){l&&l()}):l&&l()})}}})();
(function(d,c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c(require("@popperjs/core")):"function"===typeof define&&define.amd?define(["@popperjs/core"],c):(d=d||self,d.tippy=c(d.Popper))})(this,function(d){function c(J){var W=document.createElement("style");W.textContent=J;W.setAttribute("data-tippy-stylesheet","");J=document.head;var ea=document.querySelector("head>style,head>link");ea?J.insertBefore(W,ea):J.appendChild(W)}function f(J,W,ea){return Array.isArray(J)?(J=
J[W],null==J?Array.isArray(ea)?ea[W]:ea:J):J}function l(J,W){var ea={}.toString.call(J);return 0===ea.indexOf("[object")&&-1<ea.indexOf(W+"]")}function a(J,W){return"function"===typeof J?J.apply(void 0,W):J}function e(J,W){if(0===W)return J;var ea;return function(ta){clearTimeout(ea);ea=setTimeout(function(){J(ta)},W)}}function b(J,W){var ea=Object.assign({},J);W.forEach(function(ta){delete ea[ta]});return ea}function h(J,W){-1===J.indexOf(W)&&J.push(W)}function k(J){return J.filter(function(W,ea){return J.indexOf(W)===
ea})}function g(J){return Object.keys(J).reduce(function(W,ea){void 0!==J[ea]&&(W[ea]=J[ea]);return W},{})}function m(){return document.createElement("div")}function n(J){return["Element","Fragment"].some(function(W){return l(J,W)})}function q(J){return n(J)?[J]:l(J,"NodeList")?[].slice.call(J):Array.isArray(J)?J:[].slice.call(document.querySelectorAll(J))}function p(J,W){J.forEach(function(ea){ea&&(ea.style.transitionDuration=W+"ms")})}function u(J,W){J.forEach(function(ea){ea&&ea.setAttribute("data-state",
W)})}function r(J){var W;J=[].concat(J)[0];return(null==J?0:null==(W=J.ownerDocument)?0:W.body)?J.ownerDocument:document}function t(J,W){var ea=W.clientX,ta=W.clientY;return J.every(function(ya){var Ia=ya.popperRect,Ea=ya.popperState;ya=ya.props.interactiveBorder;var Da=Ea.placement.split("-")[0];Ea=Ea.modifiersData.offset;if(!Ea)return!0;var Ca=ta-Ia.bottom-("top"===Da?Ea.bottom.y:0)>ya,Ja=Ia.left-ea+("right"===Da?Ea.left.x:0)>ya,Za=ea-Ia.right-("left"===Da?Ea.right.x:0)>ya;return Ia.top-ta+("bottom"===
Da?Ea.top.y:0)>ya||Ca||Ja||Za})}function v(J,W,ea){var ta=W+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(ya){J[ta](ya,ea)})}function x(){oa.isTouch||(oa.isTouch=!0,window.performance&&document.addEventListener("mousemove",y))}function y(){var J=performance.now();20>J-pa&&(oa.isTouch=!1,document.removeEventListener("mousemove",y));pa=J}function A(){var J=document.activeElement;if(J&&J._tippy&&J._tippy.reference===J){var W=J._tippy;J.blur&&!W.state.isVisible&&J.blur()}}function D(J){return[J+
"() was called on a"+("destroy"===J?"n already-":" ")+"destroyed instance. This is a no-op but","indicates a potential memory leak."].join(" ")}function M(J){return J.replace(/[ \t]{2,}/g," ").replace(/^[ \t]*/gm,"").trim()}function L(J){return[M("\n  %ctippy.js\n\n  %c"+M(J)+"\n\n  %c\ud83d\udc77\u200d This is a development-only message. It will be removed in production.\n  "),"color: #00C584; font-size: 1.3em; font-weight: bold;","line-height: 1.5","color: #a6a095;"]}function F(J,W){if(J&&!la.has(W)){var ea;
la.add(W);(ea=console).warn.apply(ea,L(W))}}function E(J,W){if(J&&!la.has(W)){var ea;la.add(W);(ea=console).error.apply(ea,L(W))}}function H(J){var W=!J,ea="[object Object]"===Object.prototype.toString.call(J)&&!J.addEventListener;E(W,["tippy() was passed","`"+String(J)+"`","as its targets (first) argument. Valid types are: String, Element, Element[], or NodeList."].join(" "));E(ea,"tippy() was passed a plain object which is not supported as an argument for virtual positioning. Use props.getReferenceClientRect instead.")}
function T(J){var W=(J.plugins||[]).reduce(function(ea,ta){var ya=ta.name,Ia=ta.defaultValue;ya&&(ea[ya]=void 0!==J[ya]?J[ya]:Ia);return ea},{});return Object.assign({},J,{},W)}function P(J,W){return(W?Object.keys(T(Object.assign({},ca,{plugins:W}))):ja).reduce(function(ea,ta){var ya=(J.getAttribute("data-tippy-"+ta)||"").trim();if(!ya)return ea;if("content"===ta)ea[ta]=ya;else try{ea[ta]=JSON.parse(ya)}catch(Ia){ea[ta]=ya}return ea},{})}function ia(J,W){var ea=Object.assign({},W,{content:a(W.content,
[J])},W.ignoreAttributes?{}:P(J,W.plugins));ea.aria=Object.assign({},ca.aria,{},ea.aria);ea.aria={expanded:"auto"===ea.aria.expanded?W.interactive:ea.aria.expanded,content:"auto"===ea.aria.content?W.interactive?null:"describedby":ea.aria.content};return ea}function R(J,W){void 0===J&&(J={});void 0===W&&(W=[]);Object.keys(J).forEach(function(ea){var ta=b(ca,Object.keys(V));(ta=!{}.hasOwnProperty.call(ta,ea))&&(ta=0===W.filter(function(ya){return ya.name===ea}).length);F(ta,["`"+ea+"`","is not a valid prop. You may have spelled it incorrectly, or if it's a plugin, forgot to pass it in an array as props.plugins. \n\n All props: https://atomiks.github.io/tippyjs/v6/all-props/\n Plugins: https://atomiks.github.io/tippyjs/v6/plugins/"].join(" "))})}
function ba(J){var W=m();!0===J?W.className="tippy-arrow":(W.className="tippy-svg-arrow",n(J)?W.appendChild(J):W.innerHTML=J);return W}function O(J,W){n(W.content)?(J.innerHTML="",J.appendChild(W.content)):"function"!==typeof W.content&&(W.allowHTML?J.innerHTML=W.content:J.textContent=W.content)}function C(J){J=J.firstElementChild;var W=[].slice.call(J.children);return{box:J,content:W.find(function(ea){return ea.classList.contains("tippy-content")}),arrow:W.find(function(ea){return ea.classList.contains("tippy-arrow")||
ea.classList.contains("tippy-svg-arrow")}),backdrop:W.find(function(ea){return ea.classList.contains("tippy-backdrop")})}}function z(J){function W(Ia,Ea){var Da=C(ea),Ca=Da.box,Ja=Da.content;Da=Da.arrow;Ea.theme?Ca.setAttribute("data-theme",Ea.theme):Ca.removeAttribute("data-theme");"string"===typeof Ea.animation?Ca.setAttribute("data-animation",Ea.animation):Ca.removeAttribute("data-animation");Ea.inertia?Ca.setAttribute("data-inertia",""):Ca.removeAttribute("data-inertia");Ca.style.maxWidth="number"===
typeof Ea.maxWidth?Ea.maxWidth+"px":Ea.maxWidth;Ea.role?Ca.setAttribute("role",Ea.role):Ca.removeAttribute("role");Ia.content===Ea.content&&Ia.allowHTML===Ea.allowHTML||O(Ja,J.props);Ea.arrow?Da?Ia.arrow!==Ea.arrow&&(Ca.removeChild(Da),Ca.appendChild(ba(Ea.arrow))):Ca.appendChild(ba(Ea.arrow)):Da&&Ca.removeChild(Da)}var ea=m(),ta=m();ta.className="tippy-box";ta.setAttribute("data-state","hidden");ta.setAttribute("tabindex","-1");var ya=m();ya.className="tippy-content";ya.setAttribute("data-state",
"hidden");O(ya,J.props);ea.appendChild(ta);ta.appendChild(ya);W(J.props,J.props);return{popper:ea,onUpdate:W}}function w(J,W){function ea(){var ha=fa.props.touch;return Array.isArray(ha)?ha:[ha,0]}function ta(){var ha;return!(null==(ha=fa.props.render)||!ha.$$tippy)}function ya(){var ha=($a||J).parentNode;return ha?r(ha):document}function Ia(ha){return fa.state.isMounted&&!fa.state.isVisible||oa.isTouch||Aa&&"focus"===Aa.type?0:f(fa.props.delay,ha?0:1,ca.delay)}function Ea(){Pa.style.pointerEvents=
fa.props.interactive&&fa.state.isVisible?"":"none";Pa.style.zIndex=""+fa.props.zIndex}function Da(ha,Ga,Ma){void 0===Ma&&(Ma=!0);ub.forEach(function(Wa){Wa[ha]&&Wa[ha].apply(void 0,Ga)});if(Ma){var Oa;(Oa=fa.props)[ha].apply(Oa,Ga)}}function Ca(){var ha=fa.props.aria;if(ha.content){var Ga="aria-"+ha.content,Ma=Pa.id;[].concat(fa.props.triggerTarget||J).forEach(function(Oa){var Wa=Oa.getAttribute(Ga);fa.state.isVisible?Oa.setAttribute(Ga,Wa?Wa+" "+Ma:Ma):(Wa=Wa&&Wa.replace(Ma,"").trim())?Oa.setAttribute(Ga,
Wa):Oa.removeAttribute(Ga)})}}function Ja(){!vb&&fa.props.aria.expanded&&[].concat(fa.props.triggerTarget||J).forEach(function(ha){fa.props.interactive?ha.setAttribute("aria-expanded",fa.state.isVisible&&ha===($a||J)?"true":"false"):ha.removeAttribute("aria-expanded")})}function Za(){ya().removeEventListener("mousemove",eb);Fa=Fa.filter(function(ha){return ha!==eb})}function Qa(ha){if(!oa.isTouch||!Sa&&"mousedown"!==ha.type)if(!fa.props.interactive||!Pa.contains(ha.target)){if(($a||J).contains(ha.target)){if(oa.isTouch||
fa.state.isVisible&&0<=fa.props.trigger.indexOf("click"))return}else Da("onClickOutside",[fa,ha]);!0===fa.props.hideOnClick&&(fa.clearDelayTimeouts(),fa.hide(),Ra=!0,setTimeout(function(){Ra=!1}),fa.state.isMounted||db())}}function Va(){Sa=!0}function Ba(){Sa=!1}function Xa(){var ha=ya();ha.addEventListener("mousedown",Qa,!0);ha.addEventListener("touchend",Qa,Z);ha.addEventListener("touchstart",Ba,Z);ha.addEventListener("touchmove",Va,Z)}function db(){var ha=ya();ha.removeEventListener("mousedown",
Qa,!0);ha.removeEventListener("touchend",Qa,Z);ha.removeEventListener("touchstart",Ba,Z);ha.removeEventListener("touchmove",Va,Z)}function Ha(ha,Ga){Ta(ha,function(){!fa.state.isVisible&&Pa.parentNode&&Pa.parentNode.contains(Pa)&&Ga()})}function Na(ha,Ga){Ta(ha,Ga)}function Ta(ha,Ga){function Ma(Wa){Wa.target===Oa&&(v(Oa,"remove",Ma),Ga())}var Oa=C(Pa).box;if(0===ha)return Ga();v(Oa,"remove",ab);v(Oa,"add",Ma);ab=Ma}function Ya(ha,Ga,Ma){void 0===Ma&&(Ma=!1);[].concat(fa.props.triggerTarget||J).forEach(function(Oa){Oa.addEventListener(ha,
Ga,Ma);bb.push({node:Oa,eventType:ha,handler:Ga,options:Ma})})}function hb(){"hold"===ea()[0]&&(Ya("touchstart",jb,{passive:!0}),Ya("touchend",Y,{passive:!0}));fa.props.trigger.split(/\s+/).filter(Boolean).forEach(function(ha){if("manual"!==ha)switch(Ya(ha,jb),ha){case "mouseenter":Ya("mouseleave",Y);break;case "focus":Ya(S?"focusout":"blur",na);break;case "focusin":Ya("focusout",na)}})}function gb(){bb.forEach(function(ha){ha.node.removeEventListener(ha.eventType,ha.handler,ha.options)});bb=[]}function jb(ha){var Ga,
Ma=!1;if(fa.state.isEnabled&&!qa(ha)&&!Ra){var Oa="focus"===(null==(Ga=Aa)?void 0:Ga.type);Aa=ha;$a=ha.currentTarget;Ja();!fa.state.isVisible&&l(ha,"MouseEvent")&&Fa.forEach(function(Wa){return Wa(ha)});"click"===ha.type&&(0>fa.props.trigger.indexOf("mouseenter")||La)&&!1!==fa.props.hideOnClick&&fa.state.isVisible?Ma=!0:sa(ha);"click"===ha.type&&(La=!Ma);Ma&&!Oa&&ma(ha)}}function Q(ha){var Ga=ha.target;Ga=($a||J).contains(Ga)||Pa.contains(Ga);"mousemove"===ha.type&&Ga||(Ga=ua().concat(Pa).map(function(Ma){var Oa,
Wa=null==(Oa=Ma._tippy.popperInstance)?void 0:Oa.state;return Wa?{popperRect:Ma.getBoundingClientRect(),popperState:Wa,props:X}:null}).filter(Boolean),t(Ga,ha)&&(Za(),ma(ha)))}function Y(ha){qa(ha)||0<=fa.props.trigger.indexOf("click")&&La||(fa.props.interactive?fa.hideWithInteractivity(ha):ma(ha))}function na(ha){0>fa.props.trigger.indexOf("focusin")&&ha.target!==($a||J)||fa.props.interactive&&ha.relatedTarget&&Pa.contains(ha.relatedTarget)||ma(ha)}function qa(ha){return oa.isTouch?"hold"===ea()[0]!==
0<=ha.type.indexOf("touch"):!1}function da(){ka();var ha=fa.props,Ga=ha.popperOptions,Ma=ha.placement,Oa=ha.offset,Wa=ha.getReferenceClientRect,qb=ha.moveTransition;ha=ta()?C(Pa).arrow:null;Wa=Wa?{getBoundingClientRect:Wa,contextElement:Wa.contextElement||$a||J}:J;Oa=[{name:"offset",options:{offset:Oa}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!qb}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",
requires:["computeStyles"],fn:function(nb){var pb=nb.state;if(ta()){var sb=C(Pa).box;["placement","reference-hidden","escaped"].forEach(function(rb){"placement"===rb?sb.setAttribute("data-placement",pb.placement):pb.attributes.popper["data-popper-"+rb]?sb.setAttribute("data-"+rb,""):sb.removeAttribute("data-"+rb)});pb.attributes.popper={}}}}];ta()&&ha&&Oa.push({name:"arrow",options:{element:ha,padding:3}});Oa.push.apply(Oa,(null==Ga?void 0:Ga.modifiers)||[]);fa.popperInstance=d.createPopper(Wa,Pa,
Object.assign({},Ga,{placement:Ma,onFirstUpdate:cb,modifiers:Oa}))}function ka(){fa.popperInstance&&(fa.popperInstance.destroy(),fa.popperInstance=null)}function ra(){var ha=fa.props.appendTo,Ga=$a||J;var Ma=fa.props.interactive&&ha===ca.appendTo||"parent"===ha?Ga.parentNode:a(ha,[Ga]);Ma.contains(Pa)||Ma.appendChild(Pa);da();F(fa.props.interactive&&ha===ca.appendTo&&Ga.nextElementSibling!==Pa,"Interactive tippy element may not be accessible via keyboard navigation because it is not directly after the reference element in the DOM source order. \n\n Using a wrapper <div> or <span> tag around the reference element solves this by creating a new parentNode context. \n\n Specifying `appendTo: document.body` silences this warning, but it assumes you are using a focus management solution to handle keyboard navigation. \n\n See: https://atomiks.github.io/tippyjs/v6/accessibility/#interactivity")}
function ua(){return[].slice.call(Pa.querySelectorAll("[data-tippy-root]"))}function sa(ha){fa.clearDelayTimeouts();ha&&Da("onTrigger",[fa,ha]);Xa();ha=Ia(!0);var Ga=ea(),Ma=Ga[0];Ga=Ga[1];oa.isTouch&&"hold"===Ma&&Ga&&(ha=Ga);ha?za=setTimeout(function(){fa.show()},ha):fa.show()}function ma(ha){fa.clearDelayTimeouts();Da("onUntrigger",[fa,ha]);fa.state.isVisible?0<=fa.props.trigger.indexOf("mouseenter")&&0<=fa.props.trigger.indexOf("click")&&0<=["mouseleave","mousemove"].indexOf(ha.type)&&La||((ha=
Ia(!1))?va=setTimeout(function(){fa.state.isVisible&&fa.hide()},ha):Ka=requestAnimationFrame(function(){fa.hide()})):db()}var X=ia(J,Object.assign({},ca,{},T(g(W)))),za,va,Ka,La=!1,Ra=!1,Sa=!1,Ua=!1,Aa,ab,cb,bb=[],eb=e(Q,X.interactiveDebounce),$a,ib=wa++,mb=k(X.plugins),fa={id:ib,reference:J,popper:m(),popperInstance:null,props:X,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:mb,clearDelayTimeouts:function(){clearTimeout(za);clearTimeout(va);cancelAnimationFrame(Ka)},
setProps:function(ha){F(fa.state.isDestroyed,D("setProps"));if(!fa.state.isDestroyed){Da("onBeforeUpdate",[fa,ha]);gb();var Ga=fa.props,Ma=ia(J,Object.assign({},fa.props,{},ha,{ignoreAttributes:!0}));fa.props=Ma;hb();Ga.interactiveDebounce!==Ma.interactiveDebounce&&(Za(),eb=e(Q,Ma.interactiveDebounce));Ga.triggerTarget&&!Ma.triggerTarget?[].concat(Ga.triggerTarget).forEach(function(Oa){Oa.removeAttribute("aria-expanded")}):Ma.triggerTarget&&J.removeAttribute("aria-expanded");Ja();Ea();tb&&tb(Ga,Ma);
fa.popperInstance&&(da(),ua().forEach(function(Oa){requestAnimationFrame(Oa._tippy.popperInstance.forceUpdate)}));Da("onAfterUpdate",[fa,ha])}},setContent:function(ha){fa.setProps({content:ha})},show:function(){F(fa.state.isDestroyed,D("show"));var ha=fa.state.isVisible,Ga=fa.state.isDestroyed,Ma=!fa.state.isEnabled,Oa=oa.isTouch&&!fa.props.touch,Wa=f(fa.props.duration,0,ca.duration);ha||Ga||Ma||Oa||($a||J).hasAttribute("disabled")||(Da("onShow",[fa],!1),!1!==fa.props.onShow(fa)&&(fa.state.isVisible=
!0,ta()&&(Pa.style.visibility="visible"),Ea(),Xa(),fa.state.isMounted||(Pa.style.transition="none"),ta()&&(ha=C(Pa),p([ha.box,ha.content],0)),cb=function(){var qb;if(fa.state.isVisible&&!Ua){Ua=!0;void 0;Pa.style.transition=fa.props.moveTransition;if(ta()&&fa.props.animation){var nb=C(Pa),pb=nb.box;nb=nb.content;p([pb,nb],Wa);u([pb,nb],"visible")}Ca();Ja();h(xa,fa);null==(qb=fa.popperInstance)?void 0:qb.forceUpdate();fa.state.isMounted=!0;Da("onMount",[fa]);fa.props.animation&&ta()&&Na(Wa,function(){fa.state.isShown=
!0;Da("onShown",[fa])})}},ra()))},hide:function(){F(fa.state.isDestroyed,D("hide"));var ha=!fa.state.isVisible,Ga=fa.state.isDestroyed,Ma=!fa.state.isEnabled,Oa=f(fa.props.duration,1,ca.duration);ha||Ga||Ma||(Da("onHide",[fa],!1),!1!==fa.props.onHide(fa)&&(fa.state.isVisible=!1,La=Ua=fa.state.isShown=!1,ta()&&(Pa.style.visibility="hidden"),Za(),db(),Ea(),ta()&&(Ga=C(Pa),ha=Ga.box,Ga=Ga.content,fa.props.animation&&(p([ha,Ga],Oa),u([ha,Ga],"hidden"))),Ca(),Ja(),fa.props.animation?ta()&&Ha(Oa,fa.unmount):
fa.unmount()))},hideWithInteractivity:function(ha){F(fa.state.isDestroyed,D("hideWithInteractivity"));ya().addEventListener("mousemove",eb);h(Fa,eb);eb(ha)},enable:function(){fa.state.isEnabled=!0},disable:function(){fa.hide();fa.state.isEnabled=!1},unmount:function(){F(fa.state.isDestroyed,D("unmount"));fa.state.isVisible&&fa.hide();fa.state.isMounted&&(ka(),ua().forEach(function(ha){ha._tippy.unmount()}),Pa.parentNode&&Pa.parentNode.removeChild(Pa),xa=xa.filter(function(ha){return ha!==fa}),fa.state.isMounted=
!1,Da("onHidden",[fa]))},destroy:function(){F(fa.state.isDestroyed,D("destroy"));fa.state.isDestroyed||(fa.clearDelayTimeouts(),fa.unmount(),gb(),delete J._tippy,fa.state.isDestroyed=!0,Da("onDestroy",[fa]))}};if(!X.render)return E(!0,"render() function has not been supplied."),fa;ib=X.render(fa);var Pa=ib.popper,tb=ib.onUpdate;Pa.setAttribute("data-tippy-root","");Pa.id="tippy-"+fa.id;fa.popper=Pa;J._tippy=fa;Pa._tippy=fa;var ub=mb.map(function(ha){return ha.fn(fa)}),vb=J.hasAttribute("aria-expanded");
hb();Ja();Ea();Da("onCreate",[fa]);X.showOnCreate&&sa();Pa.addEventListener("mouseenter",function(){fa.props.interactive&&fa.state.isVisible&&fa.clearDelayTimeouts()});Pa.addEventListener("mouseleave",function(ha){fa.props.interactive&&0<=fa.props.trigger.indexOf("mouseenter")&&(ya().addEventListener("mousemove",eb),eb(ha))});return fa}function B(J,W){void 0===W&&(W={});var ea=ca.plugins.concat(W.plugins||[]);H(J);R(W,ea);document.addEventListener("touchstart",x,Z);window.addEventListener("blur",
A);var ta=Object.assign({},W,{plugins:ea});ea=q(J);var ya=n(ta.content),Ia=1<ea.length;F(ya&&Ia,"tippy() was passed an Element as the `content` prop, but more than one tippy instance was created by this invocation. This means the content element will only be appended to the last tippy instance. \n\n Instead, pass the .innerHTML of the element, or use a function that returns a cloned version of the element instead. \n\n 1) content: element.innerHTML\n 2) content: () => element.cloneNode(true)");ea=
ea.reduce(function(Ea,Da){var Ca=Da&&w(Da,ta);Ca&&Ea.push(Ca);return Ea},[]);return n(J)?ea[0]:ea}function G(){var J=m();J.className="tippy-backdrop";u([J],"hidden");return J}function K(J){kb={clientX:J.clientX,clientY:J.clientY}}function N(J,W){var ea;return{popperOptions:Object.assign({},J.popperOptions,{modifiers:[].concat(((null==(ea=J.popperOptions)?void 0:ea.modifiers)||[]).filter(function(ta){return ta.name!==W.name}),[W])})}}function I(J,W,ea,ta){if(2>ea.length||null===J)return W;if(2===ea.length&&
0<=ta&&ea[0].left>ea[1].right)return ea[ta]||W;switch(J){case "top":case "bottom":W=ea[0];var ya=ea[ea.length-1],Ia="top"===J;ea=W.top;ta=ya.bottom;var Ea=Ia?W.left:ya.left;W=Ia?W.right:ya.right;return{top:ea,bottom:ta,left:Ea,right:W,width:W-Ea,height:ta-ea};case "left":case "right":var Da=Math.min.apply(Math,ea.map(function(Ja){return Ja.left})),Ca=Math.max.apply(Math,ea.map(function(Ja){return Ja.right}));ea=ea.filter(function(Ja){return"left"===J?Ja.left===Da:Ja.right===Ca});W=ea[0].top;ea=ea[ea.length-
1].bottom;return{top:W,bottom:ea,left:Da,right:Ca,width:Ca-Da,height:ea-W};default:return W}}function U(J,W){return J&&W?J.top!==W.top||J.right!==W.right||J.bottom!==W.bottom||J.left!==W.left:!0}var aa="undefined"!==typeof window&&"undefined"!==typeof document,S=/MSIE |Trident\//.test(aa?navigator.userAgent:""),Z={passive:!0,capture:!0},oa={isTouch:!1},pa=0;var la=new Set;var V={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ca=Object.assign({appendTo:function(){return document.body},
aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",
plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},V,{},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),ja=Object.keys(ca);z.$$tippy=!0;var wa=1,Fa=[],xa=[];B.defaultProps=ca;B.setDefaultProps=function(J){R(J,[]);Object.keys(J).forEach(function(W){ca[W]=J[W]})};B.currentInput=oa;var fb=Object.assign({},d.applyStyles,{effect:function(J){J=J.state;var W={popper:{position:J.options.strategy,
left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(J.elements.popper.style,W.popper);J.styles=W;J.elements.arrow&&Object.assign(J.elements.arrow.style,W.arrow)}}),ob={mouseover:"mouseenter",focusin:"focus",click:"click"},kb={clientX:0,clientY:0},lb=[];aa&&c('.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(.54,1.5,.38,1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:transparent;border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}');
B.setDefaultProps({plugins:[{name:"animateFill",defaultValue:!1,fn:function(J){var W;if(null==(W=J.props.render)||!W.$$tippy)return E(J.props.animateFill,"The `animateFill` plugin requires the default render function."),{};W=C(J.popper);var ea=W.box,ta=W.content,ya=J.props.animateFill?G():null;return{onCreate:function(){ya&&(ea.insertBefore(ya,ea.firstElementChild),ea.setAttribute("data-animatefill",""),ea.style.overflow="hidden",J.setProps({arrow:!1,animation:"shift-away"}))},onMount:function(){if(ya){var Ia=
ea.style.transitionDuration,Ea=Number(Ia.replace("ms",""));ta.style.transitionDelay=Math.round(Ea/10)+"ms";ya.style.transitionDuration=Ia;u([ya],"visible")}},onShow:function(){ya&&(ya.style.transitionDuration="0ms")},onHide:function(){ya&&u([ya],"hidden")}}}},{name:"followCursor",defaultValue:!1,fn:function(J){function W(){Da=!0;J.setProps({getReferenceClientRect:null});Da=!1}function ea(Qa){var Va=Qa.target?Ia.contains(Qa.target):!0,Ba=J.props.followCursor,Xa=Qa.clientX,db=Qa.clientY;Qa=Ia.getBoundingClientRect();
var Ha=Xa-Qa.left,Na=db-Qa.top;!Va&&J.props.interactive||J.setProps({getReferenceClientRect:function(){var Ta=Ia.getBoundingClientRect(),Ya=Xa,hb=db;"initial"===Ba&&(Ya=Ta.left+Ha,hb=Ta.top+Na);var gb="horizontal"===Ba?Ta.top:hb,jb="vertical"===Ba?Ta.right:Ya;hb="horizontal"===Ba?Ta.bottom:hb;Ta="vertical"===Ba?Ta.left:Ya;return{width:jb-Ta,height:hb-gb,top:gb,right:jb,bottom:hb,left:Ta}}})}function ta(){J.props.followCursor&&(lb.push({instance:J,doc:Ea}),Ea.addEventListener("mousemove",K))}function ya(){lb=
lb.filter(function(Qa){return Qa.instance!==J});0===lb.filter(function(Qa){return Qa.doc===Ea}).length&&Ea.removeEventListener("mousemove",K)}var Ia=J.reference,Ea=r(J.props.triggerTarget||Ia),Da=!1,Ca=!1,Ja=!0,Za=J.props;return{onCreate:ta,onDestroy:ya,onBeforeUpdate:function(){Za=J.props},onAfterUpdate:function(Qa,Va){var Ba=Va.followCursor;Da||void 0===Ba||Za.followCursor===Ba||(ya(),Ba?(ta(),!J.state.isMounted||Ca||"initial"===J.props.followCursor&&J.state.isVisible||Ea.addEventListener("mousemove",
ea)):(Ea.removeEventListener("mousemove",ea),W()))},onMount:function(){J.props.followCursor&&!Ca&&(Ja&&(ea(kb),Ja=!1),"initial"===J.props.followCursor&&J.state.isVisible||Ea.addEventListener("mousemove",ea))},onTrigger:function(Qa,Va){l(Va,"MouseEvent")&&(kb={clientX:Va.clientX,clientY:Va.clientY});Ca="focus"===Va.type},onHidden:function(){J.props.followCursor&&(W(),Ea.removeEventListener("mousemove",ea),Ja=!0)}}}},{name:"inlinePositioning",defaultValue:!1,fn:function(J){function W(){if(!Ia){var Da=
N(J.props,Ea);Ia=!0;J.setProps(Da);Ia=!1}}var ea=J.reference,ta,ya=-1,Ia=!1,Ea={name:"tippyInlinePositioning",enabled:!0,phase:"afterWrite",fn:function(Da){var Ca=Da.state;J.props.inlinePositioning&&(ta!==Ca.placement&&J.setProps({getReferenceClientRect:function(){return I(Ca.placement.split("-")[0],ea.getBoundingClientRect(),[].slice.call(ea.getClientRects()),ya)}}),ta=Ca.placement)}};return{onCreate:W,onAfterUpdate:W,onTrigger:function(Da,Ca){if(l(Ca,"MouseEvent")){var Ja=[].slice.call(J.reference.getClientRects()),
Za=Ja.find(function(Qa){return Qa.left-2<=Ca.clientX&&Qa.right+2>=Ca.clientX&&Qa.top-2<=Ca.clientY&&Qa.bottom+2>=Ca.clientY});ya=Ja.indexOf(Za)}},onUntrigger:function(){ya=-1}}}},{name:"sticky",defaultValue:!1,fn:function(J){function W(){var Ea=!0===J.props.sticky||"reference"===J.props.sticky?(J.popperInstance?J.popperInstance.state.elements.reference:ea).getBoundingClientRect():null,Da=!0===J.props.sticky||"popper"===J.props.sticky?ta.getBoundingClientRect():null;(Ea&&U(ya,Ea)||Da&&U(Ia,Da))&&J.popperInstance&&
J.popperInstance.update();ya=Ea;Ia=Da;J.state.isMounted&&requestAnimationFrame(W)}var ea=J.reference,ta=J.popper,ya=null,Ia=null;return{onMount:function(){J.props.sticky&&W()}}}}],render:z});B.createSingleton=function(J,W){function ea(){Ca=Da.map(function(Ha){return Ha.reference})}function ta(Ha){Da.forEach(function(Na){Ha?Na.enable():Na.disable()})}function ya(Ha){return Da.map(function(Na){var Ta=Na.setProps;Na.setProps=function(Ya){Ta(Ya);Na.reference===Ja&&Ha.setProps(Ya)};return function(){Na.setProps=
Ta}})}function Ia(Ha,Na){var Ta=Ca.indexOf(Na);if(Na!==Ja){Ja=Na;var Ya=(Za||[]).concat("content").reduce(function(hb,gb){hb[gb]=Da[Ta].props[gb];return hb},{});Ha.setProps(Object.assign({},Ya,{getReferenceClientRect:"function"===typeof Ya.getReferenceClientRect?Ya.getReferenceClientRect:function(){return Na.getBoundingClientRect()}}))}}var Ea;void 0===W&&(W={});E(!Array.isArray(J),["The first argument passed to createSingleton() must be an array of tippy instances. The passed value was",String(J)].join(" "));
var Da=J,Ca=[],Ja,Za=W.overrides,Qa=[],Va=!1;ta(!1);ea();var Ba=B(m(),Object.assign({},b(W,["overrides"]),{plugins:[{fn:function(){return{onDestroy:function(){ta(!0)},onHidden:function(){Ja=null},onClickOutside:function(Ha){Ha.props.showOnCreate&&!Va&&(Va=!0,Ja=null)},onShow:function(Ha){Ha.props.showOnCreate&&!Va&&(Va=!0,Ia(Ha,Ca[0]))},onTrigger:function(Ha,Na){Ia(Ha,Na.currentTarget)}}}}].concat(W.plugins||[]),triggerTarget:Ca,popperOptions:Object.assign({},W.popperOptions,{modifiers:[].concat((null==
(Ea=W.popperOptions)?void 0:Ea.modifiers)||[],[fb])})})),Xa=Ba.show;Ba.show=function(Ha){Xa();if(!Ja&&null==Ha)return Ia(Ba,Ca[0]);if(!Ja||null!=Ha){if("number"===typeof Ha)return Ca[Ha]&&Ia(Ba,Ca[Ha]);if(Da.includes(Ha))return Ia(Ba,Ha.reference);if(Ca.includes(Ha))return Ia(Ba,Ha)}};Ba.showNext=function(){var Ha=Ca[0];if(!Ja)return Ba.show(0);var Na=Ca.indexOf(Ja);Ba.show(Ca[Na+1]||Ha)};Ba.showPrevious=function(){var Ha=Ca[Ca.length-1];if(!Ja)return Ba.show(Ha);var Na=Ca.indexOf(Ja);Ba.show(Ca[Na-
1]||Ha)};var db=Ba.setProps;Ba.setProps=function(Ha){Za=Ha.overrides||Za;db(Ha)};Ba.setInstances=function(Ha){ta(!0);Qa.forEach(function(Na){return Na()});Da=Ha;ta(!1);ea();ya(Ba);Ba.setProps({triggerTarget:Ca})};Qa=ya(Ba);return Ba};B.delegate=function(J,W){function ea(Ba){if(Ba.target&&!Ca){var Xa=Ba.target.closest(Ja);if(Xa){var db=Xa.getAttribute("data-tippy-trigger")||W.trigger||ca.trigger;Xa._tippy||"touchstart"===Ba.type&&"boolean"===typeof Va.touch||"touchstart"!==Ba.type&&0>db.indexOf(ob[Ba.type])||
(Ba=B(Xa,Va))&&(Da=Da.concat(Ba))}}}function ta(Ba,Xa,db,Ha){void 0===Ha&&(Ha=!1);Ba.addEventListener(Xa,db,Ha);Ea.push({node:Ba,eventType:Xa,handler:db,options:Ha})}function ya(Ba){Ba=Ba.reference;ta(Ba,"touchstart",ea,Z);ta(Ba,"mouseover",ea);ta(Ba,"focusin",ea);ta(Ba,"click",ea)}function Ia(){Ea.forEach(function(Ba){Ba.node.removeEventListener(Ba.eventType,Ba.handler,Ba.options)});Ea=[]}E(!(W&&W.target),"You must specity a `target` prop indicating a CSS selector string matching the target elements that should receive a tippy.");
var Ea=[],Da=[],Ca=!1,Ja=W.target,Za=b(W,["target"]),Qa=Object.assign({},Za,{trigger:"manual",touch:!1}),Va=Object.assign({},Za,{showOnCreate:!0});Za=B(J,Qa);[].concat(Za).forEach(function(Ba){var Xa=Ba.destroy,db=Ba.enable,Ha=Ba.disable;Ba.destroy=function(Na){void 0===Na&&(Na=!0);Na&&Da.forEach(function(Ta){Ta.destroy()});Da=[];Ia();Xa()};Ba.enable=function(){db();Da.forEach(function(Na){return Na.enable()});Ca=!1};Ba.disable=function(){Ha();Da.forEach(function(Na){return Na.disable()});Ca=!0};
ya(Ba)});return Za};B.hideAll=function(J){J=void 0===J?{}:J;var W=J.exclude,ea=J.duration;xa.forEach(function(ta){var ya=!1;W&&(ya=W&&W._tippy&&W._tippy.reference===W?ta.reference===W:ta.popper===W.popper);ya||(ya=ta.props.duration,ta.setProps({duration:ea}),ta.hide(),ta.state.isDestroyed||ta.setProps({duration:ya}))})};B.roundArrow='<svg width="16" height="6" xmlns="http://www.w3.org/2000/svg"><path d="M0 6s1.796-.013 4.67-3.615C5.851.9 6.93.006 8 0c1.07-.006 2.148.887 3.343 2.385C14.233 6.005 16 6 16 6H0z"></svg>';
return B});
(function(d,c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define(c):function(){var f=d.Base64,l=c();l.noConflict=function(){d.Base64=f;return l};d.Meteor&&(Base64=l);d.Base64=l}()})("undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof global?global:this,function(){var d="function"===typeof atob,c="function"===typeof btoa,f="function"===typeof Buffer,l="function"===typeof TextDecoder?new TextDecoder:
void 0,a="function"===typeof TextEncoder?new TextEncoder:void 0,e=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),b=function(z){var w={};z.forEach(function(B,G){return w[B]=G});return w}(e),h=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,k=String.fromCharCode.bind(String),g="function"===typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(z,w){void 0===w&&(w=function(B){return B});return new Uint8Array(Array.prototype.slice.call(z,
0).map(w))},m=function(z){return z.replace(/=/g,"").replace(/[+\/]/g,function(w){return"+"==w?"-":"_"})},n=function(z){for(var w,B,G,K="",N=z.length%3,I=0;I<z.length;){if(255<(w=z.charCodeAt(I++))||255<(B=z.charCodeAt(I++))||255<(G=z.charCodeAt(I++)))throw new TypeError("invalid character found");w=w<<16|B<<8|G;K+=e[w>>18&63]+e[w>>12&63]+e[w>>6&63]+e[w&63]}return N?K.slice(0,N-3)+"===".substring(N):K},q=c?function(z){return btoa(z)}:f?function(z){return Buffer.from(z,"binary").toString("base64")}:
n,p=f?function(z){return Buffer.from(z).toString("base64")}:function(z){for(var w=[],B=0,G=z.length;B<G;B+=4096)w.push(k.apply(null,z.subarray(B,B+4096)));return q(w.join(""))},u=function(z,w){void 0===w&&(w=!1);return w?m(p(z)):p(z)},r=function(z){if(2>z.length){var w=z.charCodeAt(0);return 128>w?z:2048>w?k(192|w>>>6)+k(128|w&63):k(224|w>>>12&15)+k(128|w>>>6&63)+k(128|w&63)}w=65536+1024*(z.charCodeAt(0)-55296)+(z.charCodeAt(1)-56320);return k(240|w>>>18&7)+k(128|w>>>12&63)+k(128|w>>>6&63)+k(128|
w&63)},t=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,v=function(z){return z.replace(t,r)},x=f?function(z){return Buffer.from(z,"utf8").toString("base64")}:a?function(z){return p(a.encode(z))}:function(z){return q(v(z))},y=function(z,w){void 0===w&&(w=!1);return w?m(x(z)):x(z)};c=function(z){return y(z,!0)};var A=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,D=function(z){switch(z.length){case 4:return z=((7&z.charCodeAt(0))<<18|(63&z.charCodeAt(1))<<12|(63&z.charCodeAt(2))<<
6|63&z.charCodeAt(3))-65536,k((z>>>10)+55296)+k((z&1023)+56320);case 3:return k((15&z.charCodeAt(0))<<12|(63&z.charCodeAt(1))<<6|63&z.charCodeAt(2));default:return k((31&z.charCodeAt(0))<<6|63&z.charCodeAt(1))}},M=function(z){return z.replace(A,D)},L=function(z){z=z.replace(/\s+/g,"");if(!h.test(z))throw new TypeError("malformed base64.");z+="==".slice(2-(z.length&3));for(var w,B="",G,K,N=0;N<z.length;)w=b[z.charAt(N++)]<<18|b[z.charAt(N++)]<<12|(G=b[z.charAt(N++)])<<6|(K=b[z.charAt(N++)]),B+=64===
G?k(w>>16&255):64===K?k(w>>16&255,w>>8&255):k(w>>16&255,w>>8&255,w&255);return B},F=d?function(z){return atob(z.replace(/[^A-Za-z0-9\+\/]/g,""))}:f?function(z){return Buffer.from(z,"base64").toString("binary")}:L,E=f?function(z){return g(Buffer.from(z,"base64"))}:function(z){return g(F(z),function(w){return w.charCodeAt(0)})},H=function(z){return E(P(z))},T=f?function(z){return Buffer.from(z,"base64").toString("utf8")}:l?function(z){return l.decode(E(z))}:function(z){return M(F(z))},P=function(z){return z.replace(/[-_]/g,
function(w){return"-"==w?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,"")},ia=function(z){return T(P(z))},R=function(z){return{value:z,enumerable:!1,writable:!0,configurable:!0}},ba=function(){var z=function(w,B){return Object.defineProperty(String.prototype,w,R(B))};z("fromBase64",function(){return ia(this)});z("toBase64",function(w){return y(this,w)});z("toBase64URI",function(){return y(this,!0)});z("toBase64URL",function(){return y(this,!0)});z("toUint8Array",function(){return H(this)})},O=function(){var z=
function(w,B){return Object.defineProperty(Uint8Array.prototype,w,R(B))};z("toBase64",function(w){return u(this,w)});z("toBase64URI",function(){return u(this,!0)});z("toBase64URL",function(){return u(this,!0)})},C={version:"3.7.2",VERSION:"3.7.2",atob:F,atobPolyfill:L,btoa:q,btoaPolyfill:n,fromBase64:ia,toBase64:y,encode:y,encodeURI:c,encodeURL:c,utob:v,btou:M,decode:ia,isValid:function(z){if("string"!==typeof z)return!1;z=z.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(z)||
!/[^\s0-9a-zA-Z\-_]/.test(z)},fromUint8Array:u,toUint8Array:H,extendString:ba,extendUint8Array:O,extendBuiltins:function(){ba();O()},Base64:{}};Object.keys(C).forEach(function(z){return C.Base64[z]=C[z]});return C});
(function(){function d(x){x=String(x);return x.charAt(0).toUpperCase()+x.slice(1)}function c(x,y){var A=-1,D=x?x.length:0;if("number"==typeof D&&-1<D&&D<=p)for(;++A<D;)y(x[A],A,x);else l(x,y)}function f(x){x=String(x).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(x)?x:d(x)}function l(x,y){for(var A in x)r.call(x,A)&&y(x[A],A,x)}function a(x){return null==x?d(x):t.call(x).slice(8,-1)}function e(x,y){var A=null!=x?typeof x[y]:"number";return!/^(?:boolean|number|string|undefined)$/.test(A)&&
("object"==A?!!x[y]:!0)}function b(x){return String(x).replace(/([ -])(?!$)/g,"$1?")}function h(x,y){var A=null;c(x,function(D,M){A=y(A,D,M,x)});return A}function k(x){function y(oa){return h(oa,function(pa,la){var V=la.pattern||b(la);!pa&&(pa=RegExp("\\b"+V+" *\\d+[.\\w_]*","i").exec(x)||RegExp("\\b"+V+" *\\w+-[\\w]*","i").exec(x)||RegExp("\\b"+V+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(x))&&((pa=String(la.label&&!RegExp(V,"i").test(la.label)?la.label:pa).split("/"))[1]&&!/[\d.]+/.test(pa[0])&&
(pa[0]+=" "+pa[1]),la=la.label||la,pa=f(pa[0].replace(RegExp(V,"i"),la).replace(RegExp("; *(?:"+la+"[_-])?","i")," ").replace(RegExp("("+la+")[-_.]?(\\w)","i"),"$1 $2")));return pa})}function A(oa){return h(oa,function(pa,la){return pa||(RegExp(la+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(x)||0)[1]||null})}var D=m,M=x&&"object"==typeof x&&"String"!=a(x);M&&(D=x,x=null);var L=D.navigator||{},F=L.userAgent||"";x||(x=F);var E=M?!!L.likeChrome:/\bChrome\b/.test(x)&&!/internal|\n/i.test(t.toString()),
H=M?"Object":"ScriptBridgingProxyObject",T=M?"Object":"Environment",P=M&&D.java?"JavaPackage":a(D.java),ia=M?"Object":"RuntimeObject";T=(P=/\bJava/.test(P)&&D.java)&&a(D.environment)==T;var R=P?"a":"\u03b1",ba=P?"b":"\u03b2",O=D.document||{},C=D.operamini||D.opera,z=u.test(z=M&&C?C["[[Class]]"]:a(C))?z:C=null,w,B=x;M=[];var G=null,K=x==F;F=K&&C&&"function"==typeof C.version&&C.version();var N=function(oa){return h(oa,function(pa,la){return pa||RegExp("\\b"+(la.pattern||b(la))+"\\b","i").exec(x)&&
(la.label||la)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),I=function(oa){return h(oa,function(pa,la){return pa||RegExp("\\b"+(la.pattern||b(la))+"\\b","i").exec(x)&&(la.label||la)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},
"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",
pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=y([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV",
"Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),aa=function(oa){return h(oa,function(pa,la,V){return pa||(la[U]||la[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+b(V)+"(?:\\b|\\w*\\d)","i").exec(x))&&V})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},
Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),S=function(oa){return h(oa,function(pa,la){var V=la.pattern||b(la);if(!pa&&(pa=RegExp("\\b"+V+"(?:/[\\d.]+|[ \\w.]*)","i").exec(x))){var ca=pa,ja=la.label||la,wa={"10.0":"10",
"6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};V&&ja&&/^Win/i.test(ca)&&!/^Windows Phone /i.test(ca)&&(wa=wa[/[\d.]+$/.exec(ca)])&&(ca="Windows "+wa);ca=String(ca);V&&ja&&(ca=ca.replace(RegExp(V,"i"),ja));pa=ca=f(ca.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,
"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return pa})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS",
"Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);N&&(N=[N]);aa&&!U&&(U=y([aa]));if(w=/\bGoogle TV\b/.exec(U))U=w[0];/\bSimulator\b/i.test(x)&&(U=(U?U+" ":"")+"Simulator");"Opera Mini"==I&&/\bOPiOS\b/.test(x)&&M.push("running in Turbo/Uncompressed mode");"IE"==I&&/\blike iPhone OS\b/.test(x)?(w=k(x.replace(/like iPhone OS/,"")),aa=w.manufacturer,U=w.product):/^iP/.test(U)?(I||(I="Safari"),S="iOS"+((w=/ OS ([\d_]+)/i.exec(x))?" "+w[1].replace(/_/g,"."):"")):"Konqueror"!=I||/buntu/i.test(S)?
aa&&"Google"!=aa&&(/Chrome/.test(I)&&!/\bMobile Safari\b/i.test(x)||/\bVita\b/.test(U))||/\bAndroid\b/.test(S)&&/^Chrome/.test(I)&&/\bVersion\//i.test(x)?(I="Android Browser",S=/\bAndroid\b/.test(S)?S:"Android"):"Silk"==I?(/\bMobi/i.test(x)||(S="Android",M.unshift("desktop mode")),/Accelerated *= *true/i.test(x)&&M.unshift("accelerated")):"PaleMoon"==I&&(w=/\bFirefox\/([\d.]+)\b/.exec(x))?M.push("identifying as Firefox "+w[1]):"Firefox"==I&&(w=/\b(Mobile|Tablet|TV)\b/i.exec(x))?(S||(S="Firefox OS"),
U||(U=w[1])):!I||(w=!/\bMinefield\b/i.test(x)&&/\b(?:Firefox|Safari)\b/.exec(I))?(I&&!U&&/[\/,]|^[^(]+?\)/.test(x.slice(x.indexOf(w+"/")+8))&&(I=null),(w=U||aa||S)&&(U||aa||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(S))&&(I=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(S)?S:w)+" Browser")):"Electron"==I&&(w=(/\bChrome\/([\d.]+)\b/.exec(x)||0)[1])&&M.push("Chromium "+w):S="Kubuntu";F||(F=A(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))",
"Version",b(I),"(?:Firefox|Minefield|NetFront)"]));if(w="iCab"==N&&3<parseFloat(F)&&"WebKit"||/\bOpera\b/.test(I)&&(/\bOPR\b/.test(x)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(x)&&!/^(?:Trident|EdgeHTML)$/.test(N)&&"WebKit"||!N&&/\bMSIE\b/i.test(x)&&("Mac OS"==S?"Tasman":"Trident")||"WebKit"==N&&/\bPlayStation\b(?! Vita\b)/i.test(I)&&"NetFront")N=[w];"IE"==I&&(w=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(x)||0)[1])?(I+=" Mobile",S="Windows Phone "+(/\+$/.test(w)?w:w+".x"),M.unshift("desktop mode")):
/\bWPDesktop\b/i.test(x)?(I="IE Mobile",S="Windows Phone 8.x",M.unshift("desktop mode"),F||(F=(/\brv:([\d.]+)/.exec(x)||0)[1])):"IE"!=I&&"Trident"==N&&(w=/\brv:([\d.]+)/.exec(x))&&(I&&M.push("identifying as "+I+(F?" "+F:"")),I="IE",F=w[1]);if(K){if(e(D,"global"))if(P&&(w=P.lang.System,B=w.getProperty("os.arch"),S=S||w.getProperty("os.name")+" "+w.getProperty("os.version")),T){try{F=D.require("ringo/engine").version.join("."),I="RingoJS"}catch(oa){(w=D.system)&&w.global.system==D.system&&(I="Narwhal",
S||(S=w[0].os||null))}I||(I="Rhino")}else"object"==typeof D.process&&!D.process.browser&&(w=D.process)&&("object"==typeof w.versions&&("string"==typeof w.versions.electron?(M.push("Node "+w.versions.node),I="Electron",F=w.versions.electron):"string"==typeof w.versions.nw&&(M.push("Chromium "+F,"Node "+w.versions.node),I="NW.js",F=w.versions.nw)),I||(I="Node.js",B=w.arch,S=w.platform,F=(F=/[\d.]+/.exec(w.version))?F[0]:null));else a(w=D.runtime)==H?(I="Adobe AIR",S=w.flash.system.Capabilities.os):
a(w=D.phantom)==ia?(I="PhantomJS",F=(w=w.version||null)&&w.major+"."+w.minor+"."+w.patch):"number"==typeof O.documentMode&&(w=/\bTrident\/(\d+)/i.exec(x))?(F=[F,O.documentMode],(w=+w[1]+4)!=F[1]&&(M.push("IE "+F[1]+" mode"),N&&(N[1]=""),F[1]=w),F="IE"==I?String(F[1].toFixed(1)):F[0]):"number"==typeof O.documentMode&&/^(?:Chrome|Firefox)\b/.test(I)&&(M.push("masking as "+I+" "+F),I="IE",F="11.0",N=["Trident"],S="Windows");S=S&&f(S)}F&&(w=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(F)||/(?:alpha|beta)(?: ?\d)?/i.exec(x+
";"+(K&&L.appMinorVersion))||/\bMinefield\b/i.test(x)&&"a")&&(G=/b/i.test(w)?"beta":"alpha",F=F.replace(RegExp(w+"\\+?$"),"")+("beta"==G?ba:R)+(/\d+\+?/.exec(w)||""));if("Fennec"==I||"Firefox"==I&&/\b(?:Android|Firefox OS)\b/.test(S))I="Firefox Mobile";else if("Maxthon"==I&&F)F=F.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(S=null),"Xbox 360"==U&&/\bIEMobile\b/.test(x)&&M.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(I)&&(!I||U||/Browser|Mobi/.test(I))||"Windows CE"!=
S&&!/Mobi/i.test(x))if("IE"==I&&K)try{null===D.external&&M.unshift("platform preview")}catch(oa){M.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(x))&&(w=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(x)||0)[1]||F)?(w=[w,/BB10/.test(x)],S=(w[1]?(U=null,aa="BlackBerry"):"Device Software")+" "+w[0],F=null):this!=l&&"Wii"!=U&&(K&&C||/Opera/.test(I)&&/\b(?:MSIE|Firefox)\b/i.test(x)||"Firefox"==I&&/\bOS X (?:\d+\.){2,}/.test(S)||"IE"==I&&(S&&!/^Win/.test(S)&&5.5<F||/\bWindows XP\b/.test(S)&&
8<F||8==F&&!/\bTrident\b/.test(x)))&&!u.test(w=k.call(l,x.replace(u,"")+";"))&&w.name&&(w="ing as "+w.name+((w=w.version)?" "+w:""),u.test(I)?(/\bIE\b/.test(w)&&"Mac OS"==S&&(S=null),w="identify"+w):(w="mask"+w,I=z?f(z.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(w)&&(S=null),K||(F=null)),N=["Presto"],M.push(w));else I+=" Mobile";if(w=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(x)||0)[1]){w=[parseFloat(w.replace(/\.(\d)$/,".0$1")),w];if("Safari"==I&&"+"==w[1].slice(-1))I="WebKit Nightly",G="alpha",
F=w[1].slice(0,-1);else if(F==w[1]||F==(w[2]=(/\bSafari\/([\d.]+\+?)/i.exec(x)||0)[1]))F=null;w[1]=(/\bChrome\/([\d.]+)/i.exec(x)||0)[1];537.36==w[0]&&537.36==w[2]&&28<=parseFloat(w[1])&&"WebKit"==N&&(N=["Blink"]);K&&(E||w[1])?(N&&(N[1]="like Chrome"),w=w[1]||(w=w[0],530>w?1:532>w?2:532.05>w?3:533>w?4:534.03>w?5:534.07>w?6:534.1>w?7:534.13>w?8:534.16>w?9:534.24>w?10:534.3>w?11:535.01>w?12:535.02>w?"13+":535.07>w?15:535.11>w?16:535.19>w?17:536.05>w?18:536.1>w?19:537.01>w?20:537.11>w?"21+":537.13>w?
23:537.18>w?24:537.24>w?25:537.36>w?26:"Blink"!=N?"27":"28")):(N&&(N[1]="like Safari"),w=(w=w[0],400>w?1:500>w?2:526>w?3:533>w?4:534>w?"4+":535>w?5:537>w?6:538>w?7:601>w?8:"8"));N&&(N[1]+=" "+(w+="number"==typeof w?".x":/[.+]/.test(w)?"":"+"));"Safari"==I&&(!F||45<parseInt(F))&&(F=w)}"Opera"==I&&(w=/\bzbov|zvav$/.exec(S))?(I+=" ",M.unshift("desktop mode"),"zvav"==w?(I+="Mini",F=null):I+="Mobile",S=S.replace(RegExp(" *"+w+"$"),"")):"Safari"==I&&/\bChrome\b/.exec(N&&N[1])&&(M.unshift("desktop mode"),
I="Chrome Mobile",F=null,/\bOS X\b/.test(S)?(aa="Apple",S="iOS 4.3+"):S=null);F&&0==F.indexOf(w=/[\d.]+$/.exec(S))&&-1<x.indexOf("/"+w+"-")&&(S=String(S.replace(w,"")).replace(/^ +| +$/g,""));N&&!/\b(?:Avant|Nook)\b/.test(I)&&(/Browser|Lunascape|Maxthon/.test(I)||"Safari"!=I&&/^iOS/.test(S)&&/\bSafari\b/.test(N[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(I)&&N[1])&&(w=N[N.length-1])&&M.push(w);M.length&&(M=["("+M.join("; ")+")"]);aa&&U&&0>U.indexOf(aa)&&
M.push("on "+aa);U&&M.push((/^on /.test(M[M.length-1])?"":"on ")+U);if(S){var Z=(w=/ ([\d.+]+)$/.exec(S))&&"/"==S.charAt(S.length-w[0].length-1);S={architecture:32,family:w&&!Z?S.replace(w[0],""):S,version:w?w[1]:null,toString:function(){var oa=this.version;return this.family+(oa&&!Z?" "+oa:"")+(64==this.architecture?" 64-bit":"")}}}(w=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(B))&&!/\bi686\b/i.test(B)?(S&&(S.architecture=64,S.family=S.family.replace(RegExp(" *"+w),"")),I&&(/\bWOW64\b/i.test(x)||K&&
/\w(?:86|32)$/.test(L.cpuClass||L.platform)&&!/\bWin64; x64\b/i.test(x))&&M.unshift("32-bit")):S&&/^OS X/.test(S.family)&&"Chrome"==I&&39<=parseFloat(F)&&(S.architecture=64);x||(x=null);D={};D.description=x;D.layout=N&&N[0];D.manufacturer=aa;D.name=I;D.prerelease=G;D.product=U;D.ua=x;D.version=I&&F;D.os=S||{architecture:null,family:null,version:null,toString:function(){return"null"}};D.parse=k;D.toString=function(){return this.description||""};D.version&&M.unshift(F);D.name&&M.unshift(I);S&&I&&(S!=
String(S).split(" ")[0]||S!=I.split(" ")[0]&&!U)&&M.push(U?"("+S+")":"on "+S);M.length&&(D.description=M.join(" "));return D}var g={"function":!0,object:!0},m=g[typeof window]&&window||this,n=g[typeof exports]&&exports;g=g[typeof module]&&module&&!module.nodeType&&module;var q=n&&g&&"object"==typeof global&&global;!q||q.global!==q&&q.window!==q&&q.self!==q||(m=q);var p=Math.pow(2,53)-1,u=/\bOpera/;q=Object.prototype;var r=q.hasOwnProperty,t=q.toString,v=k();"function"==typeof define&&"object"==typeof define.amd&&
define.amd?(m.platform=v,define(function(){return v})):n&&g?l(v,function(x,y){n[y]=x}):m.platform=v}).call(this);
function buildIOSMeta(){for(var d=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],c=0;c<d.length;c++){var f=document.createElement("meta");f.name=d[c].name;f.content=d[c].content;var l=window.document.head.querySelector('meta[name="'+f.name+'"]');l&&l.parentNode.removeChild(l);window.document.head.appendChild(f)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(d){return!0}}function isIOSLessThen13(){var d=platform.os,c=d.family.toLowerCase();d=parseFloat(d.version);return"ios"===c&&13>d?!0:!1}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()});var s_iOffsetX=0,s_iOffsetY=0,s_fInverseScaling=0,s_bFocus=!0;
(function(d){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(d.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(d){console.log(d)}function isIpad(){var d=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!d&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:d}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}
function isIOS(){for(var d="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");d.length;)if(navigator.platform===d.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}
function getSize(d){var c=d.toLowerCase(),f=window.document,l=f.documentElement;if(void 0===window["inner"+d])d=l["client"+d];else if(window["inner"+d]!=l["client"+d]){var a=f.createElement("body");a.id="vpw-test-b";a.style.cssText="overflow:scroll";var e=f.createElement("div");e.id="vpw-test-d";e.style.cssText="position:absolute;top:-1000px";e.innerHTML="<style>@media("+c+":"+l["client"+d]+"px){body#vpw-test-b div#vpw-test-d{"+c+":7px!important}}</style>";a.appendChild(e);l.insertBefore(a,f.head);
d=7==e["offset"+d]?l["client"+d]:window["inner"+d];l.removeChild(a)}else d=window["inner"+d];return d}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var d=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<d?d:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var d=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var c=getSize("Width");s_bFocus&&_checkOrientation(c,d);s_iScaleFactor=Math.min(d/CANVAS_HEIGHT,c/CANVAS_WIDTH);var f=Math.round(CANVAS_WIDTH*s_iScaleFactor),l=Math.round(CANVAS_HEIGHT*s_iScaleFactor);if(l<d){var a=d-l;l+=a;f+=CANVAS_WIDTH/CANVAS_HEIGHT*a}else f<c&&(a=c-f,f+=a,l+=CANVAS_HEIGHT/CANVAS_WIDTH*a);a=d/2-l/2;var e=c/2-f/2,
b=CANVAS_WIDTH/f;if(e*b<-EDGEBOARD_X||a*b<-EDGEBOARD_Y)s_iScaleFactor=Math.min(d/(CANVAS_HEIGHT-2*EDGEBOARD_Y),c/(CANVAS_WIDTH-2*EDGEBOARD_X)),f=Math.round(CANVAS_WIDTH*s_iScaleFactor),l=Math.round(CANVAS_HEIGHT*s_iScaleFactor),a=(d-l)/2,e=(c-f)/2,b=CANVAS_WIDTH/f;s_fInverseScaling=b;s_iOffsetX=-1*e*b;s_iOffsetY=-1*a*b;0<=a&&(s_iOffsetY=0);0<=e&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);
null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos();null!==s_oSelectMenu&&s_oSelectMenu.refreshButtonPos();$("#canvas").css("width",f+"px");$("#canvas").css("height",l+"px");0>a?($("#canvas").css("top",a+"px"),s_iCanvasOffsetHeight=a):(a=(d-l)/2,$("#canvas").css("top",a+"px"),s_iCanvasOffsetHeight=0);$("#canvas").css("left",e+"px");resizeCanvas3D();s_iCanvasResizeWidth=f;s_iCanvasResizeHeight=l;s_iCanvasOffsetWidth=e;fullscreenHandler()}}
function _checkOrientation(d,c){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(d>c?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),$("body").removeClass("orientation-alert"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),$("body").addClass("orientation-alert"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display",
"none"),$("body").removeClass("orientation-alert"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),$("body").addClass("orientation-alert"),s_oMain.stopUpdate()))}function saveItem(d,c){localStorage.setItem(d,c)}function getItem(d){return localStorage.getItem(d)}
function createBitmap(d,c,f){var l=new createjs.Bitmap(d),a=new createjs.Shape;c&&f?a.graphics.beginFill("#fff").drawRect(-c/2,-f/2,c,f):a.graphics.beginFill("#ff0").drawRect(0,0,d.width,d.height);l.hitArea=a;return l}function createSprite(d,c,f,l,a,e){d=null!==c?new createjs.Sprite(d,c):new createjs.Sprite(d);c=new createjs.Shape;c.graphics.beginFill("#000000").drawRect(-f,-l,a,e);d.hitArea=c;return d}
function randomFloatBetween(d,c,f){"undefined"===typeof f&&(f=2);return parseFloat(Math.min(d+Math.random()*(c-d),c).toFixed(f))}function shuffle(d){for(var c=d.length,f,l;0!==c;)l=Math.floor(Math.random()*c),--c,f=d[c],d[c]=d[l],d[l]=f;return d}function formatTime(d){d/=1E3;var c=Math.floor(d/60);d=parseFloat(d-60*c).toFixed(1);var f="";f=10>c?f+("0"+c+":"):f+(c+":");return 10>d?f+("0"+d):f+d}function degreesToRadians(d){return d*Math.PI/180}
function checkRectCollision(d,c){var f=getBounds(d,.9);var l=getBounds(c,.98);return calculateIntersection(f,l)}function calculateIntersection(d,c){var f,l,a,e;var b=d.x+(f=d.width/2);var h=d.y+(l=d.height/2);var k=c.x+(a=c.width/2);var g=c.y+(e=c.height/2);b=Math.abs(b-k)-(f+a);h=Math.abs(h-g)-(l+e);return 0>b&&0>h?(b=Math.min(Math.min(d.width,c.width),-b),h=Math.min(Math.min(d.height,c.height),-h),{x:Math.max(d.x,c.x),y:Math.max(d.y,c.y),width:b,height:h,rect1:d,rect2:c}):null}
function getBounds(d,c){var f={x:Infinity,y:Infinity,width:0,height:0};if(d instanceof createjs.Container){f.x2=-Infinity;f.y2=-Infinity;var l=d.children,a=l.length,e;for(e=0;e<a;e++){var b=getBounds(l[e],1);b.x<f.x&&(f.x=b.x);b.y<f.y&&(f.y=b.y);b.x+b.width>f.x2&&(f.x2=b.x+b.width);b.y+b.height>f.y2&&(f.y2=b.y+b.height)}Infinity==f.x&&(f.x=0);Infinity==f.y&&(f.y=0);Infinity==f.x2&&(f.x2=0);Infinity==f.y2&&(f.y2=0);f.width=f.x2-f.x;f.height=f.y2-f.y;delete f.x2;delete f.y2}else{if(d instanceof createjs.Bitmap){a=
d.sourceRect||d.image;e=a.width*c;var h=a.height*c}else if(d instanceof createjs.Sprite)if(d.spriteSheet._frames&&d.spriteSheet._frames[d.currentFrame]&&d.spriteSheet._frames[d.currentFrame].image){a=d.spriteSheet.getFrame(d.currentFrame);e=a.rect.width;h=a.rect.height;l=a.regX;var k=a.regY}else f.x=d.x||0,f.y=d.y||0;else f.x=d.x||0,f.y=d.y||0;l=l||0;e=e||0;k=k||0;h=h||0;f.regX=l;f.regY=k;a=d.localToGlobal(0-l,0-k);b=d.localToGlobal(e-l,h-k);e=d.localToGlobal(e-l,0-k);l=d.localToGlobal(0-l,h-k);f.x=
Math.min(Math.min(Math.min(a.x,b.x),e.x),l.x);f.y=Math.min(Math.min(Math.min(a.y,b.y),e.y),l.y);f.width=Math.max(Math.max(Math.max(a.x,b.x),e.x),l.x)-f.x;f.height=Math.max(Math.max(Math.max(a.y,b.y),e.y),l.y)-f.y}return f}function NoClickDelay(d){this.element=d;window.Touch&&this.element.addEventListener("touchstart",this,!1)}
NoClickDelay.prototype={handleEvent:function(d){switch(d.type){case "touchstart":this.onTouchStart(d);break;case "touchmove":this.onTouchMove(d);break;case "touchend":this.onTouchEnd(d)}},onTouchStart:function(d){d.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(d){this.moved=!0},onTouchEnd:function(d){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){d=document.elementFromPoint(d.changedTouches[0].clientX,d.changedTouches[0].clientY);3==d.nodeType&&(d=d.parentNode);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0);d.dispatchEvent(c)}}};
(function(){function d(f){var l={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};f=f||window.event;f.type in l?document.body.className=l[f.type]:(document.body.className=this[c]?"hidden":"visible",s_bMultiplayer||("hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0)))}var c="hidden";c in document?document.addEventListener("visibilitychange",d):(c="mozHidden")in document?document.addEventListener("mozvisibilitychange",
d):(c="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",d):(c="msHidden")in document?document.addEventListener("msvisibilitychange",d):"onfocusin"in document?document.onfocusin=document.onfocusout=d:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=d})();function playSound(d,c,f){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[d].play(),s_aSounds[d].volume(c),s_aSounds[d].loop(f),s_aSounds[d]):null}
function stopSound(d){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[d].stop()}function setVolume(d,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[d].volume(c)}function setMute(d,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[d].mute(c)}function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParameterByName(d,c){c=void 0===c?window.location.href:c;d=d.replace(/[\[\]]/g,"\\$&");var f=(new RegExp("[?&]"+d+"(=([^&#]*)|&|#|$)")).exec(c);return f?f[2]?decodeURIComponent(f[2].replace(/\+/g," ")):"":null}function getParamValue(d){for(var c=window.location.search.substring(1).split("&"),f=0;f<c.length;f++){var l=c[f].split("=");if(l[0]==d)return l[1]}}function rotateVector2D(d,c){return{x:c.x*Math.cos(d)+c.y*Math.sin(d),y:c.x*-Math.sin(d)+c.y*Math.cos(d)}}
function normalize(d,c){0<c&&(d.x/=c,d.y/=c);return d}function length(d){return Math.sqrt(d.x*d.x+d.y*d.y)}function findNearestIntersectingObject(d,c,f,l){var a=CANVAS_RESIZE_WIDTH+2*OFFSET_WIDTH,e=CANVAS_RESIZE_HEIGHT+2*OFFSET_HEIGHT,b=new THREE.Raycaster,h=new THREE.Vector3;h.x=d/a*2-1;h.y=2*-(c/e)+1;h.z=.5;b.setFromCamera(h,f);d=b.intersectObjects(l,!0);c=!1;0<d.length&&(c=d[0]);return c}function distance(d,c,f,l){d-=f;c-=l;return Math.sqrt(d*d+c*c)}
function distance2(d,c,f,l){d-=f;c-=l;return d*d+c*c}function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}
function createOrthoGraphicCamera(){var d=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,NEAR,FAR);s_iCurState===GOALKEEPER_MODE?(d.rotation.x=Math.PI/180*84,d.position.set(0,0,3)):(d.rotation.x=Math.PI/180*88.6,d.rotation.y=Math.PI/180*.03,d.position.set(CAMERA_POSITION.x,CAMERA_POSITION.y,CAMERA_POSITION.z));d.updateProjectionMatrix();d.updateMatrixWorld();return d}function rotateVector2D(d,c){return{x:c.x*Math.cos(d)+c.y*Math.sin(d),y:c.x*-Math.sin(d)+c.y*Math.cos(d),z:0}}
Math.radians=function(d){return d*Math.PI/180};Math.degrees=function(d){return 180*d/Math.PI};function distanceV3(d,c,f,l,a,e){d-=l;c-=a;f-=e;return Math.sqrt(d*d+c*c+f*f)}function linearFunction(d,c,f,l,a){return(d-c)*(a-l)/(f-c)+l}function distanceV2(d,c){var f=d.x-c.x,l=d.y-c.y;return Math.sqrt(f*f+l*l)}
function clearAllItem(){for(var d=1;d<NUM_MATCHES+1;d++)localStorage.removeItem(LOCALSTORAGE_STRING+"match_"+d);localStorage.removeItem(LOCALSTORAGE_STRING+"team");localStorage.removeItem(LOCALSTORAGE_STRING+"level");localStorage.removeItem(LOCALSTORAGE_STRING+"team")}
function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut(),null!==s_oSelectMenu&&s_oSelectMenu.resetFullscreenBut())}
if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut();null!==s_oSelectMenu&&s_oSelectMenu.resetFullscreenBut()});var s_szGameID="50a6ca30773345549c25cacc722305de";
window.GD_OPTIONS={gameId:s_szGameID,onEvent:function(d){switch(d.name){case "SDK_GAME_START":s_bAdShown=!1;s_oMain&&s_oMain.startUpdate();break;case "SDK_GAME_PAUSE":s_bAdShown=!0;s_oMain&&s_oMain.stopUpdate();break;case "SDK_READY":s_bMobile||($("#div_display_id").css("display","block"),"undefined"!==typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd(gdsdk.AdType.Display,{containerId:"div_display_id"}).then(function(){return console.info("showAd(gdsdk.AdType.Display) resolved.")})["catch"](function(c){return console.info(c)}))}}};
(function(d,c,f){var l=d.getElementsByTagName(c)[0];d.getElementById(f)||(d=d.createElement(c),d.id=f,d.src="/main.min.js",l.parentNode.insertBefore(d,l))})(document,"script","gamedistribution-jssdk");var s_bAdShown=!1;
function CSpriteLibrary(){var d={},c,f,l,a,e,b;this.init=function(h,k,g){c={};l=f=0;a=h;e=k;b=g};this.addSprite=function(h,k){if(!d.hasOwnProperty(h)){var g=new Image;d[h]=c[h]={szPath:k,oSprite:g,bLoaded:!1};f++}};this.getSprite=function(h){return d.hasOwnProperty(h)?d[h].oSprite:null};this._onSpritesLoaded=function(){f=0;e.call(b)};this._onSpriteLoaded=function(){a.call(b);++l===f&&this._onSpritesLoaded()};this.loadSprites=function(){for(var h in c)c[h].oSprite.oSpriteLibrary=this,c[h].oSprite.szKey=
h,c[h].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},c[h].oSprite.onerror=function(k){var g=k.currentTarget;setTimeout(function(){c[g.szKey].oSprite.src=c[g.szKey].szPath},500)},c[h].oSprite.src=c[h].szPath};this.setLoaded=function(h){d[h].bLoaded=!0};this.isLoaded=function(h){return d[h].bLoaded};this.getNumSprites=function(){return f}}
!function(d){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=d();else{var c;"undefined"!=typeof window?c=window:"undefined"!=typeof global?c=global:"undefined"!=typeof self&&(c=self);c.CANNON=d()}}(function(){return function a(c,f,l){function e(k,g){if(!f[k]){if(!c[k]){var m="function"==typeof require&&require;if(!g&&m)return m(k,!0);if(b)return b(k,!0);throw Error("Cannot find module '"+k+"'");}m=f[k]={exports:{}};c[k][0].call(m.exports,function(n){var q=c[k][1][n];return e(q?
q:n)},m,m.exports,a,c,f,l)}return f[k].exports}for(var b="function"==typeof require&&require,h=0;h<l.length;h++)e(l[h]);return e}({1:[function(c,f,l){f.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(c,f,l){f.exports={version:c("../package.json").version,AABB:c("./collision/AABB"),ArrayCollisionMatrix:c("./collision/ArrayCollisionMatrix"),
Body:c("./objects/Body"),Box:c("./shapes/Box"),Broadphase:c("./collision/Broadphase"),Constraint:c("./constraints/Constraint"),ContactEquation:c("./equations/ContactEquation"),Narrowphase:c("./world/Narrowphase"),ConeTwistConstraint:c("./constraints/ConeTwistConstraint"),ContactMaterial:c("./material/ContactMaterial"),ConvexPolyhedron:c("./shapes/ConvexPolyhedron"),Cylinder:c("./shapes/Cylinder"),DistanceConstraint:c("./constraints/DistanceConstraint"),Equation:c("./equations/Equation"),EventTarget:c("./utils/EventTarget"),
FrictionEquation:c("./equations/FrictionEquation"),GSSolver:c("./solver/GSSolver"),GridBroadphase:c("./collision/GridBroadphase"),Heightfield:c("./shapes/Heightfield"),HingeConstraint:c("./constraints/HingeConstraint"),LockConstraint:c("./constraints/LockConstraint"),Mat3:c("./math/Mat3"),Material:c("./material/Material"),NaiveBroadphase:c("./collision/NaiveBroadphase"),ObjectCollisionMatrix:c("./collision/ObjectCollisionMatrix"),Pool:c("./utils/Pool"),Particle:c("./shapes/Particle"),Plane:c("./shapes/Plane"),
PointToPointConstraint:c("./constraints/PointToPointConstraint"),Quaternion:c("./math/Quaternion"),Ray:c("./collision/Ray"),RaycastVehicle:c("./objects/RaycastVehicle"),RaycastResult:c("./collision/RaycastResult"),RigidVehicle:c("./objects/RigidVehicle"),RotationalEquation:c("./equations/RotationalEquation"),RotationalMotorEquation:c("./equations/RotationalMotorEquation"),SAPBroadphase:c("./collision/SAPBroadphase"),SPHSystem:c("./objects/SPHSystem"),Shape:c("./shapes/Shape"),Solver:c("./solver/Solver"),
Sphere:c("./shapes/Sphere"),SplitSolver:c("./solver/SplitSolver"),Spring:c("./objects/Spring"),Trimesh:c("./shapes/Trimesh"),Vec3:c("./math/Vec3"),Vec3Pool:c("./utils/Vec3Pool"),World:c("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(c,f,l){function a(k){k=k||{};
this.lowerBound=new e;k.lowerBound&&this.lowerBound.copy(k.lowerBound);this.upperBound=new e;k.upperBound&&this.upperBound.copy(k.upperBound)}var e=c("../math/Vec3");c("../utils/Utils");f.exports=a;var b=new e;a.prototype.setFromPoints=function(k,g,m,n){var q=this.lowerBound,p=this.upperBound;q.copy(k[0]);m&&m.vmult(q,q);p.copy(q);for(var u=1;u<k.length;u++){var r=k[u];m&&(m.vmult(r,b),r=b);r.x>p.x&&(p.x=r.x);r.x<q.x&&(q.x=r.x);r.y>p.y&&(p.y=r.y);r.y<q.y&&(q.y=r.y);r.z>p.z&&(p.z=r.z);r.z<q.z&&(q.z=
r.z)}g&&(g.vadd(q,q),g.vadd(p,p));n&&(q.x-=n,q.y-=n,q.z-=n,p.x+=n,p.y+=n,p.z+=n);return this};a.prototype.copy=function(k){this.lowerBound.copy(k.lowerBound);this.upperBound.copy(k.upperBound);return this};a.prototype.clone=function(){return(new a).copy(this)};a.prototype.extend=function(k){var g=k.lowerBound.x;this.lowerBound.x>g&&(this.lowerBound.x=g);g=k.upperBound.x;this.upperBound.x<g&&(this.upperBound.x=g);g=k.lowerBound.y;this.lowerBound.y>g&&(this.lowerBound.y=g);g=k.upperBound.y;this.upperBound.y<
g&&(this.upperBound.y=g);g=k.lowerBound.z;this.lowerBound.z>g&&(this.lowerBound.z=g);g=k.upperBound.z;this.upperBound.z<g&&(this.upperBound.z=g)};a.prototype.overlaps=function(k){var g=this.lowerBound,m=this.upperBound,n=k.lowerBound;k=k.upperBound;return(n.x<=m.x&&m.x<=k.x||g.x<=k.x&&k.x<=m.x)&&(n.y<=m.y&&m.y<=k.y||g.y<=k.y&&k.y<=m.y)&&(n.z<=m.z&&m.z<=k.z||g.z<=k.z&&k.z<=m.z)};a.prototype.contains=function(k){var g=this.lowerBound,m=this.upperBound,n=k.lowerBound;k=k.upperBound;return g.x<=n.x&&
m.x>=k.x&&g.y<=n.y&&m.y>=k.y&&g.z<=n.z&&m.z>=k.z};a.prototype.getCorners=function(k,g,m,n,q,p,u,r){var t=this.lowerBound,v=this.upperBound;k.copy(t);g.set(v.x,t.y,t.z);m.set(v.x,v.y,t.z);n.set(t.x,v.y,v.z);q.set(v.x,t.y,t.z);p.set(t.x,v.y,t.z);u.set(t.x,t.y,v.z);r.copy(v)};var h=[new e,new e,new e,new e,new e,new e,new e,new e];a.prototype.toLocalFrame=function(k,g){this.getCorners(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(var m=0;8!==m;m++){var n=h[m];k.pointToLocal(n,n)}return g.setFromPoints(h)};
a.prototype.toWorldFrame=function(k,g){this.getCorners(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(var m=0;8!==m;m++){var n=h[m];k.pointToWorld(n,n)}return g.setFromPoints(h)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(c,f,l){function a(){this.matrix=[]}f.exports=a;a.prototype.get=function(e,b){e=e.index;b=b.index;if(b>e){var h=b;b=e;e=h}return this.matrix[(e*(e+1)>>1)+b-1]};a.prototype.set=function(e,b,h){e=e.index;b=b.index;if(b>e){var k=b;b=e;e=k}this.matrix[(e*(e+1)>>1)+b-1]=h?1:0};
a.prototype.reset=function(){for(var e=0,b=this.matrix.length;e!==b;e++)this.matrix[e]=0};a.prototype.setNumObjects=function(e){this.matrix.length=e*(e-1)>>1}},{}],5:[function(c,f,l){function a(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var e=c("../objects/Body");l=c("../math/Vec3");var b=c("../math/Quaternion");c("../shapes/Shape");c("../shapes/Plane");f.exports=a;a.prototype.collisionPairs=function(p,u,r){throw Error("collisionPairs not implemented for this BroadPhase class!");};var h=
e.STATIC|e.KINEMATIC;a.prototype.needBroadphaseCollision=function(p,u){return 0!==(p.collisionFilterGroup&u.collisionFilterMask)&&0!==(u.collisionFilterGroup&p.collisionFilterMask)&&(0===(p.type&h)&&p.sleepState!==e.SLEEPING||0===(u.type&h)&&u.sleepState!==e.SLEEPING)?!0:!1};a.prototype.intersectionTest=function(p,u,r,t){this.useBoundingBoxes?this.doBoundingBoxBroadphase(p,u,r,t):this.doBoundingSphereBroadphase(p,u,r,t)};var k=new l;new l;new b;new l;a.prototype.doBoundingSphereBroadphase=function(p,
u,r,t){u.position.vsub(p.position,k);var v=Math.pow(p.boundingRadius+u.boundingRadius,2);k.norm2()<v&&(r.push(p),t.push(u))};a.prototype.doBoundingBoxBroadphase=function(p,u,r,t){p.aabbNeedsUpdate&&p.computeAABB();u.aabbNeedsUpdate&&u.computeAABB();p.aabb.overlaps(u.aabb)&&(r.push(p),t.push(u))};var g={keys:[]},m=[],n=[];a.prototype.makePairsUnique=function(p,u){for(var r=p.length,t=0;t!==r;t++)m[t]=p[t],n[t]=u[t];p.length=0;for(t=u.length=0;t!==r;t++){var v=m[t].id,x=n[t].id;v=v<x?v+","+x:x+","+
v;g[v]=t;g.keys.push(v)}for(t=0;t!==g.keys.length;t++)v=g.keys.pop(),r=g[v],p.push(m[r]),u.push(n[r]),delete g[v]};a.prototype.setWorld=function(p){};var q=new l;a.boundingSphereCheck=function(p,u){p.position.vsub(u.position,q);return Math.pow(p.shape.boundingSphereRadius+u.shape.boundingSphereRadius,2)>q.norm2()};a.prototype.aabbQuery=function(p,u,r){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(c,f,l){function a(g,m,n,q,p){e.apply(this);this.nx=n||10;this.ny=q||10;this.nz=p||10;this.aabbMin=g||new b(100,100,100);this.aabbMax=m||new b(-100,-100,-100);g=this.nx*this.ny*this.nz;if(0>=g)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=g;this.binLengths.length=g;for(m=0;m<g;m++)this.bins[m]=[],this.binLengths[m]=0}f.exports=a;var e=c("./Broadphase"),b=c("../math/Vec3"),h=c("../shapes/Shape");
a.prototype=new e;a.prototype.constructor=a;var k=new b;new b;a.prototype.collisionPairs=function(g,m,n){function q(V,ca,ja,wa,Fa,xa,fb){V=(V-F)*T|0;ca=(ca-E)*P|0;ja=(ja-H)*ia|0;wa=B((wa-F)*T);Fa=B((Fa-E)*P);xa=B((xa-H)*ia);0>V?V=0:V>=t&&(V=t-1);0>ca?ca=0:ca>=v&&(ca=v-1);0>ja?ja=0:ja>=x&&(ja=x-1);0>wa?wa=0:wa>=t&&(wa=t-1);0>Fa?Fa=0:Fa>=v&&(Fa=v-1);0>xa?xa=0:xa>=x&&(xa=x-1);V*=y;ca*=A;ja*=1;wa*=y;Fa*=A;for(xa*=1;V<=wa;V+=y)for(var ob=ca;ob<=Fa;ob+=A)for(var kb=ja;kb<=xa;kb+=1){var lb=V+ob+kb;z[lb][w[lb]++]=
fb}}var p=g.numObjects();g=g.bodies;var u=this.aabbMax,r=this.aabbMin,t=this.nx,v=this.ny,x=this.nz,y=v*x,A=x,D=u.x,M=u.y,L=u.z,F=r.x,E=r.y,H=r.z,T=t/(D-F),P=v/(M-E),ia=x/(L-H);D=(D-F)/t;var R=(M-E)/v;L=(L-H)/x;var ba=.5*Math.sqrt(D*D+R*R+L*L);M=h.types;var O=M.SPHERE,C=M.PLANE,z=this.bins,w=this.binLengths;M=this.bins.length;for(r=0;r!==M;r++)w[r]=0;var B=Math.ceil;r=Math.min;u=Math.max;for(r=0;r!==p;r++){u=g[r];var G=u.shape;switch(G.type){case O:var K=u.position.x,N=u.position.y,I=u.position.z;
G=G.radius;q(K-G,N-G,I-G,K+G,N+G,I+G,u);break;case C:G.worldNormalNeedsUpdate&&G.computeWorldNormal(u.quaternion);I=G.worldNormal;G=E+.5*R-u.position.y;var U=H+.5*L-u.position.z,aa=k;aa.set(F+.5*D-u.position.x,G,U);for(var S=K=0;K!==t;K++,S+=y,aa.y=G,aa.x+=D)for(var Z=N=0;N!==v;N++,Z+=A,aa.z=U,aa.y+=R)for(var oa=0,pa=0;oa!==x;oa++,pa+=1,aa.z+=L)if(aa.dot(I)<ba){var la=S+Z+pa;z[la][w[la]++]=u}break;default:u.aabbNeedsUpdate&&u.computeAABB(),q(u.aabb.lowerBound.x,u.aabb.lowerBound.y,u.aabb.lowerBound.z,
u.aabb.upperBound.x,u.aabb.upperBound.y,u.aabb.upperBound.z,u)}}for(r=0;r!==M;r++)if(p=w[r],1<p)for(g=z[r],K=0;K!==p;K++)for(u=g[K],N=0;N!==K;N++)D=g[N],this.needBroadphaseCollision(u,D)&&this.intersectionTest(u,D,m,n);this.makePairsUnique(m,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(c,f,l){function a(){e.apply(this)}f.exports=a;var e=c("./Broadphase");c=c("./AABB");a.prototype=new e;a.prototype.constructor=a;a.prototype.collisionPairs=function(b,h,k){b=b.bodies;var g=
b.length,m,n;for(m=0;m!==g;m++)for(n=0;n!==m;n++){var q=b[m];var p=b[n];this.needBroadphaseCollision(q,p)&&this.intersectionTest(q,p,h,k)}};new c;a.prototype.aabbQuery=function(b,h,k){k=k||[];for(var g=0;g<b.bodies.length;g++){var m=b.bodies[g];m.aabbNeedsUpdate&&m.computeAABB();m.aabb.overlaps(h)&&k.push(m)}return k}},{"./AABB":3,"./Broadphase":5}],8:[function(c,f,l){function a(){this.matrix={}}f.exports=a;a.prototype.get=function(e,b){e=e.id;b=b.id;if(b>e){var h=b;b=e;e=h}return e+"-"+b in this.matrix};
a.prototype.set=function(e,b,h){e=e.id;b=b.id;if(b>e){var k=b;b=e;e=k}h?this.matrix[e+"-"+b]=!0:delete this.matrix[e+"-"+b]};a.prototype.reset=function(){this.matrix={}};a.prototype.setNumObjects=function(e){}},{}],9:[function(c,f,l){function a(z,w){this.from=z?z.clone():new b;this.to=w?w.clone():new b;this._direction=new b;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=a.ANY;this.result=new k;this.hasHit=!1;
this.callback=function(B){}}function e(z,w,B,G){G.vsub(w,O);B.vsub(w,n);z.vsub(w,q);z=O.dot(O);w=O.dot(n);B=O.dot(q);G=n.dot(n);var K=n.dot(q),N,I;return 0<=(N=G*B-w*K)&&0<=(I=z*K-w*B)&&N+I<z*G-w*w}f.exports=a;var b=c("../math/Vec3");f=c("../math/Quaternion");var h=c("../math/Transform");c("../shapes/ConvexPolyhedron");c("../shapes/Box");var k=c("../collision/RaycastResult");l=c("../shapes/Shape");c=c("../collision/AABB");a.prototype.constructor=a;a.CLOSEST=1;a.ANY=2;a.ALL=4;var g=new c,m=[];a.prototype.intersectWorld=
function(z,w){this.mode=w.mode||a.ANY;this.result=w.result||new k;this.skipBackfaces=!!w.skipBackfaces;this.collisionFilterMask="undefined"!==typeof w.collisionFilterMask?w.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof w.collisionFilterGroup?w.collisionFilterGroup:-1;w.from&&this.from.copy(w.from);w.to&&this.to.copy(w.to);this.callback=w.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(g);m.length=0;z.broadphase.aabbQuery(z,g,m);
this.intersectBodies(m);return this.hasHit};var n=new b,q=new b;a.pointInTriangle=e;var p=new b,u=new f;a.prototype.intersectBody=function(z,w){w&&(this.result=w,this._updateDirection());var B=this.checkCollisionResponse;if((!B||z.collisionResponse)&&0!==(this.collisionFilterGroup&z.collisionFilterMask)&&0!==(z.collisionFilterGroup&this.collisionFilterMask))for(var G=0,K=z.shapes.length;G<K;G++){var N=z.shapes[G];if(!B||N.collisionResponse)if(z.quaternion.mult(z.shapeOrientations[G],u),z.quaternion.vmult(z.shapeOffsets[G],
p),p.vadd(z.position,p),this.intersectShape(N,u,p,z),this.result._shouldStop)break}};a.prototype.intersectBodies=function(z,w){w&&(this.result=w,this._updateDirection());for(var B=0,G=z.length;!this.result._shouldStop&&B<G;B++)this.intersectBody(z[B])};a.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};a.prototype.intersectShape=function(z,w,B,G){var K=this.from,N=this._direction;B.vsub(K,O);var I=O.dot(N);N.mult(I,C);C.vadd(K,C);B.distanceTo(C)>
z.boundingSphereRadius||(K=this[z.type])&&K.call(this,z,w,B,G)};new b;new b;var r=new b,t=new b,v=new b,x=new b;new b;new k;a.prototype.intersectBox=function(z,w,B,G){return this.intersectConvex(z.convexPolyhedronRepresentation,w,B,G)};a.prototype[l.types.BOX]=a.prototype.intersectBox;a.prototype.intersectPlane=function(z,w,B,G){var K=this.from,N=this.to,I=this._direction,U=new b(0,0,1);w.vmult(U,U);var aa=new b;K.vsub(B,aa);w=aa.dot(U);N.vsub(B,aa);aa=aa.dot(U);if(!(0<w*aa||K.distanceTo(N)<w||(aa=
U.dot(I),Math.abs(aa)<this.precision))){var S=new b;N=new b;w=new b;K.vsub(B,S);B=-U.dot(S)/aa;I.scale(B,N);K.vadd(N,w);this.reportIntersection(U,w,z,G,-1)}};a.prototype[l.types.PLANE]=a.prototype.intersectPlane;a.prototype.getAABB=function(z){var w=this.to,B=this.from;z.lowerBound.x=Math.min(w.x,B.x);z.lowerBound.y=Math.min(w.y,B.y);z.lowerBound.z=Math.min(w.z,B.z);z.upperBound.x=Math.max(w.x,B.x);z.upperBound.y=Math.max(w.y,B.y);z.upperBound.z=Math.max(w.z,B.z)};var y={faceList:[0]};a.prototype.intersectHeightfield=
function(z,w,B,G){var K=new b,N=new a(this.from,this.to);h.pointToLocalFrame(B,w,N.from,N.from);h.pointToLocalFrame(B,w,N.to,N.to);var I=[],U=null,aa=null,S=null,Z=null,oa=z.getIndexOfPosition(N.from.x,N.from.y,I,!1);oa&&(U=I[0],aa=I[1],S=I[0],Z=I[1]);if(oa=z.getIndexOfPosition(N.to.x,N.to.y,I,!1)){if(null===U||I[0]<U)U=I[0];if(null===S||I[0]>S)S=I[0];if(null===aa||I[1]<aa)aa=I[1];if(null===Z||I[1]>Z)Z=I[1]}if(null!==U)for(z.getRectMinMax(U,aa,S,Z,[]),N=U;N<=S;N++)for(I=aa;I<=Z;I++){if(this.result._shouldStop)return;
z.getConvexTrianglePillar(N,I,!1);h.pointToWorldFrame(B,w,z.pillarOffset,K);this.intersectConvex(z.pillarConvex,w,K,G,y);if(this.result._shouldStop)return;z.getConvexTrianglePillar(N,I,!0);h.pointToWorldFrame(B,w,z.pillarOffset,K);this.intersectConvex(z.pillarConvex,w,K,G,y)}};a.prototype[l.types.HEIGHTFIELD]=a.prototype.intersectHeightfield;var A=new b,D=new b;a.prototype.intersectSphere=function(z,w,B,G){w=this.from;var K=this.to,N=Math.pow(K.x-w.x,2)+Math.pow(K.y-w.y,2)+Math.pow(K.z-w.z,2),I=2*
((K.x-w.x)*(w.x-B.x)+(K.y-w.y)*(w.y-B.y)+(K.z-w.z)*(w.z-B.z)),U=Math.pow(I,2)-4*N*(Math.pow(w.x-B.x,2)+Math.pow(w.y-B.y,2)+Math.pow(w.z-B.z,2)-Math.pow(z.radius,2));if(!(0>U))if(0===U)w.lerp(K,U,A),A.vsub(B,D),D.normalize(),this.reportIntersection(D,A,z,G,-1);else{var aa=(-I-Math.sqrt(U))/(2*N);N=(-I+Math.sqrt(U))/(2*N);0<=aa&&1>=aa&&(w.lerp(K,aa,A),A.vsub(B,D),D.normalize(),this.reportIntersection(D,A,z,G,-1));!this.result._shouldStop&&0<=N&&1>=N&&(w.lerp(K,N,A),A.vsub(B,D),D.normalize(),this.reportIntersection(D,
A,z,G,-1))}};a.prototype[l.types.SPHERE]=a.prototype.intersectSphere;var M=new b;new b;new b;var L=new b;a.prototype.intersectConvex=function(z,w,B,G,K){K=K&&K.faceList||null;for(var N=z.faces,I=z.vertices,U=z.faceNormals,aa=this._direction,S=this.from,Z=S.distanceTo(this.to),oa=K?K.length:N.length,pa=this.result,la=0;!pa._shouldStop&&la<oa;la++){var V=K?K[la]:la,ca=N[V],ja=U[V],wa=w,Fa=B;L.copy(I[ca[0]]);wa.vmult(L,L);L.vadd(Fa,L);L.vsub(S,L);wa.vmult(ja,M);ja=aa.dot(M);if(!(Math.abs(ja)<this.precision||
(ja=M.dot(L)/ja,0>ja)))for(aa.mult(ja,r),r.vadd(S,r),t.copy(I[ca[0]]),wa.vmult(t,t),Fa.vadd(t,t),ja=1;!pa._shouldStop&&ja<ca.length-1;ja++){v.copy(I[ca[ja]]);x.copy(I[ca[ja+1]]);wa.vmult(v,v);wa.vmult(x,x);Fa.vadd(v,v);Fa.vadd(x,x);var xa=r.distanceTo(S);!e(r,t,v,x)&&!e(r,v,t,x)||xa>Z||this.reportIntersection(M,r,z,G,V)}}};a.prototype[l.types.CONVEXPOLYHEDRON]=a.prototype.intersectConvex;var F=new b,E=new b,H=new b,T=new b,P=new b,ia=new b;new c;var R=[],ba=new h;a.prototype.intersectTrimesh=function(z,
w,B,G,K){K=z.indices;var N=this.from,I=this.to,U=this._direction;ba.position.copy(B);ba.quaternion.copy(w);h.vectorToLocalFrame(B,w,U,E);h.pointToLocalFrame(B,w,N,H);h.pointToLocalFrame(B,w,I,T);N=H.distanceSquared(T);z.tree.rayQuery(this,ba,R);I=0;for(U=R.length;!this.result._shouldStop&&I!==U;I++){var aa=R[I];z.getNormal(aa,F);z.getVertex(K[3*aa],t);t.vsub(H,L);var S=E.dot(F);S=F.dot(L)/S;0>S||(E.scale(S,r),r.vadd(H,r),z.getVertex(K[3*aa+1],v),z.getVertex(K[3*aa+2],x),S=r.distanceSquared(H),!e(r,
v,t,x)&&!e(r,t,v,x)||S>N||(h.vectorToWorldFrame(w,F,P),h.pointToWorldFrame(B,w,r,ia),this.reportIntersection(P,ia,z,G,aa)))}R.length=0};a.prototype[l.types.TRIMESH]=a.prototype.intersectTrimesh;a.prototype.reportIntersection=function(z,w,B,G,K){var N=this.from,I=this.to,U=N.distanceTo(w),aa=this.result;if(!(this.skipBackfaces&&0<z.dot(this._direction)))switch(aa.hitFaceIndex="undefined"!==typeof K?K:-1,this.mode){case a.ALL:this.hasHit=!0;aa.set(N,I,z,w,B,G,U);aa.hasHit=!0;this.callback(aa);break;
case a.CLOSEST:if(U<aa.distance||!aa.hasHit)this.hasHit=!0,aa.hasHit=!0,aa.set(N,I,z,w,B,G,U);break;case a.ANY:this.hasHit=!0,aa.hasHit=!0,aa.set(N,I,z,w,B,G,U),aa._shouldStop=!0}};var O=new b,C=new b},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(c,f,l){function a(){this.rayFromWorld=new e;this.rayToWorld=new e;this.hitNormalWorld=new e;
this.hitPointWorld=new e;this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var e=c("../math/Vec3");f.exports=a;a.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};a.prototype.abort=function(){this._shouldStop=!0};a.prototype.set=function(b,h,k,g,m,n,q){this.rayFromWorld.copy(b);
this.rayToWorld.copy(h);this.hitNormalWorld.copy(k);this.hitPointWorld.copy(g);this.shape=m;this.body=n;this.distance=q}},{"../math/Vec3":30}],11:[function(c,f,l){function a(b){e.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var h=this.axisList;this._addBodyHandler=function(k){h.push(k.body)};this._removeBodyHandler=function(k){k=h.indexOf(k.body);-1!==k&&h.splice(k,1)};b&&this.setWorld(b)}c("../shapes/Shape");var e=c("../collision/Broadphase");f.exports=a;a.prototype=new e;a.prototype.setWorld=
function(b){for(var h=this.axisList.length=0;h<b.bodies.length;h++)this.axisList.push(b.bodies[h]);b.removeEventListener("addBody",this._addBodyHandler);b.removeEventListener("removeBody",this._removeBodyHandler);b.addEventListener("addBody",this._addBodyHandler);b.addEventListener("removeBody",this._removeBodyHandler);this.world=b;this.dirty=!0};a.insertionSortX=function(b){for(var h=1,k=b.length;h<k;h++){for(var g=b[h],m=h-1;0<=m&&!(b[m].aabb.lowerBound.x<=g.aabb.lowerBound.x);m--)b[m+1]=b[m];b[m+
1]=g}return b};a.insertionSortY=function(b){for(var h=1,k=b.length;h<k;h++){for(var g=b[h],m=h-1;0<=m&&!(b[m].aabb.lowerBound.y<=g.aabb.lowerBound.y);m--)b[m+1]=b[m];b[m+1]=g}return b};a.insertionSortZ=function(b){for(var h=1,k=b.length;h<k;h++){for(var g=b[h],m=h-1;0<=m&&!(b[m].aabb.lowerBound.z<=g.aabb.lowerBound.z);m--)b[m+1]=b[m];b[m+1]=g}return b};a.prototype.collisionPairs=function(b,h,k){b=this.axisList;var g=b.length,m=this.axisIndex,n,q;this.dirty&&(this.sortList(),this.dirty=!1);for(n=0;n!==
g;n++){var p=b[n];for(q=n+1;q<g;q++){var u=b[q];if(this.needBroadphaseCollision(p,u)){if(!a.checkBounds(p,u,m))break;this.intersectionTest(p,u,h,k)}}}};a.prototype.sortList=function(){for(var b=this.axisList,h=this.axisIndex,k=b.length,g=0;g!==k;g++){var m=b[g];m.aabbNeedsUpdate&&m.computeAABB()}0===h?a.insertionSortX(b):1===h?a.insertionSortY(b):2===h&&a.insertionSortZ(b)};a.checkBounds=function(b,h,k){if(0===k){var g=b.position.x;var m=h.position.x}else 1===k?(g=b.position.y,m=h.position.y):2===
k&&(g=b.position.z,m=h.position.z);return m-h.boundingRadius<g+b.boundingRadius};a.prototype.autoDetectAxis=function(){for(var b=0,h=0,k=0,g=0,m=0,n=0,q=this.axisList,p=q.length,u=1/p,r=0;r!==p;r++){var t=q[r],v=t.position.x;b+=v;h+=v*v;v=t.position.y;k+=v;g+=v*v;t=t.position.z;m+=t;n+=t*t}b=h-b*b*u;k=g-k*k*u;m=n-m*m*u;this.axisIndex=b>k?b>m?0:2:k>m?1:2};a.prototype.aabbQuery=function(b,h,k){k=k||[];this.dirty&&(this.sortList(),this.dirty=!1);b=this.axisList;for(var g=0;g<b.length;g++){var m=b[g];
m.aabbNeedsUpdate&&m.computeAABB();m.aabb.overlaps(h)&&k.push(m)}return k}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(c,f,l){function a(g,m,n){n=n||{};var q="undefined"!==typeof n.maxForce?n.maxForce:1E6,p=n.pivotA?n.pivotA.clone():new k,u=n.pivotB?n.pivotB.clone():new k;this.axisA=n.axisA?n.axisA.clone():new k;this.axisB=n.axisB?n.axisB.clone():new k;e.call(this,g,p,m,u,q);this.collideConnected=!!n.collideConnected;this.angle="undefined"!==typeof n.angle?n.angle:0;p=this.coneEquation=
new b(g,m,n);g=this.twistEquation=new h(g,m,n);this.twistAngle="undefined"!==typeof n.twistAngle?n.twistAngle:0;p.maxForce=0;p.minForce=-q;g.maxForce=0;g.minForce=-q;this.equations.push(p,g)}f.exports=a;c("./Constraint");var e=c("./PointToPointConstraint"),b=c("../equations/ConeEquation"),h=c("../equations/RotationalEquation");c("../equations/ContactEquation");var k=c("../math/Vec3");a.prototype=new e;a.constructor=a;new k;new k;a.prototype.update=function(){var g=this.bodyA,m=this.bodyB,n=this.coneEquation,
q=this.twistEquation;e.prototype.update.call(this);g.vectorToWorldFrame(this.axisA,n.axisA);m.vectorToWorldFrame(this.axisB,n.axisB);this.axisA.tangents(q.axisA,q.axisA);g.vectorToWorldFrame(q.axisA,q.axisA);this.axisB.tangents(q.axisB,q.axisB);m.vectorToWorldFrame(q.axisB,q.axisB);n.angle=this.angle;q.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],
13:[function(c,f,l){function a(b,h,k){k=e.defaults(k,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=b;this.bodyB=h;this.id=a.idCounter++;this.collideConnected=k.collideConnected;k.wakeUpBodies&&(b&&b.wakeUp(),h&&h.wakeUp())}f.exports=a;var e=c("../utils/Utils");a.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};a.prototype.enable=function(){for(var b=this.equations,h=0;h<b.length;h++)b[h].enabled=!0};a.prototype.disable=
function(){for(var b=this.equations,h=0;h<b.length;h++)b[h].enabled=!1};a.idCounter=0},{"../utils/Utils":53}],14:[function(c,f,l){function a(h,k,g,m){e.call(this,h,k);"undefined"===typeof g&&(g=h.position.distanceTo(k.position));"undefined"===typeof m&&(m=1E6);this.distance=g;h=this.distanceEquation=new b(h,k);this.equations.push(h);h.minForce=-m;h.maxForce=m}f.exports=a;var e=c("./Constraint"),b=c("../equations/ContactEquation");a.prototype=new e;a.prototype.update=function(){var h=this.distanceEquation,
k=.5*this.distance,g=h.ni;this.bodyB.position.vsub(this.bodyA.position,g);g.normalize();g.mult(k,h.ri);g.mult(-k,h.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(c,f,l){function a(n,q,p){p=p||{};var u="undefined"!==typeof p.maxForce?p.maxForce:1E6,r=p.pivotA?p.pivotA.clone():new k,t=p.pivotB?p.pivotB.clone():new k;e.call(this,n,r,q,t,u);(this.axisA=p.axisA?p.axisA.clone():new k(1,0,0)).normalize();(this.axisB=p.axisB?p.axisB.clone():new k(1,0,0)).normalize();r=this.rotationalEquation1=
new b(n,q,p);p=this.rotationalEquation2=new b(n,q,p);n=this.motorEquation=new h(n,q,u);n.enabled=!1;this.equations.push(r,p,n)}f.exports=a;c("./Constraint");var e=c("./PointToPointConstraint"),b=c("../equations/RotationalEquation"),h=c("../equations/RotationalMotorEquation");c("../equations/ContactEquation");var k=c("../math/Vec3");a.prototype=new e;a.constructor=a;a.prototype.enableMotor=function(){this.motorEquation.enabled=!0};a.prototype.disableMotor=function(){this.motorEquation.enabled=!1};
a.prototype.setMotorSpeed=function(n){this.motorEquation.targetVelocity=n};a.prototype.setMotorMaxForce=function(n){this.motorEquation.maxForce=n;this.motorEquation.minForce=-n};var g=new k,m=new k;a.prototype.update=function(){var n=this.bodyA,q=this.bodyB,p=this.motorEquation,u=this.rotationalEquation1,r=this.rotationalEquation2,t=this.axisA,v=this.axisB;e.prototype.update.call(this);n.quaternion.vmult(t,g);q.quaternion.vmult(v,m);g.tangents(u.axisA,r.axisA);u.axisB.copy(m);r.axisB.copy(m);this.motorEquation.enabled&&
(n.quaternion.vmult(this.axisA,p.axisA),q.quaternion.vmult(this.axisB,p.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(c,f,l){function a(k,g,m){m=m||{};var n="undefined"!==typeof m.maxForce?m.maxForce:1E6,q=new h,p=new h,u=new h;k.position.vadd(g.position,u);u.scale(.5,u);g.pointToLocalFrame(u,p);k.pointToLocalFrame(u,q);e.call(this,k,q,g,p,
n);n=this.rotationalEquation1=new b(k,g,m);q=this.rotationalEquation2=new b(k,g,m);k=this.rotationalEquation3=new b(k,g,m);this.equations.push(n,q,k)}f.exports=a;c("./Constraint");var e=c("./PointToPointConstraint"),b=c("../equations/RotationalEquation");c("../equations/RotationalMotorEquation");c("../equations/ContactEquation");var h=c("../math/Vec3");a.prototype=new e;a.constructor=a;new h;new h;a.prototype.update=function(){var k=this.bodyA,g=this.bodyB,m=this.rotationalEquation1,n=this.rotationalEquation2,
q=this.rotationalEquation3;e.prototype.update.call(this);k.vectorToWorldFrame(h.UNIT_X,m.axisA);g.vectorToWorldFrame(h.UNIT_Y,m.axisB);k.vectorToWorldFrame(h.UNIT_Y,n.axisA);g.vectorToWorldFrame(h.UNIT_Z,n.axisB);k.vectorToWorldFrame(h.UNIT_Z,q.axisA);g.vectorToWorldFrame(h.UNIT_X,q.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(c,f,l){function a(k,
g,m,n,q){e.call(this,k,m);q="undefined"!==typeof q?q:1E6;this.pivotA=g?g.clone():new h;this.pivotB=n?n.clone():new h;g=this.equationX=new b(k,m);n=this.equationY=new b(k,m);k=this.equationZ=new b(k,m);this.equations.push(g,n,k);g.minForce=n.minForce=k.minForce=-q;g.maxForce=n.maxForce=k.maxForce=q;g.ni.set(1,0,0);n.ni.set(0,1,0);k.ni.set(0,0,1)}f.exports=a;var e=c("./Constraint"),b=c("../equations/ContactEquation"),h=c("../math/Vec3");a.prototype=new e;a.prototype.update=function(){var k=this.bodyB,
g=this.equationX,m=this.equationY,n=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,g.ri);k.quaternion.vmult(this.pivotB,g.rj);m.ri.copy(g.ri);m.rj.copy(g.rj);n.ri.copy(g.ri);n.rj.copy(g.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(c,f,l){function a(g,m,n){n=n||{};var q="undefined"!==typeof n.maxForce?n.maxForce:1E6;b.call(this,g,m,-q,q);this.axisA=n.axisA?n.axisA.clone():new e(1,0,0);this.axisB=n.axisB?n.axisB.clone():new e(0,1,0);this.angle=
"undefined"!==typeof n.angle?n.angle:0}f.exports=a;var e=c("../math/Vec3");c("../math/Mat3");var b=c("./Equation");a.prototype=new b;a.prototype.constructor=a;var h=new e,k=new e;a.prototype.computeB=function(g){var m=this.a,n=this.b,q=this.axisA,p=this.axisB,u=this.jacobianElementA,r=this.jacobianElementB;q.cross(p,h);p.cross(q,k);u.rotational.copy(k);r.rotational.copy(h);q=Math.cos(this.angle)-q.dot(p);p=this.computeGW();u=this.computeGiMf();return-q*m-p*n-g*u}},{"../math/Mat3":27,"../math/Vec3":30,
"./Equation":20}],19:[function(c,f,l){function a(r,t,v){e.call(this,r,t,0,"undefined"!==typeof v?v:1E6);this.restitution=0;this.ri=new b;this.rj=new b;this.ni=new b}f.exports=a;var e=c("./Equation"),b=c("../math/Vec3");c("../math/Mat3");a.prototype=new e;a.prototype.constructor=a;var h=new b,k=new b,g=new b;a.prototype.computeB=function(r){var t=this.a,v=this.b,x=this.bi,y=this.bj,A=this.ri,D=this.rj,M=x.velocity,L=x.angularVelocity,F=y.velocity,E=y.angularVelocity,H=this.jacobianElementA,T=this.jacobianElementB,
P=this.ni;A.cross(P,h);D.cross(P,k);P.negate(H.spatial);h.negate(H.rotational);T.spatial.copy(P);T.rotational.copy(k);g.copy(y.position);g.vadd(D,g);g.vsub(x.position,g);g.vsub(A,g);x=P.dot(g);y=this.restitution+1;M=y*F.dot(P)-y*M.dot(P)+E.dot(k)-L.dot(h);L=this.computeGiMf();return-x*t-M*v-r*L};var m=new b,n=new b,q=new b,p=new b,u=new b;a.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,q);this.bj.position.vadd(this.rj,p);this.bi.getVelocityAtWorldPoint(q,m);this.bj.getVelocityAtWorldPoint(p,
n);m.vsub(n,u);return this.ni.dot(u)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(c,f,l){function a(p,u,r,t){this.id=a.id++;this.minForce="undefined"===typeof r?-1E6:r;this.maxForce="undefined"===typeof t?1E6:t;this.bi=p;this.bj=u;this.eps=this.b=this.a=0;this.jacobianElementA=new e;this.jacobianElementB=new e;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}f.exports=a;var e=c("../math/JacobianElement");c=c("../math/Vec3");a.prototype.constructor=a;a.id=0;a.prototype.setSpookParams=
function(p,u,r){this.a=4/(r*(1+4*u));this.b=4*u/(1+4*u);this.eps=4/(r*r*p*(1+4*u))};a.prototype.computeB=function(p,u,r){var t=this.computeGW(),v=this.computeGq(),x=this.computeGiMf();return-v*p-t*u-x*r};a.prototype.computeGq=function(){var p=this.jacobianElementB,u=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+p.spatial.dot(u)};var b=new c;a.prototype.computeGW=function(){var p=this.jacobianElementB,u=this.bi,r=this.bj,t=r.velocity;r=r.angularVelocity||b;return this.jacobianElementA.multiplyVectors(u.velocity,
u.angularVelocity||b)+p.multiplyVectors(t,r)};a.prototype.computeGWlambda=function(){var p=this.jacobianElementB,u=this.bi,r=this.bj,t=r.vlambda;r=r.wlambda||b;return this.jacobianElementA.multiplyVectors(u.vlambda,u.wlambda||b)+p.multiplyVectors(t,r)};var h=new c,k=new c,g=new c,m=new c;a.prototype.computeGiMf=function(){var p=this.jacobianElementA,u=this.jacobianElementB,r=this.bi,t=this.bj,v=r.force,x=r.torque,y=t.force,A=t.torque,D=r.invMassSolve,M=t.invMassSolve;r.invInertiaWorldSolve?r.invInertiaWorldSolve.vmult(x,
g):g.set(0,0,0);t.invInertiaWorldSolve?t.invInertiaWorldSolve.vmult(A,m):m.set(0,0,0);v.mult(D,h);y.mult(M,k);return p.multiplyVectors(h,g)+u.multiplyVectors(k,m)};var n=new c;a.prototype.computeGiMGt=function(){var p=this.jacobianElementA,u=this.jacobianElementB,r=this.bi,t=this.bj,v=r.invInertiaWorldSolve,x=t.invInertiaWorldSolve;r=r.invMassSolve+t.invMassSolve;v&&(v.vmult(p.rotational,n),r+=n.dot(p.rotational));x&&(x.vmult(u.rotational,n),r+=n.dot(u.rotational));return r};var q=new c;new c;new c;
new c;new c;new c;a.prototype.addToWlambda=function(p){var u=this.jacobianElementA,r=this.jacobianElementB,t=this.bi,v=this.bj;u.spatial.mult(t.invMassSolve*p,q);t.vlambda.vadd(q,t.vlambda);r.spatial.mult(v.invMassSolve*p,q);v.vlambda.vadd(q,v.vlambda);t.invInertiaWorldSolve&&(t.invInertiaWorldSolve.vmult(u.rotational,q),q.mult(p,q),t.wlambda.vadd(q,t.wlambda));v.invInertiaWorldSolve&&(v.invInertiaWorldSolve.vmult(r.rotational,q),q.mult(p,q),v.wlambda.vadd(q,v.wlambda))};a.prototype.computeC=function(){return this.computeGiMGt()+
this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(c,f,l){function a(g,m,n){e.call(this,g,m,-n,n);this.ri=new b;this.rj=new b;this.t=new b}f.exports=a;var e=c("./Equation"),b=c("../math/Vec3");c("../math/Mat3");a.prototype=new e;a.prototype.constructor=a;var h=new b,k=new b;a.prototype.computeB=function(g){var m=this.b,n=this.rj,q=this.t;this.ri.cross(q,h);n.cross(q,k);n=this.jacobianElementA;var p=this.jacobianElementB;q.negate(n.spatial);h.negate(n.rotational);p.spatial.copy(q);
p.rotational.copy(k);q=this.computeGW();n=this.computeGiMf();return-q*m-g*n}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(c,f,l){function a(g,m,n){n=n||{};var q="undefined"!==typeof n.maxForce?n.maxForce:1E6;b.call(this,g,m,-q,q);this.axisA=n.axisA?n.axisA.clone():new e(1,0,0);this.axisB=n.axisB?n.axisB.clone():new e(0,1,0);this.maxAngle=Math.PI/2}f.exports=a;var e=c("../math/Vec3");c("../math/Mat3");var b=c("./Equation");a.prototype=new b;a.prototype.constructor=a;var h=new e,
k=new e;a.prototype.computeB=function(g){var m=this.a,n=this.b,q=this.axisA,p=this.axisB,u=this.jacobianElementA,r=this.jacobianElementB;q.cross(p,h);p.cross(q,k);u.rotational.copy(k);r.rotational.copy(h);q=Math.cos(this.maxAngle)-q.dot(p);p=this.computeGW();u=this.computeGiMf();return-q*m-p*n-g*u}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(c,f,l){function a(h,k,g){g="undefined"!==typeof g?g:1E6;b.call(this,h,k,-g,g);this.axisA=new e;this.axisB=new e;this.targetVelocity=
0}f.exports=a;var e=c("../math/Vec3");c("../math/Mat3");var b=c("./Equation");a.prototype=new b;a.prototype.constructor=a;a.prototype.computeB=function(h){var k=this.b,g=this.axisB,m=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);g.negate(m.rotational);g=this.computeGW()-this.targetVelocity;m=this.computeGiMf();return-g*k-h*m}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(c,f,l){function a(b,h,k){k=e.defaults(k,{friction:.3,restitution:.3,contactEquationStiffness:1E7,
contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=a.idCounter++;this.materials=[b,h];this.friction=k.friction;this.restitution=k.restitution;this.contactEquationStiffness=k.contactEquationStiffness;this.contactEquationRelaxation=k.contactEquationRelaxation;this.frictionEquationStiffness=k.frictionEquationStiffness;this.frictionEquationRelaxation=k.frictionEquationRelaxation}var e=c("../utils/Utils");f.exports=a;a.idCounter=0},{"../utils/Utils":53}],25:[function(c,
f,l){function a(e){var b="";e=e||{};"string"===typeof e?(b=e,e={}):"object"===typeof e&&(b="");this.name=b;this.id=a.idCounter++;this.friction="undefined"!==typeof e.friction?e.friction:-1;this.restitution="undefined"!==typeof e.restitution?e.restitution:-1}f.exports=a;a.idCounter=0},{}],26:[function(c,f,l){function a(){this.spatial=new e;this.rotational=new e}f.exports=a;var e=c("./Vec3");a.prototype.multiplyElement=function(b){return b.spatial.dot(this.spatial)+b.rotational.dot(this.rotational)};
a.prototype.multiplyVectors=function(b,h){return b.dot(this.spatial)+h.dot(this.rotational)}},{"./Vec3":30}],27:[function(c,f,l){function a(b){this.elements=b?b:[0,0,0,0,0,0,0,0,0]}f.exports=a;var e=c("./Vec3");a.prototype.identity=function(){var b=this.elements;b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1};a.prototype.setZero=function(){var b=this.elements;b[0]=0;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=0;b[6]=0;b[7]=0;b[8]=0};a.prototype.setTrace=function(b){var h=this.elements;h[0]=b.x;
h[4]=b.y;h[8]=b.z};a.prototype.getTrace=function(b){b=b||new e;var h=this.elements;b.x=h[0];b.y=h[4];b.z=h[8]};a.prototype.vmult=function(b,h){h=h||new e;var k=this.elements,g=b.x,m=b.y,n=b.z;h.x=k[0]*g+k[1]*m+k[2]*n;h.y=k[3]*g+k[4]*m+k[5]*n;h.z=k[6]*g+k[7]*m+k[8]*n;return h};a.prototype.smult=function(b){for(var h=0;h<this.elements.length;h++)this.elements[h]*=b};a.prototype.mmult=function(b,h){for(var k=h||new a,g=0;3>g;g++)for(var m=0;3>m;m++){for(var n=0,q=0;3>q;q++)n+=b.elements[g+3*q]*this.elements[q+
3*m];k.elements[g+3*m]=n}return k};a.prototype.scale=function(b,h){h=h||new a;for(var k=this.elements,g=h.elements,m=0;3!==m;m++)g[3*m]=b.x*k[3*m],g[3*m+1]=b.y*k[3*m+1],g[3*m+2]=b.z*k[3*m+2];return h};a.prototype.solve=function(b,h){h=h||new e;for(var k=[],g=0;12>g;g++)k.push(0);var m;for(g=0;3>g;g++)for(m=0;3>m;m++)k[g+4*m]=this.elements[g+3*m];k[3]=b.x;k[7]=b.y;k[11]=b.z;var n=3,q=n;do{g=q-n;if(0===k[g+4*g])for(m=g+1;m<q;m++)if(0!==k[g+4*m]){var p=4;do{var u=4-p;k[u+4*g]+=k[u+4*m]}while(--p);break}if(0!==
k[g+4*g])for(m=g+1;m<q;m++){var r=k[g+4*m]/k[g+4*g];p=4;do u=4-p,k[u+4*m]=u<=g?0:k[u+4*m]-k[u+4*g]*r;while(--p)}}while(--n);h.z=k[11]/k[10];h.y=(k[7]-k[6]*h.z)/k[5];h.x=(k[3]-k[2]*h.z-k[1]*h.y)/k[0];if(isNaN(h.x)||isNaN(h.y)||isNaN(h.z)||Infinity===h.x||Infinity===h.y||Infinity===h.z)throw"Could not solve equation! Got x=["+h.toString()+"], b=["+b.toString()+"], A=["+this.toString()+"]";return h};a.prototype.e=function(b,h,k){if(void 0===k)return this.elements[h+3*b];this.elements[h+3*b]=k};a.prototype.copy=
function(b){for(var h=0;h<b.elements.length;h++)this.elements[h]=b.elements[h];return this};a.prototype.toString=function(){for(var b="",h=0;9>h;h++)b+=this.elements[h]+",";return b};a.prototype.reverse=function(b){b=b||new a;for(var h=[],k=0;18>k;k++)h.push(0);var g;for(k=0;3>k;k++)for(g=0;3>g;g++)h[k+6*g]=this.elements[k+3*g];h[3]=1;h[9]=0;h[15]=0;h[4]=0;h[10]=1;h[16]=0;h[5]=0;h[11]=0;h[17]=1;var m=3,n=m;do{k=n-m;if(0===h[k+6*k])for(g=k+1;g<n;g++)if(0!==h[k+6*g]){var q=6;do{var p=6-q;h[p+6*k]+=
h[p+6*g]}while(--q);break}if(0!==h[k+6*k])for(g=k+1;g<n;g++){var u=h[k+6*g]/h[k+6*k];q=6;do p=6-q,h[p+6*g]=p<=k?0:h[p+6*g]-h[p+6*k]*u;while(--q)}}while(--m);k=2;do{g=k-1;do{u=h[k+6*g]/h[k+6*k];q=6;do p=6-q,h[p+6*g]-=h[p+6*k]*u;while(--q)}while(g--)}while(--k);k=2;do{u=1/h[k+6*k];q=6;do p=6-q,h[p+6*k]*=u;while(--q)}while(k--);k=2;do{g=2;do{p=h[3+g+6*k];if(isNaN(p)||Infinity===p)throw"Could not reverse! A=["+this.toString()+"]";b.e(k,g,p)}while(g--)}while(k--);return b};a.prototype.setRotationFromQuaternion=
function(b){var h=b.x,k=b.y,g=b.z,m=b.w,n=h+h,q=k+k,p=g+g;b=h*n;var u=h*q;h*=p;var r=k*q;k*=p;g*=p;n*=m;q*=m;m*=p;p=this.elements;p[0]=1-(r+g);p[1]=u-m;p[2]=h+q;p[3]=u+m;p[4]=1-(b+g);p[5]=k-n;p[6]=h-q;p[7]=k+n;p[8]=1-(b+r);return this};a.prototype.transpose=function(b){b=b||new a;for(var h=b.elements,k=this.elements,g=0;3!==g;g++)for(var m=0;3!==m;m++)h[3*g+m]=k[3*m+g];return b}},{"./Vec3":30}],28:[function(c,f,l){function a(n,q,p,u){this.x=void 0!==n?n:0;this.y=void 0!==q?q:0;this.z=void 0!==p?p:
0;this.w=void 0!==u?u:1}f.exports=a;var e=c("./Vec3");a.prototype.set=function(n,q,p,u){this.x=n;this.y=q;this.z=p;this.w=u};a.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};a.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};a.prototype.setFromAxisAngle=function(n,q){var p=Math.sin(.5*q);this.x=n.x*p;this.y=n.y*p;this.z=n.z*p;this.w=Math.cos(.5*q)};a.prototype.toAxisAngle=function(n){n=n||new e;this.normalize();var q=2*Math.acos(this.w),p=Math.sqrt(1-
this.w*this.w);.001>p?(n.x=this.x,n.y=this.y,n.z=this.z):(n.x=this.x/p,n.y=this.y/p,n.z=this.z/p);return[n,q]};var b=new e,h=new e;a.prototype.setFromVectors=function(n,q){if(n.isAntiparallelTo(q))n.tangents(b,h),this.setFromAxisAngle(b,Math.PI);else{var p=n.cross(q);this.x=p.x;this.y=p.y;this.z=p.z;this.w=Math.sqrt(Math.pow(n.norm(),2)*Math.pow(q.norm(),2))+n.dot(q);this.normalize()}};var k=new e,g=new e,m=new e;a.prototype.mult=function(n,q){q=q||new a;var p=this.w;k.set(this.x,this.y,this.z);g.set(n.x,
n.y,n.z);q.w=p*n.w-k.dot(g);k.cross(g,m);q.x=p*g.x+n.w*k.x+m.x;q.y=p*g.y+n.w*k.y+m.y;q.z=p*g.z+n.w*k.z+m.z;return q};a.prototype.inverse=function(n){var q=this.x,p=this.y,u=this.z,r=this.w;n=n||new a;this.conjugate(n);q=1/(q*q+p*p+u*u+r*r);n.x*=q;n.y*=q;n.z*=q;n.w*=q;return n};a.prototype.conjugate=function(n){n=n||new a;n.x=-this.x;n.y=-this.y;n.z=-this.z;n.w=this.w;return n};a.prototype.normalize=function(){var n=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===n?this.w=this.z=
this.y=this.x=0:(n=1/n,this.x*=n,this.y*=n,this.z*=n,this.w*=n)};a.prototype.normalizeFast=function(){var n=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===n?this.w=this.z=this.y=this.x=0:(this.x*=n,this.y*=n,this.z*=n,this.w*=n)};a.prototype.vmult=function(n,q){q=q||new e;var p=n.x,u=n.y,r=n.z,t=this.x,v=this.y,x=this.z,y=this.w,A=y*p+v*r-x*u,D=y*u+x*p-t*r,M=y*r+t*u-v*p;p=-t*p-v*u-x*r;q.x=A*y+p*-t+D*-x-M*-v;q.y=D*y+p*-v+M*-t-A*-x;q.z=M*y+p*-x+A*-v-D*-t;return q};a.prototype.copy=
function(n){this.x=n.x;this.y=n.y;this.z=n.z;this.w=n.w;return this};a.prototype.toEuler=function(n,q){q=q||"YZX";var p=this.x,u=this.y,r=this.z,t=this.w;switch(q){case "YZX":var v=p*u+r*t;if(.499<v){var x=2*Math.atan2(p,t);var y=Math.PI/2;var A=0}-.499>v&&(x=-2*Math.atan2(p,t),y=-Math.PI/2,A=0);isNaN(x)&&(A=r*r,x=Math.atan2(2*u*t-2*p*r,1-2*u*u-2*A),y=Math.asin(2*v),A=Math.atan2(2*p*t-2*u*r,1-2*p*p-2*A));break;default:throw Error("Euler order "+q+" not supported yet.");}n.y=x;n.z=y;n.x=A};a.prototype.setFromEuler=
function(n,q,p,u){u=u||"XYZ";var r=Math.cos(n/2),t=Math.cos(q/2),v=Math.cos(p/2);n=Math.sin(n/2);q=Math.sin(q/2);p=Math.sin(p/2);"XYZ"===u?(this.x=n*t*v+r*q*p,this.y=r*q*v-n*t*p,this.z=r*t*p+n*q*v,this.w=r*t*v-n*q*p):"YXZ"===u?(this.x=n*t*v+r*q*p,this.y=r*q*v-n*t*p,this.z=r*t*p-n*q*v,this.w=r*t*v+n*q*p):"ZXY"===u?(this.x=n*t*v-r*q*p,this.y=r*q*v+n*t*p,this.z=r*t*p+n*q*v,this.w=r*t*v-n*q*p):"ZYX"===u?(this.x=n*t*v-r*q*p,this.y=r*q*v+n*t*p,this.z=r*t*p-n*q*v,this.w=r*t*v+n*q*p):"YZX"===u?(this.x=n*
t*v+r*q*p,this.y=r*q*v+n*t*p,this.z=r*t*p-n*q*v,this.w=r*t*v-n*q*p):"XZY"===u&&(this.x=n*t*v-r*q*p,this.y=r*q*v-n*t*p,this.z=r*t*p+n*q*v,this.w=r*t*v+n*q*p);return this};a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(c,f,l){function a(k){k=k||{};this.position=new e;k.position&&this.position.copy(k.position);this.quaternion=new b;k.quaternion&&this.quaternion.copy(k.quaternion)}var e=c("./Vec3"),b=c("./Quaternion");f.exports=a;var h=new b;a.pointToLocalFrame=
function(k,g,m,n){n=n||new e;m.vsub(k,n);g.conjugate(h);h.vmult(n,n);return n};a.prototype.pointToLocal=function(k,g){return a.pointToLocalFrame(this.position,this.quaternion,k,g)};a.pointToWorldFrame=function(k,g,m,n){n=n||new e;g.vmult(m,n);n.vadd(k,n);return n};a.prototype.pointToWorld=function(k,g){return a.pointToWorldFrame(this.position,this.quaternion,k,g)};a.prototype.vectorToWorldFrame=function(k,g){g=g||new e;this.quaternion.vmult(k,g);return g};a.vectorToWorldFrame=function(k,g,m){k.vmult(g,
m);return m};a.vectorToLocalFrame=function(k,g,m,n){n=n||new e;g.w*=-1;g.vmult(m,n);g.w*=-1;return n}},{"./Quaternion":28,"./Vec3":30}],30:[function(c,f,l){function a(g,m,n){this.x=g||0;this.y=m||0;this.z=n||0}f.exports=a;var e=c("./Mat3");a.ZERO=new a(0,0,0);a.UNIT_X=new a(1,0,0);a.UNIT_Y=new a(0,1,0);a.UNIT_Z=new a(0,0,1);a.prototype.cross=function(g,m){var n=g.x,q=g.y,p=g.z,u=this.x,r=this.y,t=this.z;m=m||new a;m.x=r*p-t*q;m.y=t*n-u*p;m.z=u*q-r*n;return m};a.prototype.set=function(g,m,n){this.x=
g;this.y=m;this.z=n;return this};a.prototype.setZero=function(){this.x=this.y=this.z=0};a.prototype.vadd=function(g,m){if(m)m.x=g.x+this.x,m.y=g.y+this.y,m.z=g.z+this.z;else return new a(this.x+g.x,this.y+g.y,this.z+g.z)};a.prototype.vsub=function(g,m){if(m)m.x=this.x-g.x,m.y=this.y-g.y,m.z=this.z-g.z;else return new a(this.x-g.x,this.y-g.y,this.z-g.z)};a.prototype.crossmat=function(){return new e([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};a.prototype.normalize=function(){var g=this.x,
m=this.y,n=this.z;g=Math.sqrt(g*g+m*m+n*n);0<g?(m=1/g,this.x*=m,this.y*=m,this.z*=m):this.z=this.y=this.x=0;return g};a.prototype.unit=function(g){g=g||new a;var m=this.x,n=this.y,q=this.z,p=Math.sqrt(m*m+n*n+q*q);0<p?(p=1/p,g.x=m*p,g.y=n*p,g.z=q*p):(g.x=1,g.y=0,g.z=0);return g};a.prototype.norm=function(){var g=this.x,m=this.y,n=this.z;return Math.sqrt(g*g+m*m+n*n)};a.prototype.length=a.prototype.norm;a.prototype.norm2=function(){return this.dot(this)};a.prototype.lengthSquared=a.prototype.norm2;
a.prototype.distanceTo=function(g){var m=this.x,n=this.y,q=this.z,p=g.x,u=g.y;g=g.z;return Math.sqrt((p-m)*(p-m)+(u-n)*(u-n)+(g-q)*(g-q))};a.prototype.distanceSquared=function(g){var m=this.x,n=this.y,q=this.z,p=g.x,u=g.y;g=g.z;return(p-m)*(p-m)+(u-n)*(u-n)+(g-q)*(g-q)};a.prototype.mult=function(g,m){m=m||new a;var n=this.y,q=this.z;m.x=g*this.x;m.y=g*n;m.z=g*q;return m};a.prototype.scale=a.prototype.mult;a.prototype.dot=function(g){return this.x*g.x+this.y*g.y+this.z*g.z};a.prototype.isZero=function(){return 0===
this.x&&0===this.y&&0===this.z};a.prototype.negate=function(g){g=g||new a;g.x=-this.x;g.y=-this.y;g.z=-this.z;return g};var b=new a,h=new a;a.prototype.tangents=function(g,m){var n=this.norm();0<n?(n=1/n,b.set(this.x*n,this.y*n,this.z*n),.9>Math.abs(b.x)?h.set(1,0,0):h.set(0,1,0),b.cross(h,g),b.cross(g,m)):(g.set(1,0,0),m.set(0,1,0))};a.prototype.toString=function(){return this.x+","+this.y+","+this.z};a.prototype.toArray=function(){return[this.x,this.y,this.z]};a.prototype.copy=function(g){this.x=
g.x;this.y=g.y;this.z=g.z;return this};a.prototype.lerp=function(g,m,n){var q=this.x,p=this.y,u=this.z;n.x=q+(g.x-q)*m;n.y=p+(g.y-p)*m;n.z=u+(g.z-u)*m};a.prototype.almostEquals=function(g,m){void 0===m&&(m=1E-6);return Math.abs(this.x-g.x)>m||Math.abs(this.y-g.y)>m||Math.abs(this.z-g.z)>m?!1:!0};a.prototype.almostZero=function(g){void 0===g&&(g=1E-6);return Math.abs(this.x)>g||Math.abs(this.y)>g||Math.abs(this.z)>g?!1:!0};var k=new a;a.prototype.isAntiparallelTo=function(g,m){this.negate(k);return k.almostEquals(g,
m)};a.prototype.clone=function(){return new a(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(c,f,l){function a(H){H=H||{};e.apply(this);this.id=a.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new b;this.collisionFilterGroup="number"===typeof H.collisionFilterGroup?H.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof H.collisionFilterMask?H.collisionFilterMask:1;this.collisionResponse=!0;this.position=new b;H.position&&this.position.copy(H.position);this.previousPosition=
new b;this.initPosition=new b;this.velocity=new b;H.velocity&&this.velocity.copy(H.velocity);this.initVelocity=new b;this.force=new b;var T="number"===typeof H.mass?H.mass:0;this.mass=T;this.invMass=0<T?1/T:0;this.material=H.material||null;this.linearDamping="number"===typeof H.linearDamping?H.linearDamping:.01;this.type=0>=T?a.STATIC:a.DYNAMIC;typeof H.type===typeof a.STATIC&&(this.type=H.type);this.allowSleep="undefined"!==typeof H.allowSleep?H.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit=
"undefined"!==typeof H.sleepSpeedLimit?H.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!==typeof H.sleepTimeLimit?H.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new b;this.quaternion=new k;H.quaternion&&this.quaternion.copy(H.quaternion);this.initQuaternion=new k;this.angularVelocity=new b;H.angularVelocity&&this.angularVelocity.copy(H.angularVelocity);this.initAngularVelocity=new b;this.interpolatedPosition=new b;this.interpolatedQuaternion=new k;this.shapes=
[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new b;this.invInertia=new b;this.invInertiaWorld=new h;this.invMassSolve=0;this.invInertiaSolve=new b;this.invInertiaWorldSolve=new h;this.fixedRotation="undefined"!==typeof H.fixedRotation?H.fixedRotation:!1;this.angularDamping="undefined"!==typeof H.angularDamping?H.angularDamping:.01;this.userData="undefined"!==typeof H.userData?H.userData:null;this.aabb=new g;this.aabbNeedsUpdate=!0;this.wlambda=new b;H.shape&&this.addShape(H.shape);
this.updateMassProperties()}f.exports=a;var e=c("../utils/EventTarget");c("../shapes/Shape");var b=c("../math/Vec3"),h=c("../math/Mat3"),k=c("../math/Quaternion");c("../material/Material");var g=c("../collision/AABB"),m=c("../shapes/Box");a.prototype=new e;a.prototype.constructor=a;a.DYNAMIC=1;a.STATIC=2;a.KINEMATIC=4;a.AWAKE=0;a.SLEEPY=1;a.SLEEPING=2;a.idCounter=0;a.prototype.wakeUp=function(){var H=this.sleepState;this.sleepState=0;H===a.SLEEPING&&this.dispatchEvent({type:"wakeup"})};a.prototype.sleep=
function(){this.sleepState=a.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};a.sleepyEvent={type:"sleepy"};a.sleepEvent={type:"sleep"};a.prototype.sleepTick=function(H){if(this.allowSleep){var T=this.sleepState,P=this.velocity.norm2()+this.angularVelocity.norm2(),ia=Math.pow(this.sleepSpeedLimit,2);T===a.AWAKE&&P<ia?(this.sleepState=a.SLEEPY,this.timeLastSleepy=H,this.dispatchEvent(a.sleepyEvent)):T===a.SLEEPY&&P>ia?this.wakeUp():T===a.SLEEPY&&H-this.timeLastSleepy>this.sleepTimeLimit&&
(this.sleep(),this.dispatchEvent(a.sleepEvent))}};a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};a.prototype.pointToLocalFrame=function(H,T){T=T||new b;H.vsub(this.position,T);this.quaternion.conjugate().vmult(T,T);return T};a.prototype.vectorToLocalFrame=
function(H,T){T=T||new b;this.quaternion.conjugate().vmult(H,T);return T};a.prototype.pointToWorldFrame=function(H,T){T=T||new b;this.quaternion.vmult(H,T);T.vadd(this.position,T);return T};a.prototype.vectorToWorldFrame=function(H,T){T=T||new b;this.quaternion.vmult(H,T);return T};var n=new b,q=new k;a.prototype.addShape=function(H,T,P){var ia=new b,R=new k;T&&ia.copy(T);P&&R.copy(P);this.shapes.push(H);this.shapeOffsets.push(ia);this.shapeOrientations.push(R);this.updateMassProperties();this.updateBoundingRadius();
this.aabbNeedsUpdate=!0;return this};a.prototype.updateBoundingRadius=function(){for(var H=this.shapes,T=this.shapeOffsets,P=H.length,ia=0,R=0;R!==P;R++){var ba=H[R];ba.updateBoundingSphereRadius();var O=T[R].norm();ba=ba.boundingSphereRadius;O+ba>ia&&(ia=O+ba)}this.boundingRadius=ia};var p=new g;a.prototype.computeAABB=function(){for(var H=this.shapes,T=this.shapeOffsets,P=this.shapeOrientations,ia=H.length,R=this.quaternion,ba=this.aabb,O=0;O!==ia;O++){var C=H[O];P[O].mult(R,q);q.vmult(T[O],n);
n.vadd(this.position,n);C.calculateWorldAABB(n,q,p.lowerBound,p.upperBound);0===O?ba.copy(p):ba.extend(p)}this.aabbNeedsUpdate=!1};var u=new h,r=new h;new h;a.prototype.updateInertiaWorld=function(H){var T=this.invInertia;if(T.x!==T.y||T.y!==T.z||H)u.setRotationFromQuaternion(this.quaternion),u.transpose(r),u.scale(T,u),u.mmult(r,this.invInertiaWorld)};var t=new b,v=new b;a.prototype.applyForce=function(H,T){this.type===a.DYNAMIC&&(T.vsub(this.position,t),t.cross(H,v),this.force.vadd(H,this.force),
this.torque.vadd(v,this.torque))};var x=new b,y=new b;a.prototype.applyLocalForce=function(H,T){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(H,x),this.pointToWorldFrame(T,y),this.applyForce(x,y))};var A=new b,D=new b,M=new b;a.prototype.applyImpulse=function(H,T){this.type===a.DYNAMIC&&(T.vsub(this.position,A),D.copy(H),D.mult(this.invMass,D),this.velocity.vadd(D,this.velocity),A.cross(H,M),this.invInertiaWorld.vmult(M,M),this.angularVelocity.vadd(M,this.angularVelocity))};var L=new b,F=new b;
a.prototype.applyLocalImpulse=function(H,T){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(H,L),this.pointToWorldFrame(T,F),this.applyImpulse(L,F))};var E=new b;a.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var H=this.inertia,T=this.fixedRotation;this.computeAABB();E.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);m.calculateInertia(E,this.mass,H);this.invInertia.set(0<
H.x&&!T?1/H.x:0,0<H.y&&!T?1/H.y:0,0<H.z&&!T?1/H.z:0);this.updateInertiaWorld(!0)};a.prototype.getVelocityAtWorldPoint=function(H,T){var P=new b;H.vsub(this.position,P);this.angularVelocity.cross(P,T);this.velocity.vadd(T,T);return T}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(c,f,l){function a(P){this.chassisBody=P.chassisBody;this.wheelInfos=[];this.sliding=
!1;this.world=null;this.indexRightAxis="undefined"!==typeof P.indexRightAxis?P.indexRightAxis:1;this.indexForwardAxis="undefined"!==typeof P.indexForwardAxis?P.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof P.indexUpAxis?P.indexUpAxis:2}function e(P,ia,R){var ba=D,O=M,C=L,z=F;ia.vsub(P.position,ba);ba.cross(R,O);P.invInertiaWorld.vmult(O,z);z.cross(ba,C);return P.invMass+R.dot(C)}c("./Body");var b=c("../math/Vec3"),h=c("../math/Quaternion");c("../collision/RaycastResult");l=c("../collision/Ray");
var k=c("../objects/WheelInfo");f.exports=a;new b;new b;new b;var g=new b,m=new b,n=new b;new l;a.prototype.addWheel=function(P){P=P||{};P=new k(P);var ia=this.wheelInfos.length;this.wheelInfos.push(P);return ia};a.prototype.setSteeringValue=function(P,ia){this.wheelInfos[ia].steering=P};new b;a.prototype.applyEngineForce=function(P,ia){this.wheelInfos[ia].engineForce=P};a.prototype.setBrake=function(P,ia){this.wheelInfos[ia].brake=P};a.prototype.addToWorld=function(P){P.add(this.chassisBody);var ia=
this;this.preStepCallback=function(){ia.updateVehicle(P.dt)};P.addEventListener("preStep",this.preStepCallback);this.world=P};a.prototype.getVehicleAxisWorld=function(P,ia){ia.set(0===P?1:0,1===P?1:0,2===P?1:0);this.chassisBody.vectorToWorldFrame(ia,ia)};a.prototype.updateVehicle=function(P){for(var ia=this.wheelInfos,R=ia.length,ba=this.chassisBody,O=0;O<R;O++)this.updateWheelTransform(O);this.currentVehicleSpeedKmHour=3.6*ba.velocity.norm();O=new b;this.getVehicleAxisWorld(this.indexForwardAxis,
O);0>O.dot(ba.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(O=0;O<R;O++)this.castRay(ia[O]);this.updateSuspension(P);var C=new b,z=new b;for(O=0;O<R;O++){var w=ia[O],B=w.suspensionForce;B>w.maxSuspensionForce&&(B=w.maxSuspensionForce);w.raycastResult.hitNormalWorld.scale(B*P,C);w.raycastResult.hitPointWorld.vsub(ba.position,z);ba.applyImpulse(C,w.raycastResult.hitPointWorld)}this.updateFriction(P);C=new b;z=new b;B=new b;for(O=0;O<R;O++){w=ia[O];ba.getVelocityAtWorldPoint(w.chassisConnectionPointWorld,
B);var G=1;switch(this.indexUpAxis){case 1:G=-1}if(w.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,z);var K=z.dot(w.raycastResult.hitNormalWorld);w.raycastResult.hitNormalWorld.scale(K,C);z.vsub(C,z);K=z.dot(B);w.deltaRotation=G*K*P/w.radius}!w.sliding&&w.isInContact||0===w.engineForce||!w.useCustomSlidingRotationalSpeed||(w.deltaRotation=(0<w.engineForce?1:-1)*w.customSlidingRotationalSpeed*P);Math.abs(w.brake)>Math.abs(w.engineForce)&&(w.deltaRotation=0);w.rotation+=w.deltaRotation;
w.deltaRotation*=.99}};a.prototype.updateSuspension=function(P){P=this.chassisBody.mass;for(var ia=this.wheelInfos,R=ia.length,ba=0;ba<R;ba++){var O=ia[ba];if(O.isInContact){var C=O.suspensionStiffness*(O.suspensionRestLength-O.suspensionLength)*O.clippedInvContactDotSuspension;var z=O.suspensionRelativeVelocity;C-=(0>z?O.dampingCompression:O.dampingRelaxation)*z;O.suspensionForce=C*P;0>O.suspensionForce&&(O.suspensionForce=0)}else O.suspensionForce=0}};a.prototype.removeFromWorld=function(P){P.remove(this.chassisBody);
P.removeEventListener("preStep",this.preStepCallback);this.world=null};var q=new b,p=new b;a.prototype.castRay=function(P){this.updateWheelTransformWorld(P);var ia=this.chassisBody,R=-1;P.directionWorld.scale(P.suspensionRestLength+P.radius,q);var ba=P.chassisConnectionPointWorld;ba.vadd(q,p);var O=P.raycastResult;O.reset();var C=ia.collisionResponse;ia.collisionResponse=!1;this.world.rayTest(ba,p,O);ia.collisionResponse=C;ba=O.body;P.raycastResult.groundObject=0;ba?(R=O.distance,P.raycastResult.hitNormalWorld=
O.hitNormalWorld,P.isInContact=!0,P.suspensionLength=O.distance-P.radius,O=P.suspensionRestLength-P.maxSuspensionTravel,ba=P.suspensionRestLength+P.maxSuspensionTravel,P.suspensionLength<O&&(P.suspensionLength=O),P.suspensionLength>ba&&(P.suspensionLength=ba,P.raycastResult.reset()),O=P.raycastResult.hitNormalWorld.dot(P.directionWorld),ba=new b,ia.getVelocityAtWorldPoint(P.raycastResult.hitPointWorld,ba),ia=P.raycastResult.hitNormalWorld.dot(ba),-.1<=O?(P.suspensionRelativeVelocity=0,P.clippedInvContactDotSuspension=
10):(O=-1/O,P.suspensionRelativeVelocity=ia*O,P.clippedInvContactDotSuspension=O)):(P.suspensionLength=P.suspensionRestLength+0*P.maxSuspensionTravel,P.suspensionRelativeVelocity=0,P.directionWorld.scale(-1,P.raycastResult.hitNormalWorld),P.clippedInvContactDotSuspension=1);return R};a.prototype.updateWheelTransformWorld=function(P){P.isInContact=!1;var ia=this.chassisBody;ia.pointToWorldFrame(P.chassisConnectionPointLocal,P.chassisConnectionPointWorld);ia.vectorToWorldFrame(P.directionLocal,P.directionWorld);
ia.vectorToWorldFrame(P.axleLocal,P.axleWorld)};a.prototype.updateWheelTransform=function(P){P=this.wheelInfos[P];this.updateWheelTransformWorld(P);P.directionLocal.scale(-1,g);m.copy(P.axleLocal);g.cross(m,n);n.normalize();m.normalize();var ia=P.steering,R=new h;R.setFromAxisAngle(g,ia);ia=new h;ia.setFromAxisAngle(m,P.rotation);var ba=P.worldTransform.quaternion;this.chassisBody.quaternion.mult(R,ba);ba.mult(ia,ba);ba.normalize();R=P.worldTransform.position;R.copy(P.directionWorld);R.scale(P.suspensionLength,
R);R.vadd(P.chassisConnectionPointWorld,R)};var u=[new b(1,0,0),new b(0,1,0),new b(0,0,1)];a.prototype.getWheelTransformWorld=function(P){return this.wheelInfos[P].worldTransform};var r=new b,t=[],v=[];a.prototype.updateFriction=function(P){for(var ia=this.wheelInfos,R=ia.length,ba=this.chassisBody,O=0,C=0;C<R;C++){var z=ia[C],w=z.raycastResult.body;w&&O++;z.sideImpulse=0;z.forwardImpulse=0;v[C]||(v[C]=new b);t[C]||(t[C]=new b)}for(C=0;C<R;C++)if(z=ia[C],w=z.raycastResult.body){var B=t[C];this.getWheelTransformWorld(C).vectorToWorldFrame(u[this.indexRightAxis],
B);O=z.raycastResult.hitNormalWorld;var G=B.dot(O);O.scale(G,r);B.vsub(r,B);B.normalize();O.cross(B,v[C]);v[C].normalize();O=z;G=ba;var K=z.raycastResult.hitPointWorld,N=z.raycastResult.hitPointWorld;if(1.1<B.norm2())w=0;else{var I=E,U=H,aa=T;G.getVelocityAtWorldPoint(K,I);w.getVelocityAtWorldPoint(N,U);I.vsub(U,aa);w=-.2*B.dot(aa)*(1/(G.invMass+w.invMass))}O.sideImpulse=w;z.sideImpulse*=1}this.sliding=!1;for(C=0;C<R;C++){z=ia[C];w=z.raycastResult.body;G=0;z.slipInfo=1;if(w){O=z.brake?z.brake:0;I=
ba;K=w;N=z.raycastResult.hitPointWorld;B=v[C];G=O;U=N;aa=x;var S=y,Z=A;I.getVelocityAtWorldPoint(U,aa);K.getVelocityAtWorldPoint(U,S);aa.vsub(S,Z);U=B.dot(Z);I=e(I,N,B);K=e(K,N,B);K=1/(I+K)*-U;G<K&&(K=G);K<-G&&(K=-G);G=K;G+=z.engineForce*P;O/=G;z.slipInfo*=O}z.forwardImpulse=0;z.skidInfo=1;w&&(z.skidInfo=1,w=z.suspensionForce*P*z.frictionSlip,O=w*w,z.forwardImpulse=G,G=.5*z.forwardImpulse,K=1*z.sideImpulse,G=G*G+K*K,z.sliding=!1,G>O&&(this.sliding=!0,z.sliding=!0,O=w/Math.sqrt(G),z.skidInfo*=O))}if(this.sliding)for(C=
0;C<R;C++)z=ia[C],0!==z.sideImpulse&&1>z.skidInfo&&(z.forwardImpulse*=z.skidInfo,z.sideImpulse*=z.skidInfo);for(C=0;C<R;C++)z=ia[C],P=new b,P.copy(z.raycastResult.hitPointWorld),0!==z.forwardImpulse&&(w=new b,v[C].scale(z.forwardImpulse,w),ba.applyImpulse(w,P)),0!==z.sideImpulse&&(w=z.raycastResult.body,O=new b,O.copy(z.raycastResult.hitPointWorld),G=new b,t[C].scale(z.sideImpulse,G),ba.pointToLocalFrame(P,P),P["xyz"[this.indexUpAxis]]*=z.rollInfluence,ba.pointToWorldFrame(P,P),ba.applyImpulse(G,
P),G.scale(-1,G),w.applyImpulse(G,O))};var x=new b,y=new b,A=new b,D=new b,M=new b,L=new b,F=new b,E=new b,H=new b,T=new b},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(c,f,l){function a(q){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof q.coordinateSystem?new k(1,2,3):q.coordinateSystem.clone();this.chassisBody=q.chassisBody;this.chassisBody||(q=new h(new k(5,2,.5)),this.chassisBody=
new e(1,q));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var e=c("./Body"),b=c("../shapes/Sphere"),h=c("../shapes/Box"),k=c("../math/Vec3"),g=c("../constraints/HingeConstraint");f.exports=a;a.prototype.addWheel=function(q){q=q||{};var p=q.body;p||(p=new e(1,new b(1.2)));this.wheelBodies.push(p);this.wheelForces.push(0);new k;var u="undefined"!==typeof q.position?q.position.clone():new k,r=new k;this.chassisBody.pointToWorldFrame(u,r);p.position.set(r.x,r.y,r.z);q="undefined"!==typeof q.axis?
q.axis.clone():new k(0,1,0);this.wheelAxes.push(q);p=new g(this.chassisBody,p,{pivotA:u,axisA:q,pivotB:k.ZERO,axisB:q,collideConnected:!1});this.constraints.push(p);return this.wheelBodies.length-1};a.prototype.setSteeringValue=function(q,p){var u=this.wheelAxes[p],r=Math.cos(q),t=Math.sin(q),v=u.x;u=u.y;this.constraints[p].axisA.set(r*v-t*u,t*v+r*u,0)};a.prototype.setMotorSpeed=function(q,p){var u=this.constraints[p];u.enableMotor();u.motorTargetVelocity=q};a.prototype.disableMotor=function(q){this.constraints[q].disableMotor()};
var m=new k;a.prototype.setWheelForce=function(q,p){this.wheelForces[p]=q};a.prototype.applyWheelForce=function(q,p){var u=this.wheelBodies[p],r=u.torque;this.wheelAxes[p].scale(q,m);u.vectorToWorldFrame(m,m);r.vadd(m,r)};a.prototype.addToWorld=function(q){for(var p=this.constraints,u=this.wheelBodies.concat([this.chassisBody]),r=0;r<u.length;r++)q.add(u[r]);for(r=0;r<p.length;r++)q.addConstraint(p[r]);q.addEventListener("preStep",this._update.bind(this))};a.prototype._update=function(){for(var q=
this.wheelForces,p=0;p<q.length;p++)this.applyWheelForce(q[p],p)};a.prototype.removeFromWorld=function(q){for(var p=this.constraints,u=this.wheelBodies.concat([this.chassisBody]),r=0;r<u.length;r++)q.remove(u[r]);for(r=0;r<p.length;r++)q.removeConstraint(p[r])};var n=new k;a.prototype.getWheelSpeed=function(q){var p=this.wheelBodies[q].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[q],n);return p.dot(n)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,
"../shapes/Sphere":44,"./Body":31}],34:[function(c,f,l){function a(){this.particles=[];this.speedOfSound=this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}f.exports=a;c("../shapes/Shape");f=c("../math/Vec3");c("../math/Quaternion");c("../shapes/Particle");c("../objects/Body");c("../material/Material");a.prototype.add=function(q){this.particles.push(q);this.neighbors.length<this.particles.length&&this.neighbors.push([])};a.prototype.remove=
function(q){q=this.particles.indexOf(q);-1!==q&&(this.particles.splice(q,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var e=new f;a.prototype.getNeighbors=function(q,p){for(var u=this.particles.length,r=q.id,t=this.smoothingRadius*this.smoothingRadius,v=0;v!==u;v++){var x=this.particles[v];x.position.vsub(q.position,e);r!==x.id&&e.norm2()<t&&p.push(x)}};var b=new f,h=new f,k=new f,g=new f,m=new f,n=new f;a.prototype.update=function(){for(var q=this.particles.length,p=this.speedOfSound,
u=this.eps,r=0;r!==q;r++){var t=this.particles[r],v=this.neighbors[r];v.length=0;this.getNeighbors(t,v);v.push(this.particles[r]);for(var x=v.length,y=0,A=0;A!==x;A++){t.position.vsub(v[A].position,b);var D=b.norm();D=this.w(D);y+=v[A].mass*D}this.densities[r]=y;this.pressures[r]=p*p*(this.densities[r]-this.density)}for(r=0;r!==q;r++){p=this.particles[r];h.set(0,0,0);k.set(0,0,0);v=this.neighbors[r];x=v.length;for(A=0;A!==x;A++)y=v[A],p.position.vsub(y.position,m),D=m.norm(),t=-y.mass*(this.pressures[r]/
(this.densities[r]*this.densities[r]+u)+this.pressures[A]/(this.densities[A]*this.densities[A]+u)),this.gradw(m,g),g.mult(t,g),h.vadd(g,h),y.velocity.vsub(p.velocity,n),n.mult(1/(1E-4+this.densities[r]*this.densities[A])*this.viscosity*y.mass,n),t=this.nablaw(D),n.mult(t,n),k.vadd(n,k);k.mult(p.mass,k);h.mult(p.mass,h);p.force.vadd(k,p.force);p.force.vadd(h,p.force)}};a.prototype.w=function(q){var p=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(p,9))*Math.pow(p*p-q*q,3)};a.prototype.gradw=
function(q,p){var u=q.norm(),r=this.smoothingRadius;q.mult(945/(32*Math.PI*Math.pow(r,9))*Math.pow(r*r-u*u,2),p)};a.prototype.nablaw=function(q){var p=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(p,9))*(p*p-q*q)*(7*q*q-3*p*p)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(c,f,l){function a(v,x,y){y=y||{};this.restLength="number"===typeof y.restLength?y.restLength:1;this.stiffness=y.stiffness||
100;this.damping=y.damping||1;this.bodyA=v;this.bodyB=x;this.localAnchorA=new e;this.localAnchorB=new e;y.localAnchorA&&this.localAnchorA.copy(y.localAnchorA);y.localAnchorB&&this.localAnchorB.copy(y.localAnchorB);y.worldAnchorA&&this.setWorldAnchorA(y.worldAnchorA);y.worldAnchorB&&this.setWorldAnchorB(y.worldAnchorB)}var e=c("../math/Vec3");f.exports=a;a.prototype.setWorldAnchorA=function(v){this.bodyA.pointToLocalFrame(v,this.localAnchorA)};a.prototype.setWorldAnchorB=function(v){this.bodyB.pointToLocalFrame(v,
this.localAnchorB)};a.prototype.getWorldAnchorA=function(v){this.bodyA.pointToWorldFrame(this.localAnchorA,v)};a.prototype.getWorldAnchorB=function(v){this.bodyB.pointToWorldFrame(this.localAnchorB,v)};var b=new e,h=new e,k=new e,g=new e,m=new e,n=new e,q=new e,p=new e,u=new e,r=new e,t=new e;a.prototype.applyForce=function(){var v=this.stiffness,x=this.damping,y=this.restLength,A=this.bodyA,D=this.bodyB;this.getWorldAnchorA(m);this.getWorldAnchorB(n);m.vsub(A.position,q);n.vsub(D.position,p);n.vsub(m,
b);var M=b.norm();h.copy(b);h.normalize();D.velocity.vsub(A.velocity,k);D.angularVelocity.cross(p,t);k.vadd(t,k);A.angularVelocity.cross(q,t);k.vsub(t,k);h.mult(-v*(M-y)-x*k.dot(h),g);A.force.vsub(g,A.force);D.force.vadd(g,D.force);q.cross(g,u);p.cross(g,r);A.torque.vsub(u,A.torque);D.torque.vadd(r,D.torque)}},{"../math/Vec3":30}],36:[function(c,f,l){function a(n){n=k.defaults(n,{chassisConnectionPointLocal:new e,chassisConnectionPointWorld:new e,directionLocal:new e,directionWorld:new e,axleLocal:new e,
axleWorld:new e,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=n.maxSuspensionTravel;
this.customSlidingRotationalSpeed=n.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=n.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=n.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=n.chassisConnectionPointWorld.clone();this.directionLocal=n.directionLocal.clone();this.directionWorld=n.directionWorld.clone();this.axleLocal=n.axleLocal.clone();this.axleWorld=n.axleWorld.clone();this.suspensionRestLength=n.suspensionRestLength;
this.suspensionMaxLength=n.suspensionMaxLength;this.radius=n.radius;this.suspensionStiffness=n.suspensionStiffness;this.dampingCompression=n.dampingCompression;this.dampingRelaxation=n.dampingRelaxation;this.frictionSlip=n.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=n.rollInfluence;this.maxSuspensionForce=n.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=n.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=
this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new h;this.worldTransform=new b;this.isInContact=!1}var e=c("../math/Vec3"),b=c("../math/Transform"),h=c("../collision/RaycastResult"),k=c("../utils/Utils");f.exports=a;var g=new e,m=new e;g=new e;a.prototype.updateWheel=function(n){var q=this.raycastResult;if(this.isInContact){var p=q.hitNormalWorld.dot(q.directionWorld);q.hitPointWorld.vsub(n.position,m);n.getVelocityAtWorldPoint(m,g);n=
q.hitNormalWorld.dot(g);-.1<=p?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(p=-1/p,this.suspensionRelativeVelocity=n*p,this.clippedInvContactDotSuspension=p)}else q.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,q.directionWorld.scale(-1,q.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(c,f,l){function a(m){e.call(this);this.type=
e.types.BOX;this.halfExtents=m;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}f.exports=a;var e=c("./Shape"),b=c("../math/Vec3"),h=c("./ConvexPolyhedron");a.prototype=new e;a.prototype.constructor=a;a.prototype.updateConvexPolyhedronRepresentation=function(){var m=this.halfExtents.x,n=this.halfExtents.y,q=this.halfExtents.z;m=[new b(-m,-n,-q),new b(m,-n,-q),new b(m,n,-q),new b(-m,n,-q),new b(-m,-n,q),new b(m,-n,q),new b(m,n,q),
new b(-m,n,q)];new b(0,0,1);new b(0,1,0);new b(1,0,0);this.convexPolyhedronRepresentation=m=new h(m,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]);m.material=this.material};a.prototype.calculateLocalInertia=function(m,n){n=n||new b;a.calculateInertia(this.halfExtents,m,n);return n};a.calculateInertia=function(m,n,q){q.x=1/12*n*(4*m.y*m.y+4*m.z*m.z);q.y=1/12*n*(4*m.x*m.x+4*m.z*m.z);q.z=1/12*n*(4*m.y*m.y+4*m.x*m.x)};a.prototype.getSideNormals=function(m,n){var q=this.halfExtents;m[0].set(q.x,
0,0);m[1].set(0,q.y,0);m[2].set(0,0,q.z);m[3].set(-q.x,0,0);m[4].set(0,-q.y,0);m[5].set(0,0,-q.z);if(void 0!==n)for(q=0;q!==m.length;q++)n.vmult(m[q],m[q]);return m};a.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var k=new b;new b;a.prototype.forEachWorldCorner=function(m,n,q){var p=this.halfExtents;p=[[p.x,p.y,p.z],[-p.x,p.y,p.z],[-p.x,-p.y,p.z],[-p.x,
-p.y,-p.z],[p.x,-p.y,-p.z],[p.x,p.y,-p.z],[-p.x,p.y,-p.z],[p.x,-p.y,p.z]];for(var u=0;u<p.length;u++)k.set(p[u][0],p[u][1],p[u][2]),n.vmult(k,k),m.vadd(k,k),q(k.x,k.y,k.z)};var g=[new b,new b,new b,new b,new b,new b,new b,new b];a.prototype.calculateWorldAABB=function(m,n,q,p){var u=this.halfExtents;g[0].set(u.x,u.y,u.z);g[1].set(-u.x,u.y,u.z);g[2].set(-u.x,-u.y,u.z);g[3].set(-u.x,-u.y,-u.z);g[4].set(u.x,-u.y,-u.z);g[5].set(u.x,u.y,-u.z);g[6].set(-u.x,u.y,-u.z);g[7].set(u.x,-u.y,u.z);var r=g[0];n.vmult(r,
r);m.vadd(r,r);p.copy(r);q.copy(r);for(u=1;8>u;u++){r=g[u];n.vmult(r,r);m.vadd(r,r);var t=r.x,v=r.y;r=r.z;t>p.x&&(p.x=t);v>p.y&&(p.y=v);r>p.z&&(p.z=r);t<q.x&&(q.x=t);v<q.y&&(q.y=v);r<q.z&&(q.z=r)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(c,f,l){function a(B,G,K){e.call(this);this.type=e.types.CONVEXPOLYHEDRON;this.vertices=B||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=G||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=
!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=K?K.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}f.exports=a;var e=c("./Shape"),b=c("../math/Vec3");c("../math/Quaternion");var h=c("../math/Transform");a.prototype=new e;a.prototype.constructor=a;var k=new b;a.prototype.computeEdges=function(){for(var B=this.faces,G=this.vertices,K=this.uniqueEdges,N=K.length=0;N!==B.length;N++)for(var I=B[N],U=I.length,aa=0;aa!==U;aa++){G[I[aa]].vsub(G[I[(aa+1)%U]],k);k.normalize();
for(var S=!1,Z=0;Z!==K.length;Z++)if(K[Z].almostEquals(k)||K[Z].almostEquals(k)){S=!0;break}S||K.push(k.clone())}};a.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var B=0;B<this.faces.length;B++){for(var G=0;G<this.faces[B].length;G++)if(!this.vertices[this.faces[B][G]])throw Error("Vertex "+this.faces[B][G]+" not found!");G=this.faceNormals[B]||new b;this.getFaceNormal(B,G);G.negate(G);this.faceNormals[B]=G;if(0>G.dot(this.vertices[this.faces[B][0]]))for(console.error(".faceNormals["+
B+"] = Vec3("+G.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),G=0;G<this.faces[B].length;G++)console.warn(".vertices["+this.faces[B][G]+"] = Vec3("+this.vertices[this.faces[B][G]].toString()+")")}};var g=new b,m=new b;a.computeNormal=function(B,G,K,N){G.vsub(B,m);K.vsub(G,g);g.cross(m,N);N.isZero()||N.normalize()};a.prototype.getFaceNormal=function(B,G){var K=this.faces[B];return a.computeNormal(this.vertices[K[0]],
this.vertices[K[1]],this.vertices[K[2]],G)};var n=new b;a.prototype.clipAgainstHull=function(B,G,K,N,I,U,aa,S,Z){for(var oa=-1,pa=-Number.MAX_VALUE,la=0;la<K.faces.length;la++){n.copy(K.faceNormals[la]);I.vmult(n,n);var V=n.dot(U);V>pa&&(pa=V,oa=la)}pa=[];la=K.faces[oa];V=la.length;for(var ca=0;ca<V;ca++){var ja=K.vertices[la[ca]],wa=new b;wa.copy(ja);I.vmult(wa,wa);N.vadd(wa,wa);pa.push(wa)}0<=oa&&this.clipFaceAgainstHull(U,B,G,pa,aa,S,Z)};var q=new b,p=new b,u=new b,r=new b,t=new b,v=new b;a.prototype.findSeparatingAxis=
function(B,G,K,N,I,U,aa,S){var Z=Number.MAX_VALUE,oa=0;if(this.uniqueAxes)for(la=0;la!==this.uniqueAxes.length;la++){K.vmult(this.uniqueAxes[la],q);V=this.testSepAxis(q,B,G,K,N,I);if(!1===V)return!1;V<Z&&(Z=V,U.copy(q))}else for(var pa=aa?aa.length:this.faces.length,la=0;la<pa;la++){V=aa?aa[la]:la;q.copy(this.faceNormals[V]);K.vmult(q,q);var V=this.testSepAxis(q,B,G,K,N,I);if(!1===V)return!1;V<Z&&(Z=V,U.copy(q))}if(B.uniqueAxes)for(la=0;la!==B.uniqueAxes.length;la++){I.vmult(B.uniqueAxes[la],p);oa++;
V=this.testSepAxis(p,B,G,K,N,I);if(!1===V)return!1;V<Z&&(Z=V,U.copy(p))}else for(aa=S?S.length:B.faces.length,la=0;la<aa;la++){V=S?S[la]:la;p.copy(B.faceNormals[V]);I.vmult(p,p);oa++;V=this.testSepAxis(p,B,G,K,N,I);if(!1===V)return!1;V<Z&&(Z=V,U.copy(p))}for(S=0;S!==this.uniqueEdges.length;S++)for(K.vmult(this.uniqueEdges[S],r),oa=0;oa!==B.uniqueEdges.length;oa++)if(I.vmult(B.uniqueEdges[oa],t),r.cross(t,v),!v.almostZero()){v.normalize();la=this.testSepAxis(v,B,G,K,N,I);if(!1===la)return!1;la<Z&&
(Z=la,U.copy(v))}N.vsub(G,u);0<u.dot(U)&&U.negate(U);return!0};var x=[],y=[];a.prototype.testSepAxis=function(B,G,K,N,I,U){a.project(this,B,K,N,x);a.project(G,B,I,U,y);K=x[0];B=x[1];G=y[0];N=y[1];if(K<N||G<B)return!1;K-=N;B=G-B;return K<B?K:B};var A=new b,D=new b;a.prototype.calculateLocalInertia=function(B,G){this.computeLocalAABB(A,D);var K=D.x-A.x,N=D.y-A.y,I=D.z-A.z;G.x=1/12*B*(4*N*N+4*I*I);G.y=1/12*B*(4*K*K+4*I*I);G.z=1/12*B*(4*N*N+4*K*K)};a.prototype.getPlaneConstantOfFace=function(B){return-this.faceNormals[B].dot(this.vertices[this.faces[B][0]])};
var M=new b,L=new b,F=new b,E=new b,H=new b,T=new b,P=new b,ia=new b;a.prototype.clipFaceAgainstHull=function(B,G,K,N,I,U,aa){for(var S=[],Z=-1,oa=Number.MAX_VALUE,pa=0;pa<this.faces.length;pa++){M.copy(this.faceNormals[pa]);K.vmult(M,M);var la=M.dot(B);la<oa&&(oa=la,Z=pa)}if(!(0>Z)){B=this.faces[Z];B.connectedFaces=[];for(oa=0;oa<this.faces.length;oa++)for(pa=0;pa<this.faces[oa].length;pa++)-1!==B.indexOf(this.faces[oa][pa])&&oa!==Z&&-1===B.connectedFaces.indexOf(oa)&&B.connectedFaces.push(oa);oa=
B.length;for(pa=0;pa<oa;pa++){la=this.vertices[B[pa]];la.vsub(this.vertices[B[(pa+1)%oa]],L);F.copy(L);K.vmult(F,F);G.vadd(F,F);E.copy(this.faceNormals[Z]);K.vmult(E,E);G.vadd(E,E);F.cross(E,H);H.negate(H);T.copy(la);K.vmult(T,T);G.vadd(T,T);T.dot(H);la=B.connectedFaces[pa];P.copy(this.faceNormals[la]);la=this.getPlaneConstantOfFace(la);ia.copy(P);K.vmult(ia,ia);la-=ia.dot(G);for(this.clipFaceAgainstPlane(N,S,ia,la);N.length;)N.shift();for(;S.length;)N.push(S.shift())}P.copy(this.faceNormals[Z]);
la=this.getPlaneConstantOfFace(Z);ia.copy(P);K.vmult(ia,ia);la-=ia.dot(G);for(oa=0;oa<N.length;oa++)G=ia.dot(N[oa])+la,G<=I&&(console.log("clamped: depth="+G+" to minDist="+(I+"")),G=I),G<=U&&(K=N[oa],0>=G&&aa.push({point:K,normal:ia,depth:G}))}};a.prototype.clipFaceAgainstPlane=function(B,G,K,N){var I=B.length;if(2>I)return G;var U=B[B.length-1];var aa=K.dot(U)+N;for(var S=0;S<I;S++){var Z=B[S];var oa=K.dot(Z)+N;if(0>aa){if(0>oa){var pa=new b;pa.copy(Z)}else pa=new b,U.lerp(Z,aa/(aa-oa),pa);G.push(pa)}else 0>
oa&&(pa=new b,U.lerp(Z,aa/(aa-oa),pa),G.push(pa),G.push(Z));U=Z;aa=oa}return G};a.prototype.computeWorldVertices=function(B,G){for(var K=this.vertices.length;this.worldVertices.length<K;)this.worldVertices.push(new b);for(var N=this.vertices,I=this.worldVertices,U=0;U!==K;U++)G.vmult(N[U],I[U]),B.vadd(I[U],I[U]);this.worldVerticesNeedsUpdate=!1};new b;a.prototype.computeLocalAABB=function(B,G){var K=this.vertices.length,N=this.vertices;B.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);G.set(-Number.MAX_VALUE,
-Number.MAX_VALUE,-Number.MAX_VALUE);for(var I=0;I<K;I++){var U=N[I];U.x<B.x?B.x=U.x:U.x>G.x&&(G.x=U.x);U.y<B.y?B.y=U.y:U.y>G.y&&(G.y=U.y);U.z<B.z?B.z=U.z:U.z>G.z&&(G.z=U.z)}};a.prototype.computeWorldFaceNormals=function(B){for(var G=this.faceNormals.length;this.worldFaceNormals.length<G;)this.worldFaceNormals.push(new b);for(var K=this.faceNormals,N=this.worldFaceNormals,I=0;I!==G;I++)B.vmult(K[I],N[I]);this.worldFaceNormalsNeedsUpdate=!1};a.prototype.updateBoundingSphereRadius=function(){for(var B=
0,G=this.vertices,K=0,N=G.length;K!==N;K++){var I=G[K].norm2();I>B&&(B=I)}this.boundingSphereRadius=Math.sqrt(B)};var R=new b;a.prototype.calculateWorldAABB=function(B,G,K,N){for(var I=this.vertices.length,U=this.vertices,aa,S,Z,oa,pa,la,V=0;V<I;V++){R.copy(U[V]);G.vmult(R,R);B.vadd(R,R);var ca=R;if(ca.x<aa||void 0===aa)aa=ca.x;else if(ca.x>oa||void 0===oa)oa=ca.x;if(ca.y<S||void 0===S)S=ca.y;else if(ca.y>pa||void 0===pa)pa=ca.y;if(ca.z<Z||void 0===Z)Z=ca.z;else if(ca.z>la||void 0===la)la=ca.z}K.set(aa,
S,Z);N.set(oa,pa,la)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.prototype.getAveragePointLocal=function(B){B=B||new b;for(var G=this.vertices.length,K=this.vertices,N=0;N<G;N++)B.vadd(K[N],B);B.mult(1/G,B);return B};a.prototype.transformAllPoints=function(B,G){var K=this.vertices.length,N=this.vertices;if(G){for(var I=0;I<K;I++){var U=N[I];G.vmult(U,U)}for(I=0;I<this.faceNormals.length;I++)U=this.faceNormals[I],G.vmult(U,U)}if(B)for(I=0;I<K;I++)U=N[I],U.vadd(B,
U)};var ba=new b,O=new b,C=new b;a.prototype.pointIsInside=function(B){var G=this.vertices,K=this.faces,N=this.faceNormals,I=this.faces.length;this.getAveragePointLocal(ba);for(var U=0;U<I;U++){var aa=N[U];var S=G[K[U][0]],Z=O;B.vsub(S,Z);Z=aa.dot(Z);var oa=C;ba.vsub(S,oa);aa=aa.dot(oa);if(0>Z&&0<aa||0<Z&&0>aa)return!1}return-1};new b;var z=new b,w=new b;a.project=function(B,G,K,N,I){var U=B.vertices.length;B=B.vertices;w.setZero();h.vectorToLocalFrame(K,N,G,z);h.pointToLocalFrame(K,N,w,w);N=w.dot(z);
K=G=B[0].dot(z);for(var aa=1;aa<U;aa++){var S=B[aa].dot(z);S>G&&(G=S);S<K&&(K=S)}K-=N;G-=N;K>G&&(U=K,K=G,G=U);I[0]=G;I[1]=K}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(c,f,l){function a(k,g,m,n){var q=[],p=[],u=[],r=[],t=[],v=Math.cos,x=Math.sin;q.push(new b(g*v(0),g*x(0),.5*-m));r.push(0);q.push(new b(k*v(0),k*x(0),.5*m));t.push(1);for(var y=0;y<n;y++){var A=2*Math.PI/n*(y+1),D=2*Math.PI/n*(y+.5);y<n-1?(q.push(new b(g*v(A),g*x(A),.5*-m)),r.push(2*
y+2),q.push(new b(k*v(A),k*x(A),.5*m)),t.push(2*y+3),u.push([2*y+2,2*y+3,2*y+1,2*y])):u.push([0,1,2*y+1,2*y]);(1===n%2||y<n/2)&&p.push(new b(v(D),x(D),0))}u.push(t);p.push(new b(0,0,1));k=[];for(y=0;y<r.length;y++)k.push(r[r.length-y-1]);u.push(k);this.type=e.types.CONVEXPOLYHEDRON;h.call(this,q,u,p)}f.exports=a;var e=c("./Shape"),b=c("../math/Vec3");c("../math/Quaternion");var h=c("./ConvexPolyhedron");a.prototype=new h},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],
40:[function(c,f,l){function a(g,m){m=k.defaults(m,{maxValue:null,minValue:null,elementSize:1});this.data=g;this.maxValue=m.maxValue;this.minValue=m.minValue;this.elementSize=m.elementSize;null===m.minValue&&this.updateMinValue();null===m.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;e.call(this);this.pillarConvex=new b;this.pillarOffset=new h;this.type=e.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var e=c("./Shape"),b=c("./ConvexPolyhedron"),h=c("../math/Vec3"),
k=c("../utils/Utils");f.exports=a;a.prototype=new e;a.prototype.update=function(){this._cachedPillars={}};a.prototype.updateMinValue=function(){for(var g=this.data,m=g[0][0],n=0;n!==g.length;n++)for(var q=0;q!==g[n].length;q++){var p=g[n][q];p<m&&(m=p)}this.minValue=m};a.prototype.updateMaxValue=function(){for(var g=this.data,m=g[0][0],n=0;n!==g.length;n++)for(var q=0;q!==g[n].length;q++){var p=g[n][q];p>m&&(m=p)}this.maxValue=m};a.prototype.setHeightValueAtIndex=function(g,m,n){this.data[g][m]=n;
this.clearCachedConvexTrianglePillar(g,m,!1);0<g&&(this.clearCachedConvexTrianglePillar(g-1,m,!0),this.clearCachedConvexTrianglePillar(g-1,m,!1));0<m&&(this.clearCachedConvexTrianglePillar(g,m-1,!0),this.clearCachedConvexTrianglePillar(g,m-1,!1));0<m&&0<g&&this.clearCachedConvexTrianglePillar(g-1,m-1,!0)};a.prototype.getRectMinMax=function(g,m,n,q,p){p=p||[];for(var u=this.data,r=this.minValue;g<=n;g++)for(var t=m;t<=q;t++){var v=u[g][t];v>r&&(r=v)}p[0]=this.minValue;p[1]=r};a.prototype.getIndexOfPosition=
function(g,m,n,q){var p=this.elementSize,u=this.data;g=Math.floor(g/p);m=Math.floor(m/p);n[0]=g;n[1]=m;q&&(0>g&&(g=0),0>m&&(m=0),g>=u.length-1&&(g=u.length-1),m>=u[0].length-1&&(m=u[0].length-1));return 0>g||0>m||g>=u.length-1||m>=u[0].length-1?!1:!0};a.prototype.getHeightAt=function(g,m,n){var q=[];this.getIndexOfPosition(g,m,q,n);g=[];this.getRectMinMax(q[0],q[1]+1,q[0],q[1]+1,g);return(g[0]+g[1])/2};a.prototype.getCacheConvexTrianglePillarKey=function(g,m,n){return g+"_"+m+"_"+(n?1:0)};a.prototype.getCachedConvexTrianglePillar=
function(g,m,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(g,m,n)]};a.prototype.setCachedConvexTrianglePillar=function(g,m,n,q,p){this._cachedPillars[this.getCacheConvexTrianglePillarKey(g,m,n)]={convex:q,offset:p}};a.prototype.clearCachedConvexTrianglePillar=function(g,m,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(g,m,n)]};a.prototype.getConvexTrianglePillar=function(g,m,n){var q=this.pillarConvex,p=this.pillarOffset;if(this.cacheEnabled){var u=this.getCachedConvexTrianglePillar(g,
m,n);if(u){this.pillarConvex=u.convex;this.pillarOffset=u.offset;return}q=new b;p=new h;this.pillarConvex=q;this.pillarOffset=p}u=this.data;var r=this.elementSize,t=q.faces;q.vertices.length=6;for(var v=0;6>v;v++)q.vertices[v]||(q.vertices[v]=new h);t.length=5;for(v=0;5>v;v++)t[v]||(t[v]=[]);v=q.vertices;var x=(Math.min(u[g][m],u[g+1][m],u[g][m+1],u[g+1][m+1])-this.minValue)/2+this.minValue;n?(p.set((g+.75)*r,(m+.75)*r,x),v[0].set(.25*r,.25*r,u[g+1][m+1]-x),v[1].set(-.75*r,.25*r,u[g][m+1]-x),v[2].set(.25*
r,-.75*r,u[g+1][m]-x),v[3].set(.25*r,.25*r,-x-1),v[4].set(-.75*r,.25*r,-x-1),v[5].set(.25*r,-.75*r,-x-1),t[0][0]=0,t[0][1]=1,t[0][2]=2,t[1][0]=5,t[1][1]=4,t[1][2]=3,t[2][0]=2,t[2][1]=5,t[2][2]=3,t[2][3]=0,t[3][0]=3,t[3][1]=4,t[3][2]=1,t[3][3]=0,t[4][0]=1,t[4][1]=4,t[4][2]=5,t[4][3]=2):(p.set((g+.25)*r,(m+.25)*r,x),v[0].set(-.25*r,-.25*r,u[g][m]-x),v[1].set(.75*r,-.25*r,u[g+1][m]-x),v[2].set(-.25*r,.75*r,u[g][m+1]-x),v[3].set(-.25*r,-.25*r,-x-1),v[4].set(.75*r,-.25*r,-x-1),v[5].set(-.25*r,.75*r,-x-
1),t[0][0]=0,t[0][1]=1,t[0][2]=2,t[1][0]=5,t[1][1]=4,t[1][2]=3,t[2][0]=0,t[2][1]=2,t[2][2]=5,t[2][3]=3,t[3][0]=1,t[3][1]=0,t[3][2]=3,t[3][3]=4,t[4][0]=4,t[4][1]=5,t[4][2]=2,t[4][3]=1);q.computeNormals();q.computeEdges();q.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(g,m,n,q,p)};a.prototype.calculateLocalInertia=function(g,m){m=m||new h;m.set(0,0,0);return m};a.prototype.volume=function(){return Number.MAX_VALUE};a.prototype.calculateWorldAABB=function(g,m,n,q){n.set(-Number.MAX_VALUE,
-Number.MAX_VALUE,-Number.MAX_VALUE);q.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};a.prototype.updateBoundingSphereRadius=function(){var g=this.data,m=this.elementSize;this.boundingSphereRadius=(new h(g.length*m,g[0].length*m,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(c,f,l){function a(){e.call(this);this.type=e.types.PARTICLE}f.exports=a;var e=c("./Shape"),b=c("../math/Vec3");
a.prototype=new e;a.prototype.constructor=a;a.prototype.calculateLocalInertia=function(h,k){k=k||new b;k.set(0,0,0);return k};a.prototype.volume=function(){return 0};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};a.prototype.calculateWorldAABB=function(h,k,g,m){g.copy(h);m.copy(h)}},{"../math/Vec3":30,"./Shape":43}],42:[function(c,f,l){function a(){e.call(this);this.type=e.types.PLANE;this.worldNormal=new b;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}
f.exports=a;var e=c("./Shape"),b=c("../math/Vec3");a.prototype=new e;a.prototype.constructor=a;a.prototype.computeWorldNormal=function(k){var g=this.worldNormal;g.set(0,0,1);k.vmult(g,g);this.worldNormalNeedsUpdate=!1};a.prototype.calculateLocalInertia=function(k,g){return g=g||new b};a.prototype.volume=function(){return Number.MAX_VALUE};var h=new b;a.prototype.calculateWorldAABB=function(k,g,m,n){h.set(0,0,1);g.vmult(h,h);g=Number.MAX_VALUE;m.set(-g,-g,-g);n.set(g,g,g);1===h.x&&(n.x=k.x);1===h.y&&
(n.y=k.y);1===h.z&&(n.z=k.z);-1===h.x&&(m.x=k.x);-1===h.y&&(m.y=k.y);-1===h.z&&(m.z=k.z)};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(c,f,l){function a(){this.id=a.idCounter++;this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=null}f.exports=a;a=c("./Shape");c("../math/Vec3");c("../math/Quaternion");c("../material/Material");a.prototype.constructor=a;a.prototype.updateBoundingSphereRadius=
function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};a.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};a.prototype.calculateLocalInertia=function(e,b){throw"calculateLocalInertia() not implemented for shape type "+this.type;};a.idCounter=0;a.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,
"./Shape":43}],44:[function(c,f,l){function a(h){e.call(this);this.radius=void 0!==h?Number(h):1;this.type=e.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}f.exports=a;var e=c("./Shape"),b=c("../math/Vec3");a.prototype=new e;a.prototype.constructor=a;a.prototype.calculateLocalInertia=function(h,k){k=k||new b;var g=2*h*this.radius*this.radius/5;k.x=g;k.y=g;k.z=g;return k};a.prototype.volume=function(){return 4*Math.PI*this.radius/
3};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};a.prototype.calculateWorldAABB=function(h,k,g,m){k=this.radius;for(var n=["x","y","z"],q=0;q<n.length;q++){var p=n[q];g[p]=h[p]-k;m[p]=h[p]+k}}},{"../math/Vec3":30,"./Shape":43}],45:[function(c,f,l){function a(L,F){e.call(this);this.type=e.types.TRIMESH;this.vertices=new Float32Array(L);this.indices=new Int16Array(F);this.normals=new Float32Array(F.length);this.aabb=new k;this.edges=null;this.scale=new b(1,
1,1);this.tree=new g;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}f.exports=a;var e=c("./Shape"),b=c("../math/Vec3");c("../math/Quaternion");var h=c("../math/Transform"),k=c("../collision/AABB"),g=c("../utils/Octree");a.prototype=new e;a.prototype.constructor=a;var m=new b;a.prototype.updateTree=function(){var L=this.tree;L.reset();L.aabb.copy(this.aabb);var F=this.scale;L.aabb.lowerBound.x*=1/F.x;L.aabb.lowerBound.y*=1/F.y;L.aabb.lowerBound.z*=
1/F.z;L.aabb.upperBound.x*=1/F.x;L.aabb.upperBound.y*=1/F.y;L.aabb.upperBound.z*=1/F.z;F=new k;for(var E=new b,H=new b,T=new b,P=[E,H,T],ia=0;ia<this.indices.length/3;ia++){var R=3*ia;this._getUnscaledVertex(this.indices[R],E);this._getUnscaledVertex(this.indices[R+1],H);this._getUnscaledVertex(this.indices[R+2],T);F.setFromPoints(P);L.insert(F,ia)}L.removeEmptyNodes()};var n=new k;a.prototype.getTrianglesInAABB=function(L,F){n.copy(L);var E=this.scale,H=E.x,T=E.y;E=E.z;var P=n.lowerBound,ia=n.upperBound;
P.x/=H;P.y/=T;P.z/=E;ia.x/=H;ia.y/=T;ia.z/=E;return this.tree.aabbQuery(n,F)};a.prototype.setScale=function(L){var F=L.x===L.y===L.z;this.scale.x===this.scale.y===this.scale.z&&F||this.updateNormals();this.scale.copy(L);this.updateAABB();this.updateBoundingSphereRadius()};a.prototype.updateNormals=function(){for(var L=this.normals,F=0;F<this.indices.length/3;F++){var E=3*F,H=this.indices[E+1],T=this.indices[E+2];this.getVertex(this.indices[E],t);this.getVertex(H,v);this.getVertex(T,x);a.computeNormal(v,
t,x,m);L[E]=m.x;L[E+1]=m.y;L[E+2]=m.z}};a.prototype.updateEdges=function(){for(var L={},F=function(ia,R){L[T<P?T+"_"+P:P+"_"+T]=!0},E=0;E<this.indices.length/3;E++){var H=3*E,T=this.indices[H],P=this.indices[H+1];H=this.indices[H+2];F(T,P);F(P,H);F(H,T)}F=Object.keys(L);this.edges=new Int16Array(2*F.length);for(E=0;E<F.length;E++)H=F[E].split("_"),this.edges[2*E]=parseInt(H[0],10),this.edges[2*E+1]=parseInt(H[1],10)};a.prototype.getEdgeVertex=function(L,F,E){this.getVertex(this.edges[2*L+(F?1:0)],
E)};var q=new b,p=new b;a.prototype.getEdgeVector=function(L,F){this.getEdgeVertex(L,0,q);this.getEdgeVertex(L,1,p);p.vsub(q,F)};var u=new b,r=new b;a.computeNormal=function(L,F,E,H){F.vsub(L,r);E.vsub(F,u);u.cross(r,H);H.isZero()||H.normalize()};var t=new b,v=new b,x=new b;a.prototype.getVertex=function(L,F){var E=this.scale;this._getUnscaledVertex(L,F);F.x*=E.x;F.y*=E.y;F.z*=E.z;return F};a.prototype._getUnscaledVertex=function(L,F){var E=3*L,H=this.vertices;return F.set(H[E],H[E+1],H[E+2])};a.prototype.getWorldVertex=
function(L,F,E,H){this.getVertex(L,H);h.pointToWorldFrame(F,E,H,H);return H};a.prototype.getTriangleVertices=function(L,F,E,H){L*=3;this.getVertex(this.indices[L],F);this.getVertex(this.indices[L+1],E);this.getVertex(this.indices[L+2],H)};a.prototype.getNormal=function(L,F){var E=3*L;return F.set(this.normals[E],this.normals[E+1],this.normals[E+2])};var y=new k;a.prototype.calculateLocalInertia=function(L,F){this.computeLocalAABB(y);var E=y.upperBound.x-y.lowerBound.x,H=y.upperBound.y-y.lowerBound.y,
T=y.upperBound.z-y.lowerBound.z;return F.set(1/12*L*(4*H*H+4*T*T),1/12*L*(4*E*E+4*T*T),1/12*L*(4*H*H+4*E*E))};var A=new b;a.prototype.computeLocalAABB=function(L){var F=L.lowerBound;L=L.upperBound;var E=this.vertices.length;this.getVertex(0,A);F.copy(A);L.copy(A);for(var H=0;H!==E;H++)this.getVertex(H,A),A.x<F.x?F.x=A.x:A.x>L.x&&(L.x=A.x),A.y<F.y?F.y=A.y:A.y>L.y&&(L.y=A.y),A.z<F.z?F.z=A.z:A.z>L.z&&(L.z=A.z)};a.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};a.prototype.updateBoundingSphereRadius=
function(){var L=0,F=this.vertices,E=new b,H=0;for(F=F.length/3;H!==F;H++){this.getVertex(H,E);var T=E.norm2();T>L&&(L=T)}this.boundingSphereRadius=Math.sqrt(L)};new b;var D=new h,M=new k;a.prototype.calculateWorldAABB=function(L,F,E,H){D.position=L;D.quaternion=F;this.aabb.toWorldFrame(D,M);E.copy(M.lowerBound);H.copy(M.upperBound)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.createTorus=function(L,F,E,H,T){L=L||1;F=F||.5;E=E||8;H=H||6;T=T||2*Math.PI;for(var P=[],
ia=[],R=0;R<=E;R++)for(var ba=0;ba<=H;ba++){var O=ba/H*T,C=R/E*Math.PI*2;P.push((L+F*Math.cos(C))*Math.cos(O),(L+F*Math.cos(C))*Math.sin(O),F*Math.sin(C))}for(R=1;R<=E;R++)for(ba=1;ba<=H;ba++)L=(H+1)*(R-1)+ba-1,F=(H+1)*(R-1)+ba,T=(H+1)*R+ba,ia.push((H+1)*R+ba-1,L,T),ia.push(L,F,T);return new a(P,ia)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(c,f,l){function a(){e.call(this);this.iterations=10;this.tolerance=
1E-7}f.exports=a;c("../math/Vec3");c("../math/Quaternion");var e=c("./Solver");a.prototype=new e;var b=[],h=[],k=[];a.prototype.solve=function(g,m){var n=0,q=this.iterations,p=this.tolerance*this.tolerance,u=this.equations,r=u.length,t=m.bodies,v=t.length,x;if(0!==r)for(x=0;x!==v;x++)t[x].updateSolveMassProperties();h.length=r;k.length=r;b.length=r;for(x=0;x!==r;x++){var y=u[x];b[x]=0;k[x]=y.computeB(g);h[x]=1/y.computeC()}if(0!==r){for(x=0;x!==v;x++)y=t[x],n=y.wlambda,y.vlambda.set(0,0,0),n&&n.set(0,
0,0);for(n=0;n!==q;n++){for(var A=x=0;A!==r;A++){y=u[A];var D=k[A];var M=h[A];var L=b[A];var F=y.computeGWlambda();D=M*(D-F-y.eps*L);L+D<y.minForce?D=y.minForce-L:L+D>y.maxForce&&(D=y.maxForce-L);b[A]+=D;x+=0<D?D:-D;y.addToWlambda(D)}if(x*x<p)break}for(x=0;x!==v;x++)y=t[x],q=y.velocity,p=y.angularVelocity,q.vadd(y.vlambda,q),p&&p.vadd(y.wlambda,p)}return n}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(c,f,l){function a(){this.equations=[]}f.exports=a;a.prototype.solve=
function(e,b){return 0};a.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)};a.prototype.removeEquation=function(e){var b=this.equations;e=b.indexOf(e);-1!==e&&b.splice(e,1)};a.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(c,f,l){function a(u,r,t){k.call(this);this.iterations=r;this.tolerance=t;this.subsolver=u;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function e(u){for(var r=u.length,t=
0;t!==r;t++){var v=u[t];if(!(v.visited||v.body.type&q))return v}return!1}function b(u,r,t){r.push(u.body);r=u.eqs.length;for(var v=0;v!==r;v++){var x=u.eqs[v];-1===t.indexOf(x)&&t.push(x)}}function h(u,r){return r.id-u.id}f.exports=a;c("../math/Vec3");c("../math/Quaternion");var k=c("./Solver");c=c("../objects/Body");a.prototype=new k;var g=[],m=[],n={bodies:[]},q=c.STATIC,p=[];a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};a.prototype.solve=function(u,r){for(var t=
this.nodePool,v=r.bodies,x=this.equations,y=x.length,A=v.length,D=this.subsolver;t.length<A;)t.push(this.createNode());g.length=A;for(var M=0;M<A;M++)g[M]=t[M];for(M=0;M!==A;M++)t=g[M],t.body=v[M],t.children.length=0,t.eqs.length=0,t.visited=!1;for(A=0;A!==y;A++){t=x[A];M=v.indexOf(t.bi);var L=v.indexOf(t.bj);M=g[M];L=g[L];M.children.push(L);M.eqs.push(t);L.children.push(M);L.eqs.push(t)}v=0;x=m;D.tolerance=this.tolerance;for(D.iterations=this.iterations;M=e(g);){x.length=0;n.bodies.length=0;t=M;
M=b;y=n.bodies;A=x;p.push(t);t.visited=!0;for(M(t,y,A);p.length;)for(t=p.pop();L=e(t.children);)L.visited=!0,M(L,y,A),p.push(L);y=x.length;x=x.sort(h);for(M=0;M!==y;M++)D.addEquation(x[M]);D.solve(u,n);D.removeAllEquations();v++}return v}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(c,f,l){c=function(){};f.exports=c;c.prototype={constructor:c,addEventListener:function(a,e){void 0===this._listeners&&(this._listeners={});var b=this._listeners;void 0===
b[a]&&(b[a]=[]);-1===b[a].indexOf(e)&&b[a].push(e);return this},hasEventListener:function(a,e){if(void 0===this._listeners)return!1;var b=this._listeners;return void 0!==b[a]&&-1!==b[a].indexOf(e)?!0:!1},removeEventListener:function(a,e){if(void 0===this._listeners)return this;var b=this._listeners;if(void 0===b[a])return this;var h=b[a].indexOf(e);-1!==h&&b[a].splice(h,1);return this},dispatchEvent:function(a){if(void 0===this._listeners)return this;var e=this._listeners[a.type];if(void 0!==e){a.target=
this;for(var b=0,h=e.length;b<h;b++)e[b].call(this,a)}return this}}},{}],50:[function(c,f,l){function a(m){m=m||{};this.root=m.root||null;this.aabb=m.aabb?m.aabb.clone():new b;this.data=[];this.children=[]}function e(m,n){n=n||{};n.root=null;n.aabb=m;a.call(this,n);this.maxDepth="undefined"!==typeof n.maxDepth?n.maxDepth:8}var b=c("../collision/AABB"),h=c("../math/Vec3");f.exports=e;e.prototype=new a;a.prototype.reset=function(m,n){this.children.length=this.data.length=0};a.prototype.insert=function(m,
n,q){var p=this.data;q=q||0;if(!this.aabb.contains(m))return!1;var u=this.children;if(q<(this.maxDepth||this.root.maxDepth)){var r=!1;u.length||(this.subdivide(),r=!0);for(var t=0;8!==t;t++)if(u[t].insert(m,n,q+1))return!0;r&&(u.length=0)}p.push(n);return!0};var k=new h;a.prototype.subdivide=function(){var m=this.aabb,n=m.lowerBound,q=m.upperBound;m=this.children;m.push(new a({aabb:new b({lowerBound:new h(0,0,0)})}),new a({aabb:new b({lowerBound:new h(1,0,0)})}),new a({aabb:new b({lowerBound:new h(1,
1,0)})}),new a({aabb:new b({lowerBound:new h(1,1,1)})}),new a({aabb:new b({lowerBound:new h(0,1,1)})}),new a({aabb:new b({lowerBound:new h(0,0,1)})}),new a({aabb:new b({lowerBound:new h(1,0,1)})}),new a({aabb:new b({lowerBound:new h(0,1,0)})}));q.vsub(n,k);k.scale(.5,k);q=this.root||this;for(var p=0;8!==p;p++){var u=m[p];u.root=q;var r=u.aabb.lowerBound;r.x*=k.x;r.y*=k.y;r.z*=k.z;r.vadd(n,r);r.vadd(k,u.aabb.upperBound)}};a.prototype.aabbQuery=function(m,n){for(var q=[this];q.length;){var p=q.pop();
p.aabb.overlaps(m)&&Array.prototype.push.apply(n,p.data);Array.prototype.push.apply(q,p.children)}return n};var g=new b;a.prototype.rayQuery=function(m,n,q){m.getAABB(g);g.toLocalFrame(n,g);this.aabbQuery(g,q);return q};a.prototype.removeEmptyNodes=function(){for(var m=[this];m.length;){for(var n=m.pop(),q=n.children.length-1;0<=q;q--)n.children[q].data.length||n.children.splice(q,1);Array.prototype.push.apply(m,n.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(c,f,l){function a(){this.objects=
[];this.type=Object}f.exports=a;a.prototype.release=function(){for(var e=arguments.length,b=0;b!==e;b++)this.objects.push(arguments[b])};a.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};a.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(c,f,l){function a(){this.data={keys:[]}}f.exports=a;a.prototype.get=function(e,b){if(e>b){var h=b;b=e;e=h}return this.data[e+"-"+
b]};a.prototype.set=function(e,b,h){if(e>b){var k=b;b=e;e=k}k=e+"-"+b;this.get(e,b)||this.data.keys.push(k);this.data[k]=h};a.prototype.reset=function(){for(var e=this.data,b=e.keys;0<b.length;){var h=b.pop();delete e[h]}}},{}],53:[function(c,f,l){function a(){}f.exports=a;a.defaults=function(e,b){e=e||{};for(var h in b)h in e||(e[h]=b[h]);return e}},{}],54:[function(c,f,l){function a(){b.call(this);this.type=e}f.exports=a;var e=c("../math/Vec3"),b=c("./Pool");a.prototype=new b;a.prototype.constructObject=
function(){return new e}},{"../math/Vec3":30,"./Pool":51}],55:[function(c,f,l){function a(Q){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new g;this.world=Q;this.currentContactMaterial=null;this.enableFrictionReduction=!1}f.exports=a;f=c("../collision/AABB");l=c("../shapes/Shape");var e=c("../collision/Ray"),b=c("../math/Vec3"),h=c("../math/Transform");c("../shapes/ConvexPolyhedron");var k=c("../math/Quaternion");c("../solver/Solver");var g=
c("../utils/Vec3Pool"),m=c("../equations/ContactEquation"),n=c("../equations/FrictionEquation");a.prototype.createContactEquation=function(Q,Y,na,qa,da,ka){if(this.contactPointPool.length){var ra=this.contactPointPool.pop();ra.bi=Q;ra.bj=Y}else ra=new m(Q,Y);ra.enabled=Q.collisionResponse&&Y.collisionResponse&&na.collisionResponse&&qa.collisionResponse;var ua=this.currentContactMaterial;ra.restitution=ua.restitution;ra.setSpookParams(ua.contactEquationStiffness,ua.contactEquationRelaxation,this.world.dt);
Q=na.material||Q.material;Y=qa.material||Y.material;Q&&Y&&0<=Q.restitution&&0<=Y.restitution&&(ra.restitution=Q.restitution*Y.restitution);ra.si=da||na;ra.sj=ka||qa;return ra};a.prototype.createFrictionEquationsFromContact=function(Q,Y){var na=Q.bi,qa=Q.bj,da=this.world,ka=this.currentContactMaterial,ra=ka.friction,ua=Q.si.material||na.material,sa=Q.sj.material||qa.material;ua&&sa&&0<=ua.friction&&0<=sa.friction&&(ra=ua.friction*sa.friction);if(0<ra){ra*=da.gravity.length();ua=na.invMass+qa.invMass;
0<ua&&(ua=1/ua);var ma=this.frictionEquationPool;sa=ma.length?ma.pop():new n(na,qa,ra*ua);ma=ma.length?ma.pop():new n(na,qa,ra*ua);sa.bi=ma.bi=na;sa.bj=ma.bj=qa;sa.minForce=ma.minForce=-ra*ua;sa.maxForce=ma.maxForce=ra*ua;sa.ri.copy(Q.ri);sa.rj.copy(Q.rj);ma.ri.copy(Q.ri);ma.rj.copy(Q.rj);Q.ni.tangents(sa.t,ma.t);sa.setSpookParams(ka.frictionEquationStiffness,ka.frictionEquationRelaxation,da.dt);ma.setSpookParams(ka.frictionEquationStiffness,ka.frictionEquationRelaxation,da.dt);sa.enabled=ma.enabled=
Q.enabled;Y.push(sa,ma);return!0}return!1};var q=new b,p=new b,u=new b;a.prototype.createFrictionFromAverage=function(Q){var Y=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(Y,this.frictionResult)&&1!==Q){var na=this.frictionResult[this.frictionResult.length-2],qa=this.frictionResult[this.frictionResult.length-1];q.setZero();p.setZero();u.setZero();for(var da=Y.bi,ka=0;ka!==Q;ka++)Y=this.result[this.result.length-1-ka],Y.bodyA!==da?(q.vadd(Y.ni,q),p.vadd(Y.ri,p),u.vadd(Y.rj,
u)):(q.vsub(Y.ni,q),p.vadd(Y.rj,p),u.vadd(Y.ri,u));Q=1/Q;p.scale(Q,na.ri);u.scale(Q,na.rj);qa.ri.copy(na.ri);qa.rj.copy(na.rj);q.normalize();q.tangents(na.t,qa.t)}};var r=new b,t=new b,v=new k,x=new k;a.prototype.getContacts=function(Q,Y,na,qa,da,ka,ra){this.contactPointPool=da;this.frictionEquationPool=ra;this.result=qa;this.frictionResult=ka;qa=0;for(da=Q.length;qa!==da;qa++){ka=Q[qa];ra=Y[qa];var ua=null;ka.material&&ra.material&&(ua=na.getContactMaterial(ka.material,ra.material)||null);for(var sa=
0;sa<ka.shapes.length;sa++){ka.quaternion.mult(ka.shapeOrientations[sa],v);ka.quaternion.vmult(ka.shapeOffsets[sa],r);r.vadd(ka.position,r);for(var ma=ka.shapes[sa],X=0;X<ra.shapes.length;X++){ra.quaternion.mult(ra.shapeOrientations[X],x);ra.quaternion.vmult(ra.shapeOffsets[X],t);t.vadd(ra.position,t);var za=ra.shapes[X];if(!(r.distanceTo(t)>ma.boundingSphereRadius+za.boundingSphereRadius)){var va=null;ma.material&&za.material&&(va=na.getContactMaterial(ma.material,za.material)||null);this.currentContactMaterial=
va||ua||na.defaultContactMaterial;(va=this[ma.type|za.type])&&(ma.type<za.type?va.call(this,ma,za,r,t,v,x,ka,ra,ma,za):va.call(this,za,ma,t,r,x,v,ra,ka,ma,za))}}}}};a.prototype[l.types.BOX|l.types.BOX]=a.prototype.boxBox=function(Q,Y,na,qa,da,ka,ra,ua){Q.convexPolyhedronRepresentation.material=Q.material;Y.convexPolyhedronRepresentation.material=Y.material;Q.convexPolyhedronRepresentation.collisionResponse=Q.collisionResponse;Y.convexPolyhedronRepresentation.collisionResponse=Y.collisionResponse;
this.convexConvex(Q.convexPolyhedronRepresentation,Y.convexPolyhedronRepresentation,na,qa,da,ka,ra,ua,Q,Y)};a.prototype[l.types.BOX|l.types.CONVEXPOLYHEDRON]=a.prototype.boxConvex=function(Q,Y,na,qa,da,ka,ra,ua){Q.convexPolyhedronRepresentation.material=Q.material;Q.convexPolyhedronRepresentation.collisionResponse=Q.collisionResponse;this.convexConvex(Q.convexPolyhedronRepresentation,Y,na,qa,da,ka,ra,ua,Q,Y)};a.prototype[l.types.BOX|l.types.PARTICLE]=a.prototype.boxParticle=function(Q,Y,na,qa,da,
ka,ra,ua){Q.convexPolyhedronRepresentation.material=Q.material;Q.convexPolyhedronRepresentation.collisionResponse=Q.collisionResponse;this.convexParticle(Q.convexPolyhedronRepresentation,Y,na,qa,da,ka,ra,ua,Q,Y)};a.prototype[l.types.SPHERE]=a.prototype.sphereSphere=function(Q,Y,na,qa,da,ka,ra,ua){da=this.createContactEquation(ra,ua,Q,Y);qa.vsub(na,da.ni);da.ni.normalize();da.ri.copy(da.ni);da.rj.copy(da.ni);da.ri.mult(Q.radius,da.ri);da.rj.mult(-Y.radius,da.rj);da.ri.vadd(na,da.ri);da.ri.vsub(ra.position,
da.ri);da.rj.vadd(qa,da.rj);da.rj.vsub(ua.position,da.rj);this.result.push(da);this.createFrictionEquationsFromContact(da,this.frictionResult)};var y=new b,A=new b,D=new b;a.prototype[l.types.PLANE|l.types.TRIMESH]=a.prototype.planeTrimesh=function(Q,Y,na,qa,da,ka,ra,ua){var sa=new b;y.set(0,0,1);da.vmult(y,y);for(da=0;da<Y.vertices.length/3;da++){Y.getVertex(da,sa);var ma=new b;ma.copy(sa);h.pointToWorldFrame(qa,ka,ma,sa);ma=A;sa.vsub(na,ma);if(0>=y.dot(ma)){var X=this.createContactEquation(ra,ua,
Q,Y);X.ni.copy(y);var za=D;y.scale(ma.dot(y),za);sa.vsub(za,za);X.ri.copy(za);X.ri.vsub(ra.position,X.ri);X.rj.copy(sa);X.rj.vsub(ua.position,X.rj);this.result.push(X);this.createFrictionEquationsFromContact(X,this.frictionResult)}}};var M=new b,L=new b;new b;var F=new b,E=new b,H=new b,T=new b,P=new b,ia=new b,R=new b,ba=new b,O=new b,C=new b,z=new b,w=new f,B=[];a.prototype[l.types.SPHERE|l.types.TRIMESH]=a.prototype.sphereTrimesh=function(Q,Y,na,qa,da,ka,ra,ua){h.pointToLocalFrame(qa,ka,na,R);
da=Q.radius;w.lowerBound.set(R.x-da,R.y-da,R.z-da);w.upperBound.set(R.x+da,R.y+da,R.z+da);Y.getTrianglesInAABB(w,B);var sa=Q.radius*Q.radius;for(da=0;da<B.length;da++)for(var ma=0;3>ma;ma++)if(Y.getVertex(Y.indices[3*B[da]+ma],F),F.vsub(R,L),L.norm2()<=sa){E.copy(F);h.pointToWorldFrame(qa,ka,E,F);F.vsub(na,L);var X=this.createContactEquation(ra,ua,Q,Y);X.ni.copy(L);X.ni.normalize();X.ri.copy(X.ni);X.ri.scale(Q.radius,X.ri);X.ri.vadd(na,X.ri);X.ri.vsub(ra.position,X.ri);X.rj.copy(F);X.rj.vsub(ua.position,
X.rj);this.result.push(X);this.createFrictionEquationsFromContact(X,this.frictionResult)}for(da=0;da<B.length;da++)for(ma=0;3>ma;ma++)Y.getVertex(Y.indices[3*B[da]+ma],H),Y.getVertex(Y.indices[3*B[da]+(ma+1)%3],T),T.vsub(H,P),R.vsub(T,ba),na=ba.dot(P),R.vsub(H,ba),X=ba.dot(P),0<X&&0>na&&(R.vsub(H,ba),ia.copy(P),ia.normalize(),X=ba.dot(ia),ia.scale(X,ba),ba.vadd(H,ba),na=ba.distanceTo(R),na<Q.radius&&(X=this.createContactEquation(ra,ua,Q,Y),ba.vsub(R,X.ni),X.ni.normalize(),X.ni.scale(Q.radius,X.ri),
h.pointToWorldFrame(qa,ka,ba,ba),ba.vsub(ua.position,X.rj),h.vectorToWorldFrame(ka,X.ni,X.ni),h.vectorToWorldFrame(ka,X.ri,X.ri),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult)));da=0;for(ma=B.length;da!==ma;da++)Y.getTriangleVertices(B[da],O,C,z),Y.getNormal(B[da],M),R.vsub(O,ba),na=ba.dot(M),M.scale(na,ba),R.vsub(ba,ba),na=ba.distanceTo(R),e.pointInTriangle(ba,O,C,z)&&na<Q.radius&&(X=this.createContactEquation(ra,ua,Q,Y),ba.vsub(R,X.ni),X.ni.normalize(),X.ni.scale(Q.radius,
X.ri),h.pointToWorldFrame(qa,ka,ba,ba),ba.vsub(ua.position,X.rj),h.vectorToWorldFrame(ka,X.ni,X.ni),h.vectorToWorldFrame(ka,X.ri,X.ri),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult));B.length=0};var G=new b,K=new b;a.prototype[l.types.SPHERE|l.types.PLANE]=a.prototype.spherePlane=function(Q,Y,na,qa,da,ka,ra,ua){Y=this.createContactEquation(ra,ua,Q,Y);Y.ni.set(0,0,1);ka.vmult(Y.ni,Y.ni);Y.ni.negate(Y.ni);Y.ni.normalize();Y.ni.mult(Q.radius,Y.ri);na.vsub(qa,G);Y.ni.mult(Y.ni.dot(G),
K);G.vsub(K,Y.rj);-G.dot(Y.ni)<=Q.radius&&(Q=Y.ri,ka=Y.rj,Q.vadd(na,Q),Q.vsub(ra.position,Q),ka.vadd(qa,ka),ka.vsub(ua.position,ka),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult))};var N=new b,I=new b,U=new b,aa=new b,S=new b,Z=new b,oa=new b,pa=[new b,new b,new b,new b,new b,new b],la=new b,V=new b,ca=new b,ja=new b;a.prototype[l.types.SPHERE|l.types.BOX]=a.prototype.sphereBox=function(Q,Y,na,qa,da,ka,ra,ua){da=this.v3pool;na.vsub(qa,aa);Y.getSideNormals(pa,ka);
ka=Q.radius;for(var sa=!1,ma=null,X=0,za=0,va=0,Ka=null,La=0,Ra=pa.length;La!==Ra&&!1===sa;La++){var Sa=S;Sa.copy(pa[La]);var Ua=Sa.norm();Sa.normalize();var Aa=aa.dot(Sa);if(Aa<Ua+ka&&0<Aa){var ab=Z,cb=oa;ab.copy(pa[(La+1)%3]);cb.copy(pa[(La+2)%3]);var bb=ab.norm(),eb=cb.norm();ab.normalize();cb.normalize();var $a=aa.dot(ab),ib=aa.dot(cb);$a<bb&&$a>-bb&&ib<eb&&ib>-eb&&(Aa=Math.abs(Aa-Ua-ka),null===Ka||Aa<Ka)&&(Ka=Aa,za=$a,va=ib,ma=Ua,V.copy(Sa),ca.copy(ab),ja.copy(cb),X++)}}X&&(sa=!0,X=this.createContactEquation(ra,
ua,Q,Y),V.mult(-ka,X.ri),X.ni.copy(V),X.ni.negate(X.ni),V.mult(ma,V),ca.mult(za,ca),V.vadd(ca,V),ja.mult(va,ja),V.vadd(ja,X.rj),X.ri.vadd(na,X.ri),X.ri.vsub(ra.position,X.ri),X.rj.vadd(qa,X.rj),X.rj.vsub(ua.position,X.rj),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult));Aa=da.get();for(ma=0;2!==ma&&!sa;ma++)for(za=0;2!==za&&!sa;za++)for(va=0;2!==va&&!sa;va++)Aa.set(0,0,0),ma?Aa.vadd(pa[0],Aa):Aa.vsub(pa[0],Aa),za?Aa.vadd(pa[1],Aa):Aa.vsub(pa[1],Aa),va?Aa.vadd(pa[2],
Aa):Aa.vsub(pa[2],Aa),qa.vadd(Aa,la),la.vsub(na,la),la.norm2()<ka*ka&&(sa=!0,X=this.createContactEquation(ra,ua,Q,Y),X.ri.copy(la),X.ri.normalize(),X.ni.copy(X.ri),X.ri.mult(ka,X.ri),X.rj.copy(Aa),X.ri.vadd(na,X.ri),X.ri.vsub(ra.position,X.ri),X.rj.vadd(qa,X.rj),X.rj.vsub(ua.position,X.rj),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult));da.release(Aa);Ka=da.get();La=da.get();X=da.get();Ra=da.get();Aa=da.get();Sa=pa.length;for(ma=0;ma!==Sa&&!sa;ma++)for(za=0;za!==
Sa&&!sa;za++)if(ma%3!==za%3){pa[za].cross(pa[ma],Ka);Ka.normalize();pa[ma].vadd(pa[za],La);X.copy(na);X.vsub(La,X);X.vsub(qa,X);Ua=X.dot(Ka);Ka.mult(Ua,Ra);for(va=0;va===ma%3||va===za%3;)va++;Aa.copy(na);Aa.vsub(Ra,Aa);Aa.vsub(La,Aa);Aa.vsub(qa,Aa);Ua=Math.abs(Ua);ab=Aa.norm();Ua<pa[va].norm()&&ab<ka&&(sa=!0,va=this.createContactEquation(ra,ua,Q,Y),La.vadd(Ra,va.rj),va.rj.copy(va.rj),Aa.negate(va.ni),va.ni.normalize(),va.ri.copy(va.rj),va.ri.vadd(qa,va.ri),va.ri.vsub(na,va.ri),va.ri.normalize(),va.ri.mult(ka,
va.ri),va.ri.vadd(na,va.ri),va.ri.vsub(ra.position,va.ri),va.rj.vadd(qa,va.rj),va.rj.vsub(ua.position,va.rj),this.result.push(va),this.createFrictionEquationsFromContact(va,this.frictionResult))}da.release(Ka,La,X,Ra,Aa)};var wa=new b,Fa=new b,xa=new b,fb=new b,ob=new b,kb=new b,lb=new b,J=new b,W=new b,ea=new b;a.prototype[l.types.SPHERE|l.types.CONVEXPOLYHEDRON]=a.prototype.sphereConvex=function(Q,Y,na,qa,da,ka,ra,ua){da=this.v3pool;na.vsub(qa,wa);for(var sa=Y.faceNormals,ma=Y.faces,X=Y.vertices,
za=Q.radius,va=0;va!==X.length;va++){var Ka=ob;ka.vmult(X[va],Ka);qa.vadd(Ka,Ka);var La=fb;Ka.vsub(na,La);if(La.norm2()<za*za){Q=this.createContactEquation(ra,ua,Q,Y);Q.ri.copy(La);Q.ri.normalize();Q.ni.copy(Q.ri);Q.ri.mult(za,Q.ri);Ka.vsub(qa,Q.rj);Q.ri.vadd(na,Q.ri);Q.ri.vsub(ra.position,Q.ri);Q.rj.vadd(qa,Q.rj);Q.rj.vsub(ua.position,Q.rj);this.result.push(Q);this.createFrictionEquationsFromContact(Q,this.frictionResult);return}}va=0;for(Ka=ma.length;va!==Ka;va++){La=ma[va];var Ra=kb;ka.vmult(sa[va],
Ra);var Sa=lb;ka.vmult(X[La[0]],Sa);Sa.vadd(qa,Sa);var Ua=J;Ra.mult(-za,Ua);na.vadd(Ua,Ua);var Aa=W;Ua.vsub(Sa,Aa);Ua=Aa.dot(Ra);Aa=ea;na.vsub(Sa,Aa);if(0>Ua&&0<Aa.dot(Ra)){Sa=[];Aa=0;for(var ab=La.length;Aa!==ab;Aa++){var cb=da.get();ka.vmult(X[La[Aa]],cb);qa.vadd(cb,cb);Sa.push(cb)}a:{Aa=Sa;ab=Ra;cb=na;for(var bb=null,eb=Aa.length,$a=0;$a!==eb;$a++){var ib=Aa[$a],mb=N;Aa[($a+1)%eb].vsub(ib,mb);var fa=I;mb.cross(ab,fa);mb=U;cb.vsub(ib,mb);ib=fa.dot(mb);if(null===bb||0<ib&&!0===bb||0>=ib&&!1===bb)null===
bb&&(bb=0<ib);else{Aa=!1;break a}}Aa=!0}if(Aa){Q=this.createContactEquation(ra,ua,Q,Y);Ra.mult(-za,Q.ri);Ra.negate(Q.ni);Y=da.get();Ra.mult(-Ua,Y);ka=da.get();Ra.mult(-za,ka);na.vsub(qa,Q.rj);Q.rj.vadd(ka,Q.rj);Q.rj.vadd(Y,Q.rj);Q.rj.vadd(qa,Q.rj);Q.rj.vsub(ua.position,Q.rj);Q.ri.vadd(na,Q.ri);Q.ri.vsub(ra.position,Q.ri);da.release(Y);da.release(ka);this.result.push(Q);this.createFrictionEquationsFromContact(Q,this.frictionResult);Aa=0;for(La=Sa.length;Aa!==La;Aa++)da.release(Sa[Aa]);break}else for(Aa=
0;Aa!==La.length;Aa++){Ra=da.get();Ua=da.get();ka.vmult(X[La[(Aa+1)%La.length]],Ra);ka.vmult(X[La[(Aa+2)%La.length]],Ua);qa.vadd(Ra,Ra);qa.vadd(Ua,Ua);eb=Fa;Ua.vsub(Ra,eb);bb=xa;eb.unit(bb);ab=da.get();cb=da.get();na.vsub(Ra,cb);$a=cb.dot(bb);bb.mult($a,ab);ab.vadd(Ra,ab);bb=da.get();ab.vsub(na,bb);if(0<$a&&$a*$a<eb.norm2()&&bb.norm2()<za*za){Q=this.createContactEquation(ra,ua,Q,Y);ab.vsub(qa,Q.rj);ab.vsub(na,Q.ni);Q.ni.normalize();Q.ni.mult(za,Q.ri);Q.rj.vadd(qa,Q.rj);Q.rj.vsub(ua.position,Q.rj);
Q.ri.vadd(na,Q.ri);Q.ri.vsub(ra.position,Q.ri);this.result.push(Q);this.createFrictionEquationsFromContact(Q,this.frictionResult);Aa=0;for(La=Sa.length;Aa!==La;Aa++)da.release(Sa[Aa]);da.release(Ra);da.release(Ua);da.release(ab);da.release(bb);da.release(cb);return}da.release(Ra);da.release(Ua);da.release(ab);da.release(bb);da.release(cb)}Aa=0;for(La=Sa.length;Aa!==La;Aa++)da.release(Sa[Aa])}}};new b;new b;a.prototype[l.types.PLANE|l.types.BOX]=a.prototype.planeBox=function(Q,Y,na,qa,da,ka,ra,ua){Y.convexPolyhedronRepresentation.material=
Y.material;Y.convexPolyhedronRepresentation.collisionResponse=Y.collisionResponse;this.planeConvex(Q,Y.convexPolyhedronRepresentation,na,qa,da,ka,ra,ua)};var ta=new b,ya=new b,Ia=new b,Ea=new b;a.prototype[l.types.PLANE|l.types.CONVEXPOLYHEDRON]=a.prototype.planeConvex=function(Q,Y,na,qa,da,ka,ra,ua){ya.set(0,0,1);da.vmult(ya,ya);for(var sa=da=0;sa!==Y.vertices.length;sa++)if(ta.copy(Y.vertices[sa]),ka.vmult(ta,ta),qa.vadd(ta,ta),ta.vsub(na,Ia),0>=ya.dot(Ia)){var ma=this.createContactEquation(ra,
ua,Q,Y),X=Ea;ya.mult(ya.dot(Ia),X);ta.vsub(X,X);X.vsub(na,ma.ri);ma.ni.copy(ya);ta.vsub(qa,ma.rj);ma.ri.vadd(na,ma.ri);ma.ri.vsub(ra.position,ma.ri);ma.rj.vadd(qa,ma.rj);ma.rj.vsub(ua.position,ma.rj);this.result.push(ma);da++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(ma,this.frictionResult)}this.enableFrictionReduction&&da&&this.createFrictionFromAverage(da)};var Da=new b,Ca=new b;a.prototype[l.types.CONVEXPOLYHEDRON]=a.prototype.convexConvex=function(Q,Y,na,qa,da,ka,ra,
ua,sa,ma,X,za){if(!(na.distanceTo(qa)>Q.boundingSphereRadius+Y.boundingSphereRadius)&&Q.findSeparatingAxis(Y,na,da,qa,ka,Da,X,za)){X=[];Q.clipAgainstHull(na,da,Y,qa,ka,Da,-100,100,X);for(ka=da=0;ka!==X.length;ka++){za=this.createContactEquation(ra,ua,Q,Y,sa,ma);var va=za.ri,Ka=za.rj;Da.negate(za.ni);X[ka].normal.negate(Ca);Ca.mult(X[ka].depth,Ca);X[ka].point.vadd(Ca,va);Ka.copy(X[ka].point);va.vsub(na,va);Ka.vsub(qa,Ka);va.vadd(na,va);va.vsub(ra.position,va);Ka.vadd(qa,Ka);Ka.vsub(ua.position,Ka);
this.result.push(za);da++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(za,this.frictionResult)}this.enableFrictionReduction&&da&&this.createFrictionFromAverage(da)}};var Ja=new b,Za=new b,Qa=new b;a.prototype[l.types.PLANE|l.types.PARTICLE]=a.prototype.planeParticle=function(Q,Y,na,qa,da,ka,ra,ua){Ja.set(0,0,1);ra.quaternion.vmult(Ja,Ja);qa.vsub(ra.position,Za);0>=Ja.dot(Za)&&(Q=this.createContactEquation(ua,ra,Y,Q),Q.ni.copy(Ja),Q.ni.negate(Q.ni),Q.ri.set(0,0,0),Ja.mult(Ja.dot(qa),
Qa),qa.vsub(Qa,Qa),Q.rj.copy(Qa),this.result.push(Q),this.createFrictionEquationsFromContact(Q,this.frictionResult))};var Va=new b;a.prototype[l.types.PARTICLE|l.types.SPHERE]=a.prototype.sphereParticle=function(Q,Y,na,qa,da,ka,ra,ua){Va.set(0,0,1);qa.vsub(na,Va);Va.norm2()<=Q.radius*Q.radius&&(Y=this.createContactEquation(ua,ra,Y,Q),Va.normalize(),Y.rj.copy(Va),Y.rj.mult(Q.radius,Y.rj),Y.ni.copy(Va),Y.ni.negate(Y.ni),Y.ri.set(0,0,0),this.result.push(Y),this.createFrictionEquationsFromContact(Y,this.frictionResult))};
var Ba=new k,Xa=new b;new b;var db=new b,Ha=new b,Na=new b;a.prototype[l.types.PARTICLE|l.types.CONVEXPOLYHEDRON]=a.prototype.convexParticle=function(Q,Y,na,qa,da,ka,ra,ua){var sa=-1;ka=null;var ma=0;Xa.copy(qa);Xa.vsub(na,Xa);da.conjugate(Ba);Ba.vmult(Xa,Xa);if(Q.pointIsInside(Xa)){Q.worldVerticesNeedsUpdate&&Q.computeWorldVertices(na,da);Q.worldFaceNormalsNeedsUpdate&&Q.computeWorldFaceNormals(da);da=0;for(var X=Q.faces.length;da!==X;da++){var za=Q.worldFaceNormals[da];qa.vsub(Q.worldVertices[Q.faces[da][0]],
Ha);var va=-za.dot(Ha);if(null===ka||Math.abs(va)<Math.abs(ka))ka=va,sa=da,db.copy(za),ma++}-1!==sa?(Q=this.createContactEquation(ua,ra,Y,Q),db.mult(ka,Na),Na.vadd(qa,Na),Na.vsub(na,Na),Q.rj.copy(Na),db.negate(Q.ni),Q.ri.set(0,0,0),Y=Q.ri,ka=Q.rj,Y.vadd(qa,Y),Y.vsub(ua.position,Y),ka.vadd(na,ka),ka.vsub(ra.position,ka),this.result.push(Q),this.createFrictionEquationsFromContact(Q,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};a.prototype[l.types.BOX|
l.types.HEIGHTFIELD]=a.prototype.boxHeightfield=function(Q,Y,na,qa,da,ka,ra,ua){Q.convexPolyhedronRepresentation.material=Q.material;Q.convexPolyhedronRepresentation.collisionResponse=Q.collisionResponse;this.convexHeightfield(Q.convexPolyhedronRepresentation,Y,na,qa,da,ka,ra,ua)};var Ta=new b,Ya=new b,hb=[0];a.prototype[l.types.CONVEXPOLYHEDRON|l.types.HEIGHTFIELD]=a.prototype.convexHeightfield=function(Q,Y,na,qa,da,ka,ra,ua){var sa=Y.data,ma=Y.elementSize,X=Q.boundingSphereRadius;h.pointToLocalFrame(qa,
ka,na,Ta);var za=Math.floor((Ta.x-X)/ma)-1,va=Math.ceil((Ta.x+X)/ma)+1,Ka=Math.floor((Ta.y-X)/ma)-1;ma=Math.ceil((Ta.y+X)/ma)+1;if(!(0>va||0>ma||za>sa.length||Ka>sa[0].length)){0>za&&(za=0);0>va&&(va=0);0>Ka&&(Ka=0);0>ma&&(ma=0);za>=sa.length&&(za=sa.length-1);va>=sa.length&&(va=sa.length-1);ma>=sa[0].length&&(ma=sa[0].length-1);Ka>=sa[0].length&&(Ka=sa[0].length-1);sa=[];Y.getRectMinMax(za,Ka,va,ma,sa);var La=sa[0];if(!(Ta.z-X>sa[1]||Ta.z+X<La))for(X=za;X<va;X++)for(za=Ka;za<ma;za++)Y.getConvexTrianglePillar(X,
za,!1),h.pointToWorldFrame(qa,ka,Y.pillarOffset,Ya),na.distanceTo(Ya)<Y.pillarConvex.boundingSphereRadius+Q.boundingSphereRadius&&this.convexConvex(Q,Y.pillarConvex,na,Ya,da,ka,ra,ua,null,null,hb,null),Y.getConvexTrianglePillar(X,za,!0),h.pointToWorldFrame(qa,ka,Y.pillarOffset,Ya),na.distanceTo(Ya)<Y.pillarConvex.boundingSphereRadius+Q.boundingSphereRadius&&this.convexConvex(Q,Y.pillarConvex,na,Ya,da,ka,ra,ua,null,null,hb,null)}};var gb=new b,jb=new b;a.prototype[l.types.SPHERE|l.types.HEIGHTFIELD]=
a.prototype.sphereHeightfield=function(Q,Y,na,qa,da,ka,ra,ua){var sa=Y.data,ma=Q.radius,X=Y.elementSize;h.pointToLocalFrame(qa,ka,na,gb);var za=Math.floor((gb.x-ma)/X)-1,va=Math.ceil((gb.x+ma)/X)+1,Ka=Math.floor((gb.y-ma)/X)-1;X=Math.ceil((gb.y+ma)/X)+1;if(!(0>va||0>X||za>sa.length||X>sa[0].length)){0>za&&(za=0);0>va&&(va=0);0>Ka&&(Ka=0);0>X&&(X=0);za>=sa.length&&(za=sa.length-1);va>=sa.length&&(va=sa.length-1);X>=sa[0].length&&(X=sa[0].length-1);Ka>=sa[0].length&&(Ka=sa[0].length-1);sa=[];Y.getRectMinMax(za,
Ka,va,X,sa);var La=sa[0];if(!(gb.z-ma>sa[1]||gb.z+ma<La))for(ma=this.result;za<va;za++)for(sa=Ka;sa<X;sa++)if(La=ma.length,Y.getConvexTrianglePillar(za,sa,!1),h.pointToWorldFrame(qa,ka,Y.pillarOffset,jb),na.distanceTo(jb)<Y.pillarConvex.boundingSphereRadius+Q.boundingSphereRadius&&this.sphereConvex(Q,Y.pillarConvex,na,jb,da,ka,ra,ua),Y.getConvexTrianglePillar(za,sa,!0),h.pointToWorldFrame(qa,ka,Y.pillarOffset,jb),na.distanceTo(jb)<Y.pillarConvex.boundingSphereRadius+Q.boundingSphereRadius&&this.sphereConvex(Q,
Y.pillarConvex,na,jb,da,ka,ra,ua),2<ma.length-La)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(c,f,l){function a(){k.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=
!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new e;this.broadphase=new t;this.bodies=[];this.solver=new b;this.constraints=[];this.narrowphase=new h(this);this.collisionMatrix=new g;this.collisionMatrixPrevious=new g;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new p;this.defaultMaterial=new m("default");this.defaultContactMaterial=new n(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile=
{solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null}}f.exports=a;c("../shapes/Shape");var e=c("../math/Vec3");f=c("../math/Quaternion");var b=c("../solver/GSSolver");c("../utils/Vec3Pool");c("../equations/ContactEquation");c("../equations/FrictionEquation");var h=c("./Narrowphase"),k=c("../utils/EventTarget"),g=c("../collision/ArrayCollisionMatrix"),m=c("../material/Material"),
n=c("../material/ContactMaterial"),q=c("../objects/Body"),p=c("../utils/TupleDictionary"),u=c("../collision/RaycastResult");l=c("../collision/AABB");var r=c("../collision/Ray"),t=c("../collision/NaiveBroadphase");a.prototype=new k;new l;var v=new r;a.prototype.getContactMaterial=function(R,ba){return this.contactMaterialTable.get(R.id,ba.id)};a.prototype.numObjects=function(){return this.bodies.length};a.prototype.collisionMatrixTick=function(){var R=this.collisionMatrixPrevious;this.collisionMatrixPrevious=
this.collisionMatrix;this.collisionMatrix=R;this.collisionMatrix.reset()};a.prototype.add=a.prototype.addBody=function(R){-1===this.bodies.indexOf(R)&&(R.index=this.bodies.length,this.bodies.push(R),R.world=this,R.initPosition.copy(R.position),R.initVelocity.copy(R.velocity),R.timeLastSleepy=this.time,R instanceof q&&(R.initAngularVelocity.copy(R.angularVelocity),R.initQuaternion.copy(R.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=R,this.dispatchEvent(this.addBodyEvent))};
a.prototype.addConstraint=function(R){this.constraints.push(R)};a.prototype.removeConstraint=function(R){R=this.constraints.indexOf(R);-1!==R&&this.constraints.splice(R,1)};a.prototype.rayTest=function(R,ba,O){O instanceof u?this.raycastClosest(R,ba,{skipBackfaces:!0},O):this.raycastAll(R,ba,{skipBackfaces:!0},O)};a.prototype.raycastAll=function(R,ba,O,C){O.mode=r.ALL;O.from=R;O.to=ba;O.callback=C;return v.intersectWorld(this,O)};a.prototype.raycastAny=function(R,ba,O,C){O.mode=r.ANY;O.from=R;O.to=
ba;O.result=C;return v.intersectWorld(this,O)};a.prototype.raycastClosest=function(R,ba,O,C){O.mode=r.CLOSEST;O.from=R;O.to=ba;O.result=C;return v.intersectWorld(this,O)};a.prototype.remove=function(R){R.world=null;var ba=this.bodies.length-1,O=this.bodies,C=O.indexOf(R);if(-1!==C){O.splice(C,1);for(C=0;C!==O.length;C++)O[C].index=C;this.collisionMatrix.setNumObjects(ba);this.removeBodyEvent.body=R;this.dispatchEvent(this.removeBodyEvent)}};a.prototype.removeBody=a.prototype.remove;a.prototype.addMaterial=
function(R){this.materials.push(R)};a.prototype.addContactMaterial=function(R){this.contactmaterials.push(R);this.contactMaterialTable.set(R.materials[0].id,R.materials[1].id,R)};"undefined"===typeof performance&&(performance={});if(!performance.now){var x=Date.now();performance.timing&&performance.timing.navigationStart&&(x=performance.timing.navigationStart);performance.now=function(){return Date.now()-x}}var y=new e;a.prototype.step=function(R,ba,O){O=O||10;ba=ba||0;if(0===ba)this.internalStep(R),
this.time+=R;else{var C=Math.floor((this.time+ba)/R)-Math.floor(this.time/R);C=Math.min(C,O);O=performance.now();for(var z=0;z!==C&&!(this.internalStep(R),performance.now()-O>1E3*R);z++);this.time+=ba;R=this.time%R/R;ba=this.bodies;for(C=0;C!==ba.length;C++)O=ba[C],O.type!==q.STATIC&&O.sleepState!==q.SLEEPING?(O.position.vsub(O.previousPosition,y),y.scale(R,y),O.position.vadd(y,O.interpolatedPosition)):(O.interpolatedPosition.copy(O.position),O.interpolatedQuaternion.copy(O.quaternion))}};var A={type:"postStep"},
D={type:"preStep"},M={type:"collide",body:null,contact:null},L=[],F=[],E=[],H=[];new e;new e;new e;new e;new e;new e;new e;new e;new e;new f;var T=new f,P=new f,ia=new e;a.prototype.internalStep=function(R){this.dt=R;var ba=this.contacts,O=this.numObjects(),C=this.bodies,z=this.solver,w=this.gravity,B=this.doProfiling,G=this.profile,K=q.DYNAMIC,N,I=this.constraints;w.norm();var U=w.x,aa=w.y,S=w.z;B&&(N=performance.now());for(w=0;w!==O;w++){var Z=C[w];if(Z.type&K){var oa=Z.force;Z=Z.mass;oa.x+=Z*U;
oa.y+=Z*aa;oa.z+=Z*S}}w=0;for(Z=this.subsystems.length;w!==Z;w++)this.subsystems[w].update();B&&(N=performance.now());E.length=0;H.length=0;this.broadphase.collisionPairs(this,E,H);B&&(G.broadphase=performance.now()-N);Z=I.length;for(w=0;w!==Z;w++)if(U=I[w],!U.collideConnected)for(aa=E.length-1;0<=aa;--aa)if(U.bodyA===E[aa]&&U.bodyB===H[aa]||U.bodyB===E[aa]&&U.bodyA===H[aa])E.splice(aa,1),H.splice(aa,1);this.collisionMatrixTick();B&&(N=performance.now());Z=ba.length;for(w=0;w!==Z;w++)L.push(ba[w]);
ba.length=0;Z=this.frictionEquations.length;for(w=0;w!==Z;w++)F.push(this.frictionEquations[w]);this.frictionEquations.length=0;this.narrowphase.getContacts(E,H,this,ba,L,this.frictionEquations,F);B&&(G.narrowphase=performance.now()-N);B&&(N=performance.now());for(w=0;w<this.frictionEquations.length;w++)z.addEquation(this.frictionEquations[w]);w=ba.length;for(aa=0;aa!==w;aa++)U=ba[aa],Z=U.bi,S=U.bj,Z.material&&S.material&&this.getContactMaterial(Z.material,S.material),Z.material&&S.material&&0<=Z.material.restitution&&
0<=S.material.restitution&&(U.restitution=Z.material.restitution*S.material.restitution),z.addEquation(U),Z.allowSleep&&Z.type===q.DYNAMIC&&Z.sleepState===q.SLEEPING&&S.sleepState===q.AWAKE&&S.type!==q.STATIC&&S.velocity.norm2()+S.angularVelocity.norm2()>=2*Math.pow(S.sleepSpeedLimit,2)&&(Z._wakeUpAfterNarrowphase=!0),S.allowSleep&&S.type===q.DYNAMIC&&S.sleepState===q.SLEEPING&&Z.sleepState===q.AWAKE&&Z.type!==q.STATIC&&Z.velocity.norm2()+Z.angularVelocity.norm2()>=2*Math.pow(Z.sleepSpeedLimit,2)&&
(S._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(Z,S,!0),this.collisionMatrixPrevious.get(Z,S)||(M.body=S,M.contact=U,Z.dispatchEvent(M),M.body=Z,S.dispatchEvent(M));B&&(G.makeContactConstraints=performance.now()-N,N=performance.now());for(w=0;w!==O;w++)Z=C[w],Z._wakeUpAfterNarrowphase&&(Z.wakeUp(),Z._wakeUpAfterNarrowphase=!1);Z=I.length;for(w=0;w!==Z;w++)for(U=I[w],U.update(),aa=0,ba=U.equations.length;aa!==ba;aa++)z.addEquation(U.equations[aa]);z.solve(R,this);B&&(G.solve=performance.now()-
N);z.removeAllEquations();z=Math.pow;for(w=0;w!==O;w++)if(Z=C[w],Z.type&K&&(I=z(1-Z.linearDamping,R),ba=Z.velocity,ba.mult(I,ba),I=Z.angularVelocity))ba=z(1-Z.angularDamping,R),I.mult(ba,I);this.dispatchEvent(D);for(w=0;w!==O;w++)Z=C[w],Z.preStep&&Z.preStep.call(Z);B&&(N=performance.now());K=q.DYNAMIC|q.KINEMATIC;z=0===this.stepnumber%(this.quatNormalizeSkip+1);I=this.quatNormalizeFast;ba=.5*R;for(w=0;w!==O;w++)if(Z=C[w],U=Z.force,aa=Z.torque,Z.type&K&&Z.sleepState!==q.SLEEPING){S=Z.velocity;oa=Z.angularVelocity;
var pa=Z.position,la=Z.quaternion,V=Z.invMass,ca=Z.invInertiaWorld;S.x+=U.x*V*R;S.y+=U.y*V*R;S.z+=U.z*V*R;Z.angularVelocity&&(ca.vmult(aa,ia),ia.mult(R,ia),ia.vadd(oa,oa));pa.x+=S.x*R;pa.y+=S.y*R;pa.z+=S.z*R;Z.angularVelocity&&(T.set(oa.x,oa.y,oa.z,0),T.mult(la,P),la.x+=ba*P.x,la.y+=ba*P.y,la.z+=ba*P.z,la.w+=ba*P.w,z&&(I?la.normalizeFast():la.normalize()));Z.aabb&&(Z.aabbNeedsUpdate=!0);Z.updateInertiaWorld&&Z.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;B&&(G.integrate=performance.now()-
N);this.time+=R;this.stepnumber+=1;this.dispatchEvent(A);for(w=0;w!==O;w++)Z=C[w],(R=Z.postStep)&&R.call(Z);if(this.allowSleep)for(w=0;w!==O;w++)C[w].sleepTick(this.time)};a.prototype.clearForces=function(){for(var R=this.bodies,ba=R.length,O=0;O!==ba;O++){var C=R[O];C.force.set(0,0,0);C.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)});CANNON=CANNON||{};var camera,scene,renderer,controls=null,s_oRender;
CANNON.Demo=function(d){function c(){if(A){for(var V in A.__controllers)A.__controllers[V].updateDisplay();for(var ca in A.__folders)for(V in A.__folders[ca].__controllers)A.__folders[ca].__controllers[V].updateDisplay()}}function f(V){function ca(wa,Fa){wa.material&&(wa.material=Fa);for(var xa=0;xa<wa.children.length;xa++)ca(wa.children[xa],Fa)}if(-1===K.indexOf(V))throw Error("Render mode "+V+" not found!");switch(V){case "solid":p.currentMaterial=E;N.intensity=1;I.color.setHex(2236962);break;case "wireframe":p.currentMaterial=
H,N.intensity=0,I.color.setHex(16777215)}for(var ja=0;ja<x.length;ja++)ca(x[ja],p.currentMaterial);r.rendermode=V}function l(){for(var V=v.length,ca=0;ca<V;ca++){var ja=v[ca];ja.position.copy(ja.initPosition);ja.velocity.copy(ja.initVelocity);ja.initAngularVelocity&&(ja.angularVelocity.copy(ja.initAngularVelocity),ja.quaternion.copy(ja.initQuaternion))}}function a(V){0===V.x&&(V.x=1E-6);0===V.y&&(V.y=1E-6);0===V.z&&(V.z=1E-6)}function e(){for(var V=v.length,ca=0;ca<V;ca++){var ja=v[ca],wa=x[ca];wa.position.copy(ja.position);
ja.quaternion&&wa.quaternion.copy(ja.quaternion)}P.restart();if(r.contacts)for(ca=0;ca<G.contacts.length;ca++)for(V=0;2>V;V++){wa=P.request();var Fa=G.contacts[ca];ja=0===V?Fa.bi:Fa.bj;var xa=0===V?Fa.ri:Fa.rj;wa.position.set(ja.position.x+xa.x,ja.position.y+xa.y,ja.position.z+xa.z)}P.hideCached();ia.restart();if(r.cm2contact)for(ca=0;ca<G.contacts.length;ca++)for(V=0;2>V;V++)wa=ia.request(),Fa=G.contacts[ca],ja=0===V?Fa.bi:Fa.bj,xa=0===V?Fa.ri:Fa.rj,wa.scale.set(xa.x,xa.y,xa.z),a(wa.scale),wa.position.copy(ja.position);
ia.hideCached();C.restart();z.restart();if(r.constraints){for(ca=0;ca<G.constraints.length;ca++)Fa=G.constraints[ca],Fa instanceof CANNON.DistanceConstraint&&(ja=Fa.equations.normal,V=ja.bi,ja=ja.bj,wa=C.request(),ja=ja.position?ja.position:ja,wa.scale.set(ja.x-V.position.x,ja.y-V.position.y,ja.z-V.position.z),a(wa.scale),wa.position.copy(V.position));for(ca=0;ca<G.constraints.length;ca++)if(Fa=G.constraints[ca],Fa instanceof CANNON.PointToPointConstraint){xa=Fa.equations.normal;V=xa.bi;ja=xa.bj;
wa=z.request();Fa=z.request();var fb=z.request();wa.scale.set(xa.ri.x,xa.ri.y,xa.ri.z);Fa.scale.set(xa.rj.x,xa.rj.y,xa.rj.z);fb.scale.set(-xa.penetrationVec.x,-xa.penetrationVec.y,-xa.penetrationVec.z);a(wa.scale);a(Fa.scale);a(fb.scale);wa.position.copy(V.position);Fa.position.copy(ja.position);xa.bj.position.vadd(xa.rj,fb.position)}}z.hideCached();C.hideCached();w.restart();if(r.normals)for(ca=0;ca<G.contacts.length;ca++)Fa=G.contacts[ca],V=Fa.bi,wa=w.request(),xa=Fa.ni,ja=V,wa.scale.set(xa.x,xa.y,
xa.z),a(wa.scale),wa.position.copy(ja.position),Fa.ri.vadd(wa.position,wa.position);w.hideCached();B.restart();if(r.axes)for(V=0;V<v.length;V++)ja=v[V],wa=B.request(),wa.position.copy(ja.position),ja.quaternion&&wa.quaternion.copy(ja.quaternion);B.hideCached();O.restart();if(r.aabbs)for(ca=0;ca<v.length;ca++)ja=v[ca],ja.computeAABB&&(ja.aabbNeedsUpdate&&ja.computeAABB(),isFinite(ja.aabb.lowerBound.x)&&isFinite(ja.aabb.lowerBound.y)&&isFinite(ja.aabb.lowerBound.z)&&isFinite(ja.aabb.upperBound.x)&&
isFinite(ja.aabb.upperBound.y)&&isFinite(ja.aabb.upperBound.z)&&0!=ja.aabb.lowerBound.x-ja.aabb.upperBound.x&&0!=ja.aabb.lowerBound.y-ja.aabb.upperBound.y&&0!=ja.aabb.lowerBound.z-ja.aabb.upperBound.z&&(wa=O.request(),wa.scale.set(ja.aabb.lowerBound.x-ja.aabb.upperBound.x,ja.aabb.lowerBound.y-ja.aabb.upperBound.y,ja.aabb.lowerBound.z-ja.aabb.upperBound.z),wa.position.set(.5*(ja.aabb.lowerBound.x+ja.aabb.upperBound.x),.5*(ja.aabb.lowerBound.y+ja.aabb.upperBound.y),.5*(ja.aabb.lowerBound.z+ja.aabb.upperBound.z))));
O.hideCached()}function b(){requestAnimationFrame(b);r.paused||e();g();U.update()}function h(V){mouseX=V.clientX-pa;mouseY=V.clientY-la}function k(V){S=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth;Z=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;CAMERA_TEST_TRACKBALL&&(controls.screen.width=S,controls.screen.height=Z)}function g(){(CAMERA_TEST_TRACKBALL||CAMERA_TEST_TRANSFORM&&null!==controls)&&controls.update();renderer.clear();renderer.render(p.scene,camera)}function m(V){p.dispatchEvent({type:"destroy"});
r.paused=!1;c();n(V)}function n(V){for(var ca=x.length,ja=0;ja<ca;ja++){G.remove(v.pop());var wa=x.pop();p.scene.remove(wa)}for(;G.constraints.length;)G.removeConstraint(G.constraints[0]);y[V]();r.iterations=G.solver.iterations;r.gx=G.gravity.x+0;r.gy=G.gravity.y+0;r.gz=G.gravity.z+0;r.quatNormalizeSkip=G.quatNormalizeSkip;r.quatNormalizeFast=G.quatNormalizeFast;c();P.restart();P.hideCached();ia.restart();ia.hideCached();C.restart();C.hideCached();w.restart();w.hideCached()}function q(V){var ca=[],
ja=[];this.request=function(){geo=ca.length?ca.pop():V();scene.add(geo);ja.push(geo);return geo};this.restart=function(){for(;ja.length;)ca.push(ja.pop())};this.hideCached=function(){for(var wa=0;wa<ca.length;wa++)scene.remove(ca[wa])}}var p=this;this.addScene=function(V,ca){if("string"!==typeof V)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof ca)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");y.push(ca);var ja=
y.length-1;L[V]=function(){m(ja)};u.add(L,V)};this.restartCurrentScene=l;this.changeScene=m;this.start=function(){n(0)};var u,r=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};d=d||{};for(var t in d)t in r&&(r[t]=d[t]);if(0!==r.stepFrequency%60)throw Error("stepFrequency must be a multiple of 60.");
var v=this.bodies=[],x=this.visuals=[],y=[],A=null,D=null,M=null,L={},F=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var E=new THREE.MeshPhongMaterial({color:11184810,specular:1118481,shininess:50}),H=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=E;var T=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var P=new q(function(){return new THREE.Mesh(F,T)}),ia=new q(function(){var V=
new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:16711680}))}),R=new THREE.BoxGeometry(1,1,1),ba=new THREE.MeshBasicMaterial({color:11184810,wireframe:!0}),O=new q(function(){return new THREE.Mesh(R,ba)}),C=new q(function(){var V=new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:16711680}))}),
z=new q(function(){var V=new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:16711680}))}),w=new q(function(){var V=new THREE.Geometry;V.vertices.push(new THREE.Vector3(0,0,0));V.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(V,new THREE.LineBasicMaterial({color:65280}))}),B=new q(function(){var V=new THREE.Object3D,ca=new THREE.Vector3(0,0,0),ja=new THREE.Geometry,wa=new THREE.Geometry,
Fa=new THREE.Geometry;ja.vertices.push(ca);wa.vertices.push(ca);Fa.vertices.push(ca);ja.vertices.push(new THREE.Vector3(1,0,0));wa.vertices.push(new THREE.Vector3(0,1,0));Fa.vertices.push(new THREE.Vector3(0,0,1));ca=new THREE.Line(ja,new THREE.LineBasicMaterial({color:16711680}));wa=new THREE.Line(wa,new THREE.LineBasicMaterial({color:65280}));Fa=new THREE.Line(Fa,new THREE.LineBasicMaterial({color:255}));V.add(ca);V.add(wa);V.add(Fa);return V}),G=this.world=new CANNON.World;G.broadphase=new CANNON.NaiveBroadphase;
var K=["solid","wireframe"],N,I,U,aa;Detector.webgl||Detector.addGetWebGLMessage();var S=s_iCanvasResizeWidth+s_iCanvasOffsetWidth,Z=s_iCanvasResizeHeight+s_iCanvasOffsetHeight,oa,pa=S/2,la=Z/2;(function(){oa=document.createElement("div");document.body.appendChild(oa);CAMERA_TEST_TRACKBALL?(NEAR=1,camera=new THREE.PerspectiveCamera(45,S/Z,NEAR,FAR),camera.lookAt(new THREE.Vector3(CAMERA_TEST_LOOK_AT.x,CAMERA_TEST_LOOK_AT.y,CAMERA_TEST_LOOK_AT.z)),camera.position.set(0,500,500),camera.up.set(0,0,1)):
camera=createOrthoGraphicCamera();scene=p.scene=new THREE.Scene;scene.fog=new THREE.Fog(8306926,.5*FAR,FAR);I=new THREE.AmbientLight(4473924);scene.add(I);N=new THREE.DirectionalLight(16777181,1);N.position.set(180,0,180);N.target.position.set(0,0,0);N.castShadow=!0;N.shadow.camera.near=10;N.shadow.camera.far=100;N.shadow.camera.fov=FOV;N.shadowMapBias=.0139;N.shadowMapDarkness=.1;N.shadow.mapSize.width=1024;N.shadow.mapSize.height=1024;new THREE.CameraHelper(N.shadow.camera);scene.add(N);scene.add(camera);
renderer=SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!0,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0});renderer.setSize(S,Z);renderer.domElement.style.position="relative";renderer.domElement.style.top="0px";renderer.domElement.style.opacity=CANVAS_3D_OPACITY;oa.appendChild(renderer.domElement);aa=document.createElement("div");aa.style.position="absolute";aa.style.top="10px";aa.style.width="100%";aa.style.textAlign="center";
aa.innerHTML='<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';oa.appendChild(aa);document.addEventListener("mousemove",h);window.addEventListener("resize",k);renderer.setClearColor(scene.fog.color,1);renderer.autoClear=!1;M=document.createElement("canvas");M.width=S;M.height=Z;M.style.opacity=.5;M.style.position="absolute";M.style.top="0px";M.style.zIndex=90;oa.appendChild(M);D=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",
fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});D.streamTo(M);var V={},ca=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255]],ja=0,wa;for(wa in G.profile){var Fa=ca[ja%ca.length];V[wa]=new TimeSeries({label:wa,fillStyle:"rgb("+Fa[0]+","+Fa[1]+","+Fa[2]+")",maxDataLength:500});ja++}G.addEventListener("postStep",function(xa){for(var fb in G.profile)V[fb].append(1E3*G.time,G.profile[fb])});ja=0;for(wa in G.profile)Fa=ca[ja%
ca.length],D.addTimeSeries(V[wa],{strokeStyle:"rgb("+Fa[0]+","+Fa[1]+","+Fa[2]+")",lineWidth:2}),ja++;G.doProfiling=!1;D.stop();M.style.display="none";U=new Stats;U.domElement.style.position="absolute";U.domElement.style.top="0px";U.domElement.style.zIndex=100;oa.appendChild(U.domElement);void 0!=window.dat&&(A=new dat.GUI,A.domElement.parentNode.style.zIndex=120,ca=A.addFolder("Rendering"),ca.add(r,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(xa){f(xa)}),ca.add(r,"contacts"),
ca.add(r,"cm2contact"),ca.add(r,"normals"),ca.add(r,"constraints"),ca.add(r,"axes"),ca.add(r,"particleSize").min(0).max(1).onChange(function(xa){for(var fb=0;fb<x.length;fb++)v[fb]instanceof CANNON.Particle&&x[fb].scale.set(xa,xa,xa)}),ca.add(r,"shadows").onChange(function(xa){xa?renderer.shadowMapAutoUpdate=!0:(renderer.shadowMapAutoUpdate=!1,renderer.clearTarget(N.shadowMap))}),ca.add(r,"aabbs"),ca.add(r,"profiling").onChange(function(xa){xa?(G.doProfiling=!0,D.start(),M.style.display="block"):
(G.doProfiling=!1,D.stop(),M.style.display="none")}),ca=A.addFolder("World"),ca.add(r,"paused").onChange(function(xa){}),ca.add(r,"stepFrequency",60,600).step(60),ca.add(r,"gx",-100,100).onChange(function(xa){isNaN(xa)||G.gravity.set(xa,r.gy,r.gz)}),ca.add(r,"gy",-100,100).onChange(function(xa){isNaN(xa)||G.gravity.set(r.gx,xa,r.gz)}),ca.add(r,"gz",-100,100).onChange(function(xa){isNaN(xa)||G.gravity.set(r.gx,r.gy,xa)}),ca.add(r,"quatNormalizeSkip",0,50).step(1).onChange(function(xa){isNaN(xa)||(G.quatNormalizeSkip=
xa)}),ca.add(r,"quatNormalizeFast").onChange(function(xa){G.quatNormalizeFast=!!xa}),ca=A.addFolder("Solver"),ca.add(r,"iterations",1,50).step(1).onChange(function(xa){G.solver.iterations=xa}),ca.add(r,"k",10,1E7).onChange(function(xa){p.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),ca.add(r,"d",0,20).step(.1).onChange(function(xa){p.setGlobalSpookParams(r.k,r.d,1/r.stepFrequency)}),ca.add(r,"tolerance",0,10).step(.01).onChange(function(xa){G.solver.tolerance=xa}),u=A.addFolder("Scenes"),u.open());
CAMERA_TEST_TRACKBALL&&(controls=new THREE.TrackballControls(camera,renderer.domElement),controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.2,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!1,controls.dynamicDampingFactor=.3,controls.minDistance=0,controls.maxDistance=1E5,controls.keys=[65,83,68],controls.screen.width=S,controls.screen.height=Z)})();b();s_oRender=g;document.addEventListener("keypress",function(V){if(V.keyCode)switch(V.keyCode){case 32:l();break;case 104:"none"==
U.domElement.style.display?(U.domElement.style.display="block",aa.style.display="block"):(U.domElement.style.display="none",aa.style.display="none");break;case 97:r.aabbs=!r.aabbs;c();break;case 99:r.constraints=!r.constraints;c();break;case 112:r.paused=!r.paused;c();break;case 115:G.step(1/r.stepFrequency);e();break;case 109:V=K.indexOf(r.rendermode);V++;V%=K.length;f(K[V]);c();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:y.length>V.keyCode-49&&!document.activeElement.localName.match(/input/)&&
m(V.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(d,c,f){for(var l=this.world,a=0;a<l.constraints.length;a++)for(var e=l.constraints[a],b=0;b<e.equations.length;b++)e.equations[b].setSpookParams(d,c,f);for(a=0;a<l.contactmaterials.length;a++)f=l.contactmaterials[a],f.contactEquationStiffness=d,f.frictionEquationStiffness=d,f.contactEquationRelaxation=c,f.frictionEquationRelaxation=c;l.defaultContactMaterial.contactEquationStiffness=d;l.defaultContactMaterial.frictionEquationStiffness=d;l.defaultContactMaterial.contactEquationRelaxation=
c;l.defaultContactMaterial.frictionEquationRelaxation=c};
CANNON.Demo.prototype.createTransformControl=function(d,c){controls=new THREE.TransformControls(camera,renderer.domElement);scene.add(d);controls.attach(d,c);scene.add(controls);console.log("CREATE");window.addEventListener("keydown",function(f){switch(f.keyCode){case 81:controls.setSpace("local"===controls.space?"world":"local");break;case 17:controls.setTranslationSnap(100);controls.setRotationSnap(THREE.Math.degToRad(15));break;case 87:controls.setMode("translate");break;case 69:controls.setMode("rotate");
break;case 82:controls.setMode("scale");break;case 187:case 107:controls.setSize(controls.size+.1);break;case 189:case 109:controls.setSize(Math.max(controls.size-.1,.1))}});window.addEventListener("keyup",function(f){switch(f.keyCode){case 17:controls.setTranslationSnap(null),controls.setRotationSnap(null)}})};CANNON.Demo.prototype.getWorld=function(){return this.world};
CANNON.Demo.prototype.addVisual=function(d,c){var f;d instanceof CANNON.Body&&(f=this.shape2mesh(d,c));f&&(this.bodies.push(d),this.visuals.push(f),d.visualref=f,d.visualref.visualId=this.bodies.length-1,this.scene.add(f));return f};CANNON.Demo.prototype.addVisuals=function(d){for(var c=0;c<d.length;c++)this.addVisual(d[c])};
CANNON.Demo.prototype.removeVisual=function(d){if(d.visualref){for(var c=this.bodies,f=this.visuals,l=[],a=[],e=c.length,b=0;b<e;b++)l.unshift(c.pop()),a.unshift(f.pop());e=d.visualref.visualId;for(var h=0;h<l.length;h++)h!==e&&(b=h>e?h-1:h,c[b]=l[h],f[b]=a[h],c[b].visualref=l[h].visualref,c[b].visualref.visualId=b);d.visualref.visualId=null;this.scene.remove(d.visualref);d.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(d,c){for(var f=new THREE.Object3D,l=0;l<d.shapes.length;l++){var a=d.shapes[l];switch(a.type){case CANNON.Shape.types.SPHERE:var e=new THREE.SphereGeometry(a.radius,8,8);a=void 0===c?new THREE.Mesh(e,this.currentMaterial):new THREE.Mesh(e,c);a.castShadow=!0;break;case CANNON.Shape.types.PARTICLE:a=new THREE.Mesh(this.particleGeo,this.particleMaterial);e=this.settings;a.scale.set(e.particleSize,e.particleSize,e.particleSize);break;case CANNON.Shape.types.PLANE:var b=
new THREE.PlaneGeometry(10,10,4,4);a=new THREE.Object3D;e=new THREE.Object3D;b=void 0===c?new THREE.Mesh(b,this.currentMaterial):new THREE.Mesh(b,c);b.scale.set(100,100,100);e.add(b);b.castShadow=!1;b.receiveShadow=!0;a.add(e);break;case CANNON.Shape.types.BOX:e=new THREE.BoxGeometry(2*a.halfExtents.x,2*a.halfExtents.y,2*a.halfExtents.z);a=void 0===c?new THREE.Mesh(e,this.currentMaterial):new THREE.Mesh(e,c);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:b=new THREE.Geometry;for(e=0;e<a.vertices.length;e++){var h=
a.vertices[e];b.vertices.push(new THREE.Vector3(h.x,h.y,h.z))}for(e=0;e<a.faces.length;e++){var k=a.faces[e],g=k[0];for(h=1;h<k.length-1;h++)b.faces.push(new THREE.Face3(g,k[h],k[h+1]))}b.computeBoundingSphere();b.computeFaceNormals();a=void 0===c?new THREE.Mesh(b,this.currentMaterial):new THREE.Mesh(b,c);break;case CANNON.Shape.types.HEIGHTFIELD:b=new THREE.Geometry;k=new CANNON.Vec3;g=new CANNON.Vec3;var m=new CANNON.Vec3;for(h=0;h<a.data.length-1;h++)for(var n=0;n<a.data[h].length-1;n++)for(var q=
0;2>q;q++)a.getConvexTrianglePillar(h,n,0===q),k.copy(a.pillarConvex.vertices[0]),g.copy(a.pillarConvex.vertices[1]),m.copy(a.pillarConvex.vertices[2]),k.vadd(a.pillarOffset,k),g.vadd(a.pillarOffset,g),m.vadd(a.pillarOffset,m),b.vertices.push(new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(m.x,m.y,m.z)),e=b.vertices.length-3,b.faces.push(new THREE.Face3(e,e+1,e+2));b.computeBoundingSphere();b.computeFaceNormals();a=void 0===c?new THREE.Mesh(b,this.currentMaterial):
new THREE.Mesh(b,c);break;case CANNON.Shape.types.TRIMESH:b=new THREE.Geometry;k=new CANNON.Vec3;g=new CANNON.Vec3;m=new CANNON.Vec3;for(e=0;e<a.indices.length/3;e++)a.getTriangleVertices(e,k,g,m),b.vertices.push(new THREE.Vector3(k.x,k.y,k.z),new THREE.Vector3(g.x,g.y,g.z),new THREE.Vector3(m.x,m.y,m.z)),h=b.vertices.length-3,b.faces.push(new THREE.Face3(h,h+1,h+2));b.computeBoundingSphere();b.computeFaceNormals();a=void 0===c?new THREE.Mesh(b,this.currentMaterial):new THREE.Mesh(b,c);break;default:throw"Visual type not recognized: "+
a.type;}a.receiveShadow=!0;a.castShadow=!0;if(a.children)for(e=0;e<a.children.length;e++)if(a.children[e].castShadow=!0,a.children[e].receiveShadow=!0,a.children[e])for(h=0;h<a.children[e].length;h++)a.children[e].children[h].castShadow=!0,a.children[e].children[h].receiveShadow=!0;e=d.shapeOffsets[l];b=d.shapeOrientations[l];a.position.set(e.x,e.y,e.z);a.quaternion.set(b.x,b.y,b.z,b.w);f.add(a)}this.camera=function(){return camera};this.getScene=function(){return scene};return f};
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(d){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var d=document.createElement("div");d.id="webgl-error-message";d.style.fontFamily="monospace";d.style.fontSize="13px";d.style.fontWeight="normal";d.style.textAlign="center";d.style.background=
"#fff";d.style.color="#000";d.style.padding="1.5em";d.style.width="400px";d.style.margin="5em auto 0";this.webgl||(d.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return d},addGetWebGLMessage:function(d){d=d||{};var c=void 0!==d.parent?d.parent:document.body;d=void 0!==d.id?d.id:"oldie";var f=Detector.getWebGLErrorMessage();f.id=d;c.appendChild(f)}};
function TimeSeries(d){d=d||{};d.resetBoundsInterval=d.resetBoundsInterval||3E3;d.resetBounds=void 0===d.resetBounds?!0:d.resetBounds;this.options=d;this.data=[];this.label=d.label||"";this.maxDataLength=d.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;d.resetBounds&&(this.boundsTimer=setInterval(function(c){return function(){c.resetBounds()}}(this),d.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var d=0;d<this.data.length;d++)this.maxValue=isNaN(this.maxValue)?this.data[d][1]:Math.max(this.maxValue,this.data[d][1]),this.minValue=isNaN(this.minValue)?this.data[d][1]:Math.min(this.minValue,this.data[d][1])};
TimeSeries.prototype.append=function(d,c){this.lastTimeStamp=d;var f=this.dataPool.length?this.dataPool.pop():[d,c];f[0]=d;f[1]=c;this.data.push(f);this.maxValue=isNaN(this.maxValue)?c:Math.max(this.maxValue,c);for(this.minValue=isNaN(this.minValue)?c:Math.min(this.minValue,c);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(d){d=d||{};d.grid=d.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};d.millisPerPixel=d.millisPerPixel||20;d.fps=d.fps||50;d.maxValueScale=d.maxValueScale||1;d.minValue=d.minValue;d.maxValue=d.maxValue;d.labels=d.labels||{fillStyle:"#ffffff"};d.interpolation=d.interpolation||"bezier";d.scaleSmoothing=d.scaleSmoothing||.125;d.maxDataSetLength=d.maxDataSetLength||2;d.timestampFormatter=d.timestampFormatter||null;this.options=d;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(d,c){this.seriesSet.push({timeSeries:d,options:c||{}})};SmoothieChart.prototype.removeTimeSeries=function(d){this.seriesSet.splice(this.seriesSet.indexOf(d),1)};SmoothieChart.prototype.streamTo=function(d,c){var f=this;this.render_on_tick=function(){f.render(d,f.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(d){function c(f){return(10>f?"0":"")+f}return c(d.getHours())+":"+c(d.getMinutes())+":"+c(d.getSeconds())};
SmoothieChart.prototype.render=function(d,c){var f=d.getContext("2d"),l=this.options,a=d.clientWidth,e=d.clientHeight;f.save();c-=c%l.millisPerPixel;f.translate(0,0);f.beginPath();f.rect(0,0,a,e);f.clip();f.save();f.fillStyle=l.grid.fillStyle;f.clearRect(0,0,a,e);f.fillRect(0,0,a,e);f.restore();f.save();f.lineWidth=l.grid.lineWidth||1;f.strokeStyle=l.grid.strokeStyle||"#ffffff";if(0<l.grid.millisPerLine)for(var b=c-c%l.grid.millisPerLine;b>=c-a*l.millisPerPixel;b-=l.grid.millisPerLine){f.beginPath();
var h=Math.round(a-(c-b)/l.millisPerPixel);f.moveTo(h,0);f.lineTo(h,e);f.stroke();if(l.timestampFormatter){var k=l.timestampFormatter(new Date(b)),g=f.measureText(k).width/2+f.measureText(x).width+4;h<a-g&&(f.fillStyle=l.labels.fillStyle,f.fillText(k,h-f.measureText(k).width/2,e-2))}f.closePath()}for(x=1;x<l.grid.verticalSections;x++)b=Math.round(x*e/l.grid.verticalSections),f.beginPath(),f.moveTo(0,b),f.lineTo(a,b),f.stroke(),f.closePath();f.beginPath();f.strokeRect(0,0,a,e);f.closePath();f.restore();
x=h=Number.NaN;for(k=0;k<this.seriesSet.length;k++){var m=this.seriesSet[k].timeSeries;isNaN(m.maxValue)||(h=isNaN(h)?m.maxValue:Math.max(h,m.maxValue));isNaN(m.minValue)||(x=isNaN(x)?m.minValue:Math.min(x,m.minValue))}if(!isNaN(h)||!isNaN(x)){h=null!=l.maxValue?l.maxValue:h*l.maxValueScale;null!=l.minValue&&(x=l.minValue);this.currentValueRange+=l.scaleSmoothing*(h-x-this.currentValueRange);this.currentVisMinValue+=l.scaleSmoothing*(x-this.currentVisMinValue);g=this.currentValueRange;var n=this.currentVisMinValue;
for(k=0;k<this.seriesSet.length;k++){f.save();m=this.seriesSet[k].timeSeries;m=m.data;for(var q=this.seriesSet[k].options;m.length>=l.maxDataSetLength&&m[1][0]<c-a*l.millisPerPixel;)m.splice(0,1);f.lineWidth=q.lineWidth||1;f.fillStyle=q.fillStyle;f.strokeStyle=q.strokeStyle||"#ffffff";f.beginPath();var p=0,u=0,r=0;for(b=0;b<m.length;b++){var t=Math.round(a-(c-m[b][0])/l.millisPerPixel),v=m[b][1]-n;v=Math.max(Math.min(e-(g?Math.round(v/g*e):0),e-1),1);if(0==b)p=t,f.moveTo(t,v);else switch(l.interpolation){case "line":f.lineTo(t,
v);break;default:f.bezierCurveTo(Math.round((u+t)/2),r,Math.round(u+t)/2,v,t,v)}u=t;r=v}0<m.length&&q.fillStyle&&(f.lineTo(a+q.lineWidth+1,r),f.lineTo(a+q.lineWidth+1,e+q.lineWidth+1),f.lineTo(p,e+q.lineWidth),f.fill());f.stroke();f.closePath();f.restore()}if(!l.labels.disabled){l.labelOffsetY||(l.labelOffsetY=0);f.fillStyle=l.labels.fillStyle;b=parseFloat(h).toFixed(2);var x=parseFloat(x).toFixed(2);f.fillText(b,a-f.measureText(b).width-2,10);f.fillText(x,a-f.measureText(x).width-2,e-2);for(b=0;b<
this.seriesSet.length;b++)m=this.seriesSet[b].timeSeries,a=m.label,f.fillStyle=m.options.fillStyle||"rgb(255,255,255)",a&&f.fillText(a,2,10*(b+1)+l.labelOffsetY)}}f.restore()};
var Stats=function(){var d=0,c=0,f=Date.now(),l=f,a=f,e=0,b=1E3,h=0,k=[[16,16,48],[0,255,255]],g=0,m=1E3,n=0,q=[[16,48,16],[0,255,0]];var p=document.createElement("div");p.style.cursor="pointer";p.style.width="80px";p.style.opacity="0.9";p.style.zIndex="10001";p.addEventListener("mousedown",function(D){D.preventDefault();d=(d+1)%2;0==d?(u.style.display="block",x.style.display="none"):(u.style.display="none",x.style.display="block")},!1);var u=document.createElement("div");u.style.textAlign="left";
u.style.lineHeight="1.2em";u.style.backgroundColor="rgb("+Math.floor(k[0][0]/2)+","+Math.floor(k[0][1]/2)+","+Math.floor(k[0][2]/2)+")";u.style.padding="0 0 3px 3px";p.appendChild(u);var r=document.createElement("div");r.style.fontFamily="Helvetica, Arial, sans-serif";r.style.fontSize="9px";r.style.color="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";r.style.fontWeight="bold";r.innerHTML="FPS";u.appendChild(r);var t=document.createElement("div");t.style.position="relative";t.style.width="74px";t.style.height=
"30px";t.style.backgroundColor="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";for(u.appendChild(t);74>t.children.length;){var v=document.createElement("span");v.style.width="1px";v.style.height="30px";v.style.cssFloat="left";v.style.backgroundColor="rgb("+k[0][0]+","+k[0][1]+","+k[0][2]+")";t.appendChild(v)}var x=document.createElement("div");x.style.textAlign="left";x.style.lineHeight="1.2em";x.style.backgroundColor="rgb("+Math.floor(q[0][0]/2)+","+Math.floor(q[0][1]/2)+","+Math.floor(q[0][2]/2)+")";
x.style.padding="0 0 3px 3px";x.style.display="none";p.appendChild(x);var y=document.createElement("div");y.style.fontFamily="Helvetica, Arial, sans-serif";y.style.fontSize="9px";y.style.color="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";y.style.fontWeight="bold";y.innerHTML="MS";x.appendChild(y);var A=document.createElement("div");A.style.position="relative";A.style.width="74px";A.style.height="30px";A.style.backgroundColor="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";for(x.appendChild(A);74>A.children.length;)v=
document.createElement("span"),v.style.width="1px",v.style.height=30*Math.random()+"px",v.style.cssFloat="left",v.style.backgroundColor="rgb("+q[0][0]+","+q[0][1]+","+q[0][2]+")",A.appendChild(v);return{domElement:p,update:function(){f=Date.now();g=f-l;m=Math.min(m,g);n=Math.max(n,g);y.textContent=g+" MS ("+m+"-"+n+")";var D=Math.min(30,30-g/200*30);A.appendChild(A.firstChild).style.height=D+"px";l=f;c++;f>a+1E3&&(e=Math.round(1E3*c/(f-a)),b=Math.min(b,e),h=Math.max(h,e),r.textContent=e+" FPS ("+
b+"-"+h+")",D=Math.min(30,30-e/100*30),t.appendChild(t.firstChild).style.height=D+"px",a=f,c=0)}}};
THREE.TrackballControls=function(d,c){function f(E){!1!==b.enabled&&(window.removeEventListener("keydown",f),m=g,g===h.NONE)&&(E.keyCode!==b.keys[h.ROTATE]||b.noRotate?E.keyCode!==b.keys[h.ZOOM]||b.noZoom?E.keyCode!==b.keys[h.PAN]||b.noPan||(g=h.PAN):g=h.ZOOM:g=h.ROTATE)}function l(E){!1!==b.enabled&&(E.preventDefault(),E.stopPropagation(),g!==h.ROTATE||b.noRotate?g!==h.ZOOM||b.noZoom?g!==h.PAN||b.noPan||y.copy(L(E.pageX,E.pageY)):r.copy(L(E.pageX,E.pageY)):p.copy(F(E.pageX,E.pageY)))}function a(E){!1!==
b.enabled&&(E.preventDefault(),E.stopPropagation(),g=h.NONE,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",a),b.dispatchEvent(M))}function e(E){if(!1!==b.enabled){E.preventDefault();E.stopPropagation();var H=0;E.wheelDelta?H=E.wheelDelta/40:E.detail&&(H=-E.detail/3);u.y+=.01*H;b.dispatchEvent(D);b.dispatchEvent(M)}}var b=this,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=d;this.domElement=void 0!==c?c:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var k=new THREE.Vector3,g=h.NONE,m=h.NONE,n=new THREE.Vector3,q=new THREE.Vector3,p=new THREE.Vector3,u=new THREE.Vector2,r=new THREE.Vector2,t=0,v=0,x=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var A={type:"change"},D={type:"start"},M={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var E=this.domElement.getBoundingClientRect(),H=this.domElement.ownerDocument.documentElement;this.screen.left=E.left+window.pageXOffset-H.clientLeft;this.screen.top=E.top+window.pageYOffset-H.clientTop;
this.screen.width=E.width;this.screen.height=E.height}};this.handleEvent=function(E){if("function"==typeof this[E.type])this[E.type](E)};var L=function(){var E=new THREE.Vector2;return function(H,T){E.set((H-b.screen.left)/b.screen.width,(T-b.screen.top)/b.screen.height);return E}}(),F=function(){var E=new THREE.Vector3,H=new THREE.Vector3,T=new THREE.Vector3;return function(P,ia){T.set((P-.5*b.screen.width-b.screen.left)/(.5*b.screen.width),(.5*b.screen.height+b.screen.top-ia)/(.5*b.screen.height),
0);var R=T.length();b.noRoll?T.z=R<Math.SQRT1_2?Math.sqrt(1-R*R):.5/R:1<R?T.normalize():T.z=Math.sqrt(1-R*R);n.copy(b.object.position).sub(b.target);E.copy(b.object.up).setLength(T.y);E.add(H.copy(b.object.up).cross(n).setLength(T.x));E.add(n.setLength(T.z));return E}}();this.rotateCamera=function(){var E=new THREE.Vector3,H=new THREE.Quaternion;return function(){var T=Math.acos(q.dot(p)/q.length()/p.length());T&&(E.crossVectors(q,p).normalize(),T*=b.rotateSpeed,H.setFromAxisAngle(E,-T),n.applyQuaternion(H),
b.object.up.applyQuaternion(H),p.applyQuaternion(H),b.staticMoving?q.copy(p):(H.setFromAxisAngle(E,T*(b.dynamicDampingFactor-1)),q.applyQuaternion(H)))}}();this.zoomCamera=function(){if(g===h.TOUCH_ZOOM_PAN){var E=t/v;t=v;n.multiplyScalar(E)}else E=1+(r.y-u.y)*b.zoomSpeed,1!==E&&0<E&&(n.multiplyScalar(E),b.staticMoving?u.copy(r):u.y+=(r.y-u.y)*this.dynamicDampingFactor)};this.panCamera=function(){var E=new THREE.Vector2,H=new THREE.Vector3,T=new THREE.Vector3;return function(){E.copy(y).sub(x);E.lengthSq()&&
(E.multiplyScalar(n.length()*b.panSpeed),T.copy(n).cross(b.object.up).setLength(E.x),T.add(H.copy(b.object.up).setLength(E.y)),b.object.position.add(T),b.target.add(T),b.staticMoving?x.copy(y):x.add(E.subVectors(y,x).multiplyScalar(b.dynamicDampingFactor)))}}();this.checkDistances=function(){b.noZoom&&b.noPan||(n.lengthSq()>b.maxDistance*b.maxDistance&&b.object.position.addVectors(b.target,n.setLength(b.maxDistance)),n.lengthSq()<b.minDistance*b.minDistance&&b.object.position.addVectors(b.target,
n.setLength(b.minDistance)))};this.update=function(){n.subVectors(b.object.position,b.target);b.noRotate||b.rotateCamera();b.noZoom||b.zoomCamera();b.noPan||b.panCamera();b.object.position.addVectors(b.target,n);b.checkDistances();b.object.lookAt(b.target);1E-6<k.distanceToSquared(b.object.position)&&(b.dispatchEvent(A),k.copy(b.object.position))};this.reset=function(){m=g=h.NONE;b.target.copy(b.target0);b.object.position.copy(b.position0);b.object.up.copy(b.up0);n.subVectors(b.object.position,b.target);
b.object.lookAt(b.target);b.dispatchEvent(A);k.copy(b.object.position)};this.domElement.addEventListener("contextmenu",function(E){E.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(E){!1!==b.enabled&&(E.preventDefault(),E.stopPropagation(),g===h.NONE&&(g=E.button),g!==h.ROTATE||b.noRotate?g!==h.ZOOM||b.noZoom?g!==h.PAN||b.noPan||(x.copy(L(E.pageX,E.pageY)),y.copy(x)):(u.copy(L(E.pageX,E.pageY)),r.copy(u)):(q.copy(F(E.pageX,E.pageY)),p.copy(q)),document.addEventListener("mousemove",
l,!1),document.addEventListener("mouseup",a,!1),b.dispatchEvent(D))},!1);this.domElement.addEventListener("mousewheel",e,!1);this.domElement.addEventListener("DOMMouseScroll",e,!1);this.domElement.addEventListener("touchstart",function(E){if(!1!==b.enabled){switch(E.touches.length){case 1:g=h.TOUCH_ROTATE;q.copy(F(E.touches[0].pageX,E.touches[0].pageY));p.copy(q);break;case 2:g=h.TOUCH_ZOOM_PAN;var H=E.touches[0].pageX-E.touches[1].pageX,T=E.touches[0].pageY-E.touches[1].pageY;v=t=Math.sqrt(H*H+T*
T);x.copy(L((E.touches[0].pageX+E.touches[1].pageX)/2,(E.touches[0].pageY+E.touches[1].pageY)/2));y.copy(x);break;default:g=h.NONE}b.dispatchEvent(D)}},!1);this.domElement.addEventListener("touchend",function(E){if(!1!==b.enabled){switch(E.touches.length){case 1:p.copy(F(E.touches[0].pageX,E.touches[0].pageY));q.copy(p);break;case 2:t=v=0,y.copy(L((E.touches[0].pageX+E.touches[1].pageX)/2,(E.touches[0].pageY+E.touches[1].pageY)/2)),x.copy(y)}g=h.NONE;b.dispatchEvent(M)}},!1);this.domElement.addEventListener("touchmove",
function(E){if(!1!==b.enabled)switch(E.preventDefault(),E.stopPropagation(),E.touches.length){case 1:p.copy(F(E.touches[0].pageX,E.touches[0].pageY));break;case 2:var H=E.touches[0].pageX-E.touches[1].pageX,T=E.touches[0].pageY-E.touches[1].pageY;v=Math.sqrt(H*H+T*T);y.copy(L((E.touches[0].pageX+E.touches[1].pageX)/2,(E.touches[0].pageY+E.touches[1].pageY)/2));break;default:g=h.NONE}},!1);window.addEventListener("keydown",f,!1);window.addEventListener("keyup",function(E){!1!==b.enabled&&(g=m,window.addEventListener("keydown",
f,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(d,c){c=c||document;var f=c.createElement("link");f.type="text/css";f.rel="stylesheet";f.href=d;c.getElementsByTagName("head")[0].appendChild(f)},inject:function(d,c){c=c||document;var f=document.createElement("style");f.type="text/css";f.innerHTML=d;c.getElementsByTagName("head")[0].appendChild(f)}}}();
dat.utils.common=function(){var d=Array.prototype.forEach,c=Array.prototype.slice;return{BREAK:{},extend:function(f){this.each(c.call(arguments,1),function(l){for(var a in l)this.isUndefined(l[a])||(f[a]=l[a])},this);return f},defaults:function(f){this.each(c.call(arguments,1),function(l){for(var a in l)this.isUndefined(f[a])&&(f[a]=l[a])},this);return f},compose:function(){var f=c.call(arguments);return function(){for(var l=c.call(arguments),a=f.length-1;0<=a;a--)l=[f[a].apply(this,l)];return l[0]}},
each:function(f,l,a){if(d&&f.forEach===d)f.forEach(l,a);else if(f.length===f.length+0)for(var e=0,b=f.length;e<b&&!(e in f&&l.call(a,f[e],e)===this.BREAK);e++);else for(e in f)if(l.call(a,f[e],e)===this.BREAK)break},defer:function(f){setTimeout(f,0)},toArray:function(f){return f.toArray?f.toArray():c.call(f)},isUndefined:function(f){return void 0===f},isNull:function(f){return null===f},isNaN:function(f){return f!==f},isArray:Array.isArray||function(f){return f.constructor===Array},isObject:function(f){return f===
Object(f)},isNumber:function(f){return f===f+0},isString:function(f){return f===f+""},isBoolean:function(f){return!1===f||!0===f},isFunction:function(f){return"[object Function]"===Object.prototype.toString.call(f)}}}();
dat.controllers.Controller=function(d){var c=function(f,l){this.initialValue=f[l];this.domElement=document.createElement("div");this.object=f;this.property=l;this.__onFinishChange=this.__onChange=void 0};d.extend(c.prototype,{onChange:function(f){this.__onChange=f;return this},onFinishChange:function(f){this.__onFinishChange=f;return this},setValue:function(f){this.object[this.property]=f;this.__onChange&&this.__onChange.call(this,f);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return c}(dat.utils.common);
dat.dom.dom=function(d){function c(e){if("0"===e||d.isUndefined(e))return 0;e=e.match(l);return d.isNull(e)?0:parseFloat(e[1])}var f={};d.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,b){d.each(e,function(h){f[h]=b})});var l=/(\d+(\.\d+)?)px/,a={makeSelectable:function(e,b){void 0!==e&&void 0!==e.style&&(e.onselectstart=b?function(){return!1}:function(){},e.style.MozUserSelect=b?"auto":"none",e.style.KhtmlUserSelect=
b?"auto":"none",e.unselectable=b?"on":"off")},makeFullscreen:function(e,b,h){d.isUndefined(b)&&(b=!0);d.isUndefined(h)&&(h=!0);e.style.position="absolute";b&&(e.style.left=0,e.style.right=0);h&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,b,h,k){h=h||{};var g=f[b];if(!g)throw Error("Event type "+b+" not supported.");var m=document.createEvent(g);switch(g){case "MouseEvents":m.initMouseEvent(b,h.bubbles||!1,h.cancelable||!0,window,h.clickCount||1,0,0,h.x||h.clientX||0,h.y||h.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":g=m.initKeyboardEvent||m.initKeyEvent;d.defaults(h,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});g(b,h.bubbles||!1,h.cancelable,window,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.keyCode,h.charCode);break;default:m.initEvent(b,h.bubbles||!1,h.cancelable||!0)}d.defaults(m,k);e.dispatchEvent(m)},bind:function(e,b,h,k){e.addEventListener?e.addEventListener(b,h,k||!1):e.attachEvent&&e.attachEvent("on"+b,h);return a},
unbind:function(e,b,h,k){e.removeEventListener?e.removeEventListener(b,h,k||!1):e.detachEvent&&e.detachEvent("on"+b,h);return a},addClass:function(e,b){if(void 0===e.className)e.className=b;else if(e.className!==b){var h=e.className.split(/ +/);-1==h.indexOf(b)&&(h.push(b),e.className=h.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return a},removeClass:function(e,b){if(b){if(void 0!==e.className)if(e.className===b)e.removeAttribute("class");else{var h=e.className.split(/ +/),k=h.indexOf(b);-1!=
k&&(h.splice(k,1),e.className=h.join(" "))}}else e.className=void 0;return a},hasClass:function(e,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return c(e["border-left-width"])+c(e["border-right-width"])+c(e["padding-left"])+c(e["padding-right"])+c(e.width)},getHeight:function(e){e=getComputedStyle(e);return c(e["border-top-width"])+c(e["border-bottom-width"])+c(e["padding-top"])+c(e["padding-bottom"])+c(e.height)},getOffset:function(e){var b=
{left:0,top:0};if(e.offsetParent){do b.left+=e.offsetLeft,b.top+=e.offsetTop;while(e=e.offsetParent)}return b},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return a}(dat.utils.common);
dat.controllers.OptionController=function(d,c,f){var l=function(a,e,b){l.superclass.call(this,a,e);var h=this;this.__select=document.createElement("select");if(f.isArray(b)){var k={};f.each(b,function(g){k[g]=g});b=k}f.each(b,function(g,m){var n=document.createElement("option");n.innerHTML=m;n.setAttribute("value",g);h.__select.appendChild(n)});this.updateDisplay();c.bind(this.__select,"change",function(){h.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
l.superclass=d;f.extend(l.prototype,d.prototype,{setValue:function(a){a=l.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(d,c){var f=function(l,a,e){f.superclass.call(this,l,a);e=e||{};this.__min=e.min;this.__max=e.max;this.__step=e.step;c.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;l=this.__impliedStep;l=l.toString();l=-1<l.indexOf(".")?l.length-l.indexOf(".")-1:0;this.__precision=l};f.superclass=d;c.extend(f.prototype,d.prototype,{setValue:function(l){void 0!==
this.__min&&l<this.__min?l=this.__min:void 0!==this.__max&&l>this.__max&&(l=this.__max);void 0!==this.__step&&0!=l%this.__step&&(l=Math.round(l/this.__step)*this.__step);return f.superclass.prototype.setValue.call(this,l)},min:function(l){this.__min=l;return this},max:function(l){this.__max=l;return this},step:function(l){this.__step=l;return this}});return f}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(d,c,f){var l=function(a,e,b){function h(){var q=parseFloat(m.__input.value);f.isNaN(q)||m.setValue(q)}function k(q){var p=n-q.clientY;m.setValue(m.getValue()+p*m.__impliedStep);n=q.clientY}function g(){c.unbind(window,"mousemove",k);c.unbind(window,"mouseup",g)}this.__truncationSuspended=!1;l.superclass.call(this,a,e,b);var m=this,n;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"change",h);c.bind(this.__input,
"blur",function(){h();m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())});c.bind(this.__input,"mousedown",function(q){c.bind(window,"mousemove",k);c.bind(window,"mouseup",g);n=q.clientY});c.bind(this.__input,"keydown",function(q){13===q.keyCode&&(m.__truncationSuspended=!0,this.blur(),m.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};l.superclass=d;f.extend(l.prototype,d.prototype,{updateDisplay:function(){var a=this.__input;if(this.__truncationSuspended)var e=
this.getValue();else{e=this.getValue();var b=Math.pow(10,this.__precision);e=Math.round(e*b)/b}a.value=e;return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(d,c,f,l,a){var e=function(b,h,k,g,m){function n(u){u.preventDefault();var r=c.getOffset(p.__background),t=c.getWidth(p.__background),v=p,x=r.left,y=p.__min;v.setValue.call(v,y+(u.clientX-x)/(r.left+t-x)*(p.__max-y));return!1}function q(){c.unbind(window,"mousemove",n);c.unbind(window,"mouseup",q);p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}e.superclass.call(this,b,h,{min:k,max:g,step:m});var p=this;this.__background=document.createElement("div");
this.__foreground=document.createElement("div");c.bind(this.__background,"mousedown",function(u){c.bind(window,"mousemove",n);c.bind(window,"mouseup",q);n(u)});c.addClass(this.__background,"slider");c.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};e.superclass=d;e.useDefaultStyles=function(){f.inject(a)};l.extend(e.prototype,d.prototype,{updateDisplay:function(){var b=(this.getValue()-this.__min)/
(this.__max-this.__min);this.__foreground.style.width=100*b+"%";return e.superclass.prototype.updateDisplay.call(this)}});return e}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(d,c,f){var l=function(a,e,b){l.superclass.call(this,a,e);var h=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===b?"Fire":b;c.bind(this.__button,"click",function(k){k.preventDefault();h.fire();return!1});c.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};l.superclass=d;f.extend(l.prototype,d.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(d,c,f){var l=function(a,e){l.superclass.call(this,a,e);var b=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");c.bind(this.__checkbox,"change",function(){b.setValue(!b.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};l.superclass=d;f.extend(l.prototype,d.prototype,{setValue:function(a){a=l.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(d){return function(c){if(1==c.a||d.isUndefined(c.a)){for(c=c.hex.toString(16);6>c.length;)c="0"+c;return"#"+c}return"rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+c.a+")"}}(dat.utils.common);
dat.color.interpret=function(d,c){var f,l,a=[{litmus:c.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===e?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:d},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null===e?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:d},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:d},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:d}}},{litmus:c.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:c.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3!=
e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:c.isObject,conversions:{RGBA_OBJ:{read:function(e){return c.isNumber(e.r)&&c.isNumber(e.g)&&c.isNumber(e.b)&&c.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return c.isNumber(e.r)&&
c.isNumber(e.g)&&c.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return c.isNumber(e.h)&&c.isNumber(e.s)&&c.isNumber(e.v)&&c.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return c.isNumber(e.h)&&c.isNumber(e.s)&&c.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return function(){l=!1;
var e=1<arguments.length?c.toArray(arguments):arguments[0];c.each(a,function(b){if(b.litmus(e))return c.each(b.conversions,function(h,k){f=h.read(e);if(!1===l&&!1!==f)return l=f,f.conversionName=k,f.conversion=h,c.BREAK}),c.BREAK});return l}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(d,c,f,l,a,e,b,h,k,g,m,n,q,p,u){function r(C,z,w,B){if(void 0===z[w])throw Error("Object "+z+' has no property "'+w+'"');B.color?z=new m(z,w):(z=[z,w].concat(B.factoryArgs),z=l.apply(C,z));B.before instanceof a&&(B.before=B.before.__li);x(C,z);p.addClass(z.domElement,"c");w=document.createElement("span");p.addClass(w,"property-name");w.innerHTML=z.property;var G=document.createElement("div");G.appendChild(w);G.appendChild(z.domElement);B=t(C,G,B.before);p.addClass(B,O.CLASS_CONTROLLER_ROW);
p.addClass(B,typeof z.getValue());v(C,B,z);C.__controllers.push(z);return z}function t(C,z,w){var B=document.createElement("li");z&&B.appendChild(z);w?C.__ul.insertBefore(B,params.before):C.__ul.appendChild(B);C.onResize();return B}function v(C,z,w){w.__li=z;w.__gui=C;u.extend(w,{options:function(K){if(1<arguments.length)return w.remove(),r(C,w.object,w.property,{before:w.__li.nextElementSibling,factoryArgs:[u.toArray(arguments)]});if(u.isArray(K)||u.isObject(K))return w.remove(),r(C,w.object,w.property,
{before:w.__li.nextElementSibling,factoryArgs:[K]})},name:function(K){w.__li.firstElementChild.firstElementChild.innerHTML=K;return w},listen:function(){w.__gui.listen(w);return w},remove:function(){w.__gui.remove(w);return w}});if(w instanceof k){var B=new h(w.object,w.property,{min:w.__min,max:w.__max,step:w.__step});u.each(["updateDisplay","onChange","onFinishChange"],function(K){var N=w[K],I=B[K];w[K]=B[K]=function(){var U=Array.prototype.slice.call(arguments);N.apply(w,U);return I.apply(B,U)}});
p.addClass(z,"has-slider");w.domElement.insertBefore(B.domElement,w.domElement.firstElementChild)}else if(w instanceof h){var G=function(K){return u.isNumber(w.__min)&&u.isNumber(w.__max)?(w.remove(),r(C,w.object,w.property,{before:w.__li.nextElementSibling,factoryArgs:[w.__min,w.__max,w.__step]})):K};w.min=u.compose(G,w.min);w.max=u.compose(G,w.max)}else w instanceof e?(p.bind(z,"click",function(){p.fakeEvent(w.__checkbox,"click")}),p.bind(w.__checkbox,"click",function(K){K.stopPropagation()})):
w instanceof b?(p.bind(z,"click",function(){p.fakeEvent(w.__button,"click")}),p.bind(z,"mouseover",function(){p.addClass(w.__button,"hover")}),p.bind(z,"mouseout",function(){p.removeClass(w.__button,"hover")})):w instanceof m&&(p.addClass(z,"color"),w.updateDisplay=u.compose(function(K){z.style.borderLeftColor=w.__color.toString();return K},w.updateDisplay),w.updateDisplay());w.setValue=u.compose(function(K){C.getRoot().__preset_select&&w.isModified()&&F(C.getRoot(),!0);return K},w.setValue)}function x(C,
z){var w=C.getRoot(),B=w.__rememberedObjects.indexOf(z.object);if(-1!=B){var G=w.__rememberedObjectIndecesToControllers[B];void 0===G&&(G={},w.__rememberedObjectIndecesToControllers[B]=G);G[z.property]=z;if(w.load&&w.load.remembered){w=w.load.remembered;if(w[C.preset])w=w[C.preset];else if(w.Default)w=w.Default;else return;w[B]&&void 0!==w[B][z.property]&&(B=w[B][z.property],z.initialValue=B,z.setValue(B))}}}function y(C){var z=C.__save_row=document.createElement("li");p.addClass(C.domElement,"has-save");
C.__ul.insertBefore(z,C.__ul.firstChild);p.addClass(z,"save-row");var w=document.createElement("span");w.innerHTML="&nbsp;";p.addClass(w,"button gears");var B=document.createElement("span");B.innerHTML="Save";p.addClass(B,"button");p.addClass(B,"save");var G=document.createElement("span");G.innerHTML="New";p.addClass(G,"button");p.addClass(G,"save-as");var K=document.createElement("span");K.innerHTML="Revert";p.addClass(K,"button");p.addClass(K,"revert");var N=C.__preset_select=document.createElement("select");
C.load&&C.load.remembered?u.each(C.load.remembered,function(S,Z){L(C,Z,Z==C.preset)}):L(C,"Default",!1);p.bind(N,"change",function(){for(var S=0;S<C.__preset_select.length;S++)C.__preset_select[S].innerHTML=C.__preset_select[S].value;C.preset=this.value});z.appendChild(N);z.appendChild(w);z.appendChild(B);z.appendChild(G);z.appendChild(K);if(H){var I=function(){U.style.display=C.useLocalStorage?"block":"none"};z=document.getElementById("dg-save-locally");var U=document.getElementById("dg-local-explain");
z.style.display="block";z=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&z.setAttribute("checked","checked");I();p.bind(z,"change",function(){C.useLocalStorage=!C.useLocalStorage;I()})}var aa=document.getElementById("dg-new-constructor");p.bind(aa,"keydown",function(S){!S.metaKey||67!==S.which&&67!=S.keyCode||T.hide()});p.bind(w,"click",function(){aa.innerHTML=JSON.stringify(C.getSaveObject(),void 0,2);T.show();aa.focus();aa.select()});
p.bind(B,"click",function(){C.save()});p.bind(G,"click",function(){var S=prompt("Enter a new preset name.");S&&C.saveAs(S)});p.bind(K,"click",function(){C.revert()})}function A(C){function z(K){K.preventDefault();G=K.clientX;p.addClass(C.__closeButton,O.CLASS_DRAG);p.bind(window,"mousemove",w);p.bind(window,"mouseup",B);return!1}function w(K){K.preventDefault();C.width+=G-K.clientX;C.onResize();G=K.clientX;return!1}function B(){p.removeClass(C.__closeButton,O.CLASS_DRAG);p.unbind(window,"mousemove",
w);p.unbind(window,"mouseup",B)}C.__resize_handle=document.createElement("div");u.extend(C.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var G;p.bind(C.__resize_handle,"mousedown",z);p.bind(C.__closeButton,"mousedown",z);C.domElement.insertBefore(C.__resize_handle,C.domElement.firstElementChild)}function D(C,z){C.domElement.style.width=z+"px";C.__save_row&&C.autoPlace&&(C.__save_row.style.width=z+"px");C.__closeButton&&(C.__closeButton.style.width=
z+"px")}function M(C,z){var w={};u.each(C.__rememberedObjects,function(B,G){var K={};u.each(C.__rememberedObjectIndecesToControllers[G],function(N,I){K[I]=z?N.initialValue:N.getValue()});w[G]=K});return w}function L(C,z,w){var B=document.createElement("option");B.innerHTML=z;B.value=z;C.__preset_select.appendChild(B);w&&(C.__preset_select.selectedIndex=C.__preset_select.length-1)}function F(C,z){var w=C.__preset_select[C.__preset_select.selectedIndex];w.innerHTML=z?w.value+"*":w.value}function E(C){0!=
C.length&&n(function(){E(C)});u.each(C,function(z){z.updateDisplay()})}d.inject(f);try{var H="localStorage"in window&&null!==window.localStorage}catch(C){H=!1}var T,P=!0,ia,R=!1,ba=[],O=function(C){function z(){localStorage.setItem(document.location.href+".gui",JSON.stringify(B.getSaveObject()))}function w(){var I=B.getRoot();I.width+=1;u.defer(function(){--I.width})}var B=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);
p.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];C=C||{};C=u.defaults(C,{autoPlace:!0,width:O.DEFAULT_WIDTH});C=u.defaults(C,{resizable:C.autoPlace,hideable:C.autoPlace});u.isUndefined(C.load)?C.load={preset:"Default"}:C.preset&&(C.load.preset=C.preset);u.isUndefined(C.parent)&&C.hideable&&ba.push(this);C.resizable=u.isUndefined(C.parent)&&C.resizable;C.autoPlace&&u.isUndefined(C.scrollable)&&
(C.scrollable=!0);var G=H&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return C.parent}},scrollable:{get:function(){return C.scrollable}},autoPlace:{get:function(){return C.autoPlace}},preset:{get:function(){return B.parent?B.getRoot().preset:C.load.preset},set:function(I){B.parent?B.getRoot().preset=I:C.load.preset=I;for(I=0;I<this.__preset_select.length;I++)this.__preset_select[I].value==this.preset&&(this.__preset_select.selectedIndex=
I);B.revert()}},width:{get:function(){return C.width},set:function(I){C.width=I;D(B,I)}},name:{get:function(){return C.name},set:function(I){C.name=I;N&&(N.innerHTML=C.name)}},closed:{get:function(){return C.closed},set:function(I){C.closed=I;C.closed?p.addClass(B.__ul,O.CLASS_CLOSED):p.removeClass(B.__ul,O.CLASS_CLOSED);this.onResize();B.__closeButton&&(B.__closeButton.innerHTML=I?O.TEXT_OPEN:O.TEXT_CLOSED)}},load:{get:function(){return C.load}},useLocalStorage:{get:function(){return G},set:function(I){H&&
((G=I)?p.bind(window,"unload",z):p.unbind(window,"unload",z),localStorage.setItem(document.location.href+".isLocal",I))}}});if(u.isUndefined(C.parent)){C.closed=!1;p.addClass(this.domElement,O.CLASS_MAIN);p.makeSelectable(this.domElement,!1);if(H&&G){B.useLocalStorage=!0;var K=localStorage.getItem(document.location.href+".gui");K&&(C.load=JSON.parse(K))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=O.TEXT_CLOSED;p.addClass(this.__closeButton,O.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
p.bind(this.__closeButton,"click",function(){B.closed=!B.closed})}else{void 0===C.closed&&(C.closed=!0);var N=document.createTextNode(C.name);p.addClass(N,"controller-name");K=t(B,N);p.addClass(this.__ul,O.CLASS_CLOSED);p.addClass(K,"title");p.bind(K,"click",function(I){I.preventDefault();B.closed=!B.closed;return!1});C.closed||(this.closed=!1)}C.autoPlace&&(u.isUndefined(C.parent)&&(P&&(ia=document.createElement("div"),p.addClass(ia,"dg"),p.addClass(ia,O.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ia),
P=!1),ia.appendChild(this.domElement),p.addClass(this.domElement,O.CLASS_AUTO_PLACE)),this.parent||D(B,C.width));p.bind(window,"resize",function(){B.onResize()});p.bind(this.__ul,"webkitTransitionEnd",function(){B.onResize()});p.bind(this.__ul,"transitionend",function(){B.onResize()});p.bind(this.__ul,"oTransitionEnd",function(){B.onResize()});this.onResize();C.resizable&&A(this);B.getRoot();C.parent||w()};O.toggleHide=function(){R=!R;u.each(ba,function(C){C.domElement.style.zIndex=R?-999:999;C.domElement.style.opacity=
R?0:1})};O.CLASS_AUTO_PLACE="a";O.CLASS_AUTO_PLACE_CONTAINER="ac";O.CLASS_MAIN="main";O.CLASS_CONTROLLER_ROW="cr";O.CLASS_TOO_TALL="taller-than-window";O.CLASS_CLOSED="closed";O.CLASS_CLOSE_BUTTON="close-button";O.CLASS_DRAG="drag";O.DEFAULT_WIDTH=245;O.TEXT_CLOSED="Close Controls";O.TEXT_OPEN="Open Controls";p.bind(window,"keydown",function(C){"text"===document.activeElement.type||72!==C.which&&72!=C.keyCode||O.toggleHide()},!1);u.extend(O.prototype,{add:function(C,z){return r(this,C,z,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(C,z){return r(this,C,z,{color:!0})},remove:function(C){this.__ul.removeChild(C.__li);this.__controllers.slice(this.__controllers.indexOf(C),1);var z=this;u.defer(function(){z.onResize()})},destroy:function(){this.autoPlace&&ia.removeChild(this.domElement)},addFolder:function(C){if(void 0!==this.__folders[C])throw Error('You already have a folder in this GUI by the name "'+C+'"');var z={name:C,parent:this};z.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[C]&&
(z.closed=this.load.folders[C].closed,z.load=this.load.folders[C]);z=new O(z);this.__folders[C]=z;C=t(this,z.domElement);p.addClass(C,"folder");return z},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var C=this.getRoot();if(C.scrollable){var z=p.getOffset(C.__ul).top,w=0;u.each(C.__ul.childNodes,function(B){C.autoPlace&&B===C.__save_row||(w+=p.getHeight(B))});window.innerHeight-z-20<w?(p.addClass(C.domElement,O.CLASS_TOO_TALL),C.__ul.style.height=window.innerHeight-
z-20+"px"):(p.removeClass(C.domElement,O.CLASS_TOO_TALL),C.__ul.style.height="auto")}C.__resize_handle&&u.defer(function(){C.__resize_handle.style.height=C.__ul.offsetHeight+"px"});C.__closeButton&&(C.__closeButton.style.width=C.width+"px")},remember:function(){u.isUndefined(T)&&(T=new q,T.domElement.innerHTML=c);if(this.parent)throw Error("You can only call remember on a top level GUI.");var C=this;u.each(Array.prototype.slice.call(arguments),function(z){0==C.__rememberedObjects.length&&y(C);-1==
C.__rememberedObjects.indexOf(z)&&C.__rememberedObjects.push(z)});this.autoPlace&&D(this,this.width)},getRoot:function(){for(var C=this;C.parent;)C=C.parent;return C},getSaveObject:function(){var C=this.load;C.closed=this.closed;0<this.__rememberedObjects.length&&(C.preset=this.preset,C.remembered||(C.remembered={}),C.remembered[this.preset]=M(this));C.folders={};u.each(this.__folders,function(z,w){C.folders[w]=z.getSaveObject()});return C},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=M(this);F(this,!1)},saveAs:function(C){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=M(this,!0));this.load.remembered[C]=M(this);this.preset=C;L(this,C,!0)},revert:function(C){u.each(this.__controllers,function(z){this.getRoot().load.remembered?x(C||this.getRoot(),z):z.setValue(z.initialValue)},this);u.each(this.__folders,function(z){z.revert(z)});C||F(this.getRoot(),!1)},listen:function(C){var z=0==this.__listening.length;this.__listening.push(C);
z&&E(this.__listening)}});return O}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(d,c,f,l,a,e,b){return function(h,k,g,m){var n=h[k];if(b.isArray(g)||b.isObject(g))return new d(h,k,g);if(b.isNumber(n))return b.isNumber(g)&&b.isNumber(m)?new f(h,k,g,m):new c(h,k,{min:g,max:m});if(b.isString(n))return new l(h,k);if(b.isFunction(n))return new a(h,k,"");if(b.isBoolean(n))return new e(h,k)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(d,c,f){var l=
function(a,e){function b(){h.setValue(h.__input.value)}l.superclass.call(this,a,e);var h=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"keyup",b);c.bind(this.__input,"change",b);c.bind(this.__input,"blur",function(){h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())});c.bind(this.__input,"keydown",function(k){13===k.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};l.superclass=d;f.extend(l.prototype,
d.prototype,{updateDisplay:function(){c.isActive(this.__input)||(this.__input.value=this.getValue());return l.superclass.prototype.updateDisplay.call(this)}});return l}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(d,c,f,l,a){function e(g,m,n,q){g.style.background="";a.each(k,function(p){g.style.cssText+="background: "+p+"linear-gradient("+m+", "+n+" 0%, "+q+" 100%); "})}function b(g){g.style.background="";g.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";g.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
g.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";g.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";g.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(g,m){function n(y){r(y);c.bind(window,"mousemove",r);c.bind(window,
"mouseup",q)}function q(){c.unbind(window,"mousemove",r);c.unbind(window,"mouseup",q)}function p(){var y=l(this.value);!1!==y?(v.__color.__state=y,v.setValue(v.__color.toOriginal())):this.value=v.__color.toString()}function u(){c.unbind(window,"mousemove",t);c.unbind(window,"mouseup",u)}function r(y){y.preventDefault();var A=c.getWidth(v.__saturation_field),D=c.getOffset(v.__saturation_field),M=(y.clientX-D.left+document.body.scrollLeft)/A;y=1-(y.clientY-D.top+document.body.scrollTop)/A;1<y?y=1:0>
y&&(y=0);1<M?M=1:0>M&&(M=0);v.__color.v=y;v.__color.s=M;v.setValue(v.__color.toOriginal());return!1}function t(y){y.preventDefault();var A=c.getHeight(v.__hue_field),D=c.getOffset(v.__hue_field);y=1-(y.clientY-D.top+document.body.scrollTop)/A;1<y?y=1:0>y&&(y=0);v.__color.h=360*y;v.setValue(v.__color.toOriginal());return!1}h.superclass.call(this,g,m);this.__color=new f(this.getValue());this.__temp=new f(0);var v=this;this.domElement=document.createElement("div");c.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";c.bind(this.__input,"keydown",function(y){13===y.keyCode&&p.call(this)});c.bind(this.__input,"blur",p);c.bind(this.__selector,"mousedown",function(y){c.addClass(this,"drag").bind(window,"mouseup",function(A){c.removeClass(v.__selector,"drag")})});var x=document.createElement("div");a.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});a.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});a.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});a.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});a.extend(x.style,{width:"100%",height:"100%",
background:"none"});e(x,"top","rgba(0,0,0,0)","#000");a.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});b(this.__hue_field);a.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});c.bind(this.__saturation_field,"mousedown",n);c.bind(this.__field_knob,"mousedown",n);c.bind(this.__hue_field,"mousedown",function(y){t(y);c.bind(window,
"mousemove",t);c.bind(window,"mouseup",u)});this.__saturation_field.appendChild(x);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};h.superclass=d;a.extend(h.prototype,d.prototype,{updateDisplay:function(){var g=l(this.getValue());if(!1!==g){var m=!1;
a.each(f.COMPONENTS,function(p){if(!a.isUndefined(g[p])&&!a.isUndefined(this.__color.__state[p])&&g[p]!==this.__color.__state[p])return m=!0,{}},this);m&&a.extend(this.__color.__state,g)}a.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var n=.5>this.__color.v||.5<this.__color.s?255:0,q=255-n;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+n+
","+n+","+n+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;e(this.__saturation_field,"left","#fff",this.__temp.toString());a.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+q+","+q+","+q+",.7)"})}});var k=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(d,c,f,l){function a(g,
m,n){Object.defineProperty(g,m,{get:function(){if("RGB"===this.__state.space)return this.__state[m];b(this,m,n);return this.__state[m]},set:function(q){"RGB"!==this.__state.space&&(b(this,m,n),this.__state.space="RGB");this.__state[m]=q}})}function e(g,m){Object.defineProperty(g,m,{get:function(){if("HSV"===this.__state.space)return this.__state[m];h(this);return this.__state[m]},set:function(n){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV");this.__state[m]=n}})}function b(g,m,n){if("HEX"===
g.__state.space)g.__state[m]=c.component_from_hex(g.__state.hex,n);else if("HSV"===g.__state.space)l.extend(g.__state,c.hsv_to_rgb(g.__state.h,g.__state.s,g.__state.v));else throw"Corrupted color state";}function h(g){var m=c.rgb_to_hsv(g.r,g.g,g.b);l.extend(g.__state,{s:m.s,v:m.v});l.isNaN(m.h)?l.isUndefined(g.__state.h)&&(g.__state.h=0):g.__state.h=m.h}var k=function(){this.__state=d.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};k.COMPONENTS="r g b h s v hex a".split(" ");l.extend(k.prototype,{toString:function(){return f(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(k.prototype,"r",2);a(k.prototype,"g",1);a(k.prototype,"b",0);e(k.prototype,"h");e(k.prototype,"s");e(k.prototype,"v");Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(g){this.__state.a=g}});Object.defineProperty(k.prototype,"hex",{get:function(){this.__state.hex=c.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(g){this.__state.space="HEX";this.__state.hex=g}});return k}(dat.color.interpret,dat.color.math=function(){var d;return{hsv_to_rgb:function(c,f,l){var a=c/60-Math.floor(c/60),e=l*(1-f),b=l*(1-a*f);f=l*(1-(1-a)*f);c=[[l,f,e],[b,l,e],[e,l,f],[e,b,l],[f,e,l],[l,e,b]][Math.floor(c/60)%6];return{r:255*c[0],g:255*c[1],b:255*c[2]}},rgb_to_hsv:function(c,f,l){var a=Math.max(c,f,l),e=a-Math.min(c,f,l);if(0==a)return{h:NaN,s:0,v:0};c=(c==a?(f-l)/e:f==a?2+(l-c)/e:
4+(c-f)/e)/6;0>c&&(c+=1);return{h:360*c,s:e/a,v:a/255}},rgb_to_hex:function(c,f,l){c=this.hex_with_component(0,2,c);c=this.hex_with_component(c,1,f);return c=this.hex_with_component(c,0,l)},component_from_hex:function(c,f){return c>>8*f&255},hex_with_component:function(c,f,l){return l<<(d=8*f)|c&~(255<<d)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d,c){window.setTimeout(d,1E3/60)}}(),dat.dom.CenteredDiv=function(d,c){var f=function(){this.backgroundElement=document.createElement("div");c.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});d.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
c.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var l=this;d.bind(this.backgroundElement,"click",function(){l.hide()})};f.prototype.show=function(){var l=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();c.defer(function(){l.backgroundElement.style.opacity=1;l.domElement.style.opacity=1;l.domElement.style.webkitTransform="scale(1)"})};f.prototype.hide=function(){var l=this,a=function(){l.domElement.style.display="none";l.backgroundElement.style.display="none";d.unbind(l.domElement,"webkitTransitionEnd",a);d.unbind(l.domElement,"transitionend",a);d.unbind(l.domElement,"oTransitionEnd",a)};d.bind(this.domElement,"webkitTransitionEnd",a);d.bind(this.domElement,"transitionend",
a);d.bind(this.domElement,"oTransitionEnd",a);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};f.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-d.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-d.getHeight(this.domElement)/2+"px"};return f}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
function CVector2(d,c){var f,l;this._init=function(a,e){f=a;l=e};this.add=function(a,e){f+=a;l+=e};this.addV=function(a){f+=a.getX();l+=a.getY()};this.scalarDivision=function(a){f/=a;l/=a};this.subtract=function(a){f-=a.getX();l-=a.getY()};this.scalarProduct=function(a){f*=a;l*=a};this.invert=function(){f*=-1;l*=-1};this.dotProduct=function(a){return f*a.getX()+l*a.getY()};this.set=function(a,e){f=a;l=e};this.setV=function(a){f=a.getX();l=a.getY()};this.length=function(){return Math.sqrt(f*f+l*l)};
this.length2=function(){return f*f+l*l};this.normalize=function(){var a=this.length();0<a&&(f/=a,l/=a)};this.angleBetweenVectors=function(a){a=Math.acos(this.dotProduct(a)/(this.length()*a.length()));return!0===isNaN(a)?0:a};this.getNormalize=function(a){this.length();a.set(f,l);a.normalize()};this.rot90CCW=function(){var a=f;f=-l;l=a};this.rot90CW=function(){var a=f;f=l;l=-a};this.getRotCCW=function(a){a.set(f,l);a.rot90CCW()};this.getRotCW=function(a){a.set(f,l);a.rot90CW()};this.ceil=function(){f=
Math.ceil(f);l=Math.ceil(l)};this.round=function(){f=Math.round(f);l=Math.round(l)};this.toString=function(){return"Vector2: "+f+", "+l};this.print=function(){trace("Vector2: "+f+", "+l)};this.getX=function(){return f};this.getY=function(){return l};this.rotate=function(a){var e=f,b=l;f=e*Math.cos(a)-b*Math.sin(a);l=e*Math.sin(a)+b*Math.cos(a)};this._init(d,c)}
function CToggle(d,c,f,l,a){var e,b,h,k,g,m=[],n,q,p;this._init=function(u,r,t,v){b=t.width/2;h=t.height;k=[];g=[];var x=new createjs.SpriteSheet({images:[t],frames:{width:t.width/2,height:t.height,regX:t.width/2/2,regY:t.height/2},animations:{state_true:0,state_false:1}});e=v;p=createSprite(x,"state_"+e,t.width/2/2,t.height/2,t.width/2,t.height);p.mouseEnabled=!0;p.x=u;p.y=r;p.cursor="pointer";p.stop();a.addChild(p);this._initListener()};this.unload=function(){p.off("mousedown",n);p.off("pressup",
q);p.mouseEnabled=!1;a.removeChild(p)};this._initListener=function(){n=p.on("mousedown",this.buttonDown);q=p.on("pressup",this.buttonRelease)};this.addEventListener=function(u,r,t){k[u]=r;g[u]=t};this.addEventListenerWithParams=function(u,r,t,v){k[u]=r;g[u]=t;m=v};this.setActive=function(u){e=u;p.gotoAndStop("state_"+e)};this.buttonRelease=function(){p.scaleX=1;p.scaleY=1;playSound("click",1,!1);e=!e;p.gotoAndStop("state_"+e);k[ON_MOUSE_UP]&&k[ON_MOUSE_UP].call(g[ON_MOUSE_UP],m)};this.buttonDown=
function(){p.scaleX=.9;p.scaleY=.9;k[ON_MOUSE_DOWN]&&k[ON_MOUSE_DOWN].call(g[ON_MOUSE_DOWN],m)};this.setPosition=function(u,r){p.x=u;p.y=r};this.setVisible=function(u){p.visible=u};this.getContainer=function(){return p};this.getWidth=function(){return b};this.getHeight=function(){return h};this._init(d,c,f,l)}
function CGfxButton(d,c,f,l){var a,e,b,h,k,g,m,n,q=[],p;this._init=function(r,t,v){a=!1;h=1;e=v.width;b=v.height;m=[];n=[];p=createBitmap(v);p.x=r;p.y=t;p.cursor="pointer";p.regX=v.width/2;p.regY=v.height/2;u.addChild(p);this._initListener()};this.unload=function(){createjs.Tween.removeTweens(p);p.off("mousedown",k);p.off("pressup",g);u.removeChild(p)};this.setVisible=function(r){p.visible=r};this.setScale=function(r){h=r;p.scaleX=p.scaleY=h};this.disable=function(){a=!0};this.enable=function(){a=
!1};this._initListener=function(){k=p.on("mousedown",this.buttonDown);g=p.on("pressup",this.buttonRelease)};this.addEventListener=function(r,t,v){m[r]=t;n[r]=v};this.addEventListenerWithParams=function(r,t,v,x){m[r]=t;n[r]=v;q=x};this.refreshImage=function(r){p.image=s_oSpriteLibrary.getSprite(r)};this.buttonRelease=function(){a||(p.scaleX=h,p.scaleY=h,m[ON_MOUSE_UP]&&m[ON_MOUSE_UP].call(n[ON_MOUSE_UP],q))};this.buttonDown=function(){a||(p.scaleX=.9*h,p.scaleY=.9*h,playSound("click",1,!1),m[ON_MOUSE_DOWN]&&
m[ON_MOUSE_DOWN].call(n[ON_MOUSE_DOWN],q))};this.setPosition=function(r,t){p.x=r;p.y=t};this.pulseAnimation=function(){createjs.Tween.get(p,{loop:-1}).to({scaleX:1.1*h,scaleY:1.1*h},850,createjs.Ease.quadOut).to({scaleX:h,scaleY:h},650,createjs.Ease.quadIn)};this.trembleAnimation=function(){createjs.Tween.get(p,{loop:!0}).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750)};this.stopAnimation=function(){p.rotation=
0;createjs.Tween.removeTweens(p)};this.setX=function(r){p.x=r};this.setY=function(r){p.y=r};this.getContainer=function(){return p};this.getWidth=function(){return e};this.getHeight=function(){return b};this.getX=function(){return p.x};this.getY=function(){return p.y};var u=l;this._init(d,c,f);return this}
function CRadialWipeWidget(d,c,f){var l,a,e,b,h,k;this._init=function(g,m,n){l=!1;a=0;k=new createjs.Container;k.x=g;k.y=m;n.addChild(k);e=createjs.Graphics.getRGB(93156);b=new createjs.Shape;b.rotation=-90;b.alpha=1;k.addChild(b);h=new createjs.Text(""," 60px "+PRIMARY_FONT,"#ffffff");h.textAlign="center";h.textBaseline="alphabetic";h.y=20;h.shadow=new createjs.Shadow("#000000",5,5,10);k.addChild(h)};this.unload=function(){f.removeChild(k)};this.setPos=function(g,m){k.x=g;k.y=m};this.reset=function(){h.color=
"#ffffff"};this.setVisible=function(g){k.visible=g};this.setScale=function(g){k.scaleX=k.scaleY=g};this.setHurryUpMode=function(g){l=!0;a=g};this.removeHurryUpMode=function(){l=!1};this._showHurryUpWarning=function(){h.color="#ff0000";playSound("hurryup",1,!1);new CTremble(k,1E3,50,4)};this._updateTimeText=function(g){h.text=Math.ceil(g/1E3)};this._updateRadialWipe=function(g,m){var n=linearFunction(g,m,0,0,360);b.graphics.clear();b.graphics.f(e);b.graphics.moveTo(0,0);b.graphics.arc(0,0,50,0,degreesToRadians(n),
!0)};this.update=function(g,m){this._updateTimeText(g);this._updateRadialWipe(g,m);0===g&&(h.text="",b.graphics.clear());l&&g<a&&(l=!1,this._showHurryUpWarning())};this._init(d,c,f)}
function CTremble(d,c,f,l){var a,e,b,h,k,g,m;this._init=function(q,p,u,r){h=b=!1;g=0;this._calculateDuration();a=q.x;e=q.y;b||(b=!0,k=setInterval(function(){n._tremble()},u))};this._tremble=function(){if(h=!h){var q=.5>Math.random()?-l:l;var p=.5>Math.random()?-l:l;d.x+=q;d.y+=p}else d.x=a,d.y=e;g++;g>m&&(g=0,b=!1,d.x=a,d.y=e,0===c?k=setInterval(function(){n._tremble()},f):clearInterval(k))};this._calculateDuration=function(){m=c/f};this.stopTremble=function(){clearInterval(k)};var n=this;this._init(d,
c,f,l)}var ON_CONNECTION_ERROR=0,ON_DISCONNECTION=1,ON_LOGIN_SUCCESS=2,ON_MATCHMAKING_CONNECTION_SUCCESS=3,ON_GAMEROOM_CONNECTION_SUCCESS=4,ON_USEROWNERROOM_CREATE_SUCCESS=5,ON_USEROWNERROOM_JOIN_SUCCESS=6,ON_ROOM_INFO_RETURNED=7,ON_BACK_FROM_A_ROOM=8,ERROR_CODE_UNKNOWNROOM="UnknownRoom",ON_STATUS_ONLINE="online",ON_STATUS_OFFLINE="offline",ROOM_TYPE_MATCHMAKING="MatchmakingRoom",ROOM_TYPE_USEROWNER="UserOwnerRoom",ROOM_TYPE_GAME="GameRoom";
function CNetworkManager(){var d,c,f,l,a,e,b,h,k,g,m,n,q,p,u,r;this._init=function(){d=navigator.onLine;g=0;c=[];f=[];l=[];a=[];window.addEventListener("online",this._onConnectionChangeStatusOnline);window.addEventListener("offline",this._onConnectionChangeStatusOffline);h=new CNetworkMessageForwarder;r=this};this.unload=function(){window.removeEventListener("online",this._onConnectionChangeStatusOnline);window.removeEventListener("offline",this._onConnectionChangeStatusOffline);c=[];f=[];e&&(e.removeDisconnectCallback(),
e.removeMessageCallback());s_oNetworkManager=null};this.disconnectFromSystem=function(){g_oCTLMultiplayer.closeAllDialog();r.disconnectFromCurRoom()};this.connectToSystem=function(){d?g_oCTLMultiplayer.showChooseNickName():r.showErrorMessage(TEXT_NO_CONNECTION)};this.login=function(t){r.isAllowedWord(t)?(m=t,t=this._setValidNick(t),g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showLoading(TEXT_SYS_LOADING),PlayerIO.useSecureApiRequests=!MULTIPLAYER_TEST_LOCAL,PlayerIO.authenticate(GAME_PLAYERIO_ID,
"public",{userId:t},{},function(v){b=v;b.multiplayer.useSecureConnections=!MULTIPLAYER_TEST_LOCAL;MULTIPLAYER_TEST_LOCAL&&(b.multiplayer.developmentServer="localhost:8184");c[ON_LOGIN_SUCCESS]&&c[ON_LOGIN_SUCCESS].call(f[ON_LOGIN_SUCCESS])},r.callbackError)):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_INVALID_NAME,"g_oCTLMultiplayer.closeAllDialog"))};this.isAllowedWord=function(t){var v=!0;t=t.toLocaleLowerCase();for(var x=0;x<FORBIDDEN_LIST.length;x++)if(t.includes(FORBIDDEN_LIST[x])){v=
!1;break}return v};this._setValidNick=function(t){var v=r._getRandomCodeNumber();""===t||null===t||void 0===t?m=t="guest-"+v:t=t+"-"+v;return t};this._getRandomCodeNumber=function(){return Math.floor(1E3*Math.random())};this.generateRandomName=function(){var t="xmariox alex max mahuro biajus rob idah fabrix seth ikillyou commander admiral general seasalt emperorofthesea Aspect Kraken Dragon Shiver Dracula Doom Scar Roadkill Cobra Psycho Ranger Ripley Clink Bruise Bowser Creep Cannon Daemon Steel Tempest Hurricane Titanium Tito Lightning IronHeart Sabotage Rex Hydra Terminator Agrippa Gash Blade Katana Gladius Angon Claymore Pike Hammer Club Heart Gauntlet Montante Longbow bow Dagger".split(" "),
v=Math.floor(Math.random()*t.length);t=t[v];if(.5<Math.random()){var x=Math.floor(100*Math.random());if(.5<Math.random()){var y=["-","_"];v=Math.floor(Math.random()*y.length);t+=y[v]}t+=x}return u=t};this.getBotName=function(){return u};this._onConnectionChangeStatusOnline=function(t){d=!0;c[ON_STATUS_ONLINE]&&c[ON_STATUS_ONLINE].call(f[ON_STATUS_ONLINE]);0<jQuery(".ctl-multiplayer-dlg-content").length&&r._onReconnection()};this._onConnectionChangeStatusOffline=function(){d=!1;c[ON_STATUS_OFFLINE]&&
c[ON_STATUS_OFFLINE].call(f[ON_STATUS_OFFLINE]);0<jQuery(".ctl-multiplayer-dlg-content").length&&r.showErrorMessage(TEXT_NO_CONNECTION);r.disconnect()};this._onReconnection=function(){null===m||void 0===m?(g_oCTLMultiplayer.closeAllDialog(),r.connectToSystem()):(g_oCTLMultiplayer.closeAllDialog(),r.gotoLobby())};this.showErrorMessage=function(t){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showGeneralDialog(t,"g_oCTLMultiplayer.closeAllDialog")};this.addEventListener=function(t,v,x){c[t]=
v;f[t]=x};this.callbackError=function(t){console.log("Error: "+t.code+" - "+t.message);c[ON_CONNECTION_ERROR]&&c[ON_CONNECTION_ERROR].call(f[ON_CONNECTION_ERROR],t);switch(t.code){case ERROR_CODE_UNKNOWNROOM:g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_DOESNT_EXIST,"s_oNetworkManager.gotoLobby");break;default:r.showErrorMessage(t)}};this.callbackDisconnect=function(t){console.log("Disconnected From Menu");c[ON_DISCONNECTION]&&c[ON_DISCONNECTION].call(f[ON_DISCONNECTION],
t)};this.sendMsg=function(t,v){e&&e.send(t,v)};this.disconnect=function(){e&&(e.disconnect(),e=null)};this.isUserA=function(){return 0===parseInt(k)?!0:!1};this.getPlayerOrderID=function(){return k};this.getPlayerNickname=function(){return m};this.getEnemyNickname=function(){return n};this.createRoom=function(t,v){MULTIPLAYER_TEST_LOCAL&&(b.multiplayer.developmentServer="localhost:8184");b.multiplayer.createJoinRoom(t,ROOM_TYPE_USEROWNER,!0,{id:t,pass:v},{nickname:m},function(x){e=x;x.addMessageCallback("*",
h.messageHandler);x.addDisconnectCallback(r.callbackDisconnect);c[ON_USEROWNERROOM_CREATE_SUCCESS]&&c[ON_USEROWNERROOM_CREATE_SUCCESS].call(f[ON_USEROWNERROOM_CREATE_SUCCESS]);r._onRoomCreated()},r.callbackError)};this.joinRoom=function(t){MULTIPLAYER_TEST_LOCAL&&(b.multiplayer.developmentServer="localhost:8184");b.multiplayer.joinRoom(t,{nickname:m},function(v){e=v;v.addMessageCallback("*",h.messageHandler);v.addDisconnectCallback(r.callbackDisconnect);c[ON_USEROWNERROOM_JOIN_SUCCESS]&&c[ON_USEROWNERROOM_JOIN_SUCCESS].call(f[ON_USEROWNERROOM_JOIN_SUCCESS]);
r._onRoomJoined()},r.callbackError)};this.gotoGameRoom=function(t){MULTIPLAYER_TEST_LOCAL&&(b.multiplayer.developmentServer="localhost:8184");var v=t.getString(0);k=t.getInt(1);n=t.getString(2);b.multiplayer.createJoinRoom(v,ROOM_TYPE_GAME,!0,{pass:"",maxusers:2},{ingameid:k},function(x){e=x;x.addMessageCallback("*",h.messageHandler);x.addDisconnectCallback(r.callbackDisconnect);g_oCTLMultiplayer.closeAllDialog();c[ON_GAMEROOM_CONNECTION_SUCCESS]&&c[ON_GAMEROOM_CONNECTION_SUCCESS].call(f[ON_GAMEROOM_CONNECTION_SUCCESS])},
r.callbackError)};this.gotoMatchMakingRoom=function(){MULTIPLAYER_TEST_LOCAL&&(b.multiplayer.developmentServer="localhost:8184");b.multiplayer.createJoinRoom("matchmakingroom1",ROOM_TYPE_MATCHMAKING,!0,null,{nickname:m},function(t){e=t;t.addMessageCallback("*",h.messageHandler);t.addDisconnectCallback(r.callbackDisconnect);c[ON_MATCHMAKING_CONNECTION_SUCCESS]&&c[ON_MATCHMAKING_CONNECTION_SUCCESS].call(f[ON_MATCHMAKING_CONNECTION_SUCCESS]);g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showVsPanel(TEXT_VS,
"s_oNetworkManager._onDisconnectFromARoom")},r.callbackError)};this.tryCreateUniqueRoom=function(t,v){r.isAllowedWord(t)?(q=t,p=v,b.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:t},0,0,r._onUniqueListRoomSearch,r.callbackError)):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_INVALID_NAME,"g_oCTLMultiplayer.closeAllDialog"))};this._onUniqueListRoomSearch=function(t){0<t.length&&(q+="-"+r._getRandomCodeNumber());r.createRoom(q,p)};this._extractOwnerRoomInfo=function(t){l=
[];for(var v=0;v<t.length;v++)l[v]={name:t[v].id,"private":0===t[v].roomData.pass.length?!1:!0,accessible:!0,curusers:t[v].roomData.curusers,maxusers:t[v].roomData.maxusers,lang:t[v].roomData.lang};return l};this._onRoomCreated=function(){var t={id:"back",func:"s_oNetworkManager._onDisconnectFromARoom",label:TEXT_SYS_BACK},v={id:"invite",func:"s_oNetworkManager._onClickInvite",label:TEXT_SYS_INVITE,classes:"ctl-multiplayer-room-invite"},x=r.inviteLink();t=[t,v];g_oCTLMultiplayer.closeAllDialog();
g_oCTLMultiplayer.showWaitingPlayersInRoom(TEXT_WAITING_FOR_OPPONENT_IN_ROOM+q,[m],t,x);tippy("#link",{content:TEXT_SYS_COPIED_TO_CLIPBOARD,trigger:"click",duration:100});tippy("#invite",{content:TEXT_SYS_COPIED_TO_CLIPBOARD,trigger:"click",duration:100});new ClipboardJS(".ctl-multiplayer-room-invite");new ClipboardJS(".ctl-multiplayer-room-link")};this._onDisconnectFromARoom=function(){c[ON_BACK_FROM_A_ROOM]&&c[ON_BACK_FROM_A_ROOM].call(f[ON_BACK_FROM_A_ROOM]);g_oCTLMultiplayer.closeAllDialog();
g_oCTLMultiplayer.showLoading(TEXT_CONNECT_TO_LOBBY);r.disconnect();setTimeout(function(){r.gotoLobby()},250)};this.inviteLink=function(){var t=Base64.encode(q),v=Base64.encode(p);return window.location.href+"?"+PARAM_ROOM_ID+"="+t+"&"+PARAM_PASSWORD+"="+v};this._onClickInvite=function(){};this._onRoomJoined=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showWaitingPlayersInRoom(TEXT_WAITING_FOR_OPPONENT_IN_ROOM+q,[],[{func:"s_oNetworkManager._onDisconnectFromARoom",label:TEXT_SYS_BACK}])};
this.gotoLobby=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_CONNECT_TO_LOBBY);r.refreshRooms()};this.refreshRooms=function(){b.multiplayer.listRooms(ROOM_TYPE_USEROWNER,null,0,0,r._onFillWithOwnerRoom,r.callbackError);b.multiplayer.listRooms(ROOM_TYPE_GAME,null,0,0,r._onFillWithGameRoom,r.callbackError)};this._onFillWithOwnerRoom=function(t){g++;r._extractOwnerRoomInfo(t);2<=g&&r._onFinalUpdateRoomList()};this._onFillWithGameRoom=function(t){g++;r._extractGameRoomInfo(t);
2<=g&&r._onFinalUpdateRoomList()};this._onFinalUpdateRoomList=function(){var t=r._getCombinedRoomsLists();0<jQuery(".ctl-multiplayer-room-list").length?g_oCTLMultiplayer.refreshRoomList(t):this._showLobby(t);t="300px";s_bMobile&&(t="200px");$(".ctl-multiplayer-room-list").css("max-height",t)};this._showLobby=function(t){g=0;g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showRoomList(t)};this._onAutoRefreshRoom=function(t){t=r._extractRoomInfo(t);g_oCTLMultiplayer.refreshRoomList(t)};this._extractRoomInfo=
function(t){l=[];for(var v=0;v<t.length;v++)l[v]={name:t[v].id,"private":0===t[v].roomData.pass.length?!1:!0,accessible:!0,curusers:t[v].roomData.curusers,maxusers:t[v].roomData.maxusers,lang:t[v].roomData.lang};return l};this.joinQuickMatch=function(){g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING);r.gotoMatchMakingRoom()};this.tryJoinFromInvitation=function(t,v){q=Base64.decode(t);p=Base64.decode(v);b.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:q,pass:p},0,0,r._checkRoomAvailableFromInvitation,
r.callbackError)};this._checkRoomAvailableFromInvitation=function(t){0<t.length?r.joinRoom(t[0].roomData.id,t[0].roomData.pass):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_DOESNT_EXIST,"s_oNetworkManager.gotoLobby"))};this.tryJoinRoomWithPass=function(t,v){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING);q=t;p=v;b.multiplayer.listRooms(ROOM_TYPE_USEROWNER,{id:t,pass:v},0,0,r._checkUserPermissionToJoin,r.callbackError)};
this._checkUserPermissionToJoin=function(t){0<t.length?r.joinRoom(t[0].roomData.id,t[0].roomData.pass):(g_oCTLMultiplayer.closeAllDialog(),g_oCTLMultiplayer.showGeneralDialog(TEXT_WRONG_PASSWORD,"s_oNetworkManager._onPasswordFailed"))};this._onPasswordFailed=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showTypeRoomPassword(q)};this.filterRoomsShown=function(t){var v=this._getCombinedRoomsLists();t=t.toLowerCase();for(var x=[],y=0;y<v.length;y++){var A=v[y].name.toLowerCase();void 0!==
A&&A.includes(t)&&x.push(v[y])}0<t.length?g_oCTLMultiplayer.refreshRoomList(x):g_oCTLMultiplayer.refreshRoomList(v)};this._extractGameRoomInfo=function(t){a=[];for(var v=0;v<t.length;v++)a[v]={name:"game-"+t[v].id,"private":!1,accessible:!1,minutes:t[v].roomData.minutes};return a};this._getCombinedRoomsLists=function(){for(var t=[],v=0;v<l.length;v++)t.push(l[v]);for(v=0;v<a.length;v++)t.push(a[v]);return t};this._onRoomInfoReturned=function(t){c[ON_ROOM_INFO_RETURNED]&&c[ON_ROOM_INFO_RETURNED].call(f[ON_ROOM_INFO_RETURNED],
t)};this._init()}
var MSG_ROOM_IS_FULL="room_is_full",MSG_GAME_FOUND="game_found",MSG_EXIT_FROM_MENU="exit_from_menu",MSG_SET_WINNER="set_winner",MSG_CHANGE_TURN="change_turn",MSG_REMATCH_PANEL="rematch_panel",MSG_REMATCH_ANSWER_RESULTS="rematch_answer_results",MSG_STRIKER_KICKS_RESULTS="striker_kicks_results",MSG_GOALKEEPER_SAVES_RESULTS="goalkeeper_saves_results",MSG_NEXT_PLAYER_TO_PICK_TEAM="next_player_to_pick_team",MSG_ALL_TEAM_SELECTED="all_team_selected",MSG_NOTIFY_ACCEPT_REMATCH="notify_accept_rematch",MSG_END_TURN=
"end_turn",MSG_END_MATCH="end_match",MSG_ACCEPT_REMATCH="accept_rematch",MSG_DISCONNECTION="disconnection",MSG_STRIKER_KICKS="striker_kicks",MSG_GOALKEEPER_SAVES="goalkeeper_saves",MSG_TEAM_SELECTED="team_selected";
function CNetworkMessageForwarder(){this._init=function(){};this.messageHandler=function(c){switch(c.type){case MSG_ROOM_IS_FULL:d._onFullRoom(c);break;case MSG_GAME_FOUND:d._onGameFound(c);break;case MSG_EXIT_FROM_MENU:d._onExitFromMenu(c);break;case MSG_SET_WINNER:d._onSetWinner(c);break;case MSG_CHANGE_TURN:d._onChangeTurn(c);break;case MSG_REMATCH_PANEL:d._onRematchPanel(c);break;case MSG_REMATCH_ANSWER_RESULTS:d._onRematchResults(c);break;case MSG_STRIKER_KICKS_RESULTS:d._onStrikerKicksResults(c);
break;case MSG_GOALKEEPER_SAVES_RESULTS:d._onGoalkeeperSavesResults(c);break;case MSG_NEXT_PLAYER_TO_PICK_TEAM:d._onNextPlayerToPickTeam(c);break;case MSG_ALL_TEAM_SELECTED:d._onAllTeamSelected(c);break;case MSG_NOTIFY_ACCEPT_REMATCH:d._onNotifyAcceptRematch(c)}};this._onFullRoom=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showGeneralDialog(TEXT_ROOM_IS_FULL,"s_oNetworkManager.gotoLobby")};this._onGameFound=function(c){var f=c.getString(2);g_oCTLMultiplayer.onPlayerFound(f);setTimeout(function(){s_oNetworkManager.gotoGameRoom(c)},
1500)};this._onExitFromMenu=function(c){s_oSelectMenu.opponentLeaveTheGame()};this._onSetWinner=function(c){s_oGame&&s_oGame.opponentLeftTheGame()};this._onChangeTurn=function(){s_oGameKeeper&&s_oGameKeeper.endTurn()};this._onRematchPanel=function(){s_oGame&&s_oGame.showRematchQuestion()};this._onRematchResults=function(c){c=c.getBoolean(0);if(s_oGame)if(c)s_oGame.onOpponentAcceptRematch();else s_oGame.onOpponentRefuseRematch()};this._onNextPlayerToPickTeam=function(c){c=c.getString(0);c=JSON.parse(c);
s_oSelectMenu&&parseInt(c.nextplayertopick)===s_oNetworkManager.getPlayerOrderID()&&s_oSelectMenu.gotoTeamSelect(c.teamspicked)};this._onAllTeamSelected=function(c){c=c.getString(0);c=JSON.parse(c);if(s_oSelectMenu)s_oSelectMenu.onGameStart(c)};this._onStrikerKicksResults=function(c){c=c.getString(0);c=JSON.parse(c);s_oGameKeeper&&s_oGameKeeper.remoteStartOpponentShot(c[MSG_STRIKER_KICKS])};this._onGoalkeeperSavesResults=function(c){c=c.getString(0);c=JSON.parse(c);if(s_oGameStriker)s_oGameStriker.onRemoteGoalkeeperResults(c[MSG_GOALKEEPER_SAVES])};
this._onNotifyAcceptRematch=function(){if(s_oGame)s_oGame.onNotifyAcceptRematch()};var d=this;this._init()}
var CCTLMultiplayerGui=function(){this._cssClassDomain="ctl-multiplayer-";this._idCurDialog;this._idLoadingDialog;this._szAvatar=this._szNickName="";this._iTimeInterval;this._iIdInterval;jQuery(document).on("click","."+this._cssClassDomain+"room-list li",function(){g_oCTLMultiplayer.closeCurrentDialog();var d=jQuery(this).text();"true"===jQuery(this).attr("data-private")?g_oCTLMultiplayer.showTypeRoomPassword(d):(g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING),on_ctl_multiplayer_join_room(d))})};
CCTLMultiplayerGui.prototype.refreshRoomList=function(d){for(var c="",f=0;f<d.length;f++)c+='<li data-private="'+d[f]["private"]+'">',c+="<span>",c+=d[f].name,c+="</span>",c=!0===d[f]["private"]?c+('<i class="'+this._cssClassDomain+'icons-lock"></i>'):!1===d[f].accessible?c+('<i class="'+this._cssClassDomain+'icons-block"></i>'):c+('<i class="'+this._cssClassDomain+'icons-login"></i>'),c+="</li>";jQuery("."+this._cssClassDomain+"room-list").html(c)};
CCTLMultiplayerGui.prototype.showRoomList=function(d){var c='<input type="text" placeholder="'+TEXT_SYS_FINDROOM+'" name="nickname" maxlength="60" value="" oninput="on_ctl_user_search(this.value)">';c+='<ul class="'+this._cssClassDomain+"list "+this._cssClassDomain+'room-list">';c=c+'</ul><button onclick="on_ctl_multiplayer_refresh_room_list()" type="button" class="'+(this._cssClassDomain+"update "+this._cssClassDomain+'btn-gray">');c+='<i class="'+this._cssClassDomain+'icons-arrows-cw"></i>';c+=
"<span>"+TEXT_SYS_UPDATE+"</span>";this._idCurDialog=this.showDialog(TEXT_SYS_MATCH_LIST,c+"</button>",[{txt:TEXT_SYS_QUICKMATCH,cb:"on_ctl_multiplayer_join_quick_match",classes:""},{txt:TEXT_SYS_CREATEMATCH,cb:"on_ctl_multiplayer_show_create_match",classes:""},{txt:TEXT_SYS_BACK,cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}]);this.refreshRoomList(d)};
CCTLMultiplayerGui.prototype.showTypeRoomPassword=function(d){var c='<div class="'+this._cssClassDomain+'form-group">';c+="<label>"+TEXT_SYS_TYPEROOMPASS+"</label>";this._idCurDialog=this.showDialog(TEXT_SYS_TYPEROOMPASS,c+('<input type="password" name="password" data-room-name="'+d+'"></div>'),[{txt:TEXT_SYS_OK,cb:"on_ctl_multiplayer_send_password",classes:""},{txt:TEXT_SYS_BACK,cb:"on_ctl_multiplayer_close_type_room_password",classes:""}])};
CCTLMultiplayerGui.prototype.showCreateRoom=function(){var d='<div class="'+this._cssClassDomain+'form-group">';d+="<label>"+TEXT_SYS_NAMEROOM+"</label>";d+='<input type="text" name="roomname" value="'+sprintf(TEXT_SYS_DEFAULTROOMNAME,this._szNickName)+'">';d=d+'</div><div class="'+(this._cssClassDomain+'form-group">');d+="<label>"+TEXT_SYS_PASSWORD+"</label>";d=d+'<input type="password" name="password"><p>'+(TEXT_SYS_INFOPASS+"</p>");this._idCurDialog=this.showDialog(TEXT_SYS_CREATEROOM,d+"</div>",
[{txt:TEXT_SYS_CREATE,cb:"on_ctl_multiplayer_create_room",classes:""},{txt:TEXT_SYS_BACK,cb:"on_ctl_multiplayer_close_create_room",classes:""}])};
CCTLMultiplayerGui.prototype.showChooseNickName=function(){var d=localStorage.getItem(GAME_NAME+"_nickname");null==d&&(d="");this._szNickName=d;this._szAvatar="";this._idCurDialog=this.showDialog(TEXT_SYS_CHOOSENICK,'<input type="text" name="nickname" maxlength="10" value="'+this._szNickName+'">',[{txt:TEXT_SYS_OK,cb:"on_ctl_multiplayer_send_nickname",classes:""},{txt:TEXT_SYS_CLOSE,cb:"g_oCTLMultiplayer.closeCurrentDialog",classes:""}])};
CCTLMultiplayerGui.prototype.showGeneralDialog=function(d,c){this._idCurDialog=this.showDialog(d,"",[{txt:TEXT_SYS_BACK,cb:c,classes:""}])};CCTLMultiplayerGui.prototype.closeLoadingDialog=function(){this.closeDlg(this._idLoadingDialog)};CCTLMultiplayerGui.prototype.closeCurrentDialog=function(){this.closeDlg(this._idCurDialog)};
CCTLMultiplayerGui.prototype.makeCode=function(){for(var d="",c=0;32>c;c++)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return d};
CCTLMultiplayerGui.prototype.showDialog=function(d,c,f,l){var a="";l||(l=this.makeCode());a+="<div id='"+l+"' class='"+this._cssClassDomain+"dlg-wrapper'>";a+="<div class='"+this._cssClassDomain+"dlg-block'></div>";a+="<div class='"+this._cssClassDomain+"dlg-scroll'>";a+="<div class='"+this._cssClassDomain+"dlg-content'>";a+="<div class='"+this._cssClassDomain+"dlg-header'>";a=a+("<h1>"+d+"</h1></div><div class='")+(this._cssClassDomain+"dlg-content-body'>");a+=c;a+="</div>";if(f&&0<f.length){a+=
"<div class='"+this._cssClassDomain+"dlg-footer'>";for(d=0;d<f.length;d++)a+="<button type='button' onclick='"+f[d].cb+'("'+l+"\");' class='"+this._cssClassDomain+"mini "+f[d].classes+"'>"+f[d].txt+"</button>";a+=this.buildExtraFooter();a+="</div>"}a+="</div>";a+="</div>";a+="</div>";jQuery("body").append(a);return l};CCTLMultiplayerGui.prototype.buildExtraFooter=function(){return""};
CCTLMultiplayerGui.prototype.setCountdown=function(d){jQuery("#countdown-vs-panel-text").text(d);this._iIDTimeout=setInterval(function(){--d;jQuery("#countdown-vs-panel-text").text(d);0>=d&&g_oCTLMultiplayer.removeCountdown()},1E3)};CCTLMultiplayerGui.prototype.removeCountdown=function(){null!==this._iIDTimeout&&(console.log("countdownrimosso"),jQuery("#countdown-vs-panel-text").text(""),clearInterval(this._iIDTimeout),this._iIDTimeout=null)};
CCTLMultiplayerGui.prototype.onPlayerFound=function(d){jQuery("#opponent-nickname").text(d);jQuery("#countdown-vs-panel-text").text("");jQuery("button.ctl-multiplayer-mini").hide();g_oCTLMultiplayer.removeCountdown()};
CCTLMultiplayerGui.prototype.showVsPanel=function(d,c){var f="";this._idLoadingDialog=this.makeCode();d||(d=TEXT_SYS_LOADING);f+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>";f+="<div class='"+this._cssClassDomain+"dlg-block'></div>";f+="<div class='"+this._cssClassDomain+"dlg-scroll'>";f+="<div class='"+this._cssClassDomain+"dlg-content'>";f+="<div class='"+this._cssClassDomain+"dlg-header'>";f+="<h1 style='text-align:center'>"+s_oNetworkManager.getPlayerNickname()+
"</h1>";f=f+("<h1 style='font-size:22px;text-align:center;color:#fff'>"+d+"</h1><h1 id='opponent-nickname' style='text-align:center'>")+(TEXT_WAIT_OPPONENT+"...</h1>");f+="<h1 id='countdown-vs-panel-text' style='text-align:center'></h1></div>";c&&(f+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>",f+="<button type='button' onclick='"+c+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"mini '>"+TEXT_SYS_BACK+"</button>",f+=this.buildExtraFooter(),f+=
"</div>");f+="</div></div></div>";jQuery("body").append(f);this.setCountdown(60)};CCTLMultiplayerGui.prototype.stopCountDown=function(){clearInterval(this._iIdInterval);jQuery("button.ctl-multiplayer-mini").hide()};
CCTLMultiplayerGui.prototype.showLoading=function(d,c){var f="";this._idLoadingDialog=this.makeCode();d||(d=TEXT_SYS_LOADING);f+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>";f+="<div class='"+this._cssClassDomain+"dlg-block'></div>";f+="<div class='"+this._cssClassDomain+"dlg-scroll'>";f+="<div class='"+this._cssClassDomain+"dlg-content'>";f+="<div class='"+this._cssClassDomain+"dlg-header'>";f=f+("<h1>"+d+"</h1></div><div class='")+
(this._cssClassDomain+"dlg-content-body "+this._cssClassDomain+"align-center'>");f+='<i class="'+this._cssClassDomain+'icons-spin5 animate-spin"></i>';f+="</div>";c&&(f+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>",f+="<button type='button' onclick='"+c+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"mini '>"+TEXT_SYS_BACK+"</button>",f+=this.buildExtraFooter(),f+="</div>");f+="</div>";f+="</div>";f+="</div>";jQuery("body").append(f)};
CCTLMultiplayerGui.prototype.updateRoomUserList=function(d,c){var f=jQuery("."+this._cssClassDomain+"user-list");if(0<f.length){f.html("");for(var l=0;l<d.length;l++)f.append("<li>"+d[l]+"</li>");f=TEXT_WAITING_ROOM_MESSAGE.replace("%d",c);jQuery("."+this._cssClassDomain+"room-info").text(f);0<jQuery("."+this._cssClassDomain+"room-play-now").length&&(1===d.length?jQuery("."+this._cssClassDomain+"room-play-now").addClass(this._cssClassDomain+"display-none"):jQuery("."+this._cssClassDomain+"room-play-now").removeClass(this._cssClassDomain+
"display-none"))}};
CCTLMultiplayerGui.prototype.showWaitingPlayersInRoom=function(d,c,f,l){var a="";this._idLoadingDialog=this.makeCode();d||(d=TEXT_SYS_LOADING);a+="<div id='"+this._idLoadingDialog+"' class='"+this._cssClassDomain+"dlg-wrapper "+this._cssClassDomain+"fixed'>";a+="<div class='"+this._cssClassDomain+"dlg-block'></div>";a+="<div class='"+this._cssClassDomain+"dlg-scroll'>";a+="<div class='"+this._cssClassDomain+"dlg-content'>";a+="<div class='"+this._cssClassDomain+"dlg-header'>";a=a+("<h1>"+d+"</h1></div><div class='")+
(this._cssClassDomain+"dlg-content-body "+this._cssClassDomain+"align-center'>");a+="<ul class='"+this._cssClassDomain+"list "+this._cssClassDomain+"user-list'>";for(d=0;d<c.length;d++)a+="<li>"+c[d]+"</li>";a+="</ul>";a+="<p class='"+this._cssClassDomain+"room-info'></p>";a+='<i class="'+this._cssClassDomain+'icons-spin5 animate-spin"></i>';l&&(a+='<input class="'+this._cssClassDomain+'room-link" type="text" placeholder="'+l+'" id="link" name="link"',a+='maxlength="60" value="'+l+'" size="4" data-clipboard-target="#link" readonly>');
a+="</div>";if(f){a+="<div class='"+this._cssClassDomain+"dlg-footer "+this._cssClassDomain+"center'>";for(d=0;d<f.length;d++)c=f[d],a+="<button id='"+c.id+"' type='button' "+("invite"===c.id?"data-clipboard-target='#link'":"")+" onclick='"+c.func+'("'+this._idLoadingDialog+"\");' class='"+this._cssClassDomain+"mini"+(c.classes?" "+c.classes:"")+" '>"+c.label+"</button>";a+=this.buildExtraFooter();a+="</div>"}a+="</div>";a+="</div>";a+="</div>";jQuery("body").append(a)};
CCTLMultiplayerGui.prototype.closeDlg=function(d){jQuery("#"+d).remove()};CCTLMultiplayerGui.prototype.closeAllDialog=function(){[].concat($jscomp.arrayFromIterable(document.querySelectorAll("*"))).forEach(function(d){d._tippy&&d._tippy.destroy()});g_oCTLMultiplayer.closeLoadingDialog();g_oCTLMultiplayer.closeCurrentDialog();g_oCTLMultiplayer.removeCountdown()};
CCTLMultiplayerGui.prototype.setNickName=function(d){this._szNickName=null===d||void 0===d?"":d;s_bStorageAvailable&&localStorage.setItem(GAME_NAME+"_nickname",this._szNickName)};CCTLMultiplayerGui.prototype.getAvatar=function(){return this._szAvatar};var g_oCTLMultiplayer=new CCTLMultiplayerGui;function on_ctl_multiplayer_send_nickname(){var d=jQuery("input[name='nickname']").val();g_oCTLMultiplayer.setNickName(d);s_oNetworkManager.login(d)}
function on_ctl_multiplayer_send_password(){var d=jQuery("#"+g_oCTLMultiplayer._idCurDialog+" input[name='password']"),c=d.attr("data-room-name");d=d.val();s_oNetworkManager.tryJoinRoomWithPass(c,d)}function on_ctl_multiplayer_join_room_with_password(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING)}function on_ctl_multiplayer_show_create_match(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showCreateRoom()}
function on_ctl_multiplayer_join_quick_match(){g_oCTLMultiplayer.closeAllDialog();s_oNetworkManager.joinQuickMatch()}function on_ctl_multiplayer_close_type_room_password(){g_oCTLMultiplayer.closeAllDialog();s_oNetworkManager.gotoLobby()}function on_ctl_multiplayer_close_create_room(){g_oCTLMultiplayer.closeAllDialog();s_oNetworkManager.gotoLobby()}function on_ctl_multiplayer_refresh_room_list(){s_oNetworkManager.gotoLobby()}
function on_ctl_multiplayer_create_room(){var d=jQuery("input[name='roomname']").val(),c=jQuery("input[name='password']").val();s_oNetworkManager.tryCreateUniqueRoom(d,c);g_oCTLMultiplayer.showLoading(TEXT_NETWORK_CONNECTING)}function on_ctl_multiplayer_join_room(d){s_oNetworkManager.joinRoom(d)}function on_ctl_user_search(d){s_oNetworkManager.filterRoomsShown(d)}
!function(){function d(a){var e=a;if(l[e])e=l[e];else{for(var b=e,h,k=[],g=0;b;){if(null!==(h=f.text.exec(b)))k.push(h[0]);else if(null!==(h=f.modulo.exec(b)))k.push("%");else if(null!==(h=f.placeholder.exec(b))){if(h[2]){g|=1;var m=[],n=h[2],q;if(null!==(q=f.key.exec(n)))for(m.push(q[1]);""!==(n=n.substring(q[0].length));)if(null!==(q=f.key_access.exec(n)))m.push(q[1]);else if(null!==(q=f.index_access.exec(n)))m.push(q[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");
else throw new SyntaxError("[sprintf] failed to parse named argument key");h[2]=m}else g|=2;if(3===g)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");k.push({placeholder:h[0],param_no:h[1],keys:h[2],sign:h[3],pad_char:h[4],align:h[5],width:h[6],precision:h[7],type:h[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");b=b.substring(h[0].length)}e=l[e]=k}b=arguments;h=1;k=e.length;m="";var p,u;for(n=0;n<k;n++)if("string"===typeof e[n])m+=e[n];
else if("object"===typeof e[n]){q=e[n];if(q.keys)for(g=b[h],p=0;p<q.keys.length;p++){if(void 0==g)throw Error(d('[sprintf] Cannot access property "%s" of undefined value "%s"',q.keys[p],q.keys[p-1]));g=g[q.keys[p]]}else g=q.param_no?b[q.param_no]:b[h++];f.not_type.test(q.type)&&f.not_primitive.test(q.type)&&g instanceof Function&&(g=g());if(f.numeric_arg.test(q.type)&&"number"!==typeof g&&isNaN(g))throw new TypeError(d("[sprintf] expecting number but found %T",g));f.number.test(q.type)&&(u=0<=g);
switch(q.type){case "b":g=parseInt(g,10).toString(2);break;case "c":g=String.fromCharCode(parseInt(g,10));break;case "d":case "i":g=parseInt(g,10);break;case "j":g=JSON.stringify(g,null,q.width?parseInt(q.width):0);break;case "e":g=q.precision?parseFloat(g).toExponential(q.precision):parseFloat(g).toExponential();break;case "f":g=q.precision?parseFloat(g).toFixed(q.precision):parseFloat(g);break;case "g":g=q.precision?String(Number(g.toPrecision(q.precision))):parseFloat(g);break;case "o":g=(parseInt(g,
10)>>>0).toString(8);break;case "s":g=String(g);g=q.precision?g.substring(0,q.precision):g;break;case "t":g=String(!!g);g=q.precision?g.substring(0,q.precision):g;break;case "T":g=Object.prototype.toString.call(g).slice(8,-1).toLowerCase();g=q.precision?g.substring(0,q.precision):g;break;case "u":g=parseInt(g,10)>>>0;break;case "v":g=g.valueOf();g=q.precision?g.substring(0,q.precision):g;break;case "x":g=(parseInt(g,10)>>>0).toString(16);break;case "X":g=(parseInt(g,10)>>>0).toString(16).toUpperCase()}if(f.json.test(q.type))m+=
g;else{if(!f.number.test(q.type)||u&&!q.sign)var r="";else r=u?"+":"-",g=g.toString().replace(f.sign,"");p=q.pad_char?"0"===q.pad_char?"0":q.pad_char.charAt(1):" ";var t=q.width-(r+g).length;t=q.width?0<t?p.repeat(t):"":"";m+=q.align?r+g+t:"0"===p?r+t+g:t+r+g}}return m}function c(a,e){return d.apply(null,[a].concat(e||[]))}var f={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,
placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},l=Object.create(null);"undefined"!==typeof exports&&(exports.sprintf=d,exports.vsprintf=c);"undefined"!==typeof window&&(window.sprintf=d,window.vsprintf=c,"function"===typeof define&&define.amd&&define(function(){return{sprintf:d,vsprintf:c}}))}();
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){var d=this._szMsg,c=3>d.length?!1:this._bEllipsis;if(c||this._bMultiline){var f=d.length-2,l=this._iStartingFontSize;this.__refreshTextFont(l);for(var a=this._oText.getBounds();a.height+this._iOutline>this._iEffectiveHeight||a.width+this._iOutline>this._iEffectiveWidth;){if(c&&l<this._iMinTextSize){if(f--,this._oText.text=d.slice(0,f)+"...",this.__updateY(),this.__verticalAlign(),1==f)break}else if(l--,this.__refreshTextFont(l),
this.__updateY(),this.__verticalAlign(),l<this._iMinTextSize&&!c)break;a=this._oText.getBounds()}this._iFontSize=l;this.__updateY();this.__verticalAlign();this.__updateStroke()}else this.__autofitLight()}},__autofitLight:function(){this.__refreshTextFont(this._iStartingFontSize);var d=Math.floor(linearFunction(this._iEffectiveWidth,this._oText.getBounds().width+this._iOutline,0,this._iStartingFontSize,0));d>this._iStartingFontSize?d=this._iStartingFontSize:d<this._iMinTextSize&&(d=this._iMinTextSize);
this.__refreshTextFont(d);this._iFontSize=d;this.__updateY();this.__verticalAlign();this.__updateStroke()},__refreshTextFont:function(d){this._oText.font=d+"px "+this._szFont;this._oText.lineHeight=Math.round(d*this._fLineHeightFactor)},__verticalAlign:function(){if(this._bVerticalAlign){var d=this._oText.getBounds().height;this._oText.y-=(d-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/
2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__updateStroke:function(){this._oStroke&&(this._oStroke.x=this._oText.x,this._oStroke.y=this._oText.y,this._oStroke.text=this._oText.text,this._oStroke.font=this._oText.font,this._oStroke.lineHeight=this._oText.lineHeight)},__updateOutline:function(){this._iOutline=this._oStroke&&this._oStroke.outline>this._oText.outline?this._oStroke.outline:this._oText.outline},__updateAlign:function(){switch(this._szAlign){case "center":this._oText.x=
this._iWidth/2;break;case "left":this._oText.x=this._iPaddingH;break;case "right":this._oText.x=this._iWidth-this._iPaddingH}},__createText:function(d){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,130,0,0.5)").drawRect(0,0,this._iWidth,this._iHeight).moveTo(this._iPaddingH,this._iHeight-this._iPaddingV).lineTo(this._iWidth-this._iPaddingH,this._iHeight-this._iPaddingV).lineTo(this._iWidth-this._iPaddingH,this._iPaddingV).lineTo(this._iPaddingH,
this._iPaddingV).closePath().beginFill("rgba(255,0,0,0.5)").drawRect(this._iPaddingH,this._iPaddingV,this._iEffectiveWidth,this._iEffectiveHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(d,this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;this.__updateAlign();
this._oContainer.addChild(this._oText);this.refreshText(d)},setScale:function(d){this._oContainer.scale=d},setStroke:function(d,c){this._oStroke||(this._oStroke=this._oText.clone(),this._oContainer.addChild(this._oStroke),this._oContainer.swapChildren(this._oStroke,this._oText));this.setStrokeColor(c?c:this._szStrokeColor);this.setStrokeSize(d?d:this._iStrokeSize)},setStrokeColor:function(d){this._szStrokeColor=d;this._oStroke&&(this._oStroke.color=this._szStrokeColor)},setStrokeSize:function(d){this._iStrokeSize=
d;this._oStroke&&(this._oStroke.outline=this._iStrokeSize,this.__updateOutline(),this.__autofit())},removeStroke:function(){this._oStroke&&(this._oContainer.removeChild(this._oStroke),this._oStroke=null,this.__updateOutline(),this.__autofit())},roll:function(d,c,f,l,a,e){c=null==c?1500:c;f=null==f?createjs.Ease.linear:f;if(this._oText){var b={score:parseInt(this._szMsg)};this._szMsg=d;var h=this._bFitText?function(){this._oText.text=Math.floor(b.score);this.__autofitLight()}:function(){this._oText.text=
Math.floor(b.score)};this._oTweenRollText=createjs.Tween.get(b).to({score:d},c,f);this._oTweenRollText.on("change",h,this);this._oTweenRollText.on("complete",function(){l&&l.apply(a,e);this.stopRolling()},this,!0)}},isRolling:function(){return null==this._oTweenRollText?!1:!0},stopRolling:function(){this.isRolling()&&(this._oTweenRollText.removeAllEventListeners(),this._oTweenRollText.paused=!0,this._oTweenRollText=null)},pauseRolling:function(){this.isRolling()&&(this._oTweenRollText.paused=!0)},
resumeRolling:function(){this.isRolling()&&(this._oTweenRollText.paused=!1)},setY:function(d){this._oContainer.y=d},setX:function(d){this._oContainer.x=d},setPosition:function(d,c){this._oContainer.x=d;this._oContainer.y=c},setAlign:function(d){this._szAlign=d;this._oText.textAlign=this._szAlign;this.__updateAlign()},setVerticalAlign:function(d){this._bVerticalAlign=d},setOutline:function(d){this._oText&&(this._oText.outline=d,this.__updateOutline())},setShadow:function(d,c,f,l){this._oText&&(this._oText.shadow=
new createjs.Shadow(d,c,f,l))},setColor:function(d){this._szColor=d;this._oText.color=this._szColor},setAlpha:function(d){this._oContainer.alpha=d},setVisible:function(d){this._oContainer.visible=d},setFontSize:function(d){this._iFontSize=this._iStartingFontSize=d;this.refreshText(this._szMsg)},removeTweens:function(){createjs.Tween.removeTweens(this._oContainer)},getText:function(){return this._oText},getTextWidth:function(){return this._oText.getBounds().width+this._iOutline},getTextHeight:function(){return this._oText.getBounds().height+
this._iOutline},getMsg:function(){return this._szMsg},getX:function(){return this._oContainer.x},getY:function(){return this._oContainer.y},getHeight:function(){return this._iHeight},getWidth:function(){return this._iWidth},getColor:function(){return this._szColor},getFontSize:function(){return this._iFontSize},getContainer:function(){return this._oContainer},unload:function(){this.stopRolling();this._oParentContainer.removeChild(this._oContainer)},refreshText:function(d){this._szMsg=d;""===this._szMsg&&
(this._szMsg=" ");null===this._oText&&this.__createText(this._szMsg);this._oText.text=this._szMsg;this.__refreshTextFont(this._iStartingFontSize);this.__autofit()}};
function CTLText(d,c,f,l,a,e,b,h,k,g,m,n,q,p,u,r,t,v,x){v=void 0===v?11:v;x=void 0===x?!0:x;this._oParentContainer=d;this._oContainer=new createjs.Container;this._oContainer.x=c;this._oContainer.y=f;this._oParentContainer.addChild(this._oContainer);this._iOutline=0;this._iWidth=l;this._iHeight=a;this._bMultiline=r;this._iStartingFontSize=this._iFontSize=e;this._szAlign=b;this._szColor=h;this._szFont=k;this._iPaddingH=m;this._iPaddingV=n;this._iEffectiveWidth=this._iWidth-2*this._iPaddingH;this._iEffectiveHeight=
this._iHeight-2*this._iPaddingV;this._bVerticalAlign=u;this._bFitText=p;this._iMinTextSize=v;this._bDebug=t;this._bEllipsis=x;this._oDebugShape=null;this._fLineHeightFactor=g;this._oText=null;q&&this.__createText(q)}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=640,CANVAS_WIDTH_HALF=CANVAS_WIDTH/2,CANVAS_HEIGHT_HALF=CANVAS_HEIGHT/2,START_HAND_SWIPE_POS,END_HAND_SWIPE_POS,EDGEBOARD_X=100,EDGEBOARD_Y=30,DISABLE_SOUND_MOBILE=!1,PRIMARY_FONT="RoundedMplus1c",GAME_PLAYERIO_ID="penalty-challenge-dxpyjkgxke6nk6nkokgy6q",GAME_NAME="penaltychallenge_multiplayer",MULTIPLAYER_TEST_LOCAL=!1,TIME_PER_SELECTION_TEAM=20E3,TIME_PER_MOVE=15E3,TIME_HURRYUP_WARNING=3E3,FPS=30,FPS_DESKTOP=60,FPS_TIME=1/FPS,ROLL_BALL_RATE=60/FPS,STATE_LOADING=
0,STATE_MENU=1,STATE_HELP=2,STATE_CHOOSE_LEVEL=3,STATE_CHOOSE_TEAM=4,STATE_GAME=5,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_TWEEN_ENDED=6,ON_BUT_NO_DOWN=7,ON_BUT_YES_DOWN=8,ON_ALERT_SKIP=9,ON_NEXT=10,ON_RESTART=11,ON_BACK_MENU=12,ON_SELECT_LANG=13,SHOOT_STATE_WAITING=0,SHOOT_STATE_SELECTED=1,SHOOT_STATE_ANIM=2,SHOOT_STATE_END=3,SHOOT_STATE_CHANGING_TURN=4,ON_TIMER_END=0,ON_LAST_TIMER_END=1,STEP_RATE=1.5,TEXT_SIZE=[80,100,130],MS_TIME_SWIPE_END=1E3,
MS_TIME_SWIPE_START=3E3,MS_TIME_FADE_HELP_TEXT=500,TEXT_EXCELLENT_COLOR=["#fff","#5d96fe"],TEXT_COLOR="#ffffff",TEXT_COLOR_1="#ff2222",SOUNDTRACK_VOLUME_IN_GAME=0,OUTLINE_WIDTH=3,TIME_INTERVAL_STROBE=.2,PHYSICS_ACCURACY=3,MOBILE_OFFSET_GLOVES_Y=-70,DESKTOP_OFFSET_GLOVES_Y=-150,BALL_VELOCITY_MULTIPLIER=1,PHYSICS_STEP=1/(FPS*STEP_RATE),MS_WAIT_SHOW_GAME_OVER_PANEL=250,STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=3,IDLE=0,RIGHT=1,LEFT=2,CENTER_DOWN=3,CENTER_UP=4,LEFT_DOWN=5,RIGHT_DOWN=6,CENTER=
7,SIDE_LEFT=8,SIDE_RIGHT=9,SIDE_LEFT_UP=10,SIDE_RIGHT_UP=11,SIDE_LEFT_DOWN=12,SIDE_RIGHT_DOWN=13,LEFT_UP=14,RIGHT_UP=15,ANIM_GOAL_KEEPER_FAIL_EXCLUSION_LIST=[[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT],[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT,CENTER_UP],[CENTER_UP,CENTER,SIDE_LEFT_UP,SIDE_RIGHT_UP,SIDE_LEFT,SIDE_RIGHT],[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT,CENTER_UP],[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT],[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT,SIDE_LEFT_DOWN,LEFT_DOWN],[LEFT_UP,LEFT,SIDE_LEFT_UP,SIDE_LEFT,
SIDE_LEFT_DOWN],[CENTER_UP,CENTER,SIDE_LEFT_UP,SIDE_RIGHT_UP,CENTER_DOWN,SIDE_RIGHT,SIDE_LEFT],[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT,SIDE_RIGHT_DOWN],[RIGHT_UP,RIGHT,SIDE_RIGHT_UP,SIDE_RIGHT,SIDE_RIGHT_DOWN,RIGHT_DOWN],[LEFT_DOWN,LEFT,SIDE_LEFT_DOWN],[LEFT_DOWN,LEFT,SIDE_LEFT_DOWN,SIDE_LEFT,SIDE_LEFT_UP],[CENTER_DOWN,CENTER,CENTER_UP,SIDE_RIGHT,SIDE_LEFT,SIDE_RIGHT_DOWN,SIDE_LEFT_DOWN],[RIGHT_DOWN,RIGHT,SIDE_RIGHT_DOWN,SIDE_RIGHT,SIDE_RIGHT_UP],[RIGHT_DOWN,RIGHT,SIDE_RIGHT_DOWN]],NUM_SPRITE_PLAYER=
31,SPRITE_NAME_GOALKEEPER="gk_idle gk_save_right gk_save_left gk_save_center_down gk_save_center_up gk_save_down_left gk_save_down_right gk_save_center gk_save_side_left gk_save_side_right gk_save_side_up_left gk_save_side_up_right gk_save_side_low_left gk_save_side_low_right gk_save_up_left gk_save_up_right".split(" "),NUM_SPRITE_GOALKEEPER=[24,34,34,51,25,34,34,25,30,30,30,30,51,51,36,36],OFFSET_CONTAINER_GOALKEEPER=[{x:0,y:0},{x:15,y:-29},{x:-360,y:-29},{x:-15,y:-15},{x:-20,y:-85},{x:-355,y:20},
{x:21,y:20},{x:10,y:-10},{x:-140,y:-30},{x:10,y:-30},{x:-120,y:-75},{x:14,y:-75},{x:-140,y:-10},{x:30,y:-10},{x:-430,y:-56},{x:-8,y:-56}],ORIGIN_POINT_IMPACT_ANIMATION=[{x:null,y:null},{x:295.74,y:3.76},{x:-324.82,y:3.76},{x:4.8,y:null},{x:5,y:null},{x:-354,y:null},{x:334.5,y:null},{x:4.8,y:null},{x:-198.77,y:null},{x:189,y:null},{x:-208.4,y:null},{x:189,y:null},{x:-150,y:null},{x:101.8,y:null},{x:-344,y:-88},{x:315,y:-88}],BALL_MASS=.5,BALL_LINEAR_DAMPING=.2,OBJECT,TIME_TRY_TO_SHOT_BALL_OPPONENT=
.7,STRIKER_START_BALL_POS={x:CANVAS_WIDTH_HALF+55,y:CANVAS_HEIGHT_HALF+168},START_POS_FLAG={x:277,y:268},FLAG_ADDED_POS={x:61,y:69},FLAG_LIMIT_POS_X=690,TOT_TEAM=32,MIN_BALL_VEL_ROTATION=.1,SHOOT_FRAME=7,HAND_KEEPER_ANGLE_RATE=.15,TIME_POLE_COLLISION_RESET=1E3,LIMIT_HAND_RANGE_POS={x:20,zMax:7,zMin:-8.5},LEFT_RIGHT_WALL_GOAL_SIZE,NUM_AREA_GOAL={h:3,w:5},AREA_GOALS_ANIM=[LEFT_UP,SIDE_LEFT_UP,CENTER_UP,SIDE_RIGHT_UP,RIGHT_UP,LEFT,SIDE_LEFT,CENTER,SIDE_RIGHT,RIGHT,LEFT_DOWN,SIDE_LEFT_DOWN,CENTER_DOWN,
SIDE_RIGHT_DOWN,RIGHT_DOWN],BUFFER_ANIM_PLAYER=30,MS_EFFECT_ADD=1500,MS_ROLLING_SCORE=500,MAX_PERCENT_PROBABILITY=100,GOAL_KEEPER_TOLLERANCE_LEFT=-4,GOAL_KEEPER_TOLLERANCE_RIGHT=4,TIME_RESET_AFTER_BALL_OUT=250,TIME_RESET_AFTER_SAVE=500,AREA_GOAL_PROPERTIES={width:4,depth:1,height:2.4},POLE_RIGHT_LEFT_SIZE,COLOR_AREA_GOAL=[16711680,65280,255,16776960,16711935,65535,15790320,986895,16759705,16777215,5675280,10083618,1056896,8392736,9017449],OFFSET_FIELD_Y=35,OFFSET_FIELD_X=35,FORCE_RATE=.0014,FORCE_MULTIPLIER_AXIS=
{x:.1,y:.4,z:.09},FORCE_MAX=.5,FIELD_POSITION,MAX_FORCE_Y=66,MIN_FORCE_Y=50,SHOW_AREAS_GOAL=!1,SHOW_3D_RENDER=!1,CANVAS_3D_OPACITY=.5,CAMERA_TEST_TRACKBALL=!1,CAMERA_TEST_TRANSFORM=!1,MOUSE_SENSIBILTY=.03,CAMERA_TEST_LOOK_AT={x:0,y:-500,z:-100},BALL_SCALE_FACTOR=.007,SHADOWN_FACTOR=1.1,FORCE_BALL_DISPLAY_SHOCK=[{max:55,min:MIN_FORCE_Y-1},{max:58,min:55},{max:62,min:58},{max:MAX_FORCE_Y,min:62}],GOALKEEPER_MODE=0,STRIKER_MODE=1,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION,NUM_MATCHES=10,OFFSET_BALL_POS_X=
10,HAND_KEEPER_SIZE={width:1.8,depth:.5,height:1.5},HAND_KEEPER_POSITION={x:0,y:36,z:0},CAMERA_TEST=!1,BALL_Z_FORCE_RANGE={min:3,max:10},GOAL_POSITION={x:0,y:33,z:-2.7},TIME_RESET_AFTER_KEEPER_SAVED=2,TIME_RESET_AFTER_PERFECT_KEEPER_SAVED=3,TIME_BALL_IN_HAND=1E3,NUM_KICKS=10,BALL_FORCE_X=[5,6,7,8,9,10,7,12,10,12],BALL_FORCE_Z=[{min:6,max:9},{min:5,max:9},{min:3,max:9},{min:1,max:8},{min:2,max:8},{min:4,max:8},{min:3,max:9},{min:1,max:10},{min:5,max:8},{min:5,max:10.5}],BALL_FORCE_Y=[30,40,50,60,65,
60,70,64,68,65],BALL_SAVED_POINT={x:.7,z:.6},GOAL_SCORED,GOAL_MISSED,GOAL_SAVED,GOAL_SUFFERED,LOCALSTORAGE_STRING=GAME_NAME,GOALKEEPER_GOAL_SHOOTAREA={lx:-.24,rx:.26,z:.23},STRIKER_GOAL_SHOOTAREA={lx:-.2,rx:.195,zmin:.07,zmax:.1865},GOALKEEPER_SHOOTPOWER_LIMITS={min:50,max:60},GOALKEEPER_RESULTS_GOAL=0,GOALKEEPER_RESULTS_SAVED=1,GOALKEEPER_RESULTS_BALLOUT=2,GOALKEEPER_RESULTS_POSTHIT=3,TIME_LOOP_WAIT=500,PLAYER=0,OPPONENT=1,SCORE_NORMAL=100,SCORE_NOBONUS=50,SCORE_BONUS=200,TEXT_COLOR_STROKE,BALL_RADIUS,
TIME_RESET_AFTER_GOAL,BACK_WALL_GOAL_SIZE,UP_WALL_GOAL_SIZE,BACK_WALL_GOAL_POSITION,GOAL_LINE_POS,GOAL_SPRITE_SWAP_Y,GOAL_SPRITE_SWAP_Z,FIRST_AREA_GOAL_POS,GOAL_KEEPER_DEPTH_Y,BALL_OUT_Y,POSITION_BALL,POLE_UP_SIZE,HIT_BALL_MAX_FORCE,HIT_BALL_MIN_FORCE,INTENSITY_DISPLAY_SHOCK,CAMERA_POSITION,FOV,NEAR,FAR,NUM_LANGUAGES=13,LANG_EN=0,LANG_RU=1,LANG_ES=2,LANG_FR=3,LANG_DE=4,LANG_PT=5,LANG_IT=6,LANG_TR=7,LANG_AR=8,LANG_HI=9,LANG_ID=10,LANG_JA=11,LANG_ZH=12,LANG_CODES={};LANG_CODES.en=LANG_EN;
LANG_CODES.es=LANG_ES;LANG_CODES.fr=LANG_FR;LANG_CODES.de=LANG_DE;LANG_CODES.pt=LANG_PT;LANG_CODES.it=LANG_IT;LANG_CODES.ru=LANG_RU;LANG_CODES.tr=LANG_TR;LANG_CODES.ar=LANG_AR;LANG_CODES.hi=LANG_HI;LANG_CODES.id=LANG_ID;LANG_CODES.ja=LANG_JA;LANG_CODES.zh=LANG_ZH;LANG_CODES.be=LANG_RU;LANG_CODES.kk=LANG_RU;LANG_CODES.uk=LANG_RU;LANG_CODES.uz=LANG_RU;var PARAM_ROOM_ID="roomid",PARAM_PASSWORD="pwd",PARAM_GAMETYPE="gametype";
function refreshSettings(d){d===GOALKEEPER_MODE?(TEXT_COLOR_STROKE="#000000",TIME_RESET_AFTER_GOAL=BALL_RADIUS=1,BACK_WALL_GOAL_SIZE={width:21,depth:.1,height:11},UP_WALL_GOAL_SIZE={width:21,depth:25,height:.1},POLE_RIGHT_LEFT_SIZE={radius_top:.5,radius_bottom:.5,height:21.5,segments:10},BACK_WALL_GOAL_POSITION={x:0,y:8,z:-2.7},GOAL_LINE_POS={x:0,y:31,z:-2.7},POSITION_BALL={x:0,y:125,z:-9},POLE_UP_SIZE={radius_top:.5,radius_bottom:.5,height:42,segments:10},LEFT_RIGHT_WALL_GOAL_SIZE={width:.1,depth:25,
height:11},HIT_BALL_MAX_FORCE=100,HIT_BALL_MIN_FORCE=.01,INTENSITY_DISPLAY_SHOCK=[{x:30,y:20,time:75},{x:50,y:25,time:75},{x:70,y:30,time:75},{x:90,y:40,time:75}],CAMERA_POSITION={x:0,y:0,z:100},FOV=45,NEAR=10):(TEXT_COLOR_STROKE="#002a59",BALL_RADIUS=.68,TIME_RESET_AFTER_GOAL=1E3,BACK_WALL_GOAL_SIZE={width:20.5,depth:1,height:7.5},UP_WALL_GOAL_SIZE={width:20.5,depth:25,height:.1},BACK_WALL_GOAL_POSITION={x:0,y:155,z:-2.7},GOAL_LINE_POS={x:0,y:BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth+2,z:BACK_WALL_GOAL_POSITION.z},
POSITION_BALL={x:.05,y:15.4,z:-9+BALL_RADIUS},POLE_UP_SIZE={radius_top:.5,radius_bottom:.5,height:40.5,segments:10},POLE_RIGHT_LEFT_SIZE={radius_top:.5,radius_bottom:.5,height:15,segments:10},LEFT_RIGHT_WALL_GOAL_SIZE={width:.1,depth:25,height:7.5},HIT_BALL_MAX_FORCE=130,HIT_BALL_MIN_FORCE=5,INTENSITY_DISPLAY_SHOCK=[{x:10,y:7.5,time:50},{x:20,y:9,time:50},{x:30,y:12,time:50},{x:33,y:15,time:50}],CAMERA_POSITION={x:0,y:0,z:-7},FOV=15,NEAR=1);FAR=2E3;GOAL_SPRITE_SWAP_Y=GOAL_LINE_POS.y;GOAL_SPRITE_SWAP_Z=
BACK_WALL_GOAL_POSITION.z+LEFT_RIGHT_WALL_GOAL_SIZE.height;FIRST_AREA_GOAL_POS={x:-14-.5*AREA_GOAL_PROPERTIES.width,y:BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth+1.1,z:3.1-.5*AREA_GOAL_PROPERTIES.height};BALL_OUT_Y=BACK_WALL_GOAL_POSITION.y+3;GOAL_KEEPER_DEPTH_Y=BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth;START_HAND_SWIPE_POS={x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF+200};END_HAND_SWIPE_POS=[{x:CANVAS_WIDTH_HALF-250,y:CANVAS_HEIGHT_HALF-200},{x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF-200},
{x:CANVAS_WIDTH_HALF+250,y:CANVAS_HEIGHT_HALF-200}]}
function CPreloader(){var d,c,f,l,a,e,b,h,k;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.loadSprites();k=new createjs.Container;s_oStage.addChild(k)};this.unload=function(){k.removeAllChildren()};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};
this.attachSprites=function(){var g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.addChild(g);g=s_oSpriteLibrary.getSprite("200x200");b=createBitmap(g);b.regX=.5*g.width;b.regY=.5*g.height;b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2-130;k.addChild(b);h=new createjs.Shape;h.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(b.x-100,b.y-100,200,200,10);k.addChild(h);b.mask=h;g=s_oSpriteLibrary.getSprite("progress_bar");l=createBitmap(g);l.x=CANVAS_WIDTH/2-
g.width/2;l.y=CANVAS_HEIGHT/2+50;k.addChild(l);d=g.width;c=g.height;a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(l.x,l.y,1,c);k.addChild(a);l.mask=a;f=new createjs.Text("","30px "+PRIMARY_FONT,"#fff");f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2+100;f.textBaseline="alphabetic";f.textAlign="center";k.addChild(f);e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.addChild(e);createjs.Tween.get(e).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(e);
k.removeChild(e)})};this.refreshLoader=function(g){f.text=g+"%";100===g&&(s_oMain._onRemovePreloader(),f.visible=!1,l.visible=!1);a.graphics.clear();g=Math.floor(g*d/100);a.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(l.x,l.y,g,c)};this._init()}
function CMain(d){var c,f=0,l=0,a=STATE_LOADING,e;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(canvas);createjs.Touch.enable(s_oStage,!0);s_oStage.preventSelection=!1;s_bMobile=isMobile();!1===s_bMobile?(s_oStage.enableMouseOver(20),FPS=FPS_DESKTOP,FPS_TIME=1/FPS,PHYSICS_STEP=1/(FPS*STEP_RATE),ROLL_BALL_RATE=60/FPS):BALL_VELOCITY_MULTIPLIER=.8;s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=
FPS;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;s_oNetworkManager=new CNetworkManager;e=new CPreloader;c=!0};this.soundLoaded=function(){f++;e.refreshLoader(Math.floor(f/l*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"drop_bounce_grass",loop:!1,volume:1,ingamename:"drop_bounce_grass"});s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,
ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"kick",loop:!1,volume:1,ingamename:"kick"});s_aSoundsInfo.push({path:"./sounds/",filename:"ball_saved",loop:!1,volume:1,ingamename:"ball_saved"});s_aSoundsInfo.push({path:"./sounds/",filename:"goal_keeper",loop:!1,volume:1,ingamename:"goal_keeper"});s_aSoundsInfo.push({path:"./sounds/",filename:"goal_striker",loop:!1,volume:1,ingamename:"goal_striker"});s_aSoundsInfo.push({path:"./sounds/",filename:"keep_ball",loop:!1,volume:1,ingamename:"keep_ball"});
s_aSoundsInfo.push({path:"./sounds/",filename:"pole",loop:!1,volume:1,ingamename:"pole"});s_aSoundsInfo.push({path:"./sounds/",filename:"win",loop:!1,volume:1,ingamename:"win"});s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});s_aSoundsInfo.push({path:"./sounds/",filename:"crowd",loop:!0,volume:1,ingamename:"crowd"});s_aSoundsInfo.push({path:"./sounds/",filename:"hurryup",loop:!0,volume:1,ingamename:"hurryup"});l+=s_aSoundsInfo.length;s_aSounds=
[];for(var h=0;h<s_aSoundsInfo.length;h++)this.tryToLoadSound(s_aSoundsInfo[h],!1)};this.tryToLoadSound=function(h,k){setTimeout(function(){s_aSounds[h.ingamename]=new Howl({src:[h.path+h.filename+".mp3"],autoplay:!1,preload:!0,loop:h.loop,volume:h.volume,onload:s_oMain.soundLoaded,onloaderror:function(g,m){for(var n=0;n<s_aSoundsInfo.length;n++)if(g===s_aSounds[s_aSoundsInfo[n].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[n],!0);break}},onplayerror:function(g){for(var m=0;m<s_aSoundsInfo.length;m++)if(g===
s_aSounds[s_aSoundsInfo[m].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[m].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[m].ingamename].play();"soundtrack"===s_aSoundsInfo[m].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},k?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);for(var h=0;h<NUM_LANGUAGES;h++)s_oSpriteLibrary.addSprite("logo_"+h,"./sprites/logo_"+h+".png");s_oSpriteLibrary.addSprite("bg_menu",
"./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("but_local","./sprites/but_local.png");s_oSpriteLibrary.addSprite("but_multiplayer","./sprites/but_multiplayer.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");s_oSpriteLibrary.addSprite("ball_shadow","./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("start_ball","./sprites/start_ball.png");
s_oSpriteLibrary.addSprite("hand_touch","./sprites/hand_touch.png");s_oSpriteLibrary.addSprite("cursor","./sprites/cursor.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("msg_box_small","./sprites/msg_box_small.png");s_oSpriteLibrary.addSprite("bg_levelselect","./sprites/bg_levelselect.jpg");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("logo_ctl",
"./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_level_locked","./sprites/but_level_locked.png");s_oSpriteLibrary.addSprite("but_next","./sprites/but_next.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_delete_savings",
"./sprites/but_delete_savings.png");s_oSpriteLibrary.addSprite("ball_kick","./sprites/ball_kick.png");s_oSpriteLibrary.addSprite("score_side_bg","./sprites/score_side_bg.png");s_oSpriteLibrary.addSprite("but_lang","./sprites/but_lang.png");for(h=0;h<NUM_TEAMS;h++)s_oSpriteLibrary.addSprite("flag_"+h,"./sprites/flags/flag_"+h+".png");s_oSpriteLibrary.addSprite("bg_game_striker","./sprites/striker/bg_game_striker.jpg");s_oSpriteLibrary.addSprite("goal_0","./sprites/striker/goal_0.png");for(h=0;h<NUM_TEAMS;h++)for(var k=
0;4>k;k++)s_oSpriteLibrary.addSprite("player_"+h+"-"+k,"./sprites/striker/player/player_"+h+"-"+k+".png");for(k=h=0;k<SPRITE_NAME_GOALKEEPER.length;k++)for(var g=0;g<NUM_SPRITE_GOALKEEPER[k];g++)s_oSpriteLibrary.addSprite(SPRITE_NAME_GOALKEEPER[k]+"_"+h+"_"+g,"./sprites/striker/goalkeeper/"+SPRITE_NAME_GOALKEEPER[k]+"/"+SPRITE_NAME_GOALKEEPER[k]+"_"+h+"_"+g+".png");s_oSpriteLibrary.addSprite("bg_game_gk","./sprites/goalkeeper/bg_game_gk.jpg");s_oSpriteLibrary.addSprite("gloves","./sprites/goalkeeper/gloves.png");
s_oSpriteLibrary.addSprite("goal_1","./sprites/goalkeeper/goal_1.png");s_oSpriteLibrary.addSprite("help_mouse","./sprites/goalkeeper/help_mouse.png");s_oSpriteLibrary.addSprite("help_touch","./sprites/goalkeeper/help_touch.png");for(h=0;h<NUM_TEAMS;h++)s_oSpriteLibrary.addSprite("opponent_"+h,"./sprites/goalkeeper/opponent_"+h+".png");l+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){f++;e.refreshLoader(Math.floor(f/l*100))};this._onAllImagesLoaded=
function(){};this.preloaderReady=function(){f=0;!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();this._loadImages();c=!0};this._onRemovePreloader=function(){e.unload();try{checkMoreGames(s_szGameID,"middle-left",["soccer","sport","multiplayer"],[],-1,"blue")}catch(h){}try{saveItem("ls_available","ok")}catch(h){s_bStorageAvailable=!1}this.gotoMenu();s_oSoundtrack=playSound("soundtrack",1,!0)};this.saveMatch=function(h,k,g,m,n){saveItem(LOCALSTORAGE_STRING+"match_"+h,JSON.stringify({opponent:k,
result:g,score:n,level_score:m}))};this.saveTeam=function(h){s_iTeamSelected=h;saveItem(LOCALSTORAGE_STRING+"team",s_iTeamSelected)};this.saveLevel=function(h){s_iLastLevel=h;saveItem(LOCALSTORAGE_STRING+"level",s_iLastLevel)};this.getStoredTeamSelected=function(){return getItem(LOCALSTORAGE_STRING+"team")};this.getMatches=function(){if(null===getItem(LOCALSTORAGE_STRING+"match_1"))return null;for(var h=[],k=1;k<NUM_MATCHES+1;k++)h.push(JSON.parse(getItem(LOCALSTORAGE_STRING+"match_"+k)));return h};
this.getLastLevel=function(){var h=getItem(LOCALSTORAGE_STRING+"level");return null===h?1:h};this.getScoreMatch=function(h){h=getItem(LOCALSTORAGE_STRING+"match_"+h);return JSON.parse(h).level_score};this.getScoreTillLevel=function(h){if(!s_bStorageAvailable)return 0;for(var k=0,g=0;g<h-1;g++)k+=this.getScoreMatch(g+1);return k};this.gotoMenu=function(){try{showMoreGames()}catch(h){}new CMenu;a=STATE_MENU};this.gotoLevelPanel=function(){new CLevelMenu;a=STATE_CHOOSE_LEVEL};this.gotoSelectTeam=function(){new CSelectTeamMenu;
a=STATE_CHOOSE_TEAM};this.gotoSelectTeamMulti=function(){new CSelectTeamMenu;a=STATE_CHOOSE_TEAM};this.gotoGame=function(h){s_oGame=new CGameSingle(b,h);a=STATE_GAME};this.gotoGameWithBot=function(h){s_oGame=new CGameSingleWithBot(b,h);a=STATE_GAME};this.gotoGameMulti=function(){s_oGame=new CGameMulti(b,1);a=STATE_GAME};this.gotoHelp=function(){new CHelp;a=STATE_HELP};this.stopUpdateNoBlock=function(){s_bMultiplayer||(c=!1,createjs.Ticker.paused=!0)};this.startUpdateNoBlock=function(){s_bMultiplayer||
(s_iPrevTime=(new Date).getTime(),c=!0,createjs.Ticker.paused=!1)};this.stopUpdate=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0);c=!1;createjs.Ticker.paused=!0};this.startUpdate=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||!s_bAudioActive||s_bAdShown||Howler.mute(!1);s_iPrevTime=(new Date).getTime();c=!0;createjs.Ticker.paused=!1};this._update=function(h){if(!1!==c){var k=(new Date).getTime();s_iTimeElaps=k-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=
k;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);a===STATE_GAME&&s_oGame.update();s_oStage.update(h)}};s_oMain=this;var b=d;ENABLE_FULLSCREEN=d.fullscreen;ENABLE_CHECK_ORIENTATION=d.check_orientation;GOAL_SCORED=d.score_goal;GOAL_MISSED=d.score_goal_missed;GOAL_SAVED=d.score_ball_saved;GOAL_SUFFERED=d.score_goal_opponent;AREAS_INFO=d.area_goal;s_bAudioActive=d.audio_enable_on_startup;d=navigator.language.split("-")[0];void 0===LANG_CODES[d]&&(d="en");s_iCurLang=LANG_CODES[d];this.initContainer();
refreshLanguage()}var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oPhysicsController,s_iCanvasResizeHeight,s_iCanvasResizeWidth,s_iCanvasOffsetHeight,s_iCanvasOffsetWidth,s_oDrawLayer,s_oStage,s_oCanvas,s_oMain,s_oGame=null,s_oSpriteLibrary,s_oSoundTrack=null,s_iLastLevel=1,s_iTeamSelected,s_aSounds,s_bStorageAvailable=!0,s_oNetworkManager,s_bMultiplayer,s_bPlayWithBot,s_iCurLang=LANG_EN;
function CMenu(){var d,c,f,l,a,e,b,h,k,g,m,n,q,p,u,r=null,t=null,v,x,y;this._init=function(){s_bMobile||$("#div_display_id").css("display","block");e=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(e);f=CANVAS_WIDTH/2+100;l=CANVAS_HEIGHT-170;var A=s_oSpriteLibrary.getSprite("but_local");b=new CGfxButton(f,l,A,s_oStage);b.addEventListener(ON_MOUSE_UP,this._onButLocalRelease,this);d=CANVAS_WIDTH/2+350;c=CANVAS_HEIGHT-170;A=s_oSpriteLibrary.getSprite("but_multiplayer");h=new CGfxButton(d,
c,A,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onButMultiplayerRelease,this);v=new CGuiController(10,10,s_oStage);A=s_oSpriteLibrary.getSprite("but_lang");u=new CButLang(0,0,NUM_LANGUAGES,s_iCurLang,A,s_oStage);u.addEventListener(ON_SELECT_LANG,this._onSelectLang,this);v.addTopRight(u,!0);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)A=s_oSpriteLibrary.getSprite("audio_icon"),q=new CToggle(0,0,A,s_bAudioActive,s_oStage),q.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),v.addTopRight(q,!0);
A=s_oSpriteLibrary.getSprite("but_info");k=new CGfxButton(0,0,A,s_oStage);k.addEventListener(ON_MOUSE_UP,this._onButInfoRelease,this);v.addTopLeft(k,!0);A=window.document;var D=A.documentElement;r=D.requestFullscreen||D.mozRequestFullScreen||D.webkitRequestFullScreen||D.msRequestFullscreen;t=A.exitFullscreen||A.mozCancelFullScreen||A.webkitExitFullscreen||A.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(r=!1);r&&screenfull.isEnabled&&(A=s_oSpriteLibrary.getSprite("but_fullscreen"),p=new CToggle(0,0,A,
s_bFullscreen,s_oStage),p.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this),v.addTopLeft(p,!0));A=s_oSpriteLibrary.getSprite("but_delete_savings");g=new CGfxButton(0,0,A,s_oStage);g.addEventListener(ON_MOUSE_UP,this._onDeleteSavings,this);v.addDownLeft(g,!0);null===s_oMain.getStoredTeamSelected()&&g.setVisible(!1);A=s_oSpriteLibrary.getSprite("logo_"+s_iCurLang);x=createBitmap(A);x.regX=A.width/2;x.regY=A.height/2;x.x=CANVAS_WIDTH/2;x.y=CANVAS_HEIGHT/2-150;s_oStage.addChild(x);y=new CLangPanel(s_oStage);
y.addEventListener(ON_SELECT_LANG,this._onChangeLang,this);m=new CAreYouSurePanel(s_oStage);m.addEventListener(ON_BUT_YES_DOWN,this._onConfirmDelete,this);n=new createjs.Shape;n.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(n);createjs.Tween.get(n).to({alpha:0},1E3).call(function(){n.visible=!1});s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage);this.checkPendingInvitation();this.refreshButtonPos()};this.refreshButtonPos=function(){v.refreshPos();b.setPosition(f,
l-s_iOffsetY);h.setPosition(d,c-s_iOffsetY)};this.checkPendingInvitation=function(){var A=getParameterByName(PARAM_ROOM_ID),D=getParameterByName(PARAM_PASSWORD);void 0!==A&&null!==A&&(s_oNetworkManager=new CNetworkManager,g_oCTLMultiplayer=new CCTLMultiplayerGui,s_oNetworkManager.addEventListener(ON_GAMEROOM_CONNECTION_SUCCESS,this._onGameStart),s_oNetworkManager.addEventListener(ON_LOGIN_SUCCESS,function(){s_oNetworkManager.tryJoinFromInvitation(A.toString(),D.toString())}),s_oNetworkManager.connectToSystem())};
this.unload=function(){b.unload();b=null;h.unload();h=null;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)q.unload(),q=null;r&&screenfull.isEnabled&&p.unload();g.unload();m.unload();s_oStage.removeAllChildren();s_oMenu=null};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onButInfoRelease=function(){new CCreditsPanel};this.resetFullscreenBut=function(){r&&screenfull.isEnabled&&p.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?
t.call(window.document):r.call(window.document.documentElement);sizeHandler()};this._onDeleteSavings=function(){m.show(TEXT_CONFIRM_DELETE)};this._onConfirmDelete=function(){s_iLastLevel=1;clearAllItem();g.setVisible(!1)};this._onSelectLang=function(){y.show()};this._onChangeLang=function(A){s_iCurLang=A;var D=s_oSpriteLibrary.getSprite("logo_"+s_iCurLang);x.image=D;x.regX=D.width/2;x.regY=D.height/2;u.setLang(A);refreshLanguage()};this._onButLocalRelease=function(){"undefined"!==typeof gdsdk&&"undefined"!==
gdsdk.showAd&&gdsdk.showAd();try{hideMoreGames()}catch(A){}$("#div_display_id").css("display","none");s_bPlayWithBot=s_bMultiplayer=!1;$(s_oMain).trigger("start_session");this.unload();null===s_oMain.getStoredTeamSelected()?s_oMain.gotoSelectTeam():(s_iTeamSelected=s_oMain.getStoredTeamSelected(),s_iLastLevel=s_oMain.getLastLevel(),s_oMain.gotoLevelPanel())};this._onButMultiplayerRelease=function(){"undefined"!==typeof gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd();try{hideMoreGames()}catch(A){}$("#div_display_id").css("display",
"none");$(s_oMain).trigger("start_session");s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oNetworkManager.addEventListener(ON_GAMEROOM_CONNECTION_SUCCESS,this._onGameStart);s_oNetworkManager.addEventListener(ON_MATCHMAKING_CONNECTION_SUCCESS,this._onMatchmakingConnected);s_oNetworkManager.addEventListener(ON_BACK_FROM_A_ROOM,this.clearBotCheck);s_oNetworkManager.addEventListener(ON_LOGIN_SUCCESS,s_oNetworkManager.gotoLobby);s_oNetworkManager.connectToSystem()};this._onGameStart=function(){s_oMenu.clearBotCheck();
s_bMultiplayer=!0;s_bPlayWithBot=!1;s_oMenu.unload();s_oMain.gotoSelectTeamMulti()};this._onMatchmakingConnected=function(){g_oCTLMultiplayer.closeAllDialog();g_oCTLMultiplayer.showLoading(TEXT_FIND_OPPONENT,"s_oNetworkManager._onDisconnectFromARoom");s_oMenu._checkMatchWithBot()};this._checkMatchWithBot=function(){var A=randomFloatBetween(38E3,56E3);a=setTimeout(function(){s_bPlayWithBot=s_bMultiplayer=!0;s_oNetworkManager.disconnect();var D=s_oNetworkManager.generateRandomName();g_oCTLMultiplayer.onPlayerFound(D);
setTimeout(function(){g_oCTLMultiplayer.closeAllDialog();s_oMenu.unload();s_oMain.gotoSelectTeamMulti()},1500)},A)};this.clearBotCheck=function(){clearTimeout(a)};s_oMenu=this;this._init()}var s_oMenu=null;
function CAreYouSurePanel(d){var c,f,l,a,e,b,h,k,g=this;this._init=function(){c=[];f=[];h=new createjs.Container;h.visible=!1;m.addChild(h);k=new createjs.Shape;k.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.alpha=.5;k.on("click",function(){});h.addChild(k);var n=s_oSpriteLibrary.getSprite("msg_box_small");l=createBitmap(n);l.x=CANVAS_WIDTH_HALF;l.y=CANVAS_HEIGHT_HALF;l.regX=.5*n.width;l.regY=.5*n.height;h.addChild(l);a=new CTLText(h,CANVAS_WIDTH/2-n.width/2+50,CANVAS_HEIGHT_HALF-
150,n.width-100,150,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1);e=new CGfxButton(CANVAS_WIDTH/2+180,.5*CANVAS_HEIGHT+100,s_oSpriteLibrary.getSprite("but_yes"),h);e.addEventListener(ON_MOUSE_UP,this._onButYes,this);b=new CGfxButton(CANVAS_WIDTH/2-180,.5*CANVAS_HEIGHT+100,s_oSpriteLibrary.getSprite("but_no"),h);b.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.addEventListener=function(n,q,p){c[n]=q;f[n]=p};this.show=function(n){a.refreshText(n);h.alpha=0;h.visible=!0;createjs.Tween.get(h).to({alpha:1},
300,createjs.Ease.quartOut).call(function(){s_oMain.stopUpdateNoBlock()})};this.hide=function(){s_oMain.startUpdateNoBlock();createjs.Tween.get(h).to({alpha:0},500,createjs.Ease.quartOut).call(function(){h.visible=!1})};this.unload=function(){b.unload();e.unload()};this._onButYes=function(){g.hide();c[ON_BUT_YES_DOWN]&&c[ON_BUT_YES_DOWN].call(f[ON_BUT_YES_DOWN])};this._onButNo=function(){g.hide()};var m=d;this._init()}
function CInterface(d,c,f){var l,a,e,b,h,k,g,m,n,q,p,u=null,r=null;this._init=function(t){p=new CGuiController(10,10,s_oStage);var v=s_oSpriteLibrary.getSprite("but_exit");l=new CGfxButton(0,0,v,f);l.addEventListener(ON_MOUSE_UP,this._onExit,this);p.addTopRight(l,!0);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)v=s_oSpriteLibrary.getSprite("audio_icon"),e=new CToggle(0,0,v,s_bAudioActive,f),e.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),p.addTopRight(e,!0);v=window.document;var x=v.documentElement;
u=x.requestFullscreen||x.mozRequestFullScreen||x.webkitRequestFullScreen||x.msRequestFullscreen;r=v.exitFullscreen||v.mozCancelFullScreen||v.webkitExitFullscreen||v.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(u=!1);u&&screenfull.isEnabled&&(v=s_oSpriteLibrary.getSprite("but_fullscreen"),a=new CToggle(0,0,v,!1,f),a.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this),p.addTopRight(a,!0));b=new CScoreBoard(t,{x:140,y:4},f);h=new CResultPanel(t,f);k=new CHelpText(f);q=new CWaitingPanel(f);m=new CVersusPanel(f);
g=new CFinalPanel(t,f);n=new CAreYouSurePanel(s_oStage);n.addEventListener(ON_BUT_YES_DOWN,this._onConfirmExit,this);this.refreshButtonPos()};this.refreshButtonPos=function(){p.refreshPos();b.refreshButtonPos()};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)e.unload(),e=null;u&&screenfull.isEnabled&&(a.unload(),a=null);l.unload();l=null;g.unload();n.unload();b.unload();s_oInterface=null};this.reset=function(t,v){h.reset(t);b.reset(t);q.hide()};this.setFinalPanel=function(){g.addEventListener(ON_BACK_MENU,
s_oGame.onExit,s_oGame);g.addEventListener(ON_NEXT,s_oGame.nextRound,s_oGame);g.addEventListener(ON_RESTART,s_oGame.retryLevel,s_oGame)};this.setFinalPanelMultiplayer=function(){g.addEventListener(ON_BACK_MENU,s_oGame.onExit,s_oGame);g.addEventListener(ON_RESTART,s_oGame.onConfirmRematch,s_oGame)};this.hideFinalPanelScore=function(){g.hideLevelScore()};this.changeFinalMessage=function(t){g.changeMessage(t)};this.hideFinalButtons=function(){g.hideButtons()};this.showFinalButtons=function(){g.showButtons()};
this.hideFinalPanel=function(){g.hide()};this.centerFinalHomeButton=function(){g.centerHomeButton()};this.setFinalRematch=function(t){g.setRematch(t)};this.showVsPanel=function(t,v){m.show(t,v)};this.onExitVersusPanel=function(){if(s_bMultiplayer)s_oGame.onBeginShot()};this.resetFullscreenBut=function(){u&&screenfull.isEnabled&&a.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?r.call(window.document):u.call(window.document.documentElement);sizeHandler()};this.refreshScoreBoard=
function(t,v,x){b.setScore(v,x);h.show(t,v,x)};this.setPlayersInfo=function(t,v){b.setPlayersName(t,v)};this.setExtraScore=function(){b.setExtraScore()};this.refreshKicks=function(t,v){var x=v[v.length-1];t===PLAYER?b.refreshPlayerKicks(x):b.refreshOpponentKicks(x)};this.showHelpText=function(t){k.show(t)};this.showGoalkeeperWaiting=function(){q.showGoalkeeperWaiting()};this.hideGoalkeeperWaiting=function(){q.hideGoalkeeperWaiting()};this.showStrikerWaiting=function(){q.showStrikerWaiting()};this.hideStrikerWaiting=
function(){q.hideStrikerWaiting()};this.hideHelpText=function(){k.hide()};this.showFinalPanel=function(t,v,x,y,A){g.show(t,v,x,y,A)};this.isHelpTextVisible=function(){return k.visible};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){n.show(TEXT_ARE_SURE)};this._onConfirmExit=function(){s_oGame.onExit()};s_oInterface=this;this._init(d)}
var s_oInterface=null,CGameBase=function(d){this._bExtraPenalty;this._iPlayerGoals;this._iOpponentGoals;this._iNumKicks;this._iCurLevel;this._iLevelScore;this._iTotScore;this._iMultiplier;this._iRemainingPlayerKicks;this._iRemainingOpponentKicks;this._aHistoryPlayer;this._aHistoryOpponent;this._aResults;this._oInterface;this._oCurScenario;this._oContainerGame;this._oContainer};
CGameBase.prototype._init=function(d){$(s_oMain).trigger("start_session");$(s_oMain).trigger("start_level",d);this._iCurLevel=d;this.reset();this._aResults=[];if(s_bMobile)for(d=0;d<BALL_FORCE_Y.length;d++)BALL_FORCE_Y[d]*=BALL_VELOCITY_MULTIPLIER,BALL_FORCE_Z[d].min/=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_Z[d].max*=BALL_VELOCITY_MULTIPLIER+.1,BALL_FORCE_X[d]*=BALL_VELOCITY_MULTIPLIER;this._oContainer=new createjs.Container;s_oStage.addChild(this._oContainer);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,
0,CANVAS_WIDTH,CANVAS_HEIGHT);this._oContainer.addChild(d);this._oContainerGame=new createjs.Container;this._oContainer.addChild(this._oContainerGame)};
CGameBase.prototype.reset=function(){this._iTotScore=s_bMultiplayer||1===this._iCurLevel?0:s_oMain.getScoreTillLevel(this._iCurLevel);this._bExtraPenalty=!1;s_iCurState=STRIKER_MODE;this._iOpponentGoals=this._iLevelScore=this._iPlayerGoals=0;this._iMultiplier=this._iNumKicks=1;this._iRemainingPlayerKicks=NUM_KICKS/2;this._iRemainingOpponentKicks=NUM_KICKS/2;this._aHistoryPlayer=[];this._aHistoryOpponent=[];refreshSettings(s_iCurState);setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME);playSound("crowd",
1,!0)};CGameBase.prototype.unload=function(){this._oInterface.unload();this._oCurScenario.unload();s_oStage.removeChild(this._oContainer)};
CGameBase.prototype.endShotPlayer=function(d,c){this._iRemainingPlayerKicks--;0>this._iRemainingPlayerKicks&&(this._iRemainingPlayerKicks=0);d?(this._aHistoryPlayer.push(1),this._iPlayerGoals++):(this._iMultiplier=1,this._aHistoryPlayer.push(0));this._oInterface.refreshKicks(PLAYER,this._aHistoryPlayer);var f=TEXT_MISSED;d?f=TEXT_GOAL:c&&(f=TEXT_SAVED);this._oInterface.refreshScoreBoard(f,this._iPlayerGoals,this._iOpponentGoals)};
CGameBase.prototype.endShotOpponent=function(d,c){this._iRemainingOpponentKicks--;0>this._iRemainingOpponentKicks&&(this._iRemainingOpponentKicks=0);d?(this._aHistoryOpponent.push(1),this._iOpponentGoals++,this._iMultiplier=1):this._aHistoryOpponent.push(0);this._oInterface.refreshKicks(OPPONENT,this._aHistoryOpponent);var f=TEXT_MISSED;d?f=TEXT_GOAL:c&&(f=TEXT_SAVED);this._oInterface.refreshScoreBoard(f,this._iPlayerGoals,this._iOpponentGoals)};
CGameBase.prototype.setExtraPenalty=function(){this._iRemainingOpponentKicks=this._iRemainingPlayerKicks=1;this._oInterface.setExtraScore()};CGameBase.prototype.getCurLevel=function(){return this._iCurLevel};CGameBase.prototype.update=function(){this._oCurScenario&&this._oCurScenario.update()};var s_iCurState,s_oGameKeeper,s_oGameStriker;function CGameSingle(d,c){CGameBase.call(this,d,c);this._init(c)}CGameSingle.prototype=Object.create(CGameBase.prototype);
CGameSingle.prototype._init=function(d){CGameBase.prototype._init(d);this._startGame()};CGameSingle.prototype._startGame=function(){this._oInterface=new CInterface(this._iCurLevel,this._iTotScore,this._oContainer);s_oGameStriker=this._oCurScenario=new CGameStrikerSingle(this._oContainerGame,this._iCurLevel);this._oInterface.showVsPanel(s_aMatches[this._iCurLevel-1],this._iCurLevel)};
CGameSingle.prototype.changeScenario=function(){var d=this._iPlayerGoals-this._iOpponentGoals>this._iRemainingOpponentKicks,c=this._iOpponentGoals-this._iPlayerGoals>this._iRemainingPlayerKicks;this._iNumKicks++;if(d||c){this._aResults.push({player:this._iPlayerGoals,cpu:this._iOpponentGoals});c=!1;this._iPlayerGoals<this._iOpponentGoals&&(c=!0);var f=!1;this._iCurLevel===NUM_MATCHES?f=!0:c||s_oMain.saveLevel(this._iCurLevel+1);setVolume("soundtrack",1);stopSound("crowd");d&&(this._iLevelScore=this._iNumKicks-
1===NUM_KICKS?SCORE_NORMAL:this._iNumKicks-1<NUM_KICKS?SCORE_BONUS:SCORE_NOBONUS);this._iTotScore+=this._iLevelScore;$(s_oMain).trigger("end_level",this._iCurLevel);this._oInterface.setFinalPanel();this._oInterface.showFinalPanel(this._iPlayerGoals+"-"+this._iOpponentGoals,this._iTotScore,this._iLevelScore,c,f);s_oMain.saveMatch(this._iCurLevel,s_aMatches[this._iCurLevel-1],this._iPlayerGoals+"-"+this._iOpponentGoals,this._iLevelScore,this._iTotScore)}else this._oCurScenario.unload(),this._oCurScenario=
null,s_iCurState===STRIKER_MODE?(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),this._iNumKicks>NUM_KICKS&&(this._bExtraPenalty=!0,BALL_FORCE_Y[this._iCurLevel]<HIT_BALL_MAX_FORCE&&(BALL_FORCE_Y[this._iCurLevel]+=2)),s_oGameKeeper=this._oCurScenario=new CGameGoalkeeperSingle(this._iCurLevel,BALL_FORCE_Y[this._iCurLevel-1],this._oContainerGame)):(s_iCurState=STRIKER_MODE,refreshSettings(s_iCurState),this._iNumKicks>NUM_KICKS&&(this._bExtraPenalty=!0),s_oGameStriker=this._oCurScenario=new CGameStrikerSingle(this._oContainerGame,
this._iCurLevel)),0===this._iRemainingPlayerKicks&&0===this._iRemainingOpponentKicks&&s_oGame.setExtraPenalty()};CGameSingle.prototype.retryLevel=function(){this._iCurLevel--;this.nextRound();this._oInterface.hideFinalPanel();$(s_oMain).trigger("restart_level",this._iCurLevel)};CGameSingle.prototype.onExit=function(){this.unload();$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");setVolume("soundtrack",1);s_oMain.gotoMenu()};
CGameSingle.prototype.nextRound=function(){this._iCurLevel++;this.reset();this._oCurScenario.unload();this._oCurScenario=null;this._oInterface.reset(s_aMatches[this._iCurLevel-1],this._iCurLevel);this._oInterface.showVsPanel(s_aMatches[this._iCurLevel-1],this._iCurLevel);this._oInterface.hideFinalPanel();s_oGameStriker=this._oCurScenario=new CGameStrikerSingle(this._oContainerGame,this._iCurLevel)};function CGameMulti(d,c){CGameBase.call(this,d,c);this._init(c);this._bUserAStart}
CGameMulti.prototype=Object.create(CGameBase.prototype);CGameMulti.prototype._init=function(d){CGameBase.prototype._init(d);this._startGame()};
CGameMulti.prototype._startGame=function(){this._bUserAStart=!0;this._iTotScore=0;this._oInterface=new CInterface(this._iCurLevel,this._iTotScore,this._oContainer);this._oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),s_oNetworkManager.getEnemyNickname());this._oInterface.hideFinalPanelScore();s_oNetworkManager.isUserA()?s_oGameStriker=this._oCurScenario=new CGameStrikerMulti(this._oContainerGame,this._iCurLevel):(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),this._iNumKicks>
NUM_KICKS&&(this._bExtraPenalty=!0,BALL_FORCE_Y[this._iCurLevel]<HIT_BALL_MAX_FORCE&&(BALL_FORCE_Y[this._iCurLevel]+=2)),s_oGameKeeper=this._oCurScenario=new CGameGoalkeeperMulti(this._iCurLevel,BALL_FORCE_Y[this._iCurLevel-1],this._oContainerGame));this._oInterface.showVsPanel(s_aMatches[this._iCurLevel-1],"");s_oNetworkManager.addEventListener(ON_DISCONNECTION,this.playerDisconnectedFromGame,this);this.refreshPos()};CGameMulti.prototype.onBeginShot=function(){this._oCurScenario.startCountDown()};
CGameMulti.prototype.refreshPos=function(){this._oCurScenario.refreshPos()};
CGameMulti.prototype.changeScenario=function(){var d=this._iPlayerGoals-this._iOpponentGoals>this._iRemainingOpponentKicks,c=this._iOpponentGoals-this._iPlayerGoals>this._iRemainingPlayerKicks;this._iNumKicks++;d||c?(this._aResults.push({player:this._iPlayerGoals,cpu:this._iOpponentGoals}),c=!1,this._iPlayerGoals<this._iOpponentGoals&&(c=!0),setVolume("soundtrack",1),stopSound("crowd"),$(s_oMain).trigger("end_level",this._iCurLevel),d&&(this._iLevelScore=this._iNumKicks-1===NUM_KICKS?SCORE_NORMAL:
this._iNumKicks-1<NUM_KICKS?SCORE_BONUS:SCORE_NOBONUS),this._iTotScore+=this._iLevelScore,this._oInterface.setFinalPanelMultiplayer(),this._oInterface.showFinalPanel(this._iPlayerGoals+"-"+this._iOpponentGoals,this._iTotScore,this._iLevelScore,c,!0),d=!1,s_oNetworkManager.isUserA()?c||(d=!0):c&&(d=!0),s_oNetworkManager.sendMsg(MSG_END_MATCH,d)):(this._oCurScenario.unload(),this._oCurScenario=null,s_iCurState===STRIKER_MODE?(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),this._iNumKicks>
NUM_KICKS&&(this._bExtraPenalty=!0,BALL_FORCE_Y[this._iCurLevel]<HIT_BALL_MAX_FORCE&&(BALL_FORCE_Y[this._iCurLevel]+=2)),s_oGameKeeper=this._oCurScenario=new CGameGoalkeeperMulti(this._iCurLevel,BALL_FORCE_Y[this._iCurLevel-1],this._oContainerGame)):(s_iCurState=STRIKER_MODE,refreshSettings(s_iCurState),this._iNumKicks>NUM_KICKS&&(this._bExtraPenalty=!0),s_oGameStriker=this._oCurScenario=new CGameStrikerMulti(this._oContainerGame,this._iCurLevel)),0===this._iRemainingPlayerKicks&&0===this._iRemainingOpponentKicks&&
s_oGame.setExtraPenalty(),this.onBeginShot(),this._oCurScenario.refreshPos())};
CGameMulti.prototype.nextRound=function(){this._bUserAStart=!this._bUserAStart;this.reset();this._oInterface.reset(s_aMatches[this._iCurLevel-1]);this._oInterface.hideFinalPanel();this._oCurScenario.unload();this._oCurScenario=null;s_oNetworkManager.isUserA()?this._bUserAStart?s_oGameStriker=this._oCurScenario=new CGameStrikerMulti(this._oContainerGame,this._iCurLevel):(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),s_oGameKeeper=this._oCurScenario=new CGameGoalkeeperMulti(this._iCurLevel,
BALL_FORCE_Y[this._iCurLevel-1],this._oContainerGame)):this._bUserAStart?(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),s_oGameKeeper=this._oCurScenario=new CGameGoalkeeperMulti(this._iCurLevel,BALL_FORCE_Y[this._iCurLevel-1],this._oContainerGame)):s_oGameStriker=this._oCurScenario=new CGameStrikerMulti(this._oContainerGame,this._iCurLevel);this.onBeginShot();this._oCurScenario.refreshPos()};
CGameMulti.prototype.retryLevel=function(){this.nextRound();this._oInterface.hideFinalPanel();$(s_oMain).trigger("restart_level",this._iCurLevel)};CGameMulti.prototype.onExit=function(){this.unload();$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");setVolume("soundtrack",1);s_oMain.gotoMenu();s_oNetworkManager.disconnect()};CGameMulti.prototype.showRematchQuestion=function(){};
CGameMulti.prototype.onConfirmRematch=function(){$(s_oMain).trigger("show_interlevel_ad");this._oInterface.changeFinalMessage(TEXT_WAIT_OPPONENT);this._oInterface.hideFinalButtons();s_oNetworkManager.sendMsg(MSG_ACCEPT_REMATCH,"")};CGameMulti.prototype.onOpponentRefuseRematch=function(){this._oInterface.changeFinalMessage(TEXT_OPPONENT_LEFT);this._oInterface.showFinalButtons();this._oInterface.centerFinalHomeButton()};
CGameMulti.prototype.onOpponentAcceptRematch=function(){s_oGame._oInterface.showFinalButtons();s_oGame.retryLevel()};
CGameMulti.prototype.playerDisconnectedFromGame=function(){s_oGame._oInterface.setFinalPanelMultiplayer();s_oGame._oInterface.showFinalPanel(this._iPlayerGoals+"-"+this._iOpponentGoals,this._iTotScore,this._iLevelScore,!1,!0);s_oGame._oInterface.changeFinalMessage(TEXT_OPPONENT_LEFT);s_oGame._oInterface.showFinalButtons();s_oGame._oInterface.centerFinalHomeButton();s_oNetworkManager.sendMsg(MSG_DISCONNECTION,"")};
CGameMulti.prototype.opponentLeftTheGame=function(){s_oGame._oInterface.setFinalPanelMultiplayer();s_oGame._oInterface.showFinalPanel(this._iPlayerGoals+"-"+this._iOpponentGoals,this._iTotScore,this._iLevelScore,!1,!0);s_oGame._oInterface.changeFinalMessage(TEXT_OPPONENT_LEFT);s_oGame._oInterface.showFinalButtons();s_oGame._oInterface.centerFinalHomeButton()};CGameMulti.prototype.onNotifyAcceptRematch=function(){s_oGame._oInterface.setFinalRematch(s_oNetworkManager.getEnemyNickname())};
var CGameSingleWithBot=function(d,c){CGameSingle.call(this,d,c);this._bUserAStart};CGameSingleWithBot.prototype=Object.create(CGameSingle.prototype);
CGameSingleWithBot.prototype._startGame=function(){this._bUserAStart=!0;this._iTotScore=0;this._oInterface=new CInterface(this._iCurLevel,this._iTotScore,this._oContainer);this._oInterface.setPlayersInfo(s_oNetworkManager.getPlayerNickname(),s_oNetworkManager.getBotName());this._oInterface.hideFinalPanelScore();s_oGameStriker=this._oCurScenario=new CGameStrikerSingleWithBot(this._oContainerGame,this._iCurLevel);this._oInterface.showVsPanel(s_aMatches[this._iCurLevel-1],"");this.refreshPos()};
CGameSingleWithBot.prototype.changeScenario=function(){var d=this._iPlayerGoals-this._iOpponentGoals>this._iRemainingOpponentKicks,c=this._iOpponentGoals-this._iPlayerGoals>this._iRemainingPlayerKicks;this._iNumKicks++;d||c?(this._aResults.push({player:this._iPlayerGoals,cpu:this._iOpponentGoals}),c=!1,this._iPlayerGoals<this._iOpponentGoals&&(c=!0),setVolume("soundtrack",1),stopSound("crowd"),d&&(this._iLevelScore=this._iNumKicks-1===NUM_KICKS?SCORE_NORMAL:this._iNumKicks-1<NUM_KICKS?SCORE_BONUS:
SCORE_NOBONUS),this._iTotScore+=this._iLevelScore,$(s_oMain).trigger("end_level",this._iCurLevel),this._oInterface.setFinalPanelMultiplayer(),this._oInterface.showFinalPanel(this._iPlayerGoals+"-"+this._iOpponentGoals,this._iTotScore,this._iLevelScore,c,!0),s_oGame._oInterface.showFinalButtons()):(this._oCurScenario.unload(),this._oCurScenario=null,s_iCurState===STRIKER_MODE?(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),this._iNumKicks>NUM_KICKS&&(this._bExtraPenalty=!0,BALL_FORCE_Y[this._iCurLevel]<
HIT_BALL_MAX_FORCE&&(BALL_FORCE_Y[this._iCurLevel]+=2)),s_oGameKeeper=this._oCurScenario=new CGameGoalkeeperSingleWithBot(this._iCurLevel,BALL_FORCE_Y[this._iCurLevel-1],this._oContainerGame)):(s_iCurState=STRIKER_MODE,refreshSettings(s_iCurState),this._iNumKicks>NUM_KICKS&&(this._bExtraPenalty=!0),s_oGameStriker=this._oCurScenario=new CGameStrikerSingleWithBot(this._oContainerGame,this._iCurLevel)),0===this._iRemainingPlayerKicks&&0===this._iRemainingOpponentKicks&&s_oGame.setExtraPenalty())};
CGameSingleWithBot.prototype.onBeginShot=function(){this._oCurScenario.startCountDown()};CGameSingleWithBot.prototype.refreshPos=function(){this._oCurScenario.refreshPos()};
CGameSingleWithBot.prototype.onConfirmRematch=function(){$(s_oMain).trigger("show_interlevel_ad");this._oInterface.changeFinalMessage(TEXT_WAIT_OPPONENT);this._oInterface.hideFinalButtons();var d=randomFloatBetween(200,2E3);if(.33<Math.random()).4<Math.random()?setTimeout(function(){s_oGame._rematch()},d):s_oGame._rematch();else if(.4<Math.random())setTimeout(function(){s_oGame.onBotRefuseRematch()},d);else s_oGame.onBotRefuseRematch()};
CGameSingleWithBot.prototype.onBotRefuseRematch=function(){this._oInterface.changeFinalMessage(TEXT_OPPONENT_LEFT);this._oInterface.showFinalButtons();this._oInterface.centerFinalHomeButton()};CGameSingleWithBot.prototype._rematch=function(){s_oGame.retryLevel()};
CGameSingleWithBot.prototype.nextRound=function(){this._bUserAStart=!this._bUserAStart;this.reset();this._oInterface.reset(s_aMatches[this._iCurLevel-1]);this._oInterface.hideFinalPanel();this._oCurScenario.unload();this._oCurScenario=null;this._bUserAStart?(s_iCurState=STRIKER_MODE,refreshSettings(s_iCurState),s_oGameStriker=this._oCurScenario=new CGameStrikerSingleWithBot(s_oGame._oContainerGame,this._iCurLevel)):(s_iCurState=GOALKEEPER_MODE,refreshSettings(s_iCurState),s_oGameKeeper=this._oCurScenario=
new CGameGoalkeeperSingleWithBot(this._iCurLevel,BALL_FORCE_Y[this._iCurLevel-1],this._oContainerGame))};CGameSingleWithBot.prototype.retryLevel=function(){this.nextRound();this._oInterface.hideFinalPanel();$(s_oMain).trigger("restart_level",this._iCurLevel)};
function CScoreBoard(d,c,f){var l,a,e,b,h,k,g,m,n,q,p,u,r;this._init=function(t,v){l=v;m=new createjs.Container;m.x=v.x;m.y=v.y;f.addChild(m);var x=s_oSpriteLibrary.getSprite("score_side_bg"),y=createBitmap(x);y.regX=x.width/2;m.addChild(y);g=new createjs.Container;g.x=-1;g.y=42;m.addChild(g);x=new createjs.Text("-","30px "+PRIMARY_FONT,TEXT_COLOR);x.textAlign="center";x.textBaseline="middle";x.shadow=new createjs.Shadow("#000000",1,1,4);g.addChild(x);h=new createjs.Text("0","30px "+PRIMARY_FONT,
TEXT_COLOR);h.x=-8;h.textAlign="right";h.textBaseline="middle";h.shadow=new createjs.Shadow("#000000",1,1,4);g.addChild(h);k=new createjs.Text("0","30px "+PRIMARY_FONT,TEXT_COLOR);k.x=8;k.textAlign="left";k.textBaseline="middle";k.shadow=new createjs.Shadow("#000000",1,1,4);g.addChild(k);x=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_iTeamSelected]);y=createBitmap(x);y.regX=x.width/2;y.regY=x.height/2;y.scaleX=y.scaleY=.86;y.x=-89;y.y=45;m.addChild(y);x=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_aMatches[t-
1]]);a=createBitmap(x);a.regX=x.width/2;a.regY=x.height/2;a.scaleX=a.scaleY=.86;a.x=90;a.y=45;m.addChild(a);x=s_oSpriteLibrary.getSprite("ball_kick");y=new createjs.SpriteSheet({images:[x],frames:{width:x.width/3,height:x.height,regX:x.width/3/2,regY:x.height/2},animations:{empty:0,state_1:1,state_0:2}});var A=-120;n=[];for(var D=0;D<NUM_KICKS/2;D++){var M=new CKickIcon(A,100,y,m);n.push(M);A+=x.width/3+5}q=[];A=120;for(D=0;D<NUM_KICKS/2;D++)M=new CKickIcon(A,100,y,m),q.push(M),A-=x.width/3+5;u=p=
0;r=new CTLText(m,-40,94,80,12,12,"center",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_EXTRA,!0,!0,!0,!1);r.setShadow("#000000",1,1,4);r.setVisible(!1);e=new CTLText(m,-130,110,120,20,20,"left",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_PLAYER,!0,!0,!1,!1);e.setShadow("#000000",1,1,4);b=new CTLText(m,10,110,120,20,20,"right",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_CPU,!0,!0,!1,!1);b.setShadow("#000000",1,1,4)};this.unload=function(){f.removeChild(m)};this.reset=function(t){r.setVisible(!1);u=p=0;a.image=s_oSpriteLibrary.getSprite("flag_"+
TEAM_LABEL[t]);h.text=0;for(t=k.text=0;t<NUM_KICKS/2;t++)n[t].changeState("empty"),q[t].changeState("empty"),n[t].setVisible(!0),q[t].setVisible(!0)};this.refreshButtonPos=function(){m.x=l.x+s_iOffsetX;m.y=l.y+s_iOffsetY};this.setScore=function(t,v){h.text=t;k.text=v};this.darken=function(){m.alpha=.7};this.show=function(){m.visible=!0};this.hide=function(){m.visible=!1};this.setExtraScore=function(){r.setVisible(!0);for(var t=0;t<n.length;t++)n[t].changeState("empty"),0<t&&n[t].setVisible(!1);for(t=
0;t<q.length;t++)q[t].changeState("empty"),0<t&&q[t].setVisible(!1);u=p=0};this.refreshPlayerKicks=function(t){n[p].changeState("state_"+t);p++};this.refreshOpponentKicks=function(t){q[u].changeState("state_"+t);u++};this.setPlayersName=function(t,v){e.refreshText(t);b.refreshText(v)};this._init(d,c);return this}
function CResultPanel(d,c){var f,l,a,e;this._init=function(b){e=new createjs.Container;e.visible=!1;e.x=CANVAS_WIDTH_HALF;e.y=CANVAS_HEIGHT_HALF;e.regX=CANVAS_WIDTH_HALF;e.regY=CANVAS_HEIGHT_HALF;c.addChild(e);f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=.01;f.on("click",function(){});e.addChild(f);var h=s_oSpriteLibrary.getSprite("msg_box_small"),k=createBitmap(h);k.x=CANVAS_WIDTH_HALF+6;k.y=CANVAS_HEIGHT_HALF;k.regX=h.width/2;k.regY=h.height/
2;e.addChild(k);l=new CTLText(e,CANVAS_WIDTH/2-h.width/2+50,CANVAS_HEIGHT_HALF-150,h.width-100,85,85,"center","#fff",PRIMARY_FONT,1,0,0," ",!0,!0,!1,!1);k=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_iTeamSelected]);var g=createBitmap(k);g.x=CANVAS_WIDTH_HALF-140;g.y=l.getY()+200;g.regX=k.width/2;g.regY=k.height/2;e.addChild(g);k=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_aMatches[b-1]]);b=createBitmap(k);b.x=CANVAS_WIDTH_HALF+140;b.y=l.getY()+200;b.regX=k.width/2;b.regY=k.height/2;e.addChild(b);
a=new CTLText(e,CANVAS_WIDTH/2-h.width/2+50,l.getY()+160,h.width-100,70,70,"center","#fff",PRIMARY_FONT,1,0,0," ",!0,!0,!1,!1)};this.show=function(b,h,k){l.refreshText(b);a.refreshText(h+"-"+k);e.alpha=0;e.visible=!0;createjs.Tween.get(e).to({alpha:1},500,createjs.Ease.quartOut);var g=this;setTimeout(function(){g.hide()},2500)};this.hide=function(){createjs.Tween.get(e).to({alpha:0},500,createjs.Ease.quartOut).call(function(){e.visible=!1;s_oGame.changeScenario()})};this.reset=function(){a.refreshText("0-0")};
this._init(d)}
function CFinalPanel(d,c){var f,l,a,e,b,h,k,g,m,n,q,p,u,r,t,v;this._init=function(x){f=[];l=[];t=new createjs.Container;t.visible=!1;c.addChild(t);r=new createjs.Shape;e=r.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);r.alpha=.5;r.on("click",function(){});t.addChild(r);var y=s_oSpriteLibrary.getSprite("msg_box"),A=createBitmap(y);A.x=CANVAS_WIDTH_HALF;A.y=CANVAS_HEIGHT_HALF;A.regX=y.width/2;A.regY=y.height/2;t.addChild(A);m=new CTLText(t,CANVAS_WIDTH_HALF-y.width/2+50,60,y.width-
100,110,110,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_WIN,!0,!0,!1,!1);g=new CTLText(t,CANVAS_WIDTH_HALF-75,210,150,70,70,"center","#fff",PRIMARY_FONT,1,0,0,"0-0",!0,!0,!1,!1);A=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_iTeamSelected]);p=createBitmap(A);p.x=CANVAS_WIDTH_HALF-130;p.y=g.getY()+32;p.regX=A.width/2;p.regY=A.height/2;t.addChild(p);A=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_aMatches[x-1]]);u=createBitmap(A);u.x=CANVAS_WIDTH_HALF+130;u.y=g.getY()+32;u.regX=A.width/2;u.regY=A.height/
2;t.addChild(u);n=new CTLText(t,CANVAS_WIDTH_HALF-y.width/2+50,CANVAS_HEIGHT_HALF,y.width-100,48,48,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_LEVEL_SCORE+" ",!0,!0,!1,!1);q=new CTLText(t,CANVAS_WIDTH_HALF-y.width/2+50,CANVAS_HEIGHT_HALF+60,y.width-100,58,58,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_TOTAL+" ",!0,!0,!1,!1);v=new CTLText(t,CANVAS_WIDTH_HALF+170,CANVAS_HEIGHT_HALF+140,200,100,30,"center","#fff",PRIMARY_FONT,1.1,0,0," ",!0,!0,!0,!1);k=new CGfxButton(CANVAS_WIDTH_HALF-130,CANVAS_HEIGHT_HALF+
190,s_oSpriteLibrary.getSprite("but_home"),t);k.addEventListener(ON_MOUSE_UP,this._onHome,this);h=new CGfxButton(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF+190,s_oSpriteLibrary.getSprite("but_restart"),t);h.addEventListener(ON_MOUSE_UP,this._onRetry,this);b=new CGfxButton(CANVAS_WIDTH_HALF+130,CANVAS_HEIGHT_HALF+190,s_oSpriteLibrary.getSprite("but_next"),t);b.addEventListener(ON_MOUSE_UP,this._onNext,this)};this.unload=function(){b.unload();k.unload();h.unload();r.off("click",e);c.removeChild(t)};this.addEventListener=
function(x,y,A){f[x]=y;l[x]=A};this.show=function(x,y,A,D,M){s_bMobile||($("#div_display_id").css("display","block"),console.log("show banner ad 3"));setVolume("soundtrack",1);g.refreshText(x);x=s_oSpriteLibrary.getSprite("flag_"+TEAM_LABEL[s_aMatches[s_oGame.getCurLevel()-1]]);u.image=x;D?(m.refreshText(TEXT_LOSE),b.setVisible(!1),k.setX(CANVAS_WIDTH_HALF-100),h.setX(CANVAS_WIDTH_HALF+100)):(m.refreshText(TEXT_WIN),b.setVisible(!0),M?(b.setVisible(!1),k.setX(CANVAS_WIDTH_HALF-80),h.setX(CANVAS_WIDTH_HALF+
80)):(k.setX(CANVAS_WIDTH_HALF-130),h.setX(CANVAS_WIDTH_HALF),b.setX(CANVAS_WIDTH_HALF+130)));n.refreshText=TEXT_LEVEL_SCORE+" "+A;q.refreshText(TEXT_TOTAL+" "+y);v.refreshText(" ");t.alpha=0;t.visible=!0;createjs.Tween.get(t).to({alpha:1},500,createjs.Ease.quartOut);$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("save_score",y);$(s_oMain).trigger("share_event",y)};this.hide=function(){$("#div_display_id").css("display","none");h.stopAnimation();createjs.Tween.get(t).to({alpha:0},500,
createjs.Ease.quartOut).call(function(){t.visible=!1})};this.hideLevelScore=function(){n.setVisible(!1)};this.changeMessage=function(x){q.refreshText(x)};this.hideButtons=function(){h.setVisible(!1);k.setVisible(!1)};this.showButtons=function(){k.setX(CANVAS_WIDTH_HALF-100);h.setX(CANVAS_WIDTH_HALF+100);h.setVisible(!0);k.setVisible(!0)};this.centerHomeButton=function(){h.setVisible(!1);k.setX(CANVAS_WIDTH_HALF)};this.setRematch=function(x){x=sprintf(TEXT_REMATCH_ALERT,x);v.refreshText(x.toUpperCase());
h.trembleAnimation()};this._onNext=function(){a=ON_NEXT;f[a]&&f[a].call(l[a])};this._onRetry=function(){a=ON_RESTART;f[a]&&f[a].call(l[a])};this._onHome=function(){a=ON_BACK_MENU;f[a]&&f[a].call(l[a])};this._init(d)}var NUM_ROWS_PAGE_LEVEL=2,NUM_COLS_PAGE_LEVEL=5;
function CLevelMenu(){var d,c,f,l,a,e,b,h,k,g,m,n,q,p,u,r,t,v=null,x=null,y,A,D,M=null,L=null;this._init=function(){var F=s_oMain.getMatches();if(null===F)this._extractMatches();else{s_aMatches=[];p=[];for(var E=0;E<F.length;E++){s_aMatches[E]=F[E].opponent;var H=F[E].result;""===H?p.push(["",""]):(H=H.split("-"),p.push(H))}}g=0;y=new createjs.Container;s_oStage.addChild(y);E=createBitmap(s_oSpriteLibrary.getSprite("bg_levelselect"));y.addChild(E);E=s_oSpriteLibrary.getSprite("msg_box");F=createBitmap(E);
F.x=CANVAS_WIDTH_HALF;F.y=CANVAS_HEIGHT_HALF+30;F.regX=.5*E.width;F.regY=.5*E.height;y.addChild(F);(new CTLText(y,CANVAS_WIDTH/2-E.width/2+50,100,E.width-100,50,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_MATCHES,!0,!0,!1,!1)).setShadow("#000000",2,2,4);E=s_oSpriteLibrary.getSprite("but_exit");h=CANVAS_WIDTH-E.height/2-10;k=E.height/2+10;r=new CGfxButton(h,k,E,s_oStage);r.addEventListener(ON_MOUSE_UP,this._onExit,this);m=E.height;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)e=r.getX()-E.width-10,b=
E.height/2+10,t=new CToggle(e,b,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive,s_oStage),t.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);E=window.document;F=E.documentElement;M=F.requestFullscreen||F.mozRequestFullScreen||F.webkitRequestFullScreen||F.msRequestFullscreen;L=E.exitFullscreen||E.mozCancelFullScreen||E.webkitExitFullscreen||E.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(M=!1);M&&screenfull.isEnabled&&(E=s_oSpriteLibrary.getSprite("but_fullscreen"),d=E.width/4+10,c=k,D=new CToggle(d,
c,E,s_bFullscreen,s_oStage),D.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));this._checkBoundLimits();q=[];F=Math.floor((CANVAS_WIDTH+EDGEBOARD_X)/NUM_COLS_PAGE_LEVEL)/2;H=.7*-EDGEBOARD_X;for(E=0;E<NUM_COLS_PAGE_LEVEL;E++)q.push(H),H+=F;u=[];this._createNewLevelPage(0,NUM_MATCHES);if(1<u.length){for(E=1;E<u.length;E++)u[E].visible=!1;l=CANVAS_WIDTH-180;a=CANVAS_HEIGHT_HALF;v=new CGfxButton(l,a,s_oSpriteLibrary.getSprite("arrow_right"),s_oStage);v.addEventListener(ON_MOUSE_UP,this._onRight,
this);f=CANVAS_HEIGHT_HALF;x=new CGfxButton(180,f,s_oSpriteLibrary.getSprite("arrow_left"),s_oStage);x.addEventListener(ON_MOUSE_UP,this._onLeft,this)}A=new createjs.Shape;A.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(A);createjs.Tween.get(A).to({alpha:0},1E3).call(function(){s_oStage.removeChild(A);A=null});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var F=0;F<n.length;F++)n[F].unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)t.unload(),
t=null;M&&screenfull.isEnabled&&D.unload();r.unload();r=null;null!==x&&(x.unload(),v.unload());s_oLevelMenu=null;s_oStage.removeAllChildren()};this.refreshButtonPos=function(){r.setPosition(h-s_iOffsetX,k+s_iOffsetY);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||t.setPosition(e-s_iOffsetX,s_iOffsetY+b);M&&screenfull.isEnabled&&D.setPosition(d+s_iOffsetX,c+s_iOffsetY)};this._extractMatches=function(){s_aMatches=[];p=[];for(var F=4;0<F;){var E=Math.floor(Math.random()*EASY_TEAM.length);EASY_TEAM[E]!==
s_iTeamSelected&&(s_aMatches.push(EASY_TEAM[E]),s_oMain.saveMatch(s_aMatches.length,EASY_TEAM[E],"",0,0),F--,EASY_TEAM.splice(E,1),p.push(["",""]))}for(F=3;0<F;)E=Math.floor(Math.random()*MEDIUM_TEAM.length),MEDIUM_TEAM[E]!==s_iTeamSelected&&(s_aMatches.push(MEDIUM_TEAM[E]),s_oMain.saveMatch(s_aMatches.length,MEDIUM_TEAM[E],"",0,0),F--,MEDIUM_TEAM.splice(E,1),p.push(["",""]));for(F=3;0<F;)E=Math.floor(Math.random()*HARD_TEAM.length),HARD_TEAM[E]!==s_iTeamSelected&&(s_aMatches.push(HARD_TEAM[E]),s_oMain.saveMatch(s_aMatches.length,
HARD_TEAM[E],"",0,0),F--,HARD_TEAM.splice(E,1),p.push(["",""]))};this._checkBoundLimits=function(){for(var F=s_oSpriteLibrary.getSprite("but_level"),E=0,H=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*m,T=0;E<H;)E+=F.height+20,T++;NUM_ROWS_PAGE_LEVEL>T&&(NUM_ROWS_PAGE_LEVEL=T);H=E=0;T=CANVAS_WIDTH-2*EDGEBOARD_X;for(F=s_oSpriteLibrary.getSprite("but_level");H<T;)H+=F.width/2+5,E++;NUM_COLS_PAGE_LEVEL>E&&(NUM_COLS_PAGE_LEVEL=E)};this._createNewLevelPage=function(F,E){var H=new createjs.Container;y.addChild(H);u.push(H);
n=[];for(var T=0,P=50,ia=1,R=!1,ba=s_oSpriteLibrary.getSprite("but_level"),O=F;O<E;O++){var C=new CLevelBut(q[T]+ba.width/2,P+ba.height/2,s_aMatches[O],p[O],O+1,ba,O+1>s_iLastLevel?!1:!0,H);C.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,O+1);n.push(C);T++;if(T===q.length&&(T=0,P+=ba.height+50,ia++,ia>NUM_ROWS_PAGE_LEVEL&&O<E-1)){R=!0;break}}H.x=CANVAS_WIDTH/2+ba.width/2;H.y=CANVAS_HEIGHT/2;H.regX=H.getBounds().width/2;H.regY=H.getBounds().height/2;R&&this._createNewLevelPage(O+
1,E)};this._onRight=function(){u[g].visible=!1;g++;g>=u.length&&(g=0);u[g].visible=!0};this._onLeft=function(){u[g].visible=!1;g--;0>g&&(g=u.length-1);u[g].visible=!0};this._onButLevelRelease=function(F){s_oLevelMenu.unload();s_oMain.gotoGame(F)};this._onAllImagesLoaded=function(){s_oLevelMenu.unload();s_oMain.gotoGame(void 0)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();s_oMain.gotoMenu()};this.resetFullscreenBut=
function(){M&&screenfull.isEnabled&&D.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?L.call(window.document):M.call(window.document.documentElement);sizeHandler()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(d,c,f,l,a,e,b,h){var k,g,m,n=[],q,p,u,r,t,v,x,y;this._init=function(D,M,L,F,E,H,T){g=[];m=[];v=new createjs.Container;v.x=D;v.y=M;A.addChild(v);k=T;r=createBitmap(H);r.mouseEnabled=T;r.regX=H.width/2;r.regY=H.height/2;v.addChild(r);D=s_oSpriteLibrary.getSprite("flag_"+s_iTeamSelected);M=createBitmap(D);M.y=-26;M.regX=D.width/2;M.regY=D.height/2;M.scaleX=M.scaleY=.5;v.addChild(M);D=s_oSpriteLibrary.getSprite("flag_"+L);L=createBitmap(D);L.y=26;L.regX=D.width/2;L.regY=D.height/2;
L.scaleX=L.scaleY=.5;v.addChild(L);(new CTLText(v,-H.width/2,-10,H.width,20,20,"center",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_VS,!0,!0,!1,!1)).setShadow("#000000",2,2,4);p=new createjs.Text(F[0],"30px "+PRIMARY_FONT,TEXT_COLOR);p.x=40;p.y=-20;p.textAlign="center";p.textBaseline="alphabetic";v.addChild(p);u=new createjs.Text(F[1],"30px "+PRIMARY_FONT,TEXT_COLOR);u.x=40;u.y=40;u.textAlign="center";u.textBaseline="alphabetic";v.addChild(u);F=s_oSpriteLibrary.getSprite("but_level_locked");t=createBitmap(F);
t.regX=F.width/2;t.regY=F.height/2;v.addChild(t);q=new CTLText(v,-H.width/2,-86,H.width,24,24,"center",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_MATCH+" "+E,!0,!0,!1,!1);T?(v.cursor="pointer",t.visible=!1):(q.setColor("#b4b4b4"),v.cursor="default");this._initListener()};this.unload=function(){v.off("mousedown",x);v.off("pressup",y);v.removeChild(r)};this._initListener=function(){x=v.on("mousedown",this.buttonDown);y=v.on("pressup",this.buttonRelease)};this.viewBut=function(D){v.addChild(D)};this.addEventListener=
function(D,M,L){g[D]=M;m[D]=L};this.addEventListenerWithParams=function(D,M,L,F){g[D]=M;m[D]=L;n=F};this.ifClickable=function(){return!0===v.mouseEnabled?1:0};this.setActive=function(D){k=D;r.mouseEnabled=!0;k?(t.visible=!1,q.setColor("#69b8d5")):(t.visible=!0,q.setColor("#b4b4b4"))};this.setScore=function(D,M){p.text=D;u.text=M};this.buttonRelease=function(){k&&g[ON_MOUSE_UP]&&g[ON_MOUSE_UP].call(m[ON_MOUSE_UP],n)};this.buttonDown=function(){g[ON_MOUSE_DOWN]&&g[ON_MOUSE_DOWN].call(m[ON_MOUSE_DOWN],
n)};this.setPosition=function(D,M){v.x=D;v.y=M};this.setVisible=function(D){v.visible=D};var A=h;this._init(d,c,f,l,a,e,b,h)}
function CCreditsPanel(){var d,c,f,l,a,e,b,h;this._init=function(){b=new createjs.Container;s_oStage.addChild(b);var k=s_oSpriteLibrary.getSprite("msg_box_small");a=new createjs.Shape;a.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=.5;h=a.on("click",this._onLogoButRelease);a.cursor="pointer";b.addChild(a);c=createBitmap(k);c.x=CANVAS_WIDTH_HALF;c.y=CANVAS_HEIGHT_HALF;c.regX=.5*k.width;c.regY=.5*k.height;b.addChild(c);k=s_oSpriteLibrary.getSprite("but_exit");d=.5*CANVAS_WIDTH+
290;l=new CGfxButton(d,150,k,b);l.addEventListener(ON_MOUSE_UP,this.unload,this);k=s_oSpriteLibrary.getSprite("logo_ctl");f=createBitmap(k);f.regX=k.width/2;f.regY=k.height/2;f.x=CANVAS_WIDTH/2;f.y=CANVAS_HEIGHT/2-50;b.addChild(f);e=new createjs.Text("WWW.CODETHISLAB.COM","30px "+PRIMARY_FONT,"#ffffff");e.textAlign="center";e.textBaseline="alphabetic";e.x=CANVAS_WIDTH/2;e.y=484;b.addChild(e)};this.unload=function(){a.off("click",h);l.unload();l=null;s_oStage.removeChild(b)};this._onLogoButRelease=
function(){};this._init()}
function CSelectTeamMenu(){var d,c,f,l,a,e,b,h,k,g,m=null,n=null,q,p,u,r,t,v=null,x=this;this._init=function(){p=new createjs.Container;s_oStage.addChild(p);var y=createBitmap(s_oSpriteLibrary.getSprite("bg_levelselect"));p.addChild(y);y=new createjs.Shape;y.graphics.beginFill("#000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);y.alpha=.5;p.addChild(y);u=new createjs.Container;p.addChild(u);y=s_oSpriteLibrary.getSprite("msg_box");var A=createBitmap(y);A.x=CANVAS_WIDTH_HALF;A.y=CANVAS_HEIGHT_HALF+30;
A.regX=.5*y.width;A.regY=.5*y.height;u.addChild(A);(new CTLText(u,CANVAS_WIDTH/2-y.width/2,40,y.width,50,50,"center",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_SELECT_TEAM,!0,!0,!1,!1)).setShadow("#000000",2,2,4);r=new CTLText(p,CANVAS_WIDTH/2-y.width/2+50,CANVAS_HEIGHT_HALF-70,y.width-100,140,70,"center",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_WAIT_OPPONENT,!0,!0,!0,!1);r.setShadow("#000000",2,2,4);q=new createjs.Container;q.x=CANVAS_WIDTH_HALF+50;q.y=CANVAS_HEIGHT_HALF+33;u.addChild(q);b=[];y=4;A=45;for(var D=
0;D<NUM_TEAMS;D++){var M=new CButTeam(y,A,D,q);M.addEventListener(ON_MOUSE_UP,this._onSelectFlag,this);b[D]=M;0<D&&0===(D+1)%8?(y=4,A+=120):y+=108}q.regX=q.getBounds().width/2;q.regY=q.getBounds().height/2;y=s_oSpriteLibrary.getSprite("but_exit");a=CANVAS_WIDTH-y.height/2-10;e=y.height/2+10;h=new CGfxButton(a,e,y,s_oStage);h.addEventListener(ON_MOUSE_UP,this._onExit,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)f=h.getX()-y.width-10,l=y.height/2+10,k=new CToggle(f,l,s_oSpriteLibrary.getSprite("audio_icon"),
s_bAudioActive,s_oStage),k.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);y=window.document;A=y.documentElement;m=A.requestFullscreen||A.mozRequestFullScreen||A.webkitRequestFullScreen||A.msRequestFullscreen;n=y.exitFullscreen||y.mozCancelFullScreen||y.webkitExitFullscreen||y.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(m=!1);m&&screenfull.isEnabled&&(y=s_oSpriteLibrary.getSprite("but_fullscreen"),d=y.width/4+10,c=e,g=new CToggle(d,c,y,s_bFullscreen,s_oStage),g.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,
this));t=new CMoveTimeController(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,s_oStage,TIME_PER_SELECTION_TEAM);t.addEventListener(ON_TIMER_END,this._onTimerEnd,this);s_bMultiplayer?(s_oNetworkManager.isUserA()||s_bPlayWithBot?(r.setVisible(!1),t.startTimer()):u.visible=!1,s_bPlayWithBot||s_oNetworkManager.addEventListener(ON_DISCONNECTION,this.playerDisconnectedFromGame)):r.setVisible(!1);this.refreshButtonPos()};this.unload=function(){for(var y=0;y<b.length;y++)b[y].unload();if(!1===DISABLE_SOUND_MOBILE||!1===
s_bMobile)k.unload(),k=null;m&&screenfull.isEnabled&&g.unload();h.unload();h=null;t.unload();s_oStage.removeAllChildren();s_oSelectMenu=null};this._onTimerEnd=function(){do var y=Math.floor(Math.random()*NUM_TEAMS);while(y===v);s_oSelectMenu._onSelectFlag(y)};this.playerDisconnectedFromGame=function(){u.visible=!1;r.setVisible(!0);r.refreshText(TEXT_OPPONENT_LEFT);t.stopTimer()};this.opponentLeaveTheGame=function(){u.visible=!1;r.setVisible(!0);r.refreshText(TEXT_OPPONENT_LEFT);t.stopTimer()};this.refreshButtonPos=
function(){h.setPosition(a-s_iOffsetX,e+s_iOffsetY);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||k.setPosition(f-s_iOffsetX,s_iOffsetY+l);m&&screenfull.isEnabled&&g.setPosition(d+s_iOffsetX,c+s_iOffsetY);t.setPos(CANVAS_WIDTH-60-s_iOffsetX,CANVAS_HEIGHT-60-s_iOffsetY)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){this.unload();s_oMain.gotoMenu();s_oNetworkManager.disconnect()};this.resetFullscreenBut=function(){m&&screenfull.isEnabled&&
g.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?n.call(window.document):m.call(window.document.documentElement);sizeHandler()};this._onSelectFlag=function(y){if(s_bMultiplayer)if(s_iTeamSelected=y,t.stopTimer(),u.visible=!1,r.setVisible(!0),s_bPlayWithBot)setTimeout(function(){s_oSelectMenu.onGameStart([y])},1E3+1E3*Math.random());else{var A={iTeamIndex:y,playerID:s_oNetworkManager.getPlayerOrderID()};s_oNetworkManager.sendMsg(MSG_TEAM_SELECTED,JSON.stringify(A))}else x.unload(),
s_oMain.saveTeam(y),s_oMain.gotoLevelPanel()};this.gotoTeamSelect=function(y){v=y;t.startTimer();b[y].block(!0);b[y].setAlpha(.3);u.visible=!0;r.setVisible(!1)};this.onGameStart=function(y){this.unload();s_aMatches=[];if(s_bPlayWithBot){do y=Math.floor(Math.random()*NUM_TEAMS);while(y===s_iTeamSelected);var A=5+Math.floor(4*Math.random());s_aMatches[A-1]=y;s_oMain.gotoGameWithBot(A)}else s_oNetworkManager.isUserA()?s_aMatches.push(y[1]):s_aMatches.push(y[0]),s_oMain.gotoGameMulti()};s_oSelectMenu=
this;this._init()}var s_oSelectMenu=null;
function CButTeam(d,c,f,l){var a,e,b,h,k,g,m,n,q,p=!1;this._init=function(u,r,t){a=t;e=[];b=[];g=[];n=m=1;k=new createjs.Container;k.x=u;k.y=r;l.addChild(k);u=s_oSpriteLibrary.getSprite("flag_"+t);k.regX=u.width/2;k.regY=u.height/2;k.scaleX=m;k.scaleY=n;k.cursor="pointer";h=createBitmap(u);k.addChild(h);this._initListener()};this.unload=function(){k.off("mousedown",q[0]);k.off("pressup",q[1]);!1===s_bMobile&&(k.off("mouseover",q[2]),k.off("mouseout",q[3]));l.removeChild(k)};this.setVisible=function(u){k.visible=
u};this._initListener=function(){q=[];q[0]=k.on("mousedown",this.buttonDown);q[1]=k.on("pressup",this.buttonRelease);!1===s_bMobile&&(q[2]=k.on("mouseover",this.buttonOver),q[3]=k.on("mouseout",this.buttonOut))};this.addEventListener=function(u,r,t){e[u]=r;b[u]=t};this.buttonRelease=function(){p||(playSound("click",1,!1),e[ON_MOUSE_UP]&&e[ON_MOUSE_UP].call(b[ON_MOUSE_UP],a))};this.buttonDown=function(){p||e[ON_MOUSE_DOWN]&&e[ON_MOUSE_DOWN].call(b[ON_MOUSE_DOWN],g[ON_MOUSE_DOWN])};this.buttonOver=
function(){p||createjs.Tween.get(k).to({scaleX:1.1,scaleY:1.1},300,createjs.Ease.quartOut)};this.buttonOut=function(){p||createjs.Tween.get(k).to({scaleX:m,scaleY:n},300,createjs.Ease.quartOut)};this.block=function(u){p=u;k.scaleX=m;k.scaleY=n;k.cursor=u?"default":"pointer"};this.setAlpha=function(u){k.alpha=u};this._init(d,c,f)}
var TEAM_LABEL=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],TEAM_INFO=[{goalkeeper:0,player:0,opponent:0},{goalkeeper:0,player:1,opponent:1},{goalkeeper:0,player:2,opponent:2},{goalkeeper:0,player:3,opponent:3},{goalkeeper:0,player:4,opponent:4},{goalkeeper:0,player:5,opponent:5},{goalkeeper:0,player:6,opponent:6},{goalkeeper:0,player:7,opponent:7},{goalkeeper:0,player:8,opponent:8},{goalkeeper:0,player:9,opponent:9},{goalkeeper:0,player:10,opponent:10},
{goalkeeper:0,player:11,opponent:11},{goalkeeper:0,player:12,opponent:12},{goalkeeper:0,player:13,opponent:13},{goalkeeper:0,player:14,opponent:14},{goalkeeper:0,player:15,opponent:15},{goalkeeper:0,player:16,opponent:16},{goalkeeper:0,player:17,opponent:17},{goalkeeper:0,player:18,opponent:18},{goalkeeper:0,player:19,opponent:19},{goalkeeper:0,player:20,opponent:20},{goalkeeper:0,player:21,opponent:21},{goalkeeper:0,player:22,opponent:22},{goalkeeper:0,player:23,opponent:23},{goalkeeper:0,player:24,
opponent:24},{goalkeeper:0,player:25,opponent:25},{goalkeeper:0,player:26,opponent:26},{goalkeeper:0,player:27,opponent:27},{goalkeeper:0,player:28,opponent:28},{goalkeeper:0,player:29,opponent:29},{goalkeeper:0,player:30,opponent:30},{goalkeeper:0,player:31,opponent:31}],NUM_TEAMS=TEAM_INFO.length,EASY_TEAM=[8,10,11,17,18,19,20,21,23,29,30,31],MEDIUM_TEAM=[1,7,12,13,14,16,22,24,25,26,27,28],HARD_TEAM=[0,2,3,4,5,6,9,15];
function CKickIcon(d,c,f,l){var a;this._init=function(e,b,h){var k=h.getFrameBounds(0).width/3,g=h.getFrameBounds(0).height;a=createSprite(h,"empty",k/2,g/2,k,g);a.x=e;a.y=b;l.addChild(a)};this.changeState=function(e){a.gotoAndStop(e)};this.setVisible=function(e){a.visible=e};this._init(d,c,f)}
function CVersusPanel(d){var c,f,l,a,e,b,h,k=this;this._init=function(){h=new createjs.Container;h.visible=!1;d.addChild(h);f=new createjs.Shape;f.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.alpha=.5;c=f.on("click",function(){});h.addChild(f);var g=s_oSpriteLibrary.getSprite("msg_box_small"),m=createBitmap(g);m.x=CANVAS_WIDTH_HALF;m.y=CANVAS_HEIGHT_HALF;m.regX=g.width/2;m.regY=g.height/2;h.addChild(m);m=s_oSpriteLibrary.getSprite("flag_"+s_iTeamSelected);l=createBitmap(m);
l.y=CANVAS_HEIGHT_HALF-6;h.addChild(l);m=s_oSpriteLibrary.getSprite("flag_0");a=createBitmap(m);a.y=CANVAS_HEIGHT_HALF-6;h.addChild(a);e=new CTLText(h,CANVAS_WIDTH_HALF-70,CANVAS_HEIGHT_HALF,140,82,82,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_VS,!0,!0,!1,!1);b=new CTLText(h,CANVAS_WIDTH_HALF-g.width/2+10,CANVAS_HEIGHT_HALF-100,g.width-20,82,82,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_MATCH,!0,!0,!1,!1)};this.unload=function(){f.off("click",c)};this.show=function(g,m){b.refreshText(TEXT_MATCH+" "+m);
a.image=s_oSpriteLibrary.getSprite("flag_"+g);l.x=-200;a.x=CANVAS_WIDTH+200;e.setAlpha(0);h.alpha=0;h.visible=!0;createjs.Tween.get(h).to({alpha:1},500,createjs.Ease.cubicOut).call(function(){k.playAnims()})};this.hide=function(){s_oInterface.onExitVersusPanel();createjs.Tween.get(h).to({alpha:0},500,createjs.Ease.quartOut).call(function(){h.visible=!1})};this.playAnims=function(){createjs.Tween.get(l).to({x:CANVAS_WIDTH_HALF-176},300,createjs.Ease.cubicOut);createjs.Tween.get(a).to({x:CANVAS_WIDTH_HALF+
80},300,createjs.Ease.cubicOut);createjs.Tween.get(e.getContainer()).wait(300).to({alpha:1},200,createjs.Ease.cubicOut).call(function(){setTimeout(function(){k.hide()},2500)})};this._init()}
function CMsgBox(d,c){var f,l;this._init=function(b){l=new createjs.Container;e.addChild(l);b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.5;b.on("click",function(){});l.addChild(b);b=s_oSpriteLibrary.getSprite("msg_box_small");var h=createBitmap(b);h.x=.5*CANVAS_WIDTH;h.y=.5*CANVAS_HEIGHT;h.regX=.5*b.width;h.regY=.5*b.height;l.addChild(h);new CTLText(l,CANVAS_WIDTH/2-b.width/2+50,CANVAS_HEIGHT/2-150,b.width-100,132,22,"center","#fff",PRIMARY_FONT,
1,0,0,TEXT_ERR_LS,!0,!0,!0,!1);f=new CGfxButton(CANVAS_WIDTH/2,410,s_oSpriteLibrary.getSprite("but_yes"),l);f.addEventListener(ON_MOUSE_UP,this._onButOk,this)};this._onButOk=function(){a.unload()};this.unload=function(){f.unload();e.removeChild(l)};var a=this;var e=c;this._init(d)}
function CWaitingPanel(d){var c,f,l,a,e,b,h;this._init=function(k){l=new createjs.Container;k.addChild(l);k=(new createjs.Graphics).beginFill("rgba(0,0,0,0.5)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a=new createjs.Shape(k);h=a.on("click",function(){});l.addChild(a);e=new CTLText(l,200,CANVAS_HEIGHT_HALF+100,CANVAS_WIDTH-400,42,42,"center",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_WAIT_STRIKER,!0,!0,!1,!1);e.setStroke(OUTLINE_WIDTH,"#003470");b=new CTLText(l,200,CANVAS_HEIGHT_HALF+150,CANVAS_WIDTH-400,
42,42,"center",TEXT_COLOR,PRIMARY_FONT,1,0,0,TEXT_GET_READY,!0,!0,!1,!1);b.setStroke(OUTLINE_WIDTH,"#003470");l.alpha=0};this.hide=function(){l.alpha=0};this.show=function(){l.alpha=1};this.hideGoalkeeperWaiting=function(){createjs.Tween.get(l).to({alpha:0},1E3).call(function(){clearInterval(f)})};this.showGoalkeeperWaiting=function(){this.show();c=0;b.setVisible(!0);e.refreshText(TEXT_WAIT_STRIKER);e.setX(.5*CANVAS_WIDTH-e.getWidth()/2);var k=this;f=setInterval(function(){k._updateGoalkeeperWaitingText()},
FPS)};this._updateGoalkeeperWaitingText=function(){c+=s_iTimeElaps;0<=c&&c<TIME_LOOP_WAIT/4?e.refreshText(TEXT_WAIT_STRIKER):c>=TIME_LOOP_WAIT/4&&c<2*TIME_LOOP_WAIT/4?e.refreshText(TEXT_WAIT_STRIKER+"."):c>=2*TIME_LOOP_WAIT/4&&c<3*TIME_LOOP_WAIT/4?e.refreshText(TEXT_WAIT_STRIKER+".."):c>=3*TIME_LOOP_WAIT/4&&c<TIME_LOOP_WAIT?e.refreshText(TEXT_WAIT_STRIKER+"..."):c=0};this.showStrikerWaiting=function(){b.setVisible(!1);e.refreshText(TEXT_WAIT_GOALKEEPER);e.setX(.5*CANVAS_WIDTH-e.getWidth()/2);createjs.Tween.get(l).to({alpha:1},
1E3)};this.hideStrikerWaiting=function(){createjs.Tween.get(l).to({alpha:0},1E3).call(function(){clearInterval(f)})};this.unload=function(){d.removeChild(l);a.off("click",h)};this._init(d)}
function CTrajectory(d){var c,f,l,a,e,b;this._init=function(h){b=new createjs.Container;b.visible=!1;h.addChild(b);c=STRIKER_START_BALL_POS.x-48;f=STRIKER_START_BALL_POS.y-13;e=[];for(h=0;10>h;h++){var k=new createjs.Shape;k.graphics.beginFill("rgba(255,255,255,1)").drawCircle(0,0,90);b.addChild(k);e.push(k);e[h].x=c;e[h].y=f;e[h].scaleX=e[h].scaleY=.65-.05*h;e[h].alpha=.5}};this.setTrajectory=function(h){var k=s_oGameStriker.predictBallGoalPos(h);h=(k.x+CANVAS_WIDTH/2-c)/(e.length-1);k=(k.y+CANVAS_HEIGHT/
2-156-f)/(e.length-1);for(var g=0;g<e.length;g++)e[g].x=c+g*h,e[g].y=f+g*k;l=0;a=100;b.visible=!0};this.update=function(){if(b.visible){a-=s_iTimeElaps;0>=a&&(l++,l===e.length?(l=0,a=100):a=l===e.length-1?2E3:100);for(var h=0;h<e.length;h++)e[h].alpha=.3;e[l].alpha=.9}};this.hide=function(){b.visible=!1};this._init(d)}var FORBIDDEN_LIST="2 girls 1 cup;2g1c;4r5e;5h1t;5hit;a_s_s;a55;a55hole;acrotomophilia;aeolus;ahole;alabama hot pocket;alaskan pipeline;anal;analprobe;anilingus;anus;apeshit;ar5e;areola;areole;arian;arrse;arse;arsehole;aryan;ass;ass hole;assbag;assbandit;assbang;assbanged;assbanger;assbangs;assbite;assclown;asscock;asscracker;asses;assface;assfuck;assfucker;ass-fucker;assfukka;assgoblin;assh0le;asshat;ass-hat;asshead;assho1e;asshole;assholes;asshopper;ass-jabber;assjacker;asslick;asslicker;assmaster;assmonkey;assmunch;assmuncher;assnigger;asspirate;ass-pirate;assshit;assshole;asssucker;asswad;asswhole;asswipe;asswipes;auto erotic;autoerotic;axwound;azazel;azz;b!tch;b00bs;b17ch;b1tch;babe;babeland;babes;baby batter;baby juice;ball gag;ball gravy;ball kicking;ball licking;ball sack;ball sucking;ballbag;balls;ballsack;bampot;bang;bangbros;banger;bareback;barely legal;barenaked;barf;bastard;bastardo;bastards;bastinado;bawdy;bbw;bdsm;beaner;beaners;beardedclam;beastial;beastiality;beatch;beater;beaver;beaver cleaver;beaver lips;beer;beeyotch;bellend;beotch;bestial;bestiality;bi+ch;biatch;big black;big breasts;big knockers;big tits;bigtits;bimbo;bimbos;birdlock;bitch;bitchass;bitched;bitcher;bitchers;bitches;bitchin;bitching;bitchtits;bitchy;black cock;blonde action;blonde on blonde action;bloody;blow;blow job;blow your load;blowjob;blowjobs;blue waffle;blumpkin;bod;bodily;boink;boiolas;bollock;bollocks;bollok;bollox;bondage;bone;boned;boner;boners;bong;boob;boobies;boobs;booby;booger;bookie;booobs;boooobs;booooobs;booooooobs;bootee;bootie;booty;booty call;booze;boozer;boozy;bosom;bosomy;bowel;bowels;bra;brassiere;breast;breasts;breeder;brotherfucker;brown showers;brunette action;buceta;bugger;bukkake;bull shit;bulldyke;bullet vibe;bullshit;bullshits;bullshitted;bullturds;bum;bumblefuck;bung;bung hole;bunghole;bunny fucker;busty;butt;butt fuck;butt plug;buttcheeks;buttfuck;buttfucka;buttfucker;butthole;buttmuch;butt-pirate;buttplug;c.0.c.k;c.o.c.k.;c.u.n.t;c0ck;c-0-c-k;c0cksucker;caca;cahone;camel toe;cameltoe;camgirl;camslut;camwhore;carpet muncher;carpetmuncher;cawk;cervix;chesticle;chinc;chincs;chink;choad;chocolate rosebuds;chode;chodes;cipa;circlejerk;cl1t;cleveland steamer;climax;clit;clitface;clitfuck;clitoris;clitorus;clits;clitty;clover clamps;clusterfuck;cnut;cocain;cocaine;cock;c-o-c-k;cock sucker;cockass;cockbite;cockblock;cockburger;cockeye;cockface;cockfucker;cockhead;cockholster;cockjockey;cockknocker;cockknoker;cocklump;cockmaster;cockmongler;cockmongruel;cockmonkey;cockmunch;cockmuncher;cocknose;cocknugget;cocks;cockshit;cocksmith;cocksmoke;cocksmoker;cocksniffer;cocksuck;cocksucked;cocksucker;cock-sucker;cocksucking;cocksucks;cocksuka;cocksukka;cockwaffle;coital;cok;cokmuncher;coksucka;commie;condom;coochie;coochy;coon;coons;cooter;coprolagnia;coprophilia;corksucker;cornhole;cox;crabs;crack;cracker;crackwhore;crap;crappy;creampie;crotte;cum;cumbubble;cumdumpster;cumguzzler;cumjockey;cummer;cummin;cumming;cums;cumshot;cumshots;cumslut;cumstain;cumtart;cunilingus;cunillingus;cunnie;cunnilingus;cunny;cunt;c-u-n-t;cuntass;cuntface;cunthole;cunthunter;cuntlick;cuntlicker;cuntlicking;cuntrag;cunts;cuntslut;cyalis;cyberfuc;cyberfuck;cyberfucked;cyberfucker;cyberfuckers;cyberfucking;d0ng;d0uch3;d0uche;d1ck;d1ld0;d1ldo;dago;dagos;dammit;damn;damned;damnit;darkie;date rape;daterape;dawgie-style;deep throat;deepthroat;deggo;dendrophilia;dick;dickbag;dickbeaters;dickdipper;dickface;dickflipper;dickfuck;dickfucker;dickhead;dickheads;dickhole;dickish;dick-ish;dickjuice;dickmilk\ufffd;dickmonger;dickripper;dicks;dicksipper;dickslap;dick-sneeze;dicksucker;dicksucking;dicktickler;dickwad;dickweasel;dickweed;dickwhipper;dickwod;dickzipper;diddle;dike;dildo;dildos;diligaf;dillweed;dimwit;dingle;dingleberries;dingleberry;dink;dinks;dipship;dipshit;dirsa;dirty pillows;dirty sanchez;dlck;dog style;dog-fucker;doggie style;doggiestyle;doggie-style;doggin;dogging;doggy style;doggystyle;doggy-style;dolcett;domination;dominatrix;dommes;dong;donkey punch;donkeyribber;doochbag;doofus;dookie;doosh;dopey;double dong;double penetration;doublelift;douch3;douche;douchebag;douchebags;douche-fag;douchewaffle;douchey;dp action;drunk;dry hump;duche;dumass;dumb ass;dumbass;dumbasses;dumbcunt;dumbfuck;dumbshit;dummy;dumshit;dvda;dyke;dykes;eat my ass;ecchi;ejaculate;ejaculated;ejaculates;ejaculating;ejaculatings;ejaculation;ejakulate;enlargement;erect;erection;erotic;erotism;escort;essohbee;eunuch;extacy;extasy;f u c k;f u c k e r;f.u.c.k;f_u_c_k;f4nny;fack;fag;fagbag;fagfucker;fagg;fagged;fagging;faggit;faggitt;faggot;faggotcock;faggs;fagot;fagots;fags;fagtard;faig;faigt;fanny;fannybandit;fannyflaps;fannyfucker;fanyy;fart;fartknocker;fat;fatass;fcuk;fcuker;fcuking;fecal;feck;fecker;felch;felcher;felching;fellate;fellatio;feltch;feltcher;female squirting;femdom;figging;fingerbang;fingerfuck;fingerfucked;fingerfucker;fingerfuckers;fingerfucking;fingerfucks;fingering;fisted;fistfuck;fistfucked;fistfucker;fistfuckers;fistfucking;fistfuckings;fistfucks;fisting;fisty;flamer;flange;floozy;foad;foah;fondle;foobar;fook;fooker;foot fetish;footjob;foreskin;freex;frigg;frigga;frotting;fubar;fuck;f-u-c-k;fuck buttons;fuck off;fucka;fuckass;fuckbag;fuckboy;fuckbrain;fuckbutt;fuckbutter;fucked;fucker;fuckers;fuckersucker;fuckface;fuckhead;fuckheads;fuckhole;fuckin;fucking;fuckings;fuckingshitmotherfucker;fuckme;fucknugget;fucknut;fucknutt;fuckoff;fucks;fuckstick;fucktard;fuck-tard;fucktards;fucktart;fucktwat;fuckup;fuckwad;fuckwhit;fuckwit;fuckwitt;fudge packer;fudgepacker;fuk;fuker;fukker;fukkin;fuks;fukwhit;fukwit;futanari;fux;fux0r;fvck;fxck;gae;gai;gang bang;gangbang;gangbanged;gangbangs;ganja;gay;gay sex;gayass;gaybob;gaydo;gayfuck;gayfuckist;gaylord;gays;gaysex;gaytard;gaywad;genitals;gey;gfy;ghay;ghey;giant cock;gigolo;girl on;girl on top;girls gone wild;glans;goatcx;goatse;god damn;godamn;godamnit;goddam;god-dam;goddammit;goddamn;goddamned;god-damned;goddamnit;gokkun;golden shower;goldenshower;gonad;gonads;goo girl;gooch;goodpoop;gook;gooks;goregasm;gringo;grope;group sex;gspot;g-spot;gtfo;guido;guro;h0m0;h0mo;hand job;handjob;hard core;hard on;hardcore;hardcoresex;he11;hebe;heeb;hell;hemp;hentai;heroin;herp;herpes;herpy;heshe;hitler;hiv;ho;hoar;hoare;hobag;hoe;hoer;hom0;homey;homo;homodumbshit;homoerotic;homoey;honkey;honky;hooch;hookah;hooker;hoor;hootch;hooter;hooters;hore;horniest;horny;hot carl;hot chick;hotsex;how to kill;how to murder;huge fat;hump;humped;humping;hussy;hymen;inbred;incest;injun;intercourse;j3rk0ff;jack Off;jackass;jackhole;jackoff;jack-off;jaggi;jagoff;jail bait;jailbait;jap;japs;jelly donut;jerk;jerk off;jerk0ff;jerkass;jerked;jerkoff;jerk-off;jigaboo;jiggaboo;jiggerboo;jism;jiz;jizm;jizz;jizzed;juggs;jungle bunny;junglebunny;junkie;junky;kawk;kike;kikes;kill;kinbaku;kinkster;kinky;kkk;klan;knob;knobbing;knobead;knobed;knobend;knobhead;knobjocky;knobjokey;kock;kondum;kondums;kooch;kooches;kootch;kraut;kum;kummer;kumming;kums;kunilingus;kunja;kunt;kyke;l3i+ch;l3itch;labia;lameass;lardass;leather restraint;leather straight jacket;lech;lemon party;leper;lesbian;lesbians;lesbo;lesbos;lez;lezbian;lezbians;lezbo;lezbos;lezzie;lezzies;lezzy;lmao;lmfao;loin;loins;lolita;lovemaking;lube;lust;lusting;lusty;m0f0;m0fo;m45terbate;ma5terb8;ma5terbate;make me come;male squirting;mams;masochist;massa;masterb8;masterbat;masterbat3;masterbate;master-bate;masterbating;masterbation;masterbations;masturbate;masturbating;masturbation;maxi;mcfagget;menage a trois;menses;menstruate;menstruation;meth;m-fucking;mick;milf;minge;missionary position;mof0;mofo;mo-fo;molest;moolie;moron;mothafuck;mothafucka;mothafuckas;mothafuckaz;mothafucked;mothafucker;mothafuckers;mothafuckin;mothafucking;mothafuckings;mothafucks;mother fucker;motherfuck;motherfucka;motherfucked;motherfucker;motherfuckers;motherfuckin;motherfucking;motherfuckings;motherfuckka;motherfucks;mound of venus;mr hands;mtherfucker;mthrfucker;mthrfucking;muff;muff diver;muffdiver;muffdiving;munging;murder;mutha;muthafecker;muthafuckaz;muthafucker;muthafuckker;muther;mutherfucker;mutherfucking;muthrfucking;n1gga;n1gger;nad;nads;naked;nambla;napalm;nappy;nawashi;nazi;nazism;negro;neonazi;nig nog;nigaboo;nigg3r;nigg4h;nigga;niggah;niggas;niggaz;nigger;niggers;niggle;niglet;nimphomania;nimrod;ninny;nipple;nipples;nob;nob jokey;nobhead;nobjocky;nobjokey;nooky;nsfw images;nude;nudity;numbnuts;nut sack;nutsack;nympho;nymphomania;octopussy;omorashi;one cup two girls;one guy one jar;opiate;opium;oral;orally;organ;orgasim;orgasims;orgasm;orgasmic;orgasms;orgies;orgy;ovary;ovum;ovums;p.u.s.s.y.;p0rn;paddy;paedophile;paki;panooch;pantie;panties;panty;pastie;pasty;pawn;pcp;pecker;peckerhead;pedo;pedobear;pedophile;pedophilia;pedophiliac;pee;peepee;pegging;penetrate;penetration;penial;penile;penis;penisbanger;penisfucker;penispuffer;perversion;peyote;phalli;phallic;phone sex;phonesex;phuck;phuk;phuked;phuking;phukked;phukking;phuks;phuq;piece of shit;pigfucker;pillowbiter;pimp;pimpis;pinko;piss;piss pig;pissed;pissed off;pisser;pissers;pisses;pissflaps;pissin;pissing;pissoff;piss-off;pisspig;playboy;pleasure chest;pms;polack;pole smoker;polesmoker;pollock;ponyplay;poof;poon;poonani;poonany;poontang;poop;poop chute;poopchute;poopuncher;porch monkey;porchmonkey;porn;porno;pornography;pornos;pot;potty;prick;pricks;prig;prince albert piercing;pron;prostitute;prude;pthc;pube;pubes;pubic;pubis;punanny;punany;punkass;punky;punta;puss;pusse;pussi;pussies;pussy;pussylicking;pussypounder;pussys;pust;puto;queaf;queef;queer;queerbait;queerhole;queero;queers;quicky;quim;racy;raghead;raging boner;rape;raped;raper;raping;rapist;raunch;rectal;rectum;rectus;reefer;reetard;reich;renob;retard;retarded;reverse cowgirl;revue;rimjaw;rimjob;rimming;ritard;rosy palm;rosy palm and her 5 sisters;rtard;r-tard;rum;rump;rumprammer;ruski;rusty trombone;s hit;s&m;s.h.i.t.;s.o.b.;s_h_i_t;s0b;sadism;sadist;sand nigger;sandler;sandnigger;sanger;santorum;scag;scantily;scat;schizo;schlong;scissoring;screw;screwed;screwing;scroat;scrog;scrot;scrote;scrotum;scrud;scum;seaman;seamen;seduce;seks;semen;sex;sexo;sexual;sexy;sh!+;sh!t;sh1t;s-h-1-t;shag;shagger;shaggin;shagging;shamedame;shaved beaver;shaved pussy;shemale;shi+;shibari;shit;s-h-i-t;shitass;shitbag;shitbagger;shitblimp;shitbrains;shitbreath;shitcanned;shitcunt;shitdick;shite;shiteater;shited;shitey;shitface;shitfaced;shitfuck;shitfull;shithead;shithole;shithouse;shiting;shitings;shits;shitspitter;shitstain;shitt;shitted;shitter;shitters;shittiest;shitting;shittings;shitty;shiz;shiznit;shota;shrimping;sissy;skag;skank;skeet;skullfuck;slag;slanteye;slave;sleaze;sleazy;slut;slutbag;slutdumper;slutkiss;sluts;smeg;smegma;smut;smutty;snatch;sniper;snowballing;snuff;s-o-b;sodom;sodomize;sodomy;son-of-a-bitch;souse;soused;spac;sperm;spic;spick;spik;spiks;splooge;splooge moose;spooge;spook;spread legs;spunk;steamy;stfu;stiffy;stoned;strap on;strapon;strappado;strip;strip club;stroke;stupid;style doggy;suck;suckass;sucked;sucking;sucks;suicide girls;sultry women;sumofabiatch;swastika;swinger;t1t;t1tt1e5;t1tties;tainted love;tampon;tard;taste my;tawdry;tea bagging;teabagging;teat;teets;teez;terd;teste;testee;testes;testical;testicle;testis;threesome;throating;thrust;thug;thundercunt;tied up;tight white;tinkle;tit;titfuck;titi;tits;titt;tittie5;tittiefucker;titties;titty;tittyfuck;tittyfucker;tittywank;titwank;toke;tongue in a;toots;topless;tosser;towelhead;tramp;tranny;transsexual;trashy;tribadism;tub girl;tubgirl;turd;tush;tushy;tw4t;twat;twathead;twatlips;twats;twatty;twatwaffle;twink;twinkie;two girls one cup;twunt;twunter;ugly;unclefucker;undies;undressing;unwed;upskirt;urethra play;urinal;urine;urophilia;uterus;uzi;v14gra;v1gra;vag;vagina;vajayjay;va-j-j;valium;venus mound;viagra;vibrator;violet wand;virgin;vixen;vjayjay;vodka;vomit;vorarephilia;voyeur;vulgar;vulva;w00se;wad;wang;wank;wanker;wankjob;wanky;wazoo;wedgie;weed;weenie;weewee;weiner;weirdo;wench;wet dream;wetback;wh0re;wh0reface;white power;whitey;whiz;whoar;whoralicious;whore;whorealicious;whorebag;whored;whoreface;whorehopper;whorehouse;whores;whoring;wigger;willies;willy;womb;woody;wop;wrapping men;wrinkled starfish;wtf;xrated;x-rated;xx;xxx;yaoi;yeasty;yellow showers;yiffy;yobbo;zoophile;zoophilia;zubb".split(";");
function CMoveTimeController(d,c,f,l){var a,e,b,h,k,g,m,n;this._init=function(){a=[];e=[];h=l;b=null;m=new createjs.Container;f.addChild(m);n=new CRadialWipeWidget(d,c,m);console.log("_iTimerTime:"+h)};this.unload=function(){f.removeChild(m);this.stopTimer()};this.setPos=function(p,u){n.setPos(p,u)};this.setScale=function(p){n.setScale(p)};this.setSpectatorMode=function(){n.removeHurryUpMode()};this.addEventListener=function(p,u,r){a[p]=u;e[p]=r};this.restartEndGameCounter=function(){h=l};this.startTimer=
function(){n.setHurryUpMode(TIME_HURRYUP_WARNING);g=k=h;null===b&&(b=setInterval(function(){q.update();m.visible=!0},1E3/FPS))};this.stopTimer=function(){m.visible=!1;n.reset();clearInterval(b);b=null};this._onTimerEnd=function(){var p=ON_TIMER_END;a[p]&&a[p].call(e[p])};this.update=function(){g-=s_iTimeElaps;0>g&&(g=0,this.stopTimer(),this._onTimerEnd());n.update(g,k)};this._init();var q=this}
function CBallStriker(d,c,f,l,a){var e,b,h,k=null,g=FOV*BALL_RADIUS,m=0,n=0;this._init=function(u,r,t){h=new createjs.Container;p.addChild(h);var v=new createjs.SpriteSheet({images:[t],frames:{width:t.width/7,height:t.height,regX:t.width/2/7,regY:t.height/2}});e=createSprite(v,0,t.width/2/7,t.height/2,t.width/7,t.height/2);e.stop();this.scale(g);t=s_oSpriteLibrary.getSprite("ball_shadow");b=createBitmap(t);b.x=u;b.y=r;b.regX=.5*t.width;b.regY=.5*t.height;this.scaleShadow(g);h.addChild(b,e)};this.rolls=
function(){e.rotation=Math.degrees(Math.sin(-(.15*q.velocity.x)));var u=Math.abs(q.angularVelocity.x),r=this._goToPrevFrame;0>q.angularVelocity.x&&(r=this._goToNextFrame);7<u?r():3<u?(m++,m>2/ROLL_BALL_RATE&&(r(),m=0)):1<u?(m++,m>3/ROLL_BALL_RATE&&(r(),m=0)):u>MIN_BALL_VEL_ROTATION&&(m++,m>4/ROLL_BALL_RATE&&(r(),m=0))};this._goToPrevFrame=function(){0===n?n=6:n--;e.gotoAndStop(n)};this._goToNextFrame=function(){7===n?n=1:n++;e.gotoAndStop(n)};this.unload=function(){e.removeAllEventListeners();p.removeChild(e)};
this.setVisible=function(u){h.visible=u};this.getStartScale=function(){return g};this.startPosShadowY=function(u){k=u};this.getStartShadowYPos=function(){return k};this.fadeAnimation=function(u,r,t){this.tweenFade(u,r,t)};this.tweenFade=function(u,r,t){createjs.Tween.get(h,{override:!0}).wait(t).to({alpha:u},r).call(function(){})};this.setPositionShadow=function(u,r){b.x=u;b.y=r};this.setPosition=function(u,r){e.x=u;e.y=r};this.getPhysics=function(){return q};this.setAngle=function(u){e.rotation=
u};this.getX=function(){return e.x};this.getY=function(){return e.y};this.getStartScale=function(){return g};this.scale=function(u){e.scaleX=u;e.scaleY=u};this.scaleShadow=function(u){.08<u?(b.scaleX=u,b.scaleY=u):(b.scaleX=.08,b.scaleY=.08)};this.setAlphaByHeight=function(u){b.alpha=u};this.getScale=function(){return e.scaleX};this.getObject=function(){return h};this.getDepthPos=function(){return q.position.y};var q=l;var p=a;this._init(d,c,f);return this}
var CGameStrikerBase=function(d,c){this._oBg;this._oScene;this._oBall;this._oStartBall;this._oGoalKeeper;this._oContainerGame;this._oClickPoint;this._oReleasePoint;this._oHitArea;this._oPlayer;this._oFieldCollision;this._oHandSwipeAnim;this._oGoal;this._bGoal;this._bLaunched;this._bBallOut;this._bFieldCollide;this._bAnimPlayer;this._bAnimGoalKeeper;this._bSaved;this._bMakeGoal;this._bPoleCollide;this._iLevel;this._iArea;this._iTimePressDown;this._fTimeReset;this._fTimePoleReset;this._fTimeSwipe;this._fMultiplier;
this._aObjects;this._vHitDir;this._iGameState;this._oFade;this._oCamera;this._oParentContainer;this._pGoalSize;this._bTurnEnded=!1};
CGameStrikerBase.prototype._init=function(d,c){this.pause(!0);this._bPoleCollide=this._bMakeGoal=this._bSaved=this._bAnimGoalKeeper=this._bAnimPlayer=this._bFieldCollide=this._bBallOut=this._bLaunched=this._bGoal=!1;this._fMultiplier=1;this._iTimePressDown=0;this._iGameState=STATE_INIT;this._iLevel=c;var f=s_oSpriteLibrary.getSprite("goal_0");this._pGoalSize={w:f.width-15,h:f.height-7.5};this._oParentContainer=d;this._aObjects=[];this._oContainerGame=new createjs.Container;this._oParentContainer.addChild(this._oContainerGame);
this._oFGContainer=new createjs.Container;this._oParentContainer.addChild(this._oFGContainer);this._oBg=createBitmap(s_oSpriteLibrary.getSprite("bg_game_striker"));this._oBg.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);this._oContainerGame.addChild(this._oBg);this._oScene=new CScenarioStriker(this._iLevel);this._oCamera=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();f=s_oSpriteLibrary.getSprite("goal_0");this._oGoal=new CGoalStriker(251,28,f,this._oContainerGame);this._oGoalKeeper=new CGoalKeeper(CANVAS_WIDTH_HALF-
100,CANVAS_HEIGHT_HALF-225,TEAM_INFO[s_aMatches[this._iLevel-1]].goalkeeper,this._oContainerGame);this._aObjects.push(this._oGoalKeeper);f=s_oSpriteLibrary.getSprite("ball");this._oBall=new CBallStriker(0,0,f,this._oScene.ballBody(),this._oContainerGame);this._aObjects.push(this._oBall);this.ballPosition();this._oBall.setVisible(!1);this._fTimeSwipe=MS_TIME_SWIPE_START;this._oStartBall=new CStartBall(STRIKER_START_BALL_POS.x,STRIKER_START_BALL_POS.y,this._oFGContainer);this._oPlayer=new CPlayer(CANVAS_WIDTH_HALF-
150,CANVAS_HEIGHT_HALF-320,this._oFGContainer);this._oPlayer.setVisible(!1);f="cursor";s_bMobile&&(f="hand_touch");this._oHandSwipeAnim=new CHandSwipeAnim(START_HAND_SWIPE_POS,END_HAND_SWIPE_POS,s_oSpriteLibrary.getSprite(f),this._oParentContainer);this._oHandSwipeAnim.animAllSwipe();this._oFade=new createjs.Shape;this._oFade.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);this._oFade.alpha=1;this._oParentContainer.addChild(this._oFade);resizeCanvas3D();this._vHitDir=new CANNON.Vec3(0,
0,0);createjs.Tween.get(this._oFade).to({alpha:0},300,createjs.cubicOut)};
CGameStrikerBase.prototype.sortDepth=function(d,c){d.getDepthPos()>c.getDepthPos()?this._oContainerGame.getChildIndex(d.getObject())>this._oContainerGame.getChildIndex(c.getObject())&&this._oContainerGame.swapChildren(d.getObject(),c.getObject()):d.getDepthPos()<c.getDepthPos()&&this._oContainerGame.getChildIndex(c.getObject())>this._oContainerGame.getChildIndex(d.getObject())&&this._oContainerGame.swapChildren(c.getObject(),d.getObject())};
CGameStrikerBase.prototype.poleCollide=function(){this._fTimePoleReset=TIME_POLE_COLLISION_RESET;this._bPoleCollide=!0;playSound("pole",.4,!1)};CGameStrikerBase.prototype.fieldCollision=function(){!this._oFieldCollision&&this._bLaunched&&(this._oFieldCollision=playSound("drop_bounce_grass",.3,!1),this._oFieldCollision.on("end",function(){this._oFieldCollision=null}))};
CGameStrikerBase.prototype.ballPosition=function(){var d=this._oScene.ballBody(),c=this.convert3dPosTo2dScreen(d.position,this._oCamera),f=c.z*(BALL_SCALE_FACTOR-this._oBall.getStartScale())+this._oBall.getStartScale();this._oBall.setPosition(c.x,c.y);this._oBall.scale(f);this.refreshShadowCast(this._oBall,d,f)};
CGameStrikerBase.prototype.onMouseDown=function(d){this._bLaunched||(this._fTimeSwipe=MS_TIME_SWIPE_START,this._oHandSwipeAnim.removeTweens(),this._oHandSwipeAnim.setVisible(!1),this._oClickPoint={x:d.stageX,y:d.stageY},this._oReleasePoint={x:d.stageX,y:d.stageY})};CGameStrikerBase.prototype.onPressMove=function(d){this._oReleasePoint={x:d.stageX,y:d.stageY};this._iTimePressDown+=s_iTimeElaps};
CGameStrikerBase.prototype.refreshShadowCast=function(d,c,f){var l=this._oScene.getFieldBody();if(c.position.z<l.position.z)d.scaleShadow(0);else{var a=this.convert3dPosTo2dScreen({x:c.position.x,y:c.position.y,z:l.position.z},this._oCamera);c=(c.position.z-BALL_RADIUS)*(l.position.z-SHADOWN_FACTOR-l.position.z)+l.position.z;f*=c;d.scaleShadow(f);0>f||(d.setAlphaByHeight(c),d.setPositionShadow(a.x,a.y))}};CGameStrikerBase.prototype.getLevel=function(){return this._iLevel};
CGameStrikerBase.prototype.resetValues=function(){this._fMultiplier=1};CGameStrikerBase.prototype.wallSoundCollision=function(){};CGameStrikerBase.prototype.areaGoal=function(){this._bGoal||this._bSaved||(this._bMakeGoal?(this._bGoal=!0,this._fTimeReset=TIME_RESET_AFTER_GOAL,playSound("goal_striker",1,!1)):this.goalKeeperSave())};
CGameStrikerBase.prototype.goalKeeperSave=function(){this._bSaved=!0;this._fTimeReset=TIME_RESET_AFTER_SAVE;playSound("ball_saved",1,!1);this.rejectBall();this._fMultiplier=1};
CGameStrikerBase.prototype.rejectBall=function(){this._oBall.getPhysics().velocity.negate(this._oBall.getPhysics().velocity);switch(this._iArea){case 12:this._oBall.getPhysics().velocity=this._oBall.getPhysics().velocity.vadd(new CANNON.Vec3(.4*this._oBall.getPhysics().velocity.x,.4*this._oBall.getPhysics().velocity.y,.4*this._oBall.getPhysics().velocity.z));break;default:this._oBall.getPhysics().velocity.vsub(new CANNON.Vec3(0,50,0))}};
CGameStrikerBase.prototype.predictBallGoalPos=function(d){var c=d.z/d.y;return{x:linearFunction(d.x/d.y,STRIKER_GOAL_SHOOTAREA.lx,STRIKER_GOAL_SHOOTAREA.rx,-this._pGoalSize.w/2,this._pGoalSize.w/2),y:-this._pGoalSize.h/Math.pow(STRIKER_GOAL_SHOOTAREA.zmax,2)*c*c+this._pGoalSize.h/2}};
CGameStrikerBase.prototype.calculateAreaGoal=function(d){this._iArea=-1;d=this.predictBallGoalPos(d);var c=-this._pGoalSize.w/2,f=-this._pGoalSize.h/2;c=linearFunction(d.x,c,c+this._pGoalSize.w,0,NUM_AREA_GOAL.w);c=Math.floor(c);c>NUM_AREA_GOAL.w-1?c=NUM_AREA_GOAL.w-1:0>c&&(c=0);d=linearFunction(d.y,f,f+this._pGoalSize.h,0,NUM_AREA_GOAL.h);d=Math.floor(d);d>NUM_AREA_GOAL.h-1?d=NUM_AREA_GOAL.h-1:0>d&&(d=0);return this._iArea=d*NUM_AREA_GOAL.w+c};
CGameStrikerBase.prototype.goalProbability=function(){this._iArea=-1;this.calculateAreaGoal(this._vHitDir);if(-1===this._iArea)return!1;for(var d=[],c=0;c<MAX_PERCENT_PROBABILITY;c++)d.push(!1);for(c=0;c<AREAS_INFO[this._iArea].probability;c++)d[c]=!0;return d[Math.floor(Math.random()*d.length)]};
CGameStrikerBase.prototype.addImpulseToBall=function(d){if(!this._bLaunched&&this._iGameState===STATE_PLAY){var c=this._oScene.ballBody();this._oScene.addImpulse(c,d);this._oScene.setElementAngularVelocity(c,{x:0,y:0,z:0});this._bLaunched=!0;this._oBall.setVisible(!0);this._oStartBall.setVisible(!1);var f=this;setTimeout(function(){f.chooseDirectionGoalKeeper()},100);playSound("kick",1,!1)}};
CGameStrikerBase.prototype.chooseWrongDirGK=function(){for(var d=ANIM_GOAL_KEEPER_FAIL_EXCLUSION_LIST[this._iArea],c=[],f=1;f<=AREA_GOALS_ANIM.length;f++)-1===d.indexOf(f)&&c.push(f);this._oGoalKeeper.runAnim(c[Math.floor(Math.random()*c.length)])};CGameStrikerBase.prototype.pause=function(d){this._iGameState=d?STATE_PAUSE:STATE_PLAY;createjs.Ticker.paused=d};CGameStrikerBase.prototype.onExit=function(){this.unload();setVolume("soundtrack",1);s_oMain.gotoMenu()};
CGameStrikerBase.prototype.restartLevel=function(){this.resetValues();this.resetScene();this._iGameState=STATE_PLAY;this.startOpponentShot()};
CGameStrikerBase.prototype.resetBallPosition=function(){var d=this._oScene.ballBody();d.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);this._oScene.setElementVelocity(d,{x:0,y:0,z:0});this._oScene.setElementAngularVelocity(d,{x:0,y:0,z:0});this._oBall.fadeAnimation(1,500,0);this._oBall.setVisible(!1);this._oStartBall.setVisible(!0);this._oStartBall.setAlpha(0);this._oStartBall.fadeAnim(1,500,0)};
CGameStrikerBase.prototype.ballFadeForReset=function(){this._bSaved&&this._bGoal&&this._bBallOut&&!this._bFieldCollide&&(this._oBall.fadeAnimation(0,300,10),this._bFieldCollide=!0)};CGameStrikerBase.prototype._updateInit=function(){this._oScene.update();this._updateBall2DPosition();this._iGameState=STATE_PLAY};
CGameStrikerBase.prototype.convert2dScreenPosTo3d=function(d){d=new THREE.Vector3(d.x/s_iCanvasResizeWidth*2-1,2*-(d.y/s_iCanvasResizeHeight)+1,-1);d.unproject(this._oCamera);d.sub(this._oCamera.position);d.normalize();d.multiply(new THREE.Vector3(0,1,0));return d};
CGameStrikerBase.prototype.convert3dPosTo2dScreen=function(d,c){var f=(new THREE.Vector3(d.x,d.y,d.z)).project(c),l=.5*Math.floor(s_iCanvasResizeWidth),a=.5*Math.floor(s_iCanvasResizeHeight);f.x=(f.x*l+l)*s_fInverseScaling;f.y=(-(f.y*a)+a)*s_fInverseScaling;return f};CGameStrikerBase.prototype.timeReset=function(){0<this._fTimeReset?this._fTimeReset-=s_iTimeElaps:!0!==this._bTurnEnded&&(this._bTurnEnded=!0,this.endTurn())};
CGameStrikerBase.prototype.restartGame=function(){this.resetValues();this.resetScene();this._iGameState=STATE_PLAY;this._bLaunched=!1};
CGameStrikerBase.prototype.goalAnimation=function(d){d>FORCE_BALL_DISPLAY_SHOCK[0].min&&d<FORCE_BALL_DISPLAY_SHOCK[0].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[0].time,INTENSITY_DISPLAY_SHOCK[0].x,INTENSITY_DISPLAY_SHOCK[0].y):d>FORCE_BALL_DISPLAY_SHOCK[1].min&&d<FORCE_BALL_DISPLAY_SHOCK[1].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[1].time,INTENSITY_DISPLAY_SHOCK[1].x,INTENSITY_DISPLAY_SHOCK[1].y):d>FORCE_BALL_DISPLAY_SHOCK[2].min&&d<FORCE_BALL_DISPLAY_SHOCK[2].max?this.displayShock(INTENSITY_DISPLAY_SHOCK[2].time,
INTENSITY_DISPLAY_SHOCK[2].x,INTENSITY_DISPLAY_SHOCK[2].y):d>FORCE_BALL_DISPLAY_SHOCK[3].min&&this.displayShock(INTENSITY_DISPLAY_SHOCK[3].time,INTENSITY_DISPLAY_SHOCK[3].x,INTENSITY_DISPLAY_SHOCK[3].y)};
CGameStrikerBase.prototype.displayShock=function(d,c,f){var l=this;createjs.Tween.get(l._oContainerGame).to({x:Math.round(Math.random()*c),y:Math.round(Math.random()*f)},d).call(function(){createjs.Tween.get(l._oContainerGame).to({x:Math.round(Math.random()*c*.8),y:-Math.round(Math.random()*f*.8)},d).call(function(){createjs.Tween.get(l._oContainerGame).to({x:Math.round(Math.random()*c*.6),y:Math.round(Math.random()*f*.6)},d).call(function(){createjs.Tween.get(l._oContainerGame).to({x:Math.round(Math.random()*
c*.4),y:-Math.round(Math.random()*f*.4)},d).call(function(){createjs.Tween.get(l._oContainerGame).to({x:Math.round(Math.random()*c*.2),y:Math.round(Math.random()*f*.2)},d).call(function(){createjs.Tween.get(l._oContainerGame).to({y:0,x:0},d).call(function(){})})})})})})};
CGameStrikerBase.prototype.resetScene=function(){this._bFieldCollide=this._bPoleCollide=this._bMakeGoal=this._bSaved=this._bBallOut=this._bGoal=!1;this._oGoalKeeper.fadeAnimation(1);this.resetBallPosition();this.sortDepth(this._oBall,this._oGoal)};CGameStrikerBase.prototype._onEnd=function(){this.onExit()};
CGameStrikerBase.prototype.swapChildrenIndex=function(){for(var d=0;d<this._aObjects.length-1;d++)for(var c=d+1;c<this._aObjects.length;c++)this._aObjects[d].getObject().visible&&this._aObjects[c].getObject().visible&&this.sortDepth(this._aObjects[d],this._aObjects[c])};
CGameStrikerBase.prototype.ballOut=function(){if(!this._bBallOut&&!this._bGoal&&!this._bSaved){var d=this._oBall.getPhysics().position;if(d.y>BALL_OUT_Y||d.x>BACK_WALL_GOAL_SIZE.width||d.x<-BACK_WALL_GOAL_SIZE.width)this._bBallOut=!0,this._fTimeReset=TIME_RESET_AFTER_BALL_OUT,playSound("ball_saved",1,!1),this._fMultiplier=1}};
CGameStrikerBase.prototype.animGoalKeeper=function(){this._bLaunched?this._bAnimGoalKeeper&&(this._bAnimGoalKeeper=this._oGoalKeeper.update(),this._bAnimGoalKeeper||(this._oGoalKeeper.viewFrame(this._oGoalKeeper.getAnimArray(),this._oGoalKeeper.getAnimArray().length-1),this._oGoalKeeper.hideFrame(this._oGoalKeeper.getAnimArray(),0))):this._oGoalKeeper.update()};
CGameStrikerBase.prototype.resetPoleCollision=function(){0<this._fTimePoleReset?this._fTimePoleReset-=s_iTimeElaps:this._bGoal&&this._bSaved||(this._fMultiplier=1,playSound("ball_saved",1,!1),this.endTurn(),this._fTimePoleReset=TIME_POLE_COLLISION_RESET)};
CGameStrikerBase.prototype.handSwipeAnim=function(){!this._oHandSwipeAnim||this._oHandSwipeAnim.isAnimate()||this._bLaunched||(0<this._fTimeSwipe?this._fTimeSwipe-=s_iTimeElaps:(this._oHandSwipeAnim.animAllSwipe(),this._oHandSwipeAnim.setVisible(!0),this._fTimeSwipe=MS_TIME_SWIPE_START))};CGameStrikerBase.prototype.swapGoal=function(){this._oBall.getPhysics().position.z>GOAL_SPRITE_SWAP_Z&&this.sortDepth(this._oBall,this._oGoal)};
CGameStrikerBase.prototype._updateBall2DPosition=function(){this.ballPosition();this._oBall.rolls();this._oCamera.updateProjectionMatrix();this._oCamera.updateMatrixWorld()};var CGameStrikerSingle=function(d,c){CGameStrikerBase.call(this,d,c);this._init(d,c)};CGameStrikerSingle.prototype=Object.create(CGameStrikerBase.prototype);CGameStrikerSingle.prototype._init=function(d,c){CGameStrikerBase.prototype._init(d,c);this._startGame()};
CGameStrikerSingle.prototype._startGame=function(){s_oInterface.showHelpText(TEXT_HELP);this.onExitHelp()};CGameStrikerSingle.prototype.unload=function(){this._oParentContainer.removeAllChildren();clearTimeout(this._iIDTimeout);SHOW_3D_RENDER||this._oHitArea.removeAllEventListeners();this._oScene.destroyWorld();this._oScene=null};CGameStrikerSingle.prototype.onExitHelp=function(){this.createControl();this.pause(!1)};
CGameStrikerSingle.prototype.createControl=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.onMouseDown,this),window.addEventListener("mousemove",this.onPressMove,this),window.addEventListener("mouseup",this.onPressUp,this)):(this._oHitArea=new createjs.Shape,this._oHitArea.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),this._oContainerGame.addChild(this._oHitArea),this._oHitArea.on("mousedown",this.onMouseDown,this),this._oHitArea.on("pressmove",
this.onPressMove,this),this._oHitArea.on("pressup",this.onPressUp,this))};
CGameStrikerSingle.prototype.onPressUp=function(){if(!(this._bLaunched||this._oClickPoint.y<this._oReleasePoint.y||0===this._oReleasePoint.x&&0===this._oReleasePoint.y)){var d=Math.ceil(distanceV2(this._oClickPoint,this._oReleasePoint))*FORCE_RATE;d>FORCE_MAX&&(d=FORCE_MAX);1E3<this._iTimePressDown&&(this._iTimePressDown=1E3);var c=new CVector2(this._oClickPoint.x-this._oReleasePoint.x,this._oClickPoint.y-this._oReleasePoint.y);c.scalarProduct(d);d=c.length();d>HIT_BALL_MIN_FORCE&&(d>HIT_BALL_MAX_FORCE&&
(c.normalize(),c.scalarProduct(HIT_BALL_MAX_FORCE)),this._bAnimPlayer=!0,this._oPlayer.setVisible(!0),d=MIN_FORCE_Y,this._vHitDir.set(-c.getX()*FORCE_MULTIPLIER_AXIS.x,d,c.getY()*FORCE_MULTIPLIER_AXIS.z),this._bMakeGoal=this.goalProbability());this._oReleasePoint.x=0;this._oReleasePoint.y=0}};
CGameStrikerSingle.prototype.animPlayer=function(){this._bAnimPlayer?(this._bAnimPlayer=this._oPlayer.animPlayer(),this._oPlayer.getFrame()===SHOOT_FRAME&&(this.addImpulseToBall({x:this._vHitDir.x,y:this._vHitDir.y,z:this._vHitDir.z}),this._iTimePressDown=0,this.goalAnimation(this._vHitDir.y),s_oInterface.hideHelpText())):this._oPlayer.setVisible(!1)};
CGameStrikerSingle.prototype.chooseDirectionGoalKeeper=function(){var d=this.predictBallGoalPos(this._vHitDir);if(this._bMakeGoal)this.chooseWrongDirGK();else{var c=this._iArea;75>d.y&&(14===this._iArea&&(c=9),10===this._iArea&&(c=5));this._oGoalKeeper.runAnimAndShift(AREA_GOALS_ANIM[c],d)}this._bAnimGoalKeeper=!0};
CGameStrikerSingle.prototype._updatePlay=function(){for(var d=0;d<PHYSICS_ACCURACY;d++)this._oScene.update();this.ballOut();this._bGoal||this._bBallOut||this._bSaved?this.timeReset():this._bPoleCollide&&this.resetPoleCollision();this.animGoalKeeper();this.animPlayer();this._updateBall2DPosition();this.handSwipeAnim();this.swapChildrenIndex();this.swapGoal()};CGameStrikerSingle.prototype.update=function(){switch(this._iGameState){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};
CGameStrikerSingle.prototype.endTurn=function(){s_oGame.endShotPlayer(this._bGoal,this._bSaved);this.resetScene()};var CGameStrikerMulti=function(d,c){CGameStrikerBase.call(this,d,c);this._init(d,c);this._bMultiplayerBallSaved=this._bMultiplayerGoal=!1;this._oTrajectory};CGameStrikerMulti.prototype=Object.create(CGameStrikerBase.prototype);
CGameStrikerMulti.prototype._init=function(d,c){CGameStrikerBase.prototype._init(d,c);this._startGame();this._oMoveTimeController=new CMoveTimeController(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,this._oContainerGame,TIME_PER_MOVE);this._oMoveTimeController.addEventListener(ON_TIMER_END,this._onTimerEnd,this)};CGameStrikerMulti.prototype._startGame=function(){s_oInterface.showHelpText(TEXT_HELP);this.onExitHelp();this._oTrajectory=new CTrajectory(this._oContainerGame)};
CGameStrikerMulti.prototype.unload=function(){this._oParentContainer.removeAllChildren();this._oMoveTimeController.unload();clearTimeout(this._iIDTimeout);SHOW_3D_RENDER||this._oHitArea.removeAllEventListeners();this._oScene.destroyWorld();this._oScene=null};CGameStrikerMulti.prototype.startCountDown=function(){this._oMoveTimeController.startTimer()};CGameStrikerMulti.prototype.stopCountDown=function(){this._oMoveTimeController.stopTimer()};
CGameStrikerMulti.prototype._onTimerEnd=function(){var d=-350+700*Math.random(),c=linearFunction(Math.abs(d),0,350,350,1400);this._oClickPoint={x:0,y:0};this._oReleasePoint={x:d,y:-c};this.onPressUp()};CGameStrikerMulti.prototype.refreshPos=function(){this._oMoveTimeController.setPos(CANVAS_WIDTH-60-s_iOffsetX,CANVAS_HEIGHT-60-s_iOffsetY)};CGameStrikerMulti.prototype.onExitHelp=function(){this.createControl();this.pause(!1)};
CGameStrikerMulti.prototype.createControl=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.onMouseDown,this),window.addEventListener("mousemove",this.onPressMove,this),window.addEventListener("mouseup",this.onPressUp,this)):(this._oHitArea=new createjs.Shape,this._oHitArea.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),this._oContainerGame.addChild(this._oHitArea),this._oHitArea.on("mousedown",this.onMouseDown,this),this._oHitArea.on("pressmove",
this.onPressMove,this),this._oHitArea.on("pressup",this.onPressUp,this))};
CGameStrikerMulti.prototype.onPressUp=function(){if(!(this._bLaunched||this._oClickPoint.y<this._oReleasePoint.y||0===this._oReleasePoint.x&&0===this._oReleasePoint.y)){var d=Math.ceil(distanceV2(this._oClickPoint,this._oReleasePoint))*FORCE_RATE;d>FORCE_MAX&&(d=FORCE_MAX);1E3<this._iTimePressDown&&(this._iTimePressDown=1E3);var c=new CVector2(this._oClickPoint.x-this._oReleasePoint.x,this._oClickPoint.y-this._oReleasePoint.y);c.scalarProduct(d);d=c.length();d>HIT_BALL_MIN_FORCE&&(d>HIT_BALL_MAX_FORCE&&
(c.normalize(),c.scalarProduct(HIT_BALL_MAX_FORCE)),d=MIN_FORCE_Y,this._vHitDir.set(-c.getX()*FORCE_MULTIPLIER_AXIS.x,d,c.getY()*FORCE_MULTIPLIER_AXIS.z),c=this._vHitDir.toArray(),this._oTrajectory.setTrajectory(this._vHitDir),s_oInterface.hideHelpText(),s_oInterface.showStrikerWaiting(),this._oHandSwipeAnim&&this._oHandSwipeAnim.unload(),this._oMoveTimeController.stopTimer(),this._iShootState=SHOOT_STATE_SELECTED,d={},d[MSG_STRIKER_KICKS]={x:c[0],y:c[1],z:c[2]},s_oNetworkManager.sendMsg(MSG_STRIKER_KICKS,
JSON.stringify(d)))}};CGameStrikerMulti.prototype.animPlayer=function(){this._bAnimPlayer?(this._bAnimPlayer=this._oPlayer.animPlayer(),this._oPlayer.getFrame()===SHOOT_FRAME&&(this.addImpulseToBall({x:this._vHitDir.x,y:this._vHitDir.y,z:this._vHitDir.z}),this._iTimePressDown=0,this.goalAnimation(this._vHitDir.y),s_oInterface.hideStrikerWaiting(),this._oTrajectory.hide())):this._oPlayer.setVisible(!1)};
CGameStrikerMulti.prototype.chooseDirectionGoalKeeper=function(){var d=this.predictBallGoalPos(this._vHitDir);if(this._bMakeGoal)this.chooseWrongDirGK();else if(this._bMultiplayerBallOut||this._bMultiplayerBallPost)this._randomAreaAnimation(),this._oGoalKeeper.runAnim(this._iArea);else{var c=this._iArea;75>d.y&&(14===this._iArea&&(c=9),10===this._iArea&&(c=5));this._oGoalKeeper.runAnimAndShift(AREA_GOALS_ANIM[c],d)}this._bAnimGoalKeeper=!0};
CGameStrikerMulti.prototype._randomAreaAnimation=function(){this._iArea=Math.floor(Math.random()*AREA_GOALS_ANIM.length)};CGameStrikerMulti.prototype._goalAnimation=function(){this._bMultiplayerGoal=this._bMakeGoal=!0;this._bMultiplayerBallPost=this._bMultiplayerBallOut=this._bMultiplayerBallSaved=!1;this._setBallDirToGoal()};
CGameStrikerMulti.prototype._saveAnimation=function(){this._bMultiplayerGoal=this._bMakeGoal=!1;this._bMultiplayerBallSaved=!0;this._bMultiplayerBallPost=this._bMultiplayerBallOut=!1;this._setBallDirToGoal()};CGameStrikerMulti.prototype._ballOutAnimation=function(){this._bMultiplayerBallSaved=this._bMultiplayerGoal=this._bMakeGoal=!1;this._bMultiplayerBallOut=!0;this._bMultiplayerBallPost=!1;this._setBallDirToOut()};
CGameStrikerMulti.prototype._postHitAnimation=function(){this._bMultiplayerBallOut=this._bMultiplayerBallSaved=this._bMultiplayerGoal=this._bMakeGoal=!1;this._bMultiplayerBallPost=!0;this._setBallDirToPost()};
CGameStrikerMulti.prototype._setBallDirToGoal=function(){var d=MIN_FORCE_Y;this._vHitDir.scale(1/d,this._vHitDir);this.limitXDir();this.limitZDir();var c=this._vHitDir.x>STRIKER_GOAL_SHOOTAREA.lx&&this._vHitDir.x<=STRIKER_GOAL_SHOOTAREA.lx+.015,f=this._vHitDir.x<STRIKER_GOAL_SHOOTAREA.rx&&this._vHitDir.x>=STRIKER_GOAL_SHOOTAREA.rx-.015;if(this._vHitDir.z>STRIKER_GOAL_SHOOTAREA.zmax-.015||c||f)this._vHitDir.x=linearFunction(this._vHitDir.x,STRIKER_GOAL_SHOOTAREA.lx,STRIKER_GOAL_SHOOTAREA.rx,STRIKER_GOAL_SHOOTAREA.lx+
.015,STRIKER_GOAL_SHOOTAREA.rx-.015),this._vHitDir.z=linearFunction(this._vHitDir.z,STRIKER_GOAL_SHOOTAREA.zmin,STRIKER_GOAL_SHOOTAREA.zmax,STRIKER_GOAL_SHOOTAREA.zmin,STRIKER_GOAL_SHOOTAREA.zmax-.015);this._vHitDir.scale(d,this._vHitDir)};
CGameStrikerMulti.prototype._setBallDirToOut=function(){var d=MIN_FORCE_Y;this._vHitDir.scale(1/d,this._vHitDir);this._vHitDir.x=linearFunction(this._vHitDir.x,STRIKER_GOAL_SHOOTAREA.lx,STRIKER_GOAL_SHOOTAREA.rx,STRIKER_GOAL_SHOOTAREA.lx-.015,STRIKER_GOAL_SHOOTAREA.rx+.015);this._vHitDir.z=linearFunction(this._vHitDir.z,STRIKER_GOAL_SHOOTAREA.zmin,STRIKER_GOAL_SHOOTAREA.zmax,STRIKER_GOAL_SHOOTAREA.zmin,STRIKER_GOAL_SHOOTAREA.zmax+.015);this._vHitDir.scale(d,this._vHitDir)};
CGameStrikerMulti.prototype._setBallDirToPost=function(){var d=MIN_FORCE_Y;this._vHitDir.scale(1/d,this._vHitDir);this._vHitDir.z<STRIKER_GOAL_SHOOTAREA.zmax+.01&&this._vHitDir.z>STRIKER_GOAL_SHOOTAREA.zmax-.01?(this._vHitDir.z=STRIKER_GOAL_SHOOTAREA.zmax,this.limitXDir()):(this.limitZDir(),this._vHitDir.x=0<this._vHitDir.x?STRIKER_GOAL_SHOOTAREA.rx:STRIKER_GOAL_SHOOTAREA.lx);this._vHitDir.scale(d,this._vHitDir)};
CGameStrikerMulti.prototype.limitZDir=function(){this._vHitDir.z<STRIKER_GOAL_SHOOTAREA.zmin?this._vHitDir.z=STRIKER_GOAL_SHOOTAREA.zmin:this._vHitDir.z>STRIKER_GOAL_SHOOTAREA.zmax&&(this._vHitDir.z=STRIKER_GOAL_SHOOTAREA.zmax)};CGameStrikerMulti.prototype.limitXDir=function(){this._vHitDir.x>STRIKER_GOAL_SHOOTAREA.rx?this._vHitDir.x=STRIKER_GOAL_SHOOTAREA.rx:this._vHitDir.x<STRIKER_GOAL_SHOOTAREA.lx&&(this._vHitDir.x=STRIKER_GOAL_SHOOTAREA.lx)};
CGameStrikerMulti.prototype.onRemoteGoalkeeperResults=function(d){this._iShootState=SHOOT_STATE_ANIM;this._bAnimPlayer=!0;this._oPlayer.setVisible(!0);this._oReleasePoint.x=0;this._oReleasePoint.y=0;this.calculateAreaGoal(this._vHitDir);switch(d.result){case GOALKEEPER_RESULTS_GOAL:this._goalAnimation();break;case GOALKEEPER_RESULTS_SAVED:this._saveAnimation();break;case GOALKEEPER_RESULTS_BALLOUT:this._ballOutAnimation();break;case GOALKEEPER_RESULTS_POSTHIT:this._postHitAnimation()}};
CGameStrikerMulti.prototype._updatePlay=function(){for(var d=0;d<PHYSICS_ACCURACY;d++)this._oScene.update();this.ballOut();this._bGoal||this._bBallOut||this._bSaved?this.timeReset():this._bPoleCollide&&this.resetPoleCollision();this.animGoalKeeper();this.animPlayer();this._updateBall2DPosition();this.handSwipeAnim();this.swapChildrenIndex();this.swapGoal();this._oTrajectory.update()};CGameStrikerMulti.prototype.update=function(){switch(this._iGameState){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};
CGameStrikerMulti.prototype.endTurn=function(){s_oGame.endShotPlayer(this._bMultiplayerGoal,this._bMultiplayerBallSaved);this.resetScene();s_oNetworkManager.sendMsg(MSG_END_TURN,"")};var CGameStrikerSingleWithBot=function(d,c){CGameStrikerSingle.call(this,d,c)};CGameStrikerSingleWithBot.prototype=Object.create(CGameStrikerSingle.prototype);
CGameStrikerSingleWithBot.prototype._startGame=function(){s_oInterface.showHelpText(TEXT_HELP);this._oMoveTimeController=new CMoveTimeController(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,this._oContainerGame,TIME_PER_MOVE);this._oMoveTimeController.addEventListener(ON_TIMER_END,this._onTimerEnd,this);this.onExitHelp();this._oTrajectory=new CTrajectory(this._oContainerGame)};
CGameStrikerSingleWithBot.prototype.unload=function(){this._oParentContainer.removeAllChildren();this._oMoveTimeController.unload();clearTimeout(this._iIDTimeout);SHOW_3D_RENDER||this._oHitArea.removeAllEventListeners();this._oScene.destroyWorld();this._oScene=null};CGameStrikerSingleWithBot.prototype.startCountDown=function(){this._oMoveTimeController.startTimer()};CGameStrikerSingleWithBot.prototype.stopCountDown=function(){this._oMoveTimeController.stopTimer()};
CGameStrikerSingleWithBot.prototype._onTimerEnd=function(){var d=-350+700*Math.random(),c=linearFunction(Math.abs(d),0,350,350,1400);this._oClickPoint={x:0,y:0};this._oReleasePoint={x:d,y:-c};this.onPressUp()};CGameStrikerSingleWithBot.prototype.refreshPos=function(){this._oMoveTimeController.setPos(CANVAS_WIDTH-60-s_iOffsetX,CANVAS_HEIGHT-60-s_iOffsetY)};CGameStrikerSingleWithBot.prototype.onExitHelp=function(){this.createControl();this.pause(!1)};
CGameStrikerSingleWithBot.prototype.createControl=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onPressMove),window.addEventListener("mouseup",this.onPressUp)):(this._oHitArea=new createjs.Shape,this._oHitArea.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),this._oContainerGame.addChild(this._oHitArea),this._oHitArea.on("mousedown",this.onMouseDown,this),this._oHitArea.on("pressmove",this.onPressMove,
this),this._oHitArea.on("pressup",this.onPressUp,this))};
CGameStrikerSingleWithBot.prototype.onPressUp=function(){if(!(s_oGameStriker._bLaunched||s_oGameStriker._oClickPoint.y<s_oGameStriker._oReleasePoint.y||0===s_oGameStriker._oReleasePoint.x&&0===s_oGameStriker._oReleasePoint.y)){var d=Math.ceil(distanceV2(s_oGameStriker._oClickPoint,s_oGameStriker._oReleasePoint))*FORCE_RATE;d>FORCE_MAX&&(d=FORCE_MAX);1E3<s_oGameStriker._iTimePressDown&&(s_oGameStriker._iTimePressDown=1E3);var c=new CVector2(s_oGameStriker._oClickPoint.x-s_oGameStriker._oReleasePoint.x,
s_oGameStriker._oClickPoint.y-s_oGameStriker._oReleasePoint.y);c.scalarProduct(d);d=c.length();d>HIT_BALL_MIN_FORCE&&(d>HIT_BALL_MAX_FORCE&&(c.normalize(),c.scalarProduct(HIT_BALL_MAX_FORCE)),d=MIN_FORCE_Y,s_oGameStriker._vHitDir.set(-c.getX()*FORCE_MULTIPLIER_AXIS.x,d,c.getY()*FORCE_MULTIPLIER_AXIS.z),s_oGameStriker._oTrajectory.setTrajectory(s_oGameStriker._vHitDir),s_oInterface.hideHelpText(),s_oInterface.showStrikerWaiting(),s_oGameStriker._oHandSwipeAnim&&s_oGameStriker._oHandSwipeAnim.unload(),
s_oGameStriker._bMakeGoal=s_oGameStriker.goalProbability(),this._oMoveTimeController.stopTimer(),setTimeout(function(){s_oGameStriker._startShoot()},3E3+4E3*Math.random()));s_oGameStriker._oReleasePoint.x=0;s_oGameStriker._oReleasePoint.y=0}};CGameStrikerSingleWithBot.prototype._startShoot=function(){s_oGameStriker._bAnimPlayer=!0;s_oGameStriker._oPlayer.setVisible(!0)};
CGameStrikerSingleWithBot.prototype.animPlayer=function(){this._bAnimPlayer?(this._bAnimPlayer=this._oPlayer.animPlayer(),this._oPlayer.getFrame()===SHOOT_FRAME&&(this.addImpulseToBall({x:this._vHitDir.x,y:this._vHitDir.y,z:this._vHitDir.z}),this._iTimePressDown=0,this.goalAnimation(this._vHitDir.y),s_oInterface.hideStrikerWaiting(),this._oTrajectory.hide())):this._oPlayer.setVisible(!1)};
CGameStrikerSingleWithBot.prototype._updatePlay=function(){for(var d=0;d<PHYSICS_ACCURACY;d++)this._oScene.update();this.ballOut();this._bGoal||this._bBallOut||this._bSaved?this.timeReset():this._bPoleCollide&&this.resetPoleCollision();this.animGoalKeeper();this.animPlayer();this._updateBall2DPosition();this.handSwipeAnim();this.swapChildrenIndex();this.swapGoal();this._oTrajectory.update()};
CGameStrikerSingleWithBot.prototype.update=function(){switch(this._iGameState){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};
function CGoalStriker(d,c,f,l){var a;this._init=function(b,h,k){a=createBitmap(k);this.setPosition(b,h);a.cache(0,0,k.width,k.height);e.addChild(a)};this.unload=function(){e.removeChild(a)};this.setPosition=function(b,h){a.x=b;a.y=h};this.getDepthPos=function(){return GOAL_SPRITE_SWAP_Y};this.getObject=function(){return a};var e=l;this._init(d,c,f);return this}
function CGoalKeeper(d,c,f,l){var a,e,b,h,k,g,m=0,n=0,q=IDLE;this._init=function(p,u,r){k=r;a=p;e=u;b=new createjs.Container;b.x=a;b.y=e;k.addChild(b);b.tickChildren=!1;g=[];h=[];for(r=u=p=0;r<NUM_SPRITE_GOALKEEPER.length;r++){h[r]=new createjs.Container;h[r].regX=-OFFSET_CONTAINER_GOALKEEPER[r].x;h[r].regY=-OFFSET_CONTAINER_GOALKEEPER[r].y;g.push(this.loadAnim(SPRITE_NAME_GOALKEEPER[r],NUM_SPRITE_GOALKEEPER[r],h[r]));b.addChild(h[r]);var t=s_oSpriteLibrary.getSprite(SPRITE_NAME_GOALKEEPER[r]+"_"+
f+"_0");t.width>p&&(p=t.width);t.height>u&&(u=t.height)}b.cache(-p,-u,2*p,2*u);g[IDLE][0].visible=!0};this.getAnimType=function(){return q};this.getAnimArray=function(){return g[q]};this.loadAnim=function(p,u,r){for(var t=[],v=0;v<u;v++)t.push(createBitmap(s_oSpriteLibrary.getSprite(p+"_"+f+"_"+v))),t[v].visible=!1,r.addChild(t[v]);return t};this.getX=function(){return b.x};this.getY=function(){return b.y};this.disableAllAnim=function(){for(var p=0;p<h.length;p++)h[p].visible=!1};this.setPosition=
function(p,u){b.x=p;b.y=u};this.resetPosition=function(){b.x=a;b.y=e};this.setVisible=function(p){b.visible=p};this.fadeAnimation=function(p){createjs.Tween.get(b,{override:!0}).to({alpha:p},500)};this.setAlpha=function(p){b.alpha=p};this.getObject=function(){return b};this.getFrame=function(){return n};this.viewFrame=function(p,u){p[u].visible=!0};this.hideFrame=function(p,u){p[u].visible=!1};this.getDepthPos=function(){return GOAL_KEEPER_DEPTH_Y};this.animGoalKeeper=function(p,u){m+=s_iTimeElaps;
if(m>BUFFER_ANIM_PLAYER){this.hideFrame(p,n);if(n+1<u)this.viewFrame(p,n+1),n++;else return m=n=0,this.viewFrame(p,n),!1;m=0;b.updateCache()}return!0};this.resetAnimation=function(p){this.resetAnimFrame(g[p],NUM_SPRITE_GOALKEEPER[p])};this.resetAnimFrame=function(p,u){for(var r=1;r<u;r++)p[r].visible=!1;p[0].visible=!0};this.setVisibleContainer=function(p,u){h[p].visible=u};this.runAnim=function(p){this.disableAllAnim();this.resetAnimation(p);this.setVisibleContainer(p,!0);q=p;n=0};this.runAnimAndShift=
function(p,u){this.disableAllAnim();this.resetAnimation(p);this.setVisibleContainer(p,!0);q=p;n=0;var r=ORIGIN_POINT_IMPACT_ANIMATION[p],t=u.x-r.x;null===r.x&&(t=0);var v=u.y-r.y;null===r.y&&(v=0);r=t;t=v;createjs.Tween.get(b).to({x:a+r,y:e+t},600).call(function(){0!==v&&createjs.Tween.get(b).to({x:a,y:e},300)})};this.update=function(){return this.animGoalKeeper(g[q],NUM_SPRITE_GOALKEEPER[q])};this._init(d,c,l);return this}
function CHandSwipeAnim(d,c,f,l){var a,e,b=!1;this._init=function(h){e=new createjs.Container;a=createBitmap(h);a.x=d.x;a.y=d.y;a.regX=.5*h.width;a.regY=.5*h.height;a.alpha=0;l.addChild(e);e.addChild(a)};this.animAllSwipe=function(){a.x=d.x;a.y=d.y;createjs.Tween.get(a,{loop:-1}).to({x:c[0].x,y:c[0].y,alpha:1},MS_TIME_SWIPE_END,createjs.Ease.quartOut).to({x:d.x,y:d.y,alpha:.5},0).to({x:c[1].x,y:c[1].y,alpha:1},MS_TIME_SWIPE_END,createjs.Ease.quartOut).to({x:d.x,y:d.y,alpha:.5},0).to({x:c[2].x,y:c[2].y,
alpha:1},MS_TIME_SWIPE_END,createjs.Ease.quartOut).to({x:d.x,y:d.y,alpha:.5},0)};this.fadeAnim=function(h){createjs.Tween.get(e,{override:!0}).to({alpha:h},250)};this.isAnimate=function(){return b};this.setVisible=function(h){a.visible=h};this.removeTweens=function(){createjs.Tween.removeTweens(a);b=!1};this.unload=function(){this.removeTweens();e.removeChild(a)};this._init(f);return this}
function CPlayer(d,c,f){var l,a,e,b=0,h=0;this._init=function(k,g){l={x:k,y:g};e=new createjs.Container;e.x=l.x;e.y=l.y;f.addChild(e);var m={images:[s_oSpriteLibrary.getSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"-0"),s_oSpriteLibrary.getSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"-1"),s_oSpriteLibrary.getSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"-2"),s_oSpriteLibrary.getSprite("player_"+TEAM_INFO[s_iTeamSelected].player+"-3")],frames:[[1,1,233,485,0,-509,-155],[236,1,337,
640,0,-405,0],[575,1,374,640,0,-368,0],[951,1,337,640,0,-405,0],[1290,1,438,640,0,-304,0],[1,643,655,640,0,-87,0],[658,643,658,640,0,-83,0],[1318,643,633,640,0,-98,0],[1,1285,626,640,0,-81,0],[629,1285,604,640,0,-103,0],[1235,1285,663,640,0,-47,0],[1,1,688,640,1,-42,0],[691,1,705,640,1,-37,0],[1,643,660,640,1,-82,0],[663,643,712,640,1,-30,0],[1,1285,699,640,1,-43,0],[702,1285,695,640,1,-47,0],[1,1,671,640,2,-71,0],[674,1,691,640,2,-51,0],[1,643,698,640,2,-44,0],[701,643,705,640,2,-37,0],[1408,643,
336,640,2,-406,0],[1,1285,311,640,2,-431,0],[314,1285,285,640,2,-457,0],[601,1285,258,640,2,-484,0],[861,1285,263,640,2,-479,0],[1126,1285,271,640,2,-471,0],[1399,1285,277,640,2,-465,0],[1678,1285,278,640,2,-464,0],[1,1,275,640,3,-467,0],[278,1,273,640,3,-469,0]],animations:{start:0,anim:[0,30,"hide"],hide:31}};m=new createjs.SpriteSheet(m);a=new createjs.Sprite(m,"start");e.addChild(a)};this.setPosition=function(k,g){e.x=k;e.y=g};this.getX=function(){return e.x};this.getY=function(){return e.y};
this.getStartPos=function(){return l};this.setVisible=function(k){e.visible=k};this.animFade=function(k){var g=this;createjs.Tween.get(e).to({alpha:k},250).call(function(){0===k&&(e.visible=!1,g.viewCharacter(b))})};this.viewCharacter=function(k){a.gotoAndStop(k)};this.getFrame=function(){return a.currentFrame};this.animPlayer=function(){h+=s_iTimeElaps;if(h>BUFFER_ANIM_PLAYER){if(b+1<NUM_SPRITE_PLAYER)this.viewCharacter(b+1),b++;else return this.viewCharacter(b),h=b=0,!1;h=0}return!0};this._init(d,
c);return this}
function CScenarioStriker(){var d,c,f,l,a,e,b,h,k,g,m,n,q,p,u,r;if(SHOW_3D_RENDER)var t=new CANNON.Demo;this.getDemo=function(){return t};this._init=function(){d=SHOW_3D_RENDER?t.getWorld():new CANNON.World;d.gravity.set(0,0,-9.81);d.broadphase=new CANNON.NaiveBroadphase;d.solver.iterations=50;d.solver.tolerance=1E-5;c=new CANNON.Material;f=new CANNON.Material;l=new CANNON.Material;var v=new CANNON.ContactMaterial(f,l,{friction:.1,restitution:.01}),x=new CANNON.ContactMaterial(f,c,{friction:.2,restitution:.3});
d.addContactMaterial(v);d.addContactMaterial(x);s_oScenario._createBallBody();s_oScenario._createFieldBody();s_oScenario._createGoal();s_oScenario.createBackGoalWall();SHOW_AREAS_GOAL?s_oScenario.createAreasGoal():s_oScenario.createAreaGoal(GOAL_LINE_POS,BACK_WALL_GOAL_SIZE,COLOR_AREA_GOAL[0],null)};this.createAreasGoal=function(){for(var v=0,x=FIRST_AREA_GOAL_POS.x,y=FIRST_AREA_GOAL_POS.z,A=0;A<NUM_AREA_GOAL.h;A++){for(var D=0;D<NUM_AREA_GOAL.w;D++)s_oScenario.createAreaGoal({x:x,y:FIRST_AREA_GOAL_POS.y,
z:y},AREA_GOAL_PROPERTIES,COLOR_AREA_GOAL[v],AREAS_INFO[v]),x+=2*AREA_GOAL_PROPERTIES.width,v++;x=FIRST_AREA_GOAL_POS.x;y-=2*AREA_GOAL_PROPERTIES.height}};this._createFieldBody=function(){h=new CANNON.Plane;k=new CANNON.Body({mass:0,material:c});k.addShape(h);k.position.z=-9;k.addEventListener("collide",function(x){s_oScenario.fieldCollision()});d.addBody(k);if(SHOW_3D_RENDER){var v=new THREE.MeshPhongMaterial({color:5803568,specular:1118481,shininess:10});t.addVisual(k,v)}};this._createGoal=function(){g=
new CANNON.Cylinder(POLE_RIGHT_LEFT_SIZE.radius_top,POLE_RIGHT_LEFT_SIZE.radius_bottom,POLE_RIGHT_LEFT_SIZE.height,POLE_RIGHT_LEFT_SIZE.segments);n=new CANNON.Body({mass:0});m=new CANNON.Cylinder(POLE_UP_SIZE.radius_top,POLE_UP_SIZE.radius_bottom,POLE_UP_SIZE.height,POLE_UP_SIZE.segments);var v=new CANNON.Quaternion;v.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/2);m.transformAllPoints(new CANNON.Vec3,v);n.addShape(g,new CANNON.Vec3(.5*POLE_UP_SIZE.height,0,0));n.addShape(g,new CANNON.Vec3(.5*
-POLE_UP_SIZE.height,0,0));n.addShape(m,new CANNON.Vec3(0,0,.5*POLE_RIGHT_LEFT_SIZE.height));n.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y-UP_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_POSITION.z);n.addEventListener("collide",function(x){s_oScenario.poleCollision()});d.addBody(n);SHOW_3D_RENDER&&(v=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50}),t.addVisual(n,v))};this.createBackGoalWall=function(){q=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,
BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));p=new CANNON.Box(new CANNON.Vec3(LEFT_RIGHT_WALL_GOAL_SIZE.width,LEFT_RIGHT_WALL_GOAL_SIZE.depth,LEFT_RIGHT_WALL_GOAL_SIZE.height));u=new CANNON.Box(new CANNON.Vec3(UP_WALL_GOAL_SIZE.width,UP_WALL_GOAL_SIZE.depth,UP_WALL_GOAL_SIZE.height));r=new CANNON.Body({mass:0,material:l});r.addShape(q);r.addShape(p,new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,0,0));r.addShape(p,new CANNON.Vec3(-BACK_WALL_GOAL_SIZE.width,0,0));r.addShape(u,new CANNON.Vec3(0,
0,BACK_WALL_GOAL_SIZE.height));r.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y,BACK_WALL_GOAL_POSITION.z);d.addBody(r);SHOW_3D_RENDER&&t.addVisual(r)};this.createAreaGoal=function(v,x,y,A){x=new CANNON.Box(new CANNON.Vec3(x.width,x.depth,x.height));A=new CANNON.Body({mass:0,userData:A});A.addShape(x);A.position.set(v.x,v.y,v.z);A.collisionResponse=0;A.addEventListener("collide",function(D){s_oScenario.lineGoalCollision(D)});d.addBody(A);SHOW_3D_RENDER&&(v=new THREE.MeshPhongMaterial({color:y,
specular:1118481,shininess:70}),t.addVisual(A,v));return A};this._createBallBody=function(){a=new CANNON.Sphere(BALL_RADIUS);e=new CANNON.Body({mass:BALL_MASS,material:f,linearDamping:BALL_LINEAR_DAMPING,angularDamping:2*BALL_LINEAR_DAMPING});var v=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);e.position.copy(v);e.addShape(a);d.add(e);SHOW_3D_RENDER&&(v=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:70}),b=t.addVisual(e,v))};this.addImpulse=function(v,x){var y=
new CANNON.Vec3(0,0,BALL_RADIUS),A=new CANNON.Vec3(x.x,x.y,x.z);v.applyImpulse(A,y)};this.addForce=function(v,x){var y=new CANNON.Vec3(0,0,0),A=new CANNON.Vec3(x.x,x.y,x.z);v.applyForce(A,y)};this.getBodyVelocity=function(v){return v.velocity};this.ballBody=function(){return e};this.ballMesh=function(){return b};this.getCamera=function(){return t.camera()};this.fieldCollision=function(){s_oGameStriker.fieldCollision();s_oGameStriker.ballFadeForReset()};this.setElementAngularVelocity=function(v,x){v.angularVelocity.set(x.x,
x.y,x.z)};this.setElementVelocity=function(v,x){var y=new CANNON.Vec3(x.x,x.y,x.z);v.velocity=y};this.setElementLinearDamping=function(v,x){v.linearDamping=x};this.getFieldBody=function(){return k};this.lineGoalCollision=function(v){s_oGameStriker.areaGoal(v.contact.bj.userData)};this.update=function(){d.step(PHYSICS_STEP)};this.getGoalBody=function(){return n};this.poleCollision=function(){s_oGameStriker.poleCollide()};this.destroyWorld=function(){for(var v=d.bodies,x=0;x<v.length;x++)d.remove(v[x]);
d=null};s_oScenario=this;SHOW_3D_RENDER?(t.addScene("Test",this._init),t.start()):this._init()}var s_oScenario;
function CStartBall(d,c,f){var l;this._init=function(){var a=s_oSpriteLibrary.getSprite("start_ball");l=createBitmap(a);l.regX=.5*a.width;l.regY=.5*a.height;this.setPosition(d,c);f.addChild(l)};this.setPosition=function(a,e){l.x=a;l.y=e};this.fadeAnim=function(a,e,b){createjs.Tween.get(l,{override:!0}).wait(b).to({alpha:a},e)};this.setAlpha=function(a){l.alpha=a};this.setVisible=function(a){l.visible=a};this._init();return this}
function CBallKeeper(d,c,f,l,a){var e,b,h,k=null,g=0,m=0,n=null,q;this._init=function(r,t,v){h=new createjs.Container;u.addChild(h);var x=new createjs.SpriteSheet({images:[v],frames:{width:v.width/7,height:v.height,regX:v.width/2/7,regY:v.height/2}});e=createSprite(x,0,v.width/2/7,v.height/2,v.width/7,v.height/2);e.stop();this.scale(.66);v=s_oSpriteLibrary.getSprite("ball_shadow");b=createBitmap(v);b.x=r;b.y=t;b.regX=.5*v.width;b.regY=.5*v.height;this.scaleShadow(.6);h.addChild(b,e)};this.rolls=function(){e.rotation=
Math.degrees(Math.sin(.15*p.velocity.x));var r=Math.abs(p.angularVelocity.x),t=this._goToPrevFrame;0>p.angularVelocity.x&&(t=this._goToNextFrame);7<r?t():3<r?(g++,g>2/ROLL_BALL_RATE&&(t(),g=0)):1<r?(g++,g>3/ROLL_BALL_RATE&&(t(),g=0)):r>MIN_BALL_VEL_ROTATION&&(g++,g>4/ROLL_BALL_RATE&&(t(),g=0))};this._goToPrevFrame=function(){0===m?m=6:m--;e.gotoAndStop(m)};this._goToNextFrame=function(){7===m?m=1:m++;e.gotoAndStop(m)};this.unload=function(){e.removeAllEventListeners();u.removeChild(e)};this.setVisible=
function(r){e.visible=r};this.startPosShadowY=function(r){k=r};this.getStartShadowYPos=function(){return k};this.fadeAnimation=function(r,t,v){r!==q&&(null!==n&&createjs.Tween.removeTweens(h),this.tweenFade(r,t,v),q=r)};this.tweenFade=function(r,t,v){n=createjs.Tween.get(h).wait(v).to({alpha:r},t).call(function(){n=null})};this.setPositionShadow=function(r,t){b.x=r;b.y=t};this.setPosition=function(r,t){e.x=r;e.y=t};this.getPhysics=function(){return p};this.setAngle=function(r){e.rotation=r};this.getX=
function(){return e.x};this.getY=function(){return e.y};this.getStartScale=function(){return.66};this.scale=function(r){e.scaleX=r;e.scaleY=r};this.scaleShadow=function(r){.08<r?(b.scaleX=r,b.scaleY=r):(b.scaleX=.08,b.scaleY=.08)};this.setAlphaByHeight=function(r){b.alpha=r};this.getScale=function(){return e.scaleX};this.getObject=function(){return h};this.getDepthPos=function(){return p.position.y};this.setVisible=function(r){h.visible=r};var p=l;var u=a;this._init(d,c,f);return this}
var CGameGoalkeeperBase=function(d,c,f){this._oBg;this._oScene;this._oGloves;this._oBall;this._oOpponent;this._oGoal;this._oStageMouseMove;this._oListenerClickStage;this._oContainerGame;this._bBallStoppedAfterLaunch;this._bBallOut;this._bGoal;this._bKeeperSave;this._bPerfectSaved;this._bLaunched;this._bFieldCollide;this._iLevel;this._iBallSaved;this._iGoalOpponent;this._iPerfectBallSaved;this._iCurBallForceY;this._fTimeReset;this._aObjects;this._vHitDir;this._bPostHit;this._iGameState;this._oCamera;
this._oFade;this._oParentContainer;this._bTurnEnded=!1};
CGameGoalkeeperBase.prototype._init=function(d,c,f){this._bPostHit=this._bFieldCollide=this._bLaunched=this._bPerfectSaved=this._bKeeperSave=this._bBallOut=this._bBallStoppedAfterLaunch=this._bGoal=!1;this._iCurBallForceY=c;this._iPerfectBallSaved=this._iGoalOpponent=this._iBallSaved=0;this._iGameState=STATE_INIT;this._oParentContainer=f;this._aObjects=[];this._iLevel=d;this._oContainerGame=new createjs.Container;this._oParentContainer.addChild(this._oContainerGame);this._oBg=createBitmap(s_oSpriteLibrary.getSprite("bg_game_gk"));
this._oContainerGame.addChild(this._oBg);this._oScene=new CScenarioKeeper;this._oCamera=SHOW_3D_RENDER?camera:createOrthoGraphicCamera();d=s_oSpriteLibrary.getSprite("opponent_"+TEAM_INFO[s_aMatches[this._iLevel-1]].opponent);this._oOpponent=new COpponent(600,340,d,this._oContainerGame);d=s_oSpriteLibrary.getSprite("ball");this._oBall=new CBallKeeper(0,0,d,this._oScene.ballBody(),this._oContainerGame);this._aObjects.push(this._oBall);this.ballPosition();resizeCanvas3D();this._oScene.ballBody();d=
s_oSpriteLibrary.getSprite("gloves");this._oGloves=new CGloves(CANVAS_WIDTH_HALF,CANVAS_HEIGHT_HALF,d,this._oScene.getHandKeeperBody(),this._oContainerGame);this._aObjects.push(this._oGloves);d=s_oSpriteLibrary.getSprite("goal_1");this._oGoal=new CGoalGoalkeeper(0,0,d,this._oScene.getGoalBody(),this._oContainerGame);this._aObjects.push(this._oGoal);this._oFade=new createjs.Shape;this._oFade.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);this._oFade.alpha=1;this._oParentContainer.addChild(this._oFade);
createjs.Tween.get(this._oFade).to({alpha:0},300,createjs.cubicOut)};
CGameGoalkeeperBase.prototype.sortDepth=function(d,c){null!==d&&null!==c&&(d.getDepthPos()>c.getDepthPos()?this._oContainerGame.getChildIndex(d.getObject())>this._oContainerGame.getChildIndex(c.getObject())&&this._oContainerGame.swapChildren(d.getObject(),c.getObject()):d.getDepthPos()<c.getDepthPos()&&this._oContainerGame.getChildIndex(c.getObject())>this._oContainerGame.getChildIndex(d.getObject())&&this._oContainerGame.swapChildren(c.getObject(),d.getObject()))};
CGameGoalkeeperBase.prototype.clickStage=function(){s_oGameKeeper._oContainerGame.off("click",s_oGameKeeper._oListenerClickStage);s_oGameKeeper.startOpponentShot()};CGameGoalkeeperBase.prototype.deactiveEventListeners=function(){SHOW_3D_RENDER?(window.removeEventListener("mousedown",this.addImpulseToBall),window.removeEventListener("mousemove",this.onHandKeeper)):(s_oStage.off("stagemousemove",this._oStageMouseMove),this._oStageMouseMove=null)};
CGameGoalkeeperBase.prototype.ballPosition=function(){var d=this._oScene.ballBody(),c=this.convert3dPosTo2dScreen(d.position,this._oCamera),f=c.z*(BALL_SCALE_FACTOR-this._oBall.getStartScale())+this._oBall.getStartScale();this.shadowBall(d,f);this._oBall.scale(f);this._oBall.setPosition(c.x,c.y)};
CGameGoalkeeperBase.prototype.shadowBall=function(d,c){var f=this._oScene.getFieldBody(),l=this.convert3dPosTo2dScreen({x:d.position.x,y:d.position.y,z:f.position.z},this._oCamera);this._oBall.scaleShadow(c/(d.position.z-f.position.z));this._oBall.setAlphaByHeight(.1*(-d.position.z-.1*f.position.z));this._oBall.setPositionShadow(l.x,l.y)};
CGameGoalkeeperBase.prototype.unload=function(){s_oGameKeeper._iGameState=-1;s_oGameKeeper._oParentContainer.removeAllChildren();s_oGameKeeper._oScene.destroyWorld();s_oGameKeeper._oScene=null;s_oGameKeeper.deactiveEventListeners()};CGameGoalkeeperBase.prototype.resetValues=function(){this._iPerfectBallSaved=this._iBallSaved=this._iGoalOpponent=0};CGameGoalkeeperBase.prototype.wallSoundCollision=function(){};
CGameGoalkeeperBase.prototype.onExit=function(){this.unload();setVolume("soundtrack",1);s_oMain.changeCanvasSize(1360,640);s_oMain.gotoMenu()};CGameGoalkeeperBase.prototype.restartLevel=function(){this.resetValues();this.resetScene();this.activeEventListeners();this._iGameState=STATE_PLAY;this.startOpponentShot()};
CGameGoalkeeperBase.prototype.resetBallPosition=function(){var d=this._oScene.ballBody();d.position.set(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);this._oScene.setElementVelocity(d,{x:0,y:0,z:0});this._oScene.setElementAngularVelocity(d,{x:0,y:0,z:0})};CGameGoalkeeperBase.prototype.ballFadeForReset=function(){if(this._bGoal||this._bKeeperSave){var d=1E3;this._bGoal&&(d=100);this._bFieldCollide||(this._oBall.fadeAnimation(0,300,d),this._bFieldCollide=!0)}this._bBallOut&&this._oBall.setVisible(!1)};
CGameGoalkeeperBase.prototype._updateInit=function(){this._oScene.update();this._updateBall2DPosition();this._iGameState=STATE_PLAY};
CGameGoalkeeperBase.prototype.onHandKeeper=function(d){var c=s_oGameKeeper._oScene.getHandKeeperBody();d=SHOW_3D_RENDER?{x:d.clientX-s_iCanvasOffsetWidth,y:d.clientY-s_iCanvasOffsetHeight}:{x:d.stageX/s_fInverseScaling,y:d.stageY/s_fInverseScaling};d.y=s_bMobile?d.y+MOBILE_OFFSET_GLOVES_Y:d.y+DESKTOP_OFFSET_GLOVES_Y;d=s_oGameKeeper.convert2dScreenPosTo3d(d,c);c.position.x=d.x<LIMIT_HAND_RANGE_POS.x&&d.x>-LIMIT_HAND_RANGE_POS.x?d.x:d.x<LIMIT_HAND_RANGE_POS.x?-LIMIT_HAND_RANGE_POS.x:LIMIT_HAND_RANGE_POS.x;
c.position.z=d.z>LIMIT_HAND_RANGE_POS.zMin&&d.z<LIMIT_HAND_RANGE_POS.zMax?d.z:d.z>LIMIT_HAND_RANGE_POS.zMin?LIMIT_HAND_RANGE_POS.zMax:LIMIT_HAND_RANGE_POS.zMin;d=s_oGameKeeper.convert3dPosTo2dScreen(c.position,s_oGameKeeper._oCamera);s_oGameKeeper._oGloves.setPosition(d.x,d.y);s_oGameKeeper._bPerfectSaved&&s_oGameKeeper.ballInHand(c.position)};
CGameGoalkeeperBase.prototype.ballInHand=function(d){var c=this._oScene.ballBody();c.position.x=d.x;c.position.y=d.y+.7*BALL_RADIUS;c.position.z=d.z;d=this.convert3dPosTo2dScreen(c.position,this._oCamera);var f=this._oBall.getStartScale()-d.z;this.shadowBall(c,f);this._oBall.setPosition(d.x,d.y)};
CGameGoalkeeperBase.prototype.convert2dScreenPosTo3d=function(d){d=new THREE.Vector3(d.x/s_iCanvasResizeWidth*2-1,2*-(d.y/s_iCanvasResizeHeight)+1,-1);d.unproject(this._oCamera);d.sub(this._oCamera.position);d.normalize();d.multiply(new THREE.Vector3(34,1,34));return d};
CGameGoalkeeperBase.prototype.convert3dPosTo2dScreen=function(d,c){var f=(new THREE.Vector3(d.x,d.y,d.z)).project(c),l=.5*Math.floor(s_iCanvasResizeWidth),a=.5*Math.floor(s_iCanvasResizeHeight);f.x=(f.x*l+l)*s_fInverseScaling;f.y=(-(f.y*a)+a)*s_fInverseScaling;return f};
CGameGoalkeeperBase.prototype.timeReset=function(){0<this._fTimeReset?this._fTimeReset-=FPS_TIME:!0!==this._bTurnEnded&&(this._bTurnEnded=!0,this._bGoal?this._iGoalOpponent++:this._iBallSaved++,s_oGame.endShotOpponent(this._bGoal,this._bKeeperSave),this.resetScene(),this._bLaunched=!1)};
CGameGoalkeeperBase.prototype.goalAnimation=function(d){500<d&&1E3>d?this.displayShock(INTENSITY_DISPLAY_SHOCK[0].time,INTENSITY_DISPLAY_SHOCK[0].x,INTENSITY_DISPLAY_SHOCK[0].y):999<d&&2E3>d?this.displayShock(INTENSITY_DISPLAY_SHOCK[1].time,INTENSITY_DISPLAY_SHOCK[1].x,INTENSITY_DISPLAY_SHOCK[1].y):1999<d&&3E3>d?this.displayShock(INTENSITY_DISPLAY_SHOCK[2].time,INTENSITY_DISPLAY_SHOCK[2].x,INTENSITY_DISPLAY_SHOCK[2].y):2999<d&&this.displayShock(INTENSITY_DISPLAY_SHOCK[3].time,INTENSITY_DISPLAY_SHOCK[3].x,
INTENSITY_DISPLAY_SHOCK[3].y)};
CGameGoalkeeperBase.prototype.displayShock=function(d,c,f){createjs.Tween.get(s_oGameKeeper._oContainerGame).to({x:Math.round(Math.random()*c),y:Math.round(Math.random()*f)},d).call(function(){createjs.Tween.get(s_oGameKeeper._oContainerGame).to({x:Math.round(Math.random()*c*.8),y:-Math.round(Math.random()*f*.8)},d).call(function(){createjs.Tween.get(s_oGameKeeper._oContainerGame).to({x:Math.round(Math.random()*c*.6),y:Math.round(Math.random()*f*.6)},d).call(function(){createjs.Tween.get(s_oGameKeeper._oContainerGame).to({x:Math.round(Math.random()*c*
.4),y:-Math.round(Math.random()*f*.4)},d).call(function(){createjs.Tween.get(s_oGameKeeper._oContainerGame).to({x:Math.round(Math.random()*c*.2),y:Math.round(Math.random()*f*.2)},d).call(function(){createjs.Tween.get(s_oGameKeeper._oContainerGame).to({y:0,x:0},d).call(function(){})})})})})})};CGameGoalkeeperBase.prototype.resetScene=function(){this._bKeeperSave=this._bBallOut=this._bGoal=this._bBallStoppedAfterLaunch=!1;this.resetBallPosition()};CGameGoalkeeperBase.prototype._onEnd=function(){this.onExit()};
CGameGoalkeeperBase.prototype.swapChildrenIndex=function(){if(this._bLaunched)for(var d=0;d<this._aObjects.length-1;d++)for(var c=d+1;c<this._aObjects.length;c++)this.sortDepth(this._aObjects[d],this._aObjects[c])};CGameGoalkeeperBase.prototype.rotateGuantes=function(){var d=(this._oGloves.getX()-CANVAS_WIDTH_HALF)*HAND_KEEPER_ANGLE_RATE;this._oGloves.setRotation(d)};
CGameGoalkeeperBase.prototype._updateBall2DPosition=function(){this._bPerfectSaved||(this.ballPosition(),this._oBall.rolls());this._bBallOut&&this._oBall.setVisible(!1);this._oCamera.updateProjectionMatrix();this._oCamera.updateMatrixWorld()};var CGameGoalkeeperSingle=function(d,c,f){CGameGoalkeeperBase.call(this,d,c,f);this._init(d,c,f)};CGameGoalkeeperSingle.prototype=Object.create(CGameGoalkeeperBase.prototype);
CGameGoalkeeperSingle.prototype._init=function(d,c,f){CGameGoalkeeperBase.prototype._init(d,c,f);this._startGame()};CGameGoalkeeperSingle.prototype._startGame=function(){s_oInterface.showHelpText(TEXT_HELP_KEEPER);this.pause(!1)};
CGameGoalkeeperSingle.prototype.pause=function(d){d?(this._iGameState=STATE_PAUSE,this._oOpponent&&this._oOpponent.stopAnimation(),this.deactiveEventListeners()):(this._iGameState=STATE_PLAY,this._oOpponent&&this._oOpponent.playAnimation(),this.activeEventListeners());createjs.Ticker.paused=d};
CGameGoalkeeperSingle.prototype.activeEventListeners=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.addImpulseToBall),window.addEventListener("mousemove",this.onHandKeeper)):(this._oStageMouseMove||(this._oStageMouseMove=s_oStage.on("stagemousemove",this.onHandKeeper)),this._oListenerClickStage=this._oContainerGame.on("click",this.clickStage))};
CGameGoalkeeperSingle.prototype.addImpulseToBall=function(){if(!this._bLaunched&&this._iGameState===STATE_PLAY){var d={x:Math.random()*(BALL_FORCE_X[this._iLevel-1]+BALL_FORCE_X[this._iLevel-1])-BALL_FORCE_X[this._iLevel-1],y:-this._iCurBallForceY,z:Math.random()*(BALL_FORCE_Z[this._iLevel-1].max-BALL_FORCE_Z[this._iLevel-1].min)+BALL_FORCE_Z[this._iLevel-1].min},c=this._oScene.ballBody();this._oScene.addImpulse(c,d);this._oScene.setElementAngularVelocity(c,{x:0,y:0,z:0});this._bLaunched=!0}};
CGameGoalkeeperSingle.prototype.startOpponentShot=function(){this._oOpponent.changeState("shot");this._oOpponent.fadeAnimation(1);this._oOpponent.onFinishAnimation();s_oInterface.hideHelpText()};CGameGoalkeeperSingle.prototype.goal=function(){this._bGoal||(this._bGoal=!0,this._fTimeReset=TIME_RESET_AFTER_GOAL,playSound("goal_keeper",1,!1))};
CGameGoalkeeperSingle.prototype.keeperSave=function(d){this._bGoal||this._bKeeperSave||(d.x>-BALL_SAVED_POINT.x&&d.x<BALL_SAVED_POINT.x&&d.z>-BALL_SAVED_POINT.z&&d.z<BALL_SAVED_POINT.z?(this._bPerfectSaved=!0,this._oBall.getPhysics().mass=0,this._fTimeReset=TIME_RESET_AFTER_PERFECT_KEEPER_SAVED,this._iPerfectBallSaved++,this._oGloves.changeState("perfect"),createjs.Tween.get(this._oContainerGame).wait(TIME_BALL_IN_HAND).call(function(){s_oGameKeeper._bPerfectSaved=!1;s_oGameKeeper._oBall.getPhysics().mass=
BALL_MASS;s_oGameKeeper._oGloves.changeState("normal")})):(this._bPerfectSaved=!1,this._fTimeReset=TIME_RESET_AFTER_KEEPER_SAVED),this._bKeeperSave=!0,playSound("kick",.65,!1),playSound("keep_ball",1,!1))};CGameGoalkeeperSingle.prototype._goalMiss=function(){this._bPostHit=this._bBallStoppedAfterLaunch=!0};CGameGoalkeeperSingle.prototype._ballOut=function(){this._bBallOut=!0};
CGameGoalkeeperSingle.prototype._checkBallState=function(){var d=this._oScene.ballBody();d.position.y<GOAL_LINE_POS.y&&!this._bGoal&&!this._bBallOut?this._ballOut():.01>d.velocity.lengthSquared()&&this._bLaunched&&!this._bBallStoppedAfterLaunch&&this._goalMiss()};
CGameGoalkeeperSingle.prototype._updatePlay=function(){for(var d=0;d<PHYSICS_ACCURACY;d++)this._oScene.update();this._updateBall2DPosition();(this._bKeeperSave||this._bGoal||this._bBallOut||this._bPostHit)&&this.timeReset();this.rotateGuantes();this.swapChildrenIndex();this._checkBallState()};CGameGoalkeeperSingle.prototype.update=function(){switch(this._iGameState){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};
var CGameGoalkeeperMulti=function(d,c,f){CGameGoalkeeperBase.call(this,d,c,f);this._init(d,c,f)};CGameGoalkeeperMulti.prototype=Object.create(CGameGoalkeeperBase.prototype);CGameGoalkeeperMulti.prototype._init=function(d,c,f){CGameGoalkeeperBase.prototype._init(d,c,f);this._startGame()};CGameGoalkeeperMulti.prototype._startGame=function(){s_oInterface.showGoalkeeperWaiting();this.pause(!1)};CGameGoalkeeperMulti.prototype.startCountDown=function(){};CGameGoalkeeperMulti.prototype.stopCountDown=function(){};
CGameGoalkeeperMulti.prototype.refreshPos=function(){};CGameGoalkeeperMulti.prototype.pause=function(d){d?(this._iGameState=STATE_PAUSE,this._oOpponent&&this._oOpponent.stopAnimation(),this.deactiveEventListeners()):(this._iGameState=STATE_PLAY,this._oOpponent&&this._oOpponent.playAnimation(),this.activeEventListeners());createjs.Ticker.paused=d};
CGameGoalkeeperMulti.prototype.activeEventListeners=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.addImpulseToBall,this),window.addEventListener("mousemove",this.onHandKeeper,this)):this._oStageMouseMove||(this._oStageMouseMove=s_oStage.on("stagemousemove",this.onHandKeeper,this))};
CGameGoalkeeperMulti.prototype.addImpulseToBall=function(){if(!this._bLaunched&&this._iGameState===STATE_PLAY){var d=Math.random()*(BALL_FORCE_X[7]+BALL_FORCE_X[7])-BALL_FORCE_X[7],c=Math.random()*(BALL_FORCE_Z[7].max-BALL_FORCE_Z[7].min)+BALL_FORCE_Z[7].min;this._iCurBallForceY=BALL_FORCE_Y[3];d={x:d,y:-this._iCurBallForceY,z:c};c=this._oScene.ballBody();this._oScene.addImpulse(c,d);this._oScene.setElementAngularVelocity(c,{x:0,y:0,z:0});this._bLaunched=!0}};
CGameGoalkeeperMulti.prototype.remoteStartOpponentShot=function(d){this._iShootState=SHOOT_STATE_ANIM;s_oInterface.hideGoalkeeperWaiting();this._oOpponent.changeState("shot");this._oOpponent.fadeAnimation(1);d=this._getAdjustedStrikerLaunch(d);this._oOpponent.onRemoteFinishAnimation(d);s_oInterface.hideHelpText()};
CGameGoalkeeperMulti.prototype.addRemoteImpulseToBall=function(d){if(!this._bLaunched&&this._iGameState===STATE_PLAY){this._vHitDir=d;var c=this._oScene.ballBody();this._oScene.addImpulse(c,d);this._oScene.setElementAngularVelocity(c,{x:0,y:0,z:0});this._bLaunched=!0}};
CGameGoalkeeperMulti.prototype._getAdjustedStrikerLaunch=function(d){var c=-d.x,f=d.z;d=-linearFunction(f,0,STRIKER_GOAL_SHOOTAREA.zmax*d.y,GOALKEEPER_SHOOTPOWER_LIMITS.min,GOALKEEPER_SHOOTPOWER_LIMITS.min);c=linearFunction(c,STRIKER_GOAL_SHOOTAREA.lx,STRIKER_GOAL_SHOOTAREA.rx,GOALKEEPER_GOAL_SHOOTAREA.lx,GOALKEEPER_GOAL_SHOOTAREA.rx);f=linearFunction(f,0,STRIKER_GOAL_SHOOTAREA.zmax,0,GOALKEEPER_GOAL_SHOOTAREA.z);return{x:c,y:d,z:f}};
CGameGoalkeeperMulti.prototype.goal=function(){if(!this._bGoal){this._bGoal=!0;this._fTimeReset=TIME_RESET_AFTER_GOAL;playSound("goal_keeper",1,!1);var d=this;this._iIDTimeout=setTimeout(function(){d._setResult()},1E3)}};
CGameGoalkeeperMulti.prototype.keeperSave=function(d){if(!this._bGoal&&!this._bKeeperSave){if(d.x>-BALL_SAVED_POINT.x&&d.x<BALL_SAVED_POINT.x&&d.z>-BALL_SAVED_POINT.z&&d.z<BALL_SAVED_POINT.z){this._bPerfectSaved=!0;this._oBall.getPhysics().mass=0;this._fTimeReset=TIME_RESET_AFTER_PERFECT_KEEPER_SAVED;this._iPerfectBallSaved++;this._oGloves.changeState("perfect");var c=this;createjs.Tween.get(this._oContainerGame).wait(TIME_BALL_IN_HAND).call(function(){c._bPerfectSaved=!1;c._oBall.getPhysics().mass=
BALL_MASS;c._oGloves.changeState("normal")})}else this._bPerfectSaved=!1,this._fTimeReset=TIME_RESET_AFTER_KEEPER_SAVED;this._bKeeperSave=!0;playSound("kick",.65,!1);playSound("keep_ball",1,!1)}};CGameGoalkeeperMulti.prototype._ballStopped=function(){this._bBallStoppedAfterLaunch=!0;this._setResult()};CGameGoalkeeperMulti.prototype._ballOut=function(){this._bBallOut=!0;this._setResult()};
CGameGoalkeeperMulti.prototype._setResult=function(){var d={};d[MSG_GOALKEEPER_SAVES]={result:this._bGoal?GOALKEEPER_RESULTS_GOAL:this._bBallOut?GOALKEEPER_RESULTS_BALLOUT:this._bKeeperSave?GOALKEEPER_RESULTS_SAVED:GOALKEEPER_RESULTS_POSTHIT,dir:this._vHitDir};s_oNetworkManager.sendMsg(MSG_GOALKEEPER_SAVES,JSON.stringify(d));this._bGoal?this._iGoalOpponent++:this._iBallSaved++};
CGameGoalkeeperMulti.prototype.endTurn=function(){s_oGame.endShotOpponent(this._bGoal,this._bKeeperSave);this._bLaunched=!1;this.resetScene()};CGameGoalkeeperMulti.prototype._checkBallState=function(){var d=this._oScene.ballBody();d.position.y<GOAL_LINE_POS.y&&!this._bGoal&&!this._bBallOut?this._ballOut():.3>d.velocity.lengthSquared()&&(!this._bLaunched||this._bBallStoppedAfterLaunch||this._bBallOut||this._bGoal||this._ballStopped())};
CGameGoalkeeperMulti.prototype._updatePlay=function(){for(var d=0;d<PHYSICS_ACCURACY;d++)this._oScene.update();this._updateBall2DPosition();this.rotateGuantes();this.swapChildrenIndex();this._checkBallState()};CGameGoalkeeperMulti.prototype.update=function(){switch(this._iGameState){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};var CGameGoalkeeperSingleWithBot=function(d,c,f){CGameGoalkeeperSingle.call(this,d,c,f)};CGameGoalkeeperSingleWithBot.prototype=Object.create(CGameGoalkeeperSingle.prototype);
CGameGoalkeeperSingleWithBot.prototype._startGame=function(){s_oInterface.showGoalkeeperWaiting();this.pause(!1);setTimeout(function(){s_oGameKeeper.startOpponentShot()},2E3+2E3*Math.random())};CGameGoalkeeperSingleWithBot.prototype.activeEventListeners=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.addImpulseToBall),window.addEventListener("mousemove",this.onHandKeeper)):this._oStageMouseMove||(this._oStageMouseMove=s_oStage.on("stagemousemove",this.onHandKeeper))};
CGameGoalkeeperSingleWithBot.prototype.startOpponentShot=function(){s_oGameKeeper._oOpponent.changeState("shot");s_oGameKeeper._oOpponent.fadeAnimation(1);s_oGameKeeper._oOpponent.onFinishAnimation();s_oInterface.hideGoalkeeperWaiting()};CGameGoalkeeperSingleWithBot.prototype.goal=function(){this._bGoal||(this._bGoal=!0,this._fTimeReset=4*TIME_RESET_AFTER_GOAL,playSound("goal_keeper",1,!1))};
CGameGoalkeeperSingleWithBot.prototype.keeperSave=function(d){this._bGoal||this._bKeeperSave||(d.x>-BALL_SAVED_POINT.x&&d.x<BALL_SAVED_POINT.x&&d.z>-BALL_SAVED_POINT.z&&d.z<BALL_SAVED_POINT.z?(this._bPerfectSaved=!0,this._oBall.getPhysics().mass=0,this._fTimeReset=2*TIME_RESET_AFTER_PERFECT_KEEPER_SAVED,this._iPerfectBallSaved++,this._oGloves.changeState("perfect"),createjs.Tween.get(this._oContainerGame).wait(TIME_BALL_IN_HAND).call(function(){s_oGameKeeper._bPerfectSaved=!1;s_oGameKeeper._oBall.getPhysics().mass=
BALL_MASS;s_oGameKeeper._oGloves.changeState("normal")})):(this._bPerfectSaved=!1,this._fTimeReset=3*TIME_RESET_AFTER_KEEPER_SAVED),this._bKeeperSave=!0,playSound("kick",.65,!1),playSound("keep_ball",1,!1))};CGameGoalkeeperSingleWithBot.prototype._updatePlay=function(){for(var d=0;d<PHYSICS_ACCURACY;d++)this._oScene.update();this._updateBall2DPosition();(this._bKeeperSave||this._bGoal||this._bBallOut||this._bBallStoppedAfterLaunch)&&this.timeReset();this.rotateGuantes();this.swapChildrenIndex();this._checkBallState()};
CGameGoalkeeperSingleWithBot.prototype.update=function(){switch(this._iGameState){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}};
function CGloves(d,c,f,l,a){var e;this._init=function(k,g,m){var n=new createjs.SpriteSheet({images:[m],frames:{width:m.width/2,height:m.height,regX:m.width/2/2,regY:m.height/2},animations:{normal:[0],perfect:[1]}});e=createSprite(n,"normal",m.width/2/2,m.height/2,m.width/2,m.height);this.setPosition(k,g);h.addChild(e)};this.unload=function(){h.removeChild(e)};this.setPosition=function(k,g){e.x=k;e.y=g};this.getObject=function(){return e};this.getDepthPos=function(){return b.position.y};this.getX=
function(){return e.x};this.getY=function(){return e.y};this.changeState=function(k){e.gotoAndStop(k)};this.getPhysics=function(){return b};this.setRotation=function(k){e.rotation=k};var b=l;var h=a;this._init(d,c,f);return this}
function CGoalGoalkeeper(d,c,f,l,a){var e;this._init=function(k,g,m){e=createBitmap(m);this.setPosition(k,g);h.addChild(e)};this.unload=function(){h.removeChild(e)};this.setPosition=function(k,g){e.x=k;e.y=g};this.getObject=function(){return e};this.getDepthPos=function(){return b.position.y};this.getPhysics=function(){return b};this.getX=function(){return e.x};this.getY=function(){return e.y};var b=l;var h=a;this._init(d,c,f);return this}
function COpponent(d,c,f,l){var a,e;this._init=function(b,h,k,g){e=g;k=new createjs.SpriteSheet({images:[k],frames:{width:154,height:144,regX:77,regY:144},animations:{start:0,shot:[0,44,"stay",30/FPS],stay:[45,79,"remain",30/FPS],remain:[79]}});a=createSprite(k,"start",77,144,154,144);a.scaleX=a.scaleY=.9;a.x=b;a.y=h;e.addChild(a)};this.getX=function(){return a.x};this.getY=function(){return a.y};this.setPosition=function(b,h){null!==b&&(a.x=b);null!==h&&(a.y=h)};this.rotate=function(b){a.scaleX=
b};this.setVisible=function(b){a.visible=b};this.changeState=function(b){a.gotoAndPlay(b)};this.stopAnimation=function(){a.stop()};this.playAnimation=function(){a.play()};this.onFinishAnimation=function(){a.on("animationend",function(){s_oGameKeeper.addImpulseToBall();playSound("kick",.3,!1);a.removeAllEventListeners()})};this.onRemoteFinishAnimation=function(b){a.on("animationend",function(){s_oGameKeeper.addRemoteImpulseToBall(b);playSound("kick",.3,!1);a.removeAllEventListeners()})};this.fadeAnimation=
function(b){createjs.Tween.get(a).to({alpha:b},500)};this.removeTweens=function(){createjs.Tween.removeTweens(a)};this._init(d,c,f,l);return this}
function CScenarioKeeper(){var d,c,f,l,a,e,b,h,k,g,m,n,q,p,u,r,t,v,x,y,A,D,M;SHOW_3D_RENDER&&(M=new CANNON.Demo);this.getDemo=function(){return M};this._init=function(){d=SHOW_3D_RENDER?M.getWorld():new CANNON.World;d.gravity.set(0,0,-9.81);d.broadphase=new CANNON.NaiveBroadphase;d.solver.iterations=50;d.solver.tolerance=1E-5;c=new CANNON.Material;f=new CANNON.Material;l=new CANNON.Material;a=new CANNON.Material;var L=new CANNON.ContactMaterial(f,l,{friction:.1,restitution:.5}),F=new CANNON.ContactMaterial(f,
c,{friction:.2,restitution:.3}),E=new CANNON.ContactMaterial(f,a,{friction:.5,restitution:.1});d.addContactMaterial(L);d.addContactMaterial(F);d.addContactMaterial(E);s_oScenario._createBallBody();s_oScenario._createFieldBody();s_oScenario._createGoal();s_oScenario.createBackGoalWall();s_oScenario.createLineOfGoal();s_oScenario.createHandGoalKeeper()};this._createFieldBody=function(){k=new CANNON.Plane;g=new CANNON.Body({mass:0,material:c});g.addShape(k);g.position.z=-10;g.addEventListener("collide",
function(L){s_oScenario.fieldCollision()});d.addBody(g);SHOW_3D_RENDER&&M.addVisual(g)};this._createGoal=function(){m=new CANNON.Cylinder(POLE_RIGHT_LEFT_SIZE.radius_top,POLE_RIGHT_LEFT_SIZE.radius_bottom,POLE_RIGHT_LEFT_SIZE.height,POLE_RIGHT_LEFT_SIZE.segments);q=new CANNON.Body({mass:0});n=new CANNON.Cylinder(POLE_UP_SIZE.radius_top,POLE_UP_SIZE.radius_bottom,POLE_UP_SIZE.height,POLE_UP_SIZE.segments);var L=new CANNON.Quaternion;L.setFromAxisAngle(new CANNON.Vec3(0,1,0),Math.PI/2);n.transformAllPoints(new CANNON.Vec3,
L);q.addShape(m,new CANNON.Vec3(.5*POLE_UP_SIZE.height,0,0));q.addShape(m,new CANNON.Vec3(.5*-POLE_UP_SIZE.height,0,0));q.addShape(n,new CANNON.Vec3(0,0,.5*POLE_RIGHT_LEFT_SIZE.height));q.position.set(GOAL_POSITION.x,GOAL_POSITION.y,GOAL_POSITION.z);q.addEventListener("collide",function(F){s_oScenario.poleCollision()});d.addBody(q);SHOW_3D_RENDER&&M.addVisual(q)};this.createBackGoalWall=function(){p=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));
u=new CANNON.Box(new CANNON.Vec3(LEFT_RIGHT_WALL_GOAL_SIZE.width,LEFT_RIGHT_WALL_GOAL_SIZE.depth,LEFT_RIGHT_WALL_GOAL_SIZE.height));r=new CANNON.Box(new CANNON.Vec3(UP_WALL_GOAL_SIZE.width,UP_WALL_GOAL_SIZE.depth,UP_WALL_GOAL_SIZE.height));t=new CANNON.Body({mass:0,material:l});t.addShape(p);t.addShape(u,new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,0,0));t.addShape(u,new CANNON.Vec3(-BACK_WALL_GOAL_SIZE.width,0,0));t.addShape(r,new CANNON.Vec3(0,0,BACK_WALL_GOAL_SIZE.height));t.addEventListener("collide",
function(L){s_oScenario.goalCollision(L)});t.position.set(BACK_WALL_GOAL_POSITION.x,BACK_WALL_GOAL_POSITION.y,BACK_WALL_GOAL_POSITION.z);d.addBody(t)};this.createLineOfGoal=function(){v=new CANNON.Box(new CANNON.Vec3(BACK_WALL_GOAL_SIZE.width,BACK_WALL_GOAL_SIZE.depth,BACK_WALL_GOAL_SIZE.height));x=new CANNON.Body({mass:0});x.addShape(v);x.position.set(GOAL_LINE_POS.x,GOAL_LINE_POS.y,GOAL_LINE_POS.z);x.collisionResponse=0;x.addEventListener("collide",function(L){s_oScenario.lineGoalCollision()});
d.addBody(x)};this.createHandGoalKeeper=function(){y=new CANNON.Box(new CANNON.Vec3(HAND_KEEPER_SIZE.width,HAND_KEEPER_SIZE.depth,HAND_KEEPER_SIZE.height));A=new CANNON.Body({mass:0,material:a});A.addShape(y);A.position.set(HAND_KEEPER_POSITION.x,HAND_KEEPER_POSITION.y,HAND_KEEPER_POSITION.z);A.addEventListener("collide",function(L){s_oScenario.handCollision(L)});d.addBody(A);SHOW_3D_RENDER&&(D=M.addVisual(A))};this._createBallBody=function(){e=new CANNON.Sphere(BALL_RADIUS);b=new CANNON.Body({mass:BALL_MASS,
material:f,linearDamping:BALL_LINEAR_DAMPING,angularDamping:2*BALL_LINEAR_DAMPING});var L=new CANNON.Vec3(POSITION_BALL.x,POSITION_BALL.y,POSITION_BALL.z);b.position.copy(L);b.addShape(e);d.add(b);SHOW_3D_RENDER&&(h=M.addVisual(b))};this.addImpulse=function(L,F){var E=new CANNON.Vec3(0,0,BALL_RADIUS),H=new CANNON.Vec3(F.x,F.y,F.z);L.applyImpulse(H,E)};this.addForce=function(L,F){var E=new CANNON.Vec3(0,0,0),H=new CANNON.Vec3(F.x,F.y,F.z);L.applyForce(H,E)};this.getBodyVelocity=function(L){return L.velocity};
this.ballBody=function(){return b};this.ballMesh=function(){return h};this.getCamera=function(){return M.camera()};this.fieldCollision=function(){s_oGameKeeper.ballFadeForReset();!1===s_oInterface.isHelpTextVisible()&&playSound("drop_bounce_grass",1,!1)};this.collisionWithBall=function(){s_oGameKeeper.lineGoalCollision()};this.setElementAngularVelocity=function(L,F){L.angularVelocity.set(F.x,F.y,F.z)};this.setElementVelocity=function(L,F){var E=new CANNON.Vec3(F.x,F.y,F.z);L.velocity=E};this.setElementLinearDamping=
function(L,F){L.linearDamping=F};this.getFieldBody=function(){return g};this.lineGoalCollision=function(){s_oGameKeeper.goal()};this.handCollision=function(L){s_oGameKeeper.keeperSave(L.contact.rj)};this.update=function(){d.step(PHYSICS_STEP)};this.getHandKeeperBody=function(){return A};this.getHandKeeperMesh=function(){return D};this.getGoalBody=function(){return q};this.goalCollision=function(L){s_oGameKeeper.goalAnimation(L.body.velocity.x*L.body.velocity.x+L.body.velocity.y*L.body.velocity.y)};
this.poleCollision=function(){playSound("kick",1,!1)};this.destroyWorld=function(){for(var L=d.bodies,F=[],E=0;E<L.length;E++)F[E]=L[E];L=L.length;for(E=0;E<L;E++)d.removeBody(F[E]);d=null};s_oScenario=this;SHOW_3D_RENDER?(M.addScene("Test",this._init),M.start()):this._init()}
function CButLang(d,c,f,l,a,e){var b,h,k=l,g,m,n,q,p,u;this._init=function(r,t,v,x){h=b=64;g=[];m=[];u=new createjs.Container;u.x=r;u.y=t;q=u.on("mousedown",this._onPress,this);n=u.on("click",this._onChangeLang,this);e.addChild(u);r={};for(t=0;t<v;t++)r["lang_"+t]=t;v=new createjs.SpriteSheet({images:[x],frames:{width:b,height:h},animations:r});p=createSprite(v,"lang_"+k,0,0,b,h);u.addChild(p);u.regX=b/2;u.regY=h/2};this.unload=function(){u.off("mousedown",q);u.off("click",n)};this.addEventListener=
function(r,t,v){g[r]=t;m[r]=v};this.setPosition=function(r,t){u.x=r;u.y=t};this.setLang=function(r){k=r;p.gotoAndStop("lang_"+k)};this._onPress=function(){u.scale=.9};this._onChangeLang=function(){u.scale=1;g[ON_SELECT_LANG]&&g[ON_SELECT_LANG].call(m[ON_SELECT_LANG],k)};this.getWidth=function(){return b};this.getHeight=function(){return h};this.getContainer=function(){return u};this._init(d,c,f,a)}var NUM_ITEMS_PER_COLS=5;
function CLangPanel(d){var c,f,l,a,e,b,h,k,g,m,n,q=this;this._init=function(){c=[];f=[];n=new createjs.Container;n.visible=!1;d.addChild(n);k=new createjs.Shape;k.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e=k.on("click",function(){});n.addChild(k);g=new createjs.Container;g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT/2+20;n.addChild(g);b=s_oSpriteLibrary.getSprite("msg_box_small");var p=createBitmap(b);g.addChild(p);this._placeLanguages();h=new CGfxButton(b.width-40,40,s_oSpriteLibrary.getSprite("but_exit"),
g);h.addEventListener(ON_MOUSE_UP,this.hide,this);g.regX=b.width/2;g.regY=b.height/2};this.unload=function(){h.unload();k.off("click",e);for(var p=0;p<l.length;p++)l[p].off("click",a[p])};this.addEventListener=function(p,u,r){c[p]=u;f[p]=r};this.show=function(){n.visible=!0;k.alpha=0;createjs.Tween.get(k).to({alpha:.7},400,createjs.Ease.cubicOut);g.scaleX=g.scaleY=.01;g.alpha=0;createjs.Tween.get(g).wait(400).to({scale:1,alpha:1},1E3,createjs.Ease.elasticOut).call(function(){})};this.hide=function(){createjs.Tween.get(k).to({alpha:0},
400,createjs.Ease.cubicOut);createjs.Tween.get(g).to({scaleX:.1,scaleY:.1,alpha:.5},400,createjs.Ease.backIn).call(function(){n.visible=!1})};this._placeLanguages=function(){m=new createjs.Container;m.x=b.width/2;m.y=b.height/2;g.addChild(m);for(var p=s_oSpriteLibrary.getSprite("but_lang"),u={},r=0;r<NUM_LANGUAGES;r++)u["lang_"+r]=r;u=new createjs.SpriteSheet({images:[p],frames:{width:64,height:64,regX:32,regY:32},animations:u});var t=r=0;l=[];a=[];for(var v=0,x=0;x<NUM_LANGUAGES;x++){var y=createSprite(u,
"lang_"+x,32,32,64,64);y.x=r;y.y=t;y.on("mousedown",this._onPressLang,this,!1,x);a[x]=y.on("click",this._onSelectLang,this,!1,x);m.addChild(y);l.push(y);v++;0<x&&0===v%NUM_ITEMS_PER_COLS?(r=0,t+=p.height/2+10):r+=74}m.regX=r/2+32;m.regY=t/2;m.scale=.8};this._onPressLang=function(p,u){l[u].scale=.9};this._onSelectLang=function(p,u){l[u].scale=1;c[ON_SELECT_LANG]&&c[ON_SELECT_LANG].call(f[ON_SELECT_LANG],u);q.hide()};this._init()}
function CGuiController(d,c,f){var l,a,e,b,h,k,g,m,n,q,p,u,r,t,v,x;this._init=function(y,A){l={x:y,y:A,width:0,height:0};n=new createjs.Container;n.x=l.x;n.y=l.y;f.addChild(n);a={x:CANVAS_WIDTH,y:A,width:0,height:0};q=new createjs.Container;q.x=a.x;q.y=a.y;f.addChild(q);e={x:CANVAS_WIDTH/2,y:A,width:0,height:0};p=new createjs.Container;p.x=e.x;p.y=e.y;f.addChild(p);b={x:y,y:CANVAS_HEIGHT-A,width:0,height:0};u=new createjs.Container;u.x=b.x;u.y=b.y;f.addChild(u);h={x:CANVAS_WIDTH,y:CANVAS_HEIGHT-A,
width:0,height:0};r=new createjs.Container;r.x=h.x;r.y=h.y;f.addChild(r);k={x:CANVAS_WIDTH/2,y:CANVAS_HEIGHT-A,width:0,height:0};t=new createjs.Container;t.x=k.x;t.y=k.y;f.addChild(t);g={x:y,y:CANVAS_HEIGHT/2,width:0,height:0};v=new createjs.Container;v.x=g.x;v.y=g.y;f.addChild(v);m={x:CANVAS_WIDTH,y:CANVAS_HEIGHT/2,width:0,height:0};x=new createjs.Container;x.x=m.x;x.y=m.y;f.addChild(x)};this.refreshPos=function(){t.y=k.y-s_iOffsetY;u.x=b.x+s_iOffsetX;u.y=b.y-s_iOffsetY;r.x=h.x-s_iOffsetX;r.y=h.y-
s_iOffsetY;p.y=e.y+s_iOffsetY;n.x=l.x+s_iOffsetX;n.y=l.y+s_iOffsetY;q.x=a.x-s_iOffsetX;q.y=a.y+s_iOffsetY;v.x=g.x+s_iOffsetX;x.x=m.x-s_iOffsetX};this.addTopLeft=function(y,A){var D=y.getContainer();0<n.numChildren?(D.x=A?y.getWidth()/2:0,D.x+=l.width):D.x=A?y.getWidth()/2:0;D.y=A?y.getHeight()/2:0;n.addChild(D);l.width+=y.getWidth()+d};this.addTopCenter=function(y,A){var D=y.getContainer();0<p.numChildren?(D.x=A?y.getWidth()/2:0,D.x+=a.width):D.x=A?y.getWidth()/2:0;D.y=A?y.getHeight()/2:0;p.addChild(D);
e.width+=y.getWidth()+d;p.regX=e.width/2};this.addTopRight=function(y,A){var D=y.getContainer();0<q.numChildren?(D.x=A?y.getWidth()/2:0,D.x+=a.width):D.x=A?y.getWidth()/2:0;D.y=A?y.getHeight()/2:0;q.addChild(D);a.width+=y.getWidth()+d;q.regX=a.width};this.addMiddleLeft=function(y,A){var D=y.getContainer();0<v.numChildren?(D.x=A?y.getWidth()/2:0,D.x+=g.width):D.x=A?y.getWidth()/2:0;v.addChild(D);g.width+=y.getWidth()+d};this.addMiddleRight=function(y,A){var D=y.getContainer();0<x.numChildren?(D.x=
A?y.getWidth()/2:0,D.x+=m.width):D.x=A?y.getWidth()/2:0;D.y=A?y.getHeight()/2:0;x.addChild(D);m.width+=y.getWidth()+d;x.regX=m.width};this.addDownLeft=function(y,A){var D=y.getContainer();0<u.numChildren?(D.x=A?y.getWidth()/2:0,D.x+=b.width,D.y=A?y.getHeight()/2:0):(D.x=A?y.getWidth()/2:0,D.y=A?y.getHeight()/2:0,b.height=y.getHeight(),u.regY=b.height);u.addChild(D);b.width+=y.getWidth()+d};this.addDownCenter=function(y,A){var D=y.getContainer();0<t.numChildren?(D.x=A?y.getWidth()/2:0,D.x+=k.width,
D.y=A?y.getHeight()/2:0):(D.x=A?y.getWidth()/2:0,D.y=A?y.getHeight()/2:0,k.height=y.getHeight(),t.regY=k.height);t.addChild(D);k.width+=y.getWidth()+d;r.regX=k.width};this.addDownRight=function(y,A){var D=y.getContainer();0<u.numChildren?(D.x=A?y.getWidth()/2:0,D.x+=h.width,D.y=A?y.getHeight()/2:0):(D.x=A?y.getWidth()/2:0,D.y=A?y.getHeight()/2:0,h.height=y.getHeight(),r.regY=h.height);r.addChild(D);h.width+=y.getWidth()+d;r.regX=h.width};this._init(d,c)};